!function(g){function I(A){if(C[A])return C[A].exports;var n=C[A]={i:A,l:!1,exports:{}};return g[A].call(n.exports,n,n.exports,I),n.l=!0,n.exports}var C={};return I.m=g,I.c=C,I.i=function(g){return g},I.d=function(g,C,A){I.o(g,C)||Object.defineProperty(g,C,{configurable:!1,enumerable:!0,get:A})},I.n=function(g){var C=g&&g.__esModule?function(){return g.default}:function(){return g};return I.d(C,"a",C),C},I.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},I.p="",I(I.s=74)}({1:function(module,exports){eval('module.exports = Element;\r\nfunction Element(jtopo) {\r\n    if (jtopo) {\r\n        this.jtopo = jtopo;\r\n        jtopo.qtopo = this;\r\n    }\r\n    if (!this.attr.jsonId) {\r\n        this.attr.jsonId = QTopo.util.makeId();\r\n    }\r\n    //设置额外属性处理对象\r\n    this.extra = {};\r\n}\r\n\r\nElement.prototype.setJsonId = function (id) {\r\n    this.attr.jsonId = id;\r\n};\r\nElement.prototype.show = function () {\r\n    switch (this.getType()) {\r\n        case QTopo.constant.NODE:\r\n            toggleNode.call(this, true);\r\n            break;\r\n        case QTopo.constant.CONTAINER:\r\n            toggleContainer.call(this, true);\r\n            break;\r\n        case QTopo.constant.LINK:\r\n            toggleLink.call(this, true);\r\n    }\r\n};\r\nElement.prototype.hide = function () {\r\n    switch (this.getType()) {\r\n        case QTopo.constant.NODE:\r\n            toggleNode.call(this, false);\r\n            break;\r\n        case QTopo.constant.CONTAINER:\r\n            toggleContainer.call(this, false);\r\n            break;\r\n        case QTopo.constant.LINK:\r\n            toggleLink.call(this, false);\r\n    }\r\n};\r\nElement.prototype.setUseType = function (type) {\r\n    this.attr.useType = type;\r\n};\r\nElement.prototype.getUseType = function () {\r\n    return this.attr.useType;\r\n};\r\nElement.prototype.setText = function (text) {\r\n    if (text) {\r\n        this.jtopo.text = (text + "").trim();\r\n    }\r\n    this.attr.text = this.jtopo.text;\r\n};\r\nElement.prototype.setBorder = function (border) {\r\n    var jtopo = this.jtopo;\r\n    if (border.color) {\r\n        jtopo.borderColor = QTopo.util.transHex(border.color.toLowerCase());\r\n    }\r\n    if ($.isNumeric(border.width)) {\r\n        jtopo.borderWidth = parseInt(border.width);\r\n    }\r\n    if ($.isNumeric(border.radius)) {\r\n        jtopo.borderRadius = parseInt(border.radius);\r\n    }\r\n    this.attr.border.color = jtopo.borderColor;\r\n    this.attr.border.width = jtopo.borderWidth;\r\n    this.attr.border.radius = jtopo.borderRadius;\r\n};\r\nElement.prototype.on = function (name, fn) {\r\n    this.jtopo.addEventListener(name, function (e) {\r\n        if (e.target && e.target.qtopo) {\r\n            fn(e, e.target.qtopo);\r\n        } else {\r\n            fn(e);\r\n        }\r\n    });\r\n};\r\nElement.prototype.off = function (name, fn) {\r\n    this.jtopo.removeEventListener(name);\r\n};\r\nElement.prototype.setZIndex = function (zIndex) {\r\n    if ($.isNumeric(zIndex)) {\r\n        this.jtopo.zIndex = parseInt(zIndex);\r\n    }\r\n    this.attr.zIndex = this.jtopo.zIndex;\r\n};\r\nElement.prototype.setFont = function (font) {\r\n    var type = this.attr.font.type;\r\n    var size = this.attr.font.size;\r\n    if (font) {\r\n        if ($.isNumeric(font.size)) {\r\n            size = font.size;\r\n        }\r\n        if (font.type) {\r\n            type = font.type;\r\n        }\r\n        this.jtopo.font = (size ? size : 14) + "px " + type;\r\n        if (font.color) {\r\n            this.jtopo.fontColor = QTopo.util.transHex(font.color.toLowerCase());\r\n        }\r\n    }\r\n    this.attr.font.type = type;\r\n    this.attr.font.size = size;\r\n    this.attr.font.color = this.jtopo.fontColor;\r\n};\r\nElement.prototype.setAlpha = function (alpha) {\r\n    if ($.isNumeric(alpha) && alpha <= 1 && alpha > 0) {\r\n        this.jtopo.alpha = alpha;\r\n    } else {\r\n        this.jtopo.alpha = 1;\r\n    }\r\n    this.attr.alpha = this.jtopo.alpha;\r\n};\r\n//已重写同步\r\nElement.prototype.setPosition = function (position) {\r\n    if ($.isArray(position) && position.length >= 2) {\r\n        if ($.isNumeric(position[0]) && $.isNumeric(position[1])) {\r\n            this.jtopo.setLocation(parseInt(position[0]), parseInt(position[1]));\r\n        }\r\n    }\r\n};\r\nElement.prototype.setSize = function (size) {\r\n    if ($.isArray(size) && $.isNumeric(size[0]) && $.isNumeric(size[1])) {\r\n        this.jtopo.setSize(parseInt(size[0]), parseInt(size[1]));\r\n    } else {\r\n        this.jtopo.setSize(64, 64);\r\n    }\r\n    this.attr.size = [this.jtopo.width, this.jtopo.height];\r\n};\r\nElement.prototype.setDragable = function (dragable) {\r\n    if (typeof dragable == \'boolean\') {\r\n        this.jtopo.dragable = dragable;\r\n    }\r\n    this.attr.dragable = this.jtopo.dragable;\r\n};\r\nElement.prototype.setNamePosition = function (namePosition) {\r\n    var jtopo = this.jtopo;\r\n    jtopo.text = this.attr.name || "";\r\n    switch (namePosition) {\r\n        case \'hide\':\r\n            jtopo.text = \'\';\r\n            this.attr.namePosition = "hide";\r\n            break;\r\n        case \'bottom\':\r\n            jtopo.textOffsetX = 0;\r\n            jtopo.textOffsetY = 0;\r\n            jtopo.textPosition = "Bottom_Center";\r\n            this.attr.namePosition = "bottom";\r\n            break;\r\n        case \'top\':\r\n            jtopo.textOffsetX = 0;\r\n            jtopo.textOffsetY = 0;\r\n            jtopo.textPosition = "Top_Center";\r\n            this.attr.namePosition = "top";\r\n            break;\r\n        case \'left\':\r\n            jtopo.textOffsetX = -5;\r\n            jtopo.textOffsetY = 0;\r\n            jtopo.textPosition = "Middle_Left";\r\n            this.attr.namePosition = "left";\r\n            break;\r\n        case \'right\':\r\n            jtopo.textOffsetX = 5;\r\n            jtopo.textOffsetY = 0;\r\n            jtopo.textPosition = "Middle_Right";\r\n            this.attr.namePosition = "right";\r\n            break;\r\n        case "center":\r\n            jtopo.textOffsetX = 0;\r\n            jtopo.textOffsetY = 0;\r\n            jtopo.textPosition = "Middle_Center";\r\n            this.attr.namePosition = "center";\r\n            break;\r\n        default:\r\n            jtopo.textOffsetX = 0;\r\n            jtopo.textOffsetY = 0;\r\n            jtopo.textPosition = \'Bottom_Center\';\r\n            this.attr.namePosition = "bottom";\r\n            QTopo.util.error(this, "set wrong namePosition,default is bottom");\r\n            break;\r\n    }\r\n};\r\n//只要对应属性有方法则修改\r\nElement.prototype._setAttr = function (config) {\r\n    var self = this;\r\n    $.each(config, function (k, v) {\r\n        try {\r\n            var fn = self[\'set\' + QTopo.util.upFirst(k)];\r\n            if (fn) {\r\n                fn.call(self, v);\r\n            }\r\n        } catch (e) {\r\n            QTopo.util.error(self, "Element _setAttr error :" + k, e);\r\n        }\r\n    });\r\n};\r\nElement.prototype.get = function (name) {\r\n    return this.attr[name];\r\n};\r\nElement.prototype.val = function (key, value) {\r\n    if (QTopo.util.getClass(key) == \'Object\') {\r\n        var self = this;\r\n        $.each(key, function (name, value) {\r\n            self.extra[name] = value;\r\n        })\r\n    } else {\r\n        if (typeof value == \'undefined\') {\r\n            var result;\r\n            if (this.extra[key]) {\r\n                result = this.extra[key];\r\n            } else if (this.attr[key]) {\r\n                result = this.attr[key];\r\n            } else {\r\n                result = this[key];\r\n            }\r\n            return result;\r\n        } else {\r\n            this.extra[key] = value;\r\n        }\r\n    }\r\n};\r\n/*\r\n * 对象links属性内的所有线进行切换\r\n *@links node/container的links属性\r\n * @fnName \'show\'/\'hide\'方法名\r\n */\r\nfunction toggle(links, fnName) {\r\n    try {\r\n        $.each(links, function (name, arr) {\r\n            arr.forEach(function (item) {\r\n                item[fnName]();\r\n            });\r\n        })\r\n    } catch (e) {\r\n        QTopo.util.error("切换隐藏/显示时错误", e);\r\n    }\r\n}\r\n//线的显示只有当其两端节点都显示时才显示\r\nfunction toggleLink(flag) {\r\n    if (flag) {\r\n        if (this.path.start.jtopo && this.path.end.jtopo) {\r\n            if (this.path.start.jtopo.visible && this.path.end.jtopo.visible) {\r\n                this.jtopo.visible = true;\r\n            }\r\n        }\r\n    } else {\r\n        this.jtopo.visible = false;\r\n    }\r\n}\r\nfunction toggleNode(flag) {\r\n    this.jtopo.visible = flag;\r\n    var string = flag ? "show" : "hide";\r\n    toggle(this.links, string);\r\n}\r\nfunction toggleContainer(flag) {\r\n    this.jtopo.visible = flag;\r\n    var string = flag ? "show" : "hide";\r\n    //切换子类显示隐藏\r\n    for (var i = 0; i < this.children.length; i++) {\r\n        this.children[i][string]();\r\n    }\r\n    toggle(this.links, string);\r\n}\r\nElement.prototype.getCenterPosition = function () {\r\n    return {\r\n        x: this.jtopo.cx,\r\n        y: this.jtopo.cy\r\n    }\r\n};\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9FbGVtZW50LmpzPzg1ZDAiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLDBCQUEwQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIxLmpzIiwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBFbGVtZW50O1xyXG5mdW5jdGlvbiBFbGVtZW50KGp0b3BvKSB7XHJcbiAgICBpZiAoanRvcG8pIHtcclxuICAgICAgICB0aGlzLmp0b3BvID0ganRvcG87XHJcbiAgICAgICAganRvcG8ucXRvcG8gPSB0aGlzO1xyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzLmF0dHIuanNvbklkKSB7XHJcbiAgICAgICAgdGhpcy5hdHRyLmpzb25JZCA9IFFUb3BvLnV0aWwubWFrZUlkKCk7XHJcbiAgICB9XHJcbiAgICAvL+iuvue9rumineWkluWxnuaAp+WkhOeQhuWvueixoVxyXG4gICAgdGhpcy5leHRyYSA9IHt9O1xyXG59XHJcblxyXG5FbGVtZW50LnByb3RvdHlwZS5zZXRKc29uSWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgIHRoaXMuYXR0ci5qc29uSWQgPSBpZDtcclxufTtcclxuRWxlbWVudC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHN3aXRjaCAodGhpcy5nZXRUeXBlKCkpIHtcclxuICAgICAgICBjYXNlIFFUb3BvLmNvbnN0YW50Lk5PREU6XHJcbiAgICAgICAgICAgIHRvZ2dsZU5vZGUuY2FsbCh0aGlzLCB0cnVlKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBRVG9wby5jb25zdGFudC5DT05UQUlORVI6XHJcbiAgICAgICAgICAgIHRvZ2dsZUNvbnRhaW5lci5jYWxsKHRoaXMsIHRydWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFFUb3BvLmNvbnN0YW50LkxJTks6XHJcbiAgICAgICAgICAgIHRvZ2dsZUxpbmsuY2FsbCh0aGlzLCB0cnVlKTtcclxuICAgIH1cclxufTtcclxuRWxlbWVudC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHN3aXRjaCAodGhpcy5nZXRUeXBlKCkpIHtcclxuICAgICAgICBjYXNlIFFUb3BvLmNvbnN0YW50Lk5PREU6XHJcbiAgICAgICAgICAgIHRvZ2dsZU5vZGUuY2FsbCh0aGlzLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUVRvcG8uY29uc3RhbnQuQ09OVEFJTkVSOlxyXG4gICAgICAgICAgICB0b2dnbGVDb250YWluZXIuY2FsbCh0aGlzLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUVRvcG8uY29uc3RhbnQuTElOSzpcclxuICAgICAgICAgICAgdG9nZ2xlTGluay5jYWxsKHRoaXMsIGZhbHNlKTtcclxuICAgIH1cclxufTtcclxuRWxlbWVudC5wcm90b3R5cGUuc2V0VXNlVHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICB0aGlzLmF0dHIudXNlVHlwZSA9IHR5cGU7XHJcbn07XHJcbkVsZW1lbnQucHJvdG90eXBlLmdldFVzZVR5cGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5hdHRyLnVzZVR5cGU7XHJcbn07XHJcbkVsZW1lbnQucHJvdG90eXBlLnNldFRleHQgPSBmdW5jdGlvbiAodGV4dCkge1xyXG4gICAgaWYgKHRleHQpIHtcclxuICAgICAgICB0aGlzLmp0b3BvLnRleHQgPSAodGV4dCArIFwiXCIpLnRyaW0oKTtcclxuICAgIH1cclxuICAgIHRoaXMuYXR0ci50ZXh0ID0gdGhpcy5qdG9wby50ZXh0O1xyXG59O1xyXG5FbGVtZW50LnByb3RvdHlwZS5zZXRCb3JkZXIgPSBmdW5jdGlvbiAoYm9yZGVyKSB7XHJcbiAgICB2YXIganRvcG8gPSB0aGlzLmp0b3BvO1xyXG4gICAgaWYgKGJvcmRlci5jb2xvcikge1xyXG4gICAgICAgIGp0b3BvLmJvcmRlckNvbG9yID0gUVRvcG8udXRpbC50cmFuc0hleChib3JkZXIuY29sb3IudG9Mb3dlckNhc2UoKSk7XHJcbiAgICB9XHJcbiAgICBpZiAoJC5pc051bWVyaWMoYm9yZGVyLndpZHRoKSkge1xyXG4gICAgICAgIGp0b3BvLmJvcmRlcldpZHRoID0gcGFyc2VJbnQoYm9yZGVyLndpZHRoKTtcclxuICAgIH1cclxuICAgIGlmICgkLmlzTnVtZXJpYyhib3JkZXIucmFkaXVzKSkge1xyXG4gICAgICAgIGp0b3BvLmJvcmRlclJhZGl1cyA9IHBhcnNlSW50KGJvcmRlci5yYWRpdXMpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLmJvcmRlci5jb2xvciA9IGp0b3BvLmJvcmRlckNvbG9yO1xyXG4gICAgdGhpcy5hdHRyLmJvcmRlci53aWR0aCA9IGp0b3BvLmJvcmRlcldpZHRoO1xyXG4gICAgdGhpcy5hdHRyLmJvcmRlci5yYWRpdXMgPSBqdG9wby5ib3JkZXJSYWRpdXM7XHJcbn07XHJcbkVsZW1lbnQucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKG5hbWUsIGZuKSB7XHJcbiAgICB0aGlzLmp0b3BvLmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQucXRvcG8pIHtcclxuICAgICAgICAgICAgZm4oZSwgZS50YXJnZXQucXRvcG8pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZuKGUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5FbGVtZW50LnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbiAobmFtZSwgZm4pIHtcclxuICAgIHRoaXMuanRvcG8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihuYW1lKTtcclxufTtcclxuRWxlbWVudC5wcm90b3R5cGUuc2V0WkluZGV4ID0gZnVuY3Rpb24gKHpJbmRleCkge1xyXG4gICAgaWYgKCQuaXNOdW1lcmljKHpJbmRleCkpIHtcclxuICAgICAgICB0aGlzLmp0b3BvLnpJbmRleCA9IHBhcnNlSW50KHpJbmRleCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIuekluZGV4ID0gdGhpcy5qdG9wby56SW5kZXg7XHJcbn07XHJcbkVsZW1lbnQucHJvdG90eXBlLnNldEZvbnQgPSBmdW5jdGlvbiAoZm9udCkge1xyXG4gICAgdmFyIHR5cGUgPSB0aGlzLmF0dHIuZm9udC50eXBlO1xyXG4gICAgdmFyIHNpemUgPSB0aGlzLmF0dHIuZm9udC5zaXplO1xyXG4gICAgaWYgKGZvbnQpIHtcclxuICAgICAgICBpZiAoJC5pc051bWVyaWMoZm9udC5zaXplKSkge1xyXG4gICAgICAgICAgICBzaXplID0gZm9udC5zaXplO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZm9udC50eXBlKSB7XHJcbiAgICAgICAgICAgIHR5cGUgPSBmb250LnR5cGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuanRvcG8uZm9udCA9IChzaXplID8gc2l6ZSA6IDE0KSArIFwicHggXCIgKyB0eXBlO1xyXG4gICAgICAgIGlmIChmb250LmNvbG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuanRvcG8uZm9udENvbG9yID0gUVRvcG8udXRpbC50cmFuc0hleChmb250LmNvbG9yLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuYXR0ci5mb250LnR5cGUgPSB0eXBlO1xyXG4gICAgdGhpcy5hdHRyLmZvbnQuc2l6ZSA9IHNpemU7XHJcbiAgICB0aGlzLmF0dHIuZm9udC5jb2xvciA9IHRoaXMuanRvcG8uZm9udENvbG9yO1xyXG59O1xyXG5FbGVtZW50LnByb3RvdHlwZS5zZXRBbHBoYSA9IGZ1bmN0aW9uIChhbHBoYSkge1xyXG4gICAgaWYgKCQuaXNOdW1lcmljKGFscGhhKSAmJiBhbHBoYSA8PSAxICYmIGFscGhhID4gMCkge1xyXG4gICAgICAgIHRoaXMuanRvcG8uYWxwaGEgPSBhbHBoYTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5hbHBoYSA9IDE7XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIuYWxwaGEgPSB0aGlzLmp0b3BvLmFscGhhO1xyXG59O1xyXG4vL+W3sumHjeWGmeWQjOatpVxyXG5FbGVtZW50LnByb3RvdHlwZS5zZXRQb3NpdGlvbiA9IGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgaWYgKCQuaXNBcnJheShwb3NpdGlvbikgJiYgcG9zaXRpb24ubGVuZ3RoID49IDIpIHtcclxuICAgICAgICBpZiAoJC5pc051bWVyaWMocG9zaXRpb25bMF0pICYmICQuaXNOdW1lcmljKHBvc2l0aW9uWzFdKSkge1xyXG4gICAgICAgICAgICB0aGlzLmp0b3BvLnNldExvY2F0aW9uKHBhcnNlSW50KHBvc2l0aW9uWzBdKSwgcGFyc2VJbnQocG9zaXRpb25bMV0pKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcbkVsZW1lbnQucHJvdG90eXBlLnNldFNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xyXG4gICAgaWYgKCQuaXNBcnJheShzaXplKSAmJiAkLmlzTnVtZXJpYyhzaXplWzBdKSAmJiAkLmlzTnVtZXJpYyhzaXplWzFdKSkge1xyXG4gICAgICAgIHRoaXMuanRvcG8uc2V0U2l6ZShwYXJzZUludChzaXplWzBdKSwgcGFyc2VJbnQoc2l6ZVsxXSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmp0b3BvLnNldFNpemUoNjQsIDY0KTtcclxuICAgIH1cclxuICAgIHRoaXMuYXR0ci5zaXplID0gW3RoaXMuanRvcG8ud2lkdGgsIHRoaXMuanRvcG8uaGVpZ2h0XTtcclxufTtcclxuRWxlbWVudC5wcm90b3R5cGUuc2V0RHJhZ2FibGUgPSBmdW5jdGlvbiAoZHJhZ2FibGUpIHtcclxuICAgIGlmICh0eXBlb2YgZHJhZ2FibGUgPT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5kcmFnYWJsZSA9IGRyYWdhYmxlO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLmRyYWdhYmxlID0gdGhpcy5qdG9wby5kcmFnYWJsZTtcclxufTtcclxuRWxlbWVudC5wcm90b3R5cGUuc2V0TmFtZVBvc2l0aW9uID0gZnVuY3Rpb24gKG5hbWVQb3NpdGlvbikge1xyXG4gICAgdmFyIGp0b3BvID0gdGhpcy5qdG9wbztcclxuICAgIGp0b3BvLnRleHQgPSB0aGlzLmF0dHIubmFtZSB8fCBcIlwiO1xyXG4gICAgc3dpdGNoIChuYW1lUG9zaXRpb24pIHtcclxuICAgICAgICBjYXNlICdoaWRlJzpcclxuICAgICAgICAgICAganRvcG8udGV4dCA9ICcnO1xyXG4gICAgICAgICAgICB0aGlzLmF0dHIubmFtZVBvc2l0aW9uID0gXCJoaWRlXCI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICAgICAgICAgIGp0b3BvLnRleHRPZmZzZXRYID0gMDtcclxuICAgICAgICAgICAganRvcG8udGV4dE9mZnNldFkgPSAwO1xyXG4gICAgICAgICAgICBqdG9wby50ZXh0UG9zaXRpb24gPSBcIkJvdHRvbV9DZW50ZXJcIjtcclxuICAgICAgICAgICAgdGhpcy5hdHRyLm5hbWVQb3NpdGlvbiA9IFwiYm90dG9tXCI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3RvcCc6XHJcbiAgICAgICAgICAgIGp0b3BvLnRleHRPZmZzZXRYID0gMDtcclxuICAgICAgICAgICAganRvcG8udGV4dE9mZnNldFkgPSAwO1xyXG4gICAgICAgICAgICBqdG9wby50ZXh0UG9zaXRpb24gPSBcIlRvcF9DZW50ZXJcIjtcclxuICAgICAgICAgICAgdGhpcy5hdHRyLm5hbWVQb3NpdGlvbiA9IFwidG9wXCI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICBqdG9wby50ZXh0T2Zmc2V0WCA9IC01O1xyXG4gICAgICAgICAgICBqdG9wby50ZXh0T2Zmc2V0WSA9IDA7XHJcbiAgICAgICAgICAgIGp0b3BvLnRleHRQb3NpdGlvbiA9IFwiTWlkZGxlX0xlZnRcIjtcclxuICAgICAgICAgICAgdGhpcy5hdHRyLm5hbWVQb3NpdGlvbiA9IFwibGVmdFwiO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgICAgIGp0b3BvLnRleHRPZmZzZXRYID0gNTtcclxuICAgICAgICAgICAganRvcG8udGV4dE9mZnNldFkgPSAwO1xyXG4gICAgICAgICAgICBqdG9wby50ZXh0UG9zaXRpb24gPSBcIk1pZGRsZV9SaWdodFwiO1xyXG4gICAgICAgICAgICB0aGlzLmF0dHIubmFtZVBvc2l0aW9uID0gXCJyaWdodFwiO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwiY2VudGVyXCI6XHJcbiAgICAgICAgICAgIGp0b3BvLnRleHRPZmZzZXRYID0gMDtcclxuICAgICAgICAgICAganRvcG8udGV4dE9mZnNldFkgPSAwO1xyXG4gICAgICAgICAgICBqdG9wby50ZXh0UG9zaXRpb24gPSBcIk1pZGRsZV9DZW50ZXJcIjtcclxuICAgICAgICAgICAgdGhpcy5hdHRyLm5hbWVQb3NpdGlvbiA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIGp0b3BvLnRleHRPZmZzZXRYID0gMDtcclxuICAgICAgICAgICAganRvcG8udGV4dE9mZnNldFkgPSAwO1xyXG4gICAgICAgICAgICBqdG9wby50ZXh0UG9zaXRpb24gPSAnQm90dG9tX0NlbnRlcic7XHJcbiAgICAgICAgICAgIHRoaXMuYXR0ci5uYW1lUG9zaXRpb24gPSBcImJvdHRvbVwiO1xyXG4gICAgICAgICAgICBRVG9wby51dGlsLmVycm9yKHRoaXMsIFwic2V0IHdyb25nIG5hbWVQb3NpdGlvbixkZWZhdWx0IGlzIGJvdHRvbVwiKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn07XHJcbi8v5Y+q6KaB5a+55bqU5bGe5oCn5pyJ5pa55rOV5YiZ5L+u5pS5XHJcbkVsZW1lbnQucHJvdG90eXBlLl9zZXRBdHRyID0gZnVuY3Rpb24gKGNvbmZpZykge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgJC5lYWNoKGNvbmZpZywgZnVuY3Rpb24gKGssIHYpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB2YXIgZm4gPSBzZWxmWydzZXQnICsgUVRvcG8udXRpbC51cEZpcnN0KGspXTtcclxuICAgICAgICAgICAgaWYgKGZuKSB7XHJcbiAgICAgICAgICAgICAgICBmbi5jYWxsKHNlbGYsIHYpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBRVG9wby51dGlsLmVycm9yKHNlbGYsIFwiRWxlbWVudCBfc2V0QXR0ciBlcnJvciA6XCIgKyBrLCBlKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuRWxlbWVudC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgIHJldHVybiB0aGlzLmF0dHJbbmFtZV07XHJcbn07XHJcbkVsZW1lbnQucHJvdG90eXBlLnZhbCA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XHJcbiAgICBpZiAoUVRvcG8udXRpbC5nZXRDbGFzcyhrZXkpID09ICdPYmplY3QnKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICQuZWFjaChrZXksIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xyXG4gICAgICAgICAgICBzZWxmLmV4dHJhW25hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0O1xyXG4gICAgICAgICAgICBpZiAodGhpcy5leHRyYVtrZXldKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLmV4dHJhW2tleV07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hdHRyW2tleV0pIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuYXR0cltrZXldO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpc1trZXldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5leHRyYVtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG4vKlxyXG4gKiDlr7nosaFsaW5rc+WxnuaAp+WGheeahOaJgOaciee6v+i/m+ihjOWIh+aNolxyXG4gKkBsaW5rcyBub2RlL2NvbnRhaW5lcueahGxpbmtz5bGe5oCnXHJcbiAqIEBmbk5hbWUgJ3Nob3cnLydoaWRlJ+aWueazleWQjVxyXG4gKi9cclxuZnVuY3Rpb24gdG9nZ2xlKGxpbmtzLCBmbk5hbWUpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgJC5lYWNoKGxpbmtzLCBmdW5jdGlvbiAobmFtZSwgYXJyKSB7XHJcbiAgICAgICAgICAgIGFyci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtW2ZuTmFtZV0oKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwi5YiH5o2i6ZqQ6JePL+aYvuekuuaXtumUmeivr1wiLCBlKTtcclxuICAgIH1cclxufVxyXG4vL+e6v+eahOaYvuekuuWPquacieW9k+WFtuS4pOerr+iKgueCuemDveaYvuekuuaXtuaJjeaYvuekulxyXG5mdW5jdGlvbiB0b2dnbGVMaW5rKGZsYWcpIHtcclxuICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGF0aC5zdGFydC5qdG9wbyAmJiB0aGlzLnBhdGguZW5kLmp0b3BvKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhdGguc3RhcnQuanRvcG8udmlzaWJsZSAmJiB0aGlzLnBhdGguZW5kLmp0b3BvLnZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuanRvcG8udmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuanRvcG8udmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHRvZ2dsZU5vZGUoZmxhZykge1xyXG4gICAgdGhpcy5qdG9wby52aXNpYmxlID0gZmxhZztcclxuICAgIHZhciBzdHJpbmcgPSBmbGFnID8gXCJzaG93XCIgOiBcImhpZGVcIjtcclxuICAgIHRvZ2dsZSh0aGlzLmxpbmtzLCBzdHJpbmcpO1xyXG59XHJcbmZ1bmN0aW9uIHRvZ2dsZUNvbnRhaW5lcihmbGFnKSB7XHJcbiAgICB0aGlzLmp0b3BvLnZpc2libGUgPSBmbGFnO1xyXG4gICAgdmFyIHN0cmluZyA9IGZsYWcgPyBcInNob3dcIiA6IFwiaGlkZVwiO1xyXG4gICAgLy/liIfmjaLlrZDnsbvmmL7npLrpmpDol49cclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW5baV1bc3RyaW5nXSgpO1xyXG4gICAgfVxyXG4gICAgdG9nZ2xlKHRoaXMubGlua3MsIHN0cmluZyk7XHJcbn1cclxuRWxlbWVudC5wcm90b3R5cGUuZ2V0Q2VudGVyUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHg6IHRoaXMuanRvcG8uY3gsXHJcbiAgICAgICAgeTogdGhpcy5qdG9wby5jeVxyXG4gICAgfVxyXG59O1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2RldmVsb3AvY29yZS9lbGVtZW50L0VsZW1lbnQuanNcbi8vIG1vZHVsZSBpZCA9IDFcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sInNvdXJjZVJvb3QiOiIifQ==')},10:function(module,exports){eval('!function (window) {\r\n    function Element() {\r\n        this.initialize = function () {\r\n            this.elementType = "element", this.serializedProperties = ["elementType"], this.propertiesStack = [], this._id = "" + (new Date).getTime()\r\n        }, this.distroy = function () {\r\n        }, this.removeHandler = function () {\r\n        }, this.attr = function (a, b) {\r\n            if (null != a && null != b)this[a] = b; else if (null != a)return this[a];\r\n            return this\r\n        }, this.save = function () {\r\n            var a = this, b = {};\r\n            this.serializedProperties.forEach(function (c) {\r\n                b[c] = a[c]\r\n            }), this.propertiesStack.push(b)\r\n        }, this.restore = function () {\r\n            if (null != this.propertiesStack && 0 != this.propertiesStack.length) {\r\n                var a = this, b = this.propertiesStack.pop();\r\n                this.serializedProperties.forEach(function (c) {\r\n                    a[c] = b[c]\r\n                })\r\n            }\r\n        }, this.toJson = function () {\r\n            var a = this, b = "{", c = this.serializedProperties.length;\r\n            return this.serializedProperties.forEach(function (d, e) {\r\n                var f = a[d];\r\n                "string" == typeof f && (f = \'"\' + f + \'"\'), b += \'"\' + d + \'":\' + f, c > e + 1 && (b += ",")\r\n            }), b += "}"\r\n        }\r\n    }\r\n\r\n    /*a=this.x - this.borderWidth / 2 b=this.y - this.borderWidth / 2,*/\r\n    CanvasRenderingContext2D.prototype.JTopoRoundRect = function (a, b, w_borderWidth, h_borderWidth, borderRadius) {\r\n        //画元素圆角边框\r\n        "undefined" == typeof borderRadius && (borderRadius = 5),\r\n            this.beginPath(),\r\n            this.moveTo(a + borderRadius, b),\r\n            this.lineTo(a + w_borderWidth - borderRadius, b),\r\n            this.quadraticCurveTo(a + w_borderWidth, b, a + w_borderWidth, b + borderRadius),\r\n            this.lineTo(a + w_borderWidth, b + h_borderWidth - borderRadius),\r\n            this.quadraticCurveTo(a + w_borderWidth, b + h_borderWidth, a + w_borderWidth - borderRadius, b + h_borderWidth),\r\n            this.lineTo(a + borderRadius, b + h_borderWidth),\r\n            this.quadraticCurveTo(a, b + h_borderWidth, a, b + h_borderWidth - borderRadius),\r\n            this.lineTo(a, b + borderRadius),\r\n            this.quadraticCurveTo(a, b, a + borderRadius, b),\r\n            this.closePath()\r\n    };\r\n    CanvasRenderingContext2D.prototype.JTopoDashedLineTo = function (sX, sY, eX, eY, dashedPattern) {\r\n        //画虚线\r\n        if ("undefined" == typeof dashedPattern) {\r\n            dashedPattern = 5;\r\n        }\r\n        var dX = eX - sX;\r\n        var dY = eY - sY;\r\n        var length = Math.floor(Math.sqrt(dX * dX + dY * dY));\r\n        var dashL = 0 >= dashedPattern ? length : length / dashedPattern;\r\n        var tY = dY / length * dashedPattern;\r\n        var tX = dX / length * dashedPattern;\r\n        this.beginPath();\r\n        for (var m = 0; dashL > m; m++) {\r\n            if (m % 2) {\r\n                this.lineTo(sX + m * tX, sY + m * tY);\r\n            } else {\r\n                this.moveTo(sX + m * tX, sY + m * tY);\r\n            }\r\n        }\r\n        this.stroke();\r\n    };\r\n    var JTopo = {\r\n        version: "0.4.8_01",\r\n        zIndex_Container: 1,\r\n        zIndex_Link: 2,\r\n        zIndex_Node: 3,\r\n        SceneMode: {normal: "normal", drag: "drag", edit: "edit", select: "select"},\r\n        MouseCursor: {\r\n            normal: "default",\r\n            pointer: "pointer",\r\n            top_left: "nw-resize",\r\n            top_center: "n-resize",\r\n            top_right: "ne-resize",\r\n            middle_left: "e-resize",\r\n            middle_right: "e-resize",\r\n            bottom_left: "ne-resize",\r\n            bottom_center: "n-resize",\r\n            bottom_right: "nw-resize",\r\n            move: "move",\r\n            open_hand: "default",\r\n            closed_hand: "default"\r\n        },\r\n        createStageFromJson: function (jsonStr, canvas) {\r\n            eval("var jsonObj = " + jsonStr);\r\n            var stage = new JTopo.Stage(canvas);\r\n            for (var k in jsonObj)"childs" != k && (stage[k] = jsonObj[k]);\r\n            var scenes = jsonObj.childs;\r\n            return scenes.forEach(function (a) {\r\n                var b = new JTopo.Scene(stage);\r\n                for (var c in a)"childs" != c && (b[c] = a[c]), "background" == c && (b.background = a[c]);\r\n                var d = a.childs;\r\n                d.forEach(function (a) {\r\n                    var c = null, d = a.elementType;\r\n                    "node" == d ? c = new JTopo.Node : "CircleNode" == d && (c = new JTopo.CircleNode);\r\n                    for (var e in a)c[e] = a[e];\r\n                    b.add(c)\r\n                })\r\n            }), stage\r\n        }\r\n    };\r\n    JTopo.Element = Element;\r\n    window.JTopo = JTopo;\r\n}(window), function (JTopo) {\r\n    function MessageBus(a) {\r\n        this.name = a;\r\n        this.messageMap = {};\r\n        this.messageCount = 0;\r\n    }\r\n\r\n    MessageBus.prototype.subscribe = function (evenName, fn) {\r\n        var d = this.messageMap[evenName];\r\n        if (null == d) {\r\n            this.messageMap[evenName] = [];\r\n        }\r\n        this.messageMap[evenName].push(fn);\r\n        this.messageCount++;\r\n    };\r\n    MessageBus.prototype.unsubscribe = function (evenName, fn) {\r\n        var event = this.messageMap[evenName];\r\n        if (null != event) {\r\n            if (fn && \'function\' == typeof fn) {\r\n                var index = event.indexOf(fn);\r\n                if (index > -1) {\r\n                    event.splice(index, 1);\r\n                }\r\n            } else {\r\n                this.messageMap[evenName] = null;\r\n                delete this.messageMap[evenName];\r\n                this.messageCount--;\r\n            }\r\n        }\r\n    };\r\n    MessageBus.prototype.publish = function (evenName, e, boolean) {\r\n        var eventMap = this.messageMap[evenName];\r\n        if (null != eventMap) {\r\n            eventMap.forEach(function (fn) {\r\n                if (boolean) {\r\n                    setTimeout(function () {\r\n                        fn(e);\r\n                    });\r\n                } else {\r\n                    if (e.target && e.target.qtopo) {\r\n                        fn(e, e.target.qtopo);\r\n                    } else {\r\n                        fn(e);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    function getDistance(pointA, pointB, c, d) {\r\n        var width, height;\r\n        if (null == c && null == d) {\r\n            if (pointA && pointB) {\r\n                width = pointB.x - pointA.x;\r\n                height = pointB.y - pointA.y;\r\n            }\r\n        } else {\r\n            width = c - pointA;\r\n            height = d - pointB;\r\n        }\r\n        return Math.sqrt(width * width + height * height);\r\n    }\r\n\r\n    function getElementsBound(elements) {\r\n        var b = {\r\n            left: Number.MAX_VALUE,\r\n            right: Number.MIN_VALUE,\r\n            top: Number.MAX_VALUE,\r\n            bottom: Number.MIN_VALUE\r\n        };\r\n        elements.forEach(function (element) {\r\n            if (!(element instanceof JTopo.Link)) {\r\n                if (b.left > element.x) {\r\n                    b.left = element.x;\r\n                    b.leftNode = element;\r\n                }\r\n                if (b.right < element.x + element.width) {\r\n                    b.right = element.x + element.width;\r\n                    b.rightNode = element;\r\n                }\r\n                if (b.top > element.y) {\r\n                    b.top = element.y;\r\n                    b.topNode = element;\r\n                }\r\n                if (b.bottom < element.y + element.height) {\r\n                    b.bottom = element.y + element.height;\r\n                    b.bottomNode = element;\r\n                }\r\n            }\r\n        });\r\n        b.width = b.right - b.left;\r\n        b.height = b.bottom - b.top;\r\n        return b;\r\n    }\r\n\r\n    function getEventPosition(a) {\r\n        a = cloneEvent(a);\r\n        if (!a.pageX) {\r\n            a.pageX = a.clientX + document.body.scrollLeft - document.body.clientLeft;\r\n            a.pageY = a.clientY + document.body.scrollTop - document.body.clientTop;\r\n        }\r\n        return a;\r\n    }\r\n\r\n    function rotatePoint(aX, aY, bX, bY, c) {\r\n        var width = bX - aX;\r\n        var height = bY - aY;\r\n        var ditance = Math.sqrt(width * width + height * height);\r\n        var i = Math.atan2(height, width) + c;\r\n        return {\r\n            x: aX + Math.cos(i) * ditance,\r\n            y: aY + Math.sin(i) * ditance\r\n        }\r\n    }\r\n\r\n    function rotatePoints(root, childs, beginAngle) {\r\n        for (var d = [], e = 0; e < childs.length; e++) {\r\n            d.push(rotatePoint(root.x, root.y, childs[e].x, childs[e].y, beginAngle));\r\n        }\r\n        return d\r\n    }\r\n\r\n    function cloneEvent(a) {\r\n        var b = {};\r\n        for (var c in a) {\r\n            if ("returnValue" != c && "keyLocation" != c) {\r\n                b[c] = a[c];\r\n            }\r\n        }\r\n        return b\r\n    }\r\n\r\n    function clone(object) {\r\n        var b = {};\r\n        for (var c in object) {\r\n            b[c] = object[c];\r\n        }\r\n        return b\r\n    }\r\n\r\n    function isPointInRect(rect, points) {\r\n        var X = points.x;\r\n        var Y = points.y;\r\n        var W = points.width;\r\n        var H = points.height;\r\n        return rect.x > X && rect.x < X + W && rect.y > Y && rect.y < Y + H;\r\n    }\r\n\r\n    function isPointInLine(points, start, end) {\r\n        var line = JTopo.util.getDistance(start, end);\r\n        var toStart = JTopo.util.getDistance(start, points);\r\n        var toEnd = JTopo.util.getDistance(end, points);\r\n        return Math.abs(toStart + toEnd - line) <= 0.5;\r\n    }\r\n\r\n    function removeFromArray(arr, item) {\r\n        for (var c = 0; c < arr.length; c++) {\r\n            var d = arr[c];\r\n            if (d === item) {\r\n                arr = arr.del(c);\r\n                break\r\n            }\r\n        }\r\n        return arr\r\n    }\r\n\r\n    function randomColor() {\r\n        return Math.floor(255 * Math.random()) + "," + Math.floor(255 * Math.random()) + "," + Math.floor(255 * Math.random())\r\n    }\r\n\r\n\r\n    function loadStageFromJson(json, canvas) {\r\n        var obj = eval(json), stage = new JTopo.Stage(canvas);\r\n        for (var k in stageObj)if ("scenes" != k)stage[k] = obj[k]; else for (var scenes = obj.scenes, i = 0; i < scenes.length; i++) {\r\n            var sceneObj = scenes[i], scene = new JTopo.Scene(stage);\r\n            for (var p in sceneObj)if ("elements" != p)scene[p] = sceneObj[p]; else for (var nodeMap = {}, elements = sceneObj.elements, m = 0; m < elements.length; m++) {\r\n                var elementObj = elements[m], type = elementObj.elementType, element;\r\n                "Node" == type && (element = new JTopo.Node);\r\n                for (var mk in elementObj)element[mk] = elementObj[mk];\r\n                nodeMap[element.text] = element, scene.add(element)\r\n            }\r\n        }\r\n        return console.log(stage), stage\r\n    }\r\n\r\n    function changeColor(ctx, image, color) {\r\n        var colorArr = color.split(",");\r\n        var R = parseInt(colorArr[0]);\r\n        var G = parseInt(colorArr[1]);\r\n        var B = parseInt(colorArr[2]);\r\n        var imageWidth = canvas.width = image.width;\r\n        var imageHeight = canvas.height = image.height;\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        ctx.drawImage(image, 0, 0);\r\n        var ImageData = ctx.getImageData(0, 0, image.width, image.height);\r\n        var data = ImageData.data;\r\n        for (var i = 0; imageWidth > i; i++) {\r\n            for (var j = 0; imageHeight > j; j++) {\r\n                var n = 4 * (i + j * imageWidth);\r\n                if(0 != data[n + 3]){\r\n                    if(null != R){\r\n                        data[n + 0] += R;\r\n                    }\r\n                    if(null != G){\r\n                        data[n + 1] += G;\r\n                    }\r\n                    if(null != B){\r\n                        data[n + 2] += B;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        ctx.putImageData(ImageData, 0, 0, 0, 0, image.width, image.height);\r\n        return canvas.toDataURL();\r\n    }\r\n\r\n    function genImageAlarm(image, color) {\r\n        var src = image.src + color;\r\n        if (alarmImageCache[src])return alarmImageCache[src];\r\n        var newImage = new Image;\r\n        newImage.src = changeColor(graphics, image, color);\r\n        alarmImageCache[src] = newImage;\r\n        return newImage;\r\n    }\r\n\r\n    function getOffsetPosition(a) {\r\n        if (!a)return {left: 0, top: 0};\r\n        var b = 0, c = 0;\r\n        if ("getBoundingClientRect" in document.documentElement)var d = a.getBoundingClientRect(), e = a.ownerDocument, f = e.body, g = e.documentElement, h = g.clientTop || f.clientTop || 0, i = g.clientLeft || f.clientLeft || 0, b = d.top + (self.pageYOffset || g && g.scrollTop || f.scrollTop) - h, c = d.left + (self.pageXOffset || g && g.scrollLeft || f.scrollLeft) - i; else do b += a.offsetTop || 0, c += a.offsetLeft || 0, a = a.offsetParent; while (a);\r\n        return {left: c, top: b}\r\n    }\r\n\r\n    function lineF(x1, y1, x2, y2) {\r\n        function e(a) {\r\n            return a * f + g\r\n        }\r\n\r\n        var f = (y2 - y1) / (x2 - x1), g = y1 - x1 * f;\r\n        return e.k = f, e.b = g, e.x1 = x1, e.x2 = x2, e.y1 = y1, e.y2 = y2, e\r\n    }\r\n\r\n    function inRange(a, b, c) {\r\n        var d = Math.abs(b - c), e = Math.abs(b - a), f = Math.abs(c - a), g = Math.abs(d - (e + f));\r\n        return 1e-6 > g ? !0 : !1\r\n    }\r\n\r\n    function isPointInLineSeg(a, b, c) {\r\n        return inRange(a, c.x1, c.x2) && inRange(b, c.y1, c.y2)\r\n    }\r\n\r\n    function intersection(a, b) {\r\n        var c, d;\r\n        return a.k == b.k ? null : (1 / 0 == a.k || a.k == -1 / 0 ? (c = a.x1, d = b(a.x1)) : 1 / 0 == b.k || b.k == -1 / 0 ? (c = b.x1, d = a(b.x1)) : (c = (b.b - a.b) / (a.k - b.k), d = a(c)), 0 == isPointInLineSeg(c, d, a) ? null : 0 == isPointInLineSeg(c, d, b) ? null : {\r\n            x: c,\r\n            y: d\r\n        })\r\n    }\r\n\r\n    function intersectionLineBound(link, bound) {\r\n        var c = JTopo.util.lineF(bound.left, bound.top, bound.left, bound.bottom);\r\n        var d = JTopo.util.intersection(link, c);\r\n        if (null == d) {\r\n            c = JTopo.util.lineF(bound.left, bound.top, bound.right, bound.top);\r\n            d = JTopo.util.intersection(link, c);\r\n            if (null == d) {\r\n                c = JTopo.util.lineF(bound.right, bound.top, bound.right, bound.bottom);\r\n                d = JTopo.util.intersection(link, c);\r\n                if (null == d) {\r\n                    c = JTopo.util.lineF(bound.left, bound.bottom, bound.right, bound.bottom);\r\n                    d = JTopo.util.intersection(link, c);\r\n                }\r\n            }\r\n        }\r\n\r\n        return d;\r\n    }\r\n\r\n    window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame || function (a) {\r\n            setTimeout(a, 1e3 / 24)\r\n        };\r\n    Array.prototype.del = function (item) {\r\n        if ("number" != typeof item) {\r\n            var index = this.indexOf(item);\r\n            if (index > -1) {\r\n                this.splice(index, 1);\r\n            }\r\n            return this\r\n        } else {\r\n            if (item > -1) {\r\n                this.splice(item, 1);\r\n            }\r\n            return this;\r\n        }\r\n    };\r\n    if (![].indexOf) {\r\n        Array.prototype.indexOf = function (a) {\r\n            for (var i = 0; i < this.length; i++) {\r\n                if (this[i] === a) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        }\r\n    }\r\n    window.console || (window.console = {\r\n        log: function () {\r\n        }, info: function () {\r\n        }, debug: function () {\r\n        }, warn: function () {\r\n        }, error: function () {\r\n        }\r\n    });\r\n    var canvas = document.createElement("canvas"), graphics = canvas.getContext("2d"), alarmImageCache = {};\r\n    JTopo.util = {\r\n        rotatePoint: rotatePoint,\r\n        rotatePoints: rotatePoints,\r\n        getDistance: getDistance,\r\n        getEventPosition: getEventPosition,\r\n        MessageBus: MessageBus,\r\n        isFirefox: navigator.userAgent.indexOf("Firefox") > 0,\r\n        isIE: !(!window.attachEvent || -1 !== navigator.userAgent.indexOf("Opera")),\r\n        isChrome: null != navigator.userAgent.toLowerCase().match(/chrome/),\r\n        clone: clone,\r\n        isPointInRect: isPointInRect,\r\n        isPointInLine: isPointInLine,\r\n        removeFromArray: removeFromArray,\r\n        cloneEvent: cloneEvent,\r\n        randomColor: randomColor,\r\n        loadStageFromJson: loadStageFromJson,\r\n        getElementsBound: getElementsBound,\r\n        genImageAlarm: genImageAlarm,\r\n        getOffsetPosition: getOffsetPosition,\r\n        lineF: lineF,\r\n        intersection: intersection,\r\n        intersectionLineBound: intersectionLineBound\r\n    }\r\n}(JTopo),\r\n    function (jtopo) {\r\n        function b(a) {\r\n            return {\r\n                hgap: 16, visible: !1, exportCanvas: document.createElement("canvas"), getImage: function (b, c) {\r\n                    var d = a.getBound(), e = 1, f = 1;\r\n                    this.exportCanvas.width = a.canvas.width, this.exportCanvas.height = a.canvas.height, null != b && null != c ? (this.exportCanvas.width = b, this.exportCanvas.height = c, e = b / d.width, f = c / d.height) : (d.width > a.canvas.width && (this.exportCanvas.width = d.width), d.height > a.canvas.height && (this.exportCanvas.height = d.height));\r\n                    var g = this.exportCanvas.getContext("2d");\r\n                    return a.childs.length > 0 && (g.save(), g.clearRect(0, 0, this.exportCanvas.width, this.exportCanvas.height), a.childs.forEach(function (a) {\r\n                        1 == a.visible && (a.save(), a.translateX = 0, a.translateY = 0, a.scaleX = 1, a.scaleY = 1, g.scale(e, f), d.left < 0 && (a.translateX = Math.abs(d.left)), d.top < 0 && (a.translateY = Math.abs(d.top)), a.paintAll = !0, a.repaint(g), a.paintAll = !1, a.restore())\r\n                    }), g.restore()), this.exportCanvas.toDataURL("image/png")\r\n                }, canvas: document.createElement("canvas"), update: function () {\r\n                    this.eagleImageDatas = this.getData(a)\r\n                }, setSize: function (a, b) {\r\n                    this.width = this.canvas.width = a, this.height = this.canvas.height = b\r\n                }, getData: function (b, c) {\r\n                    function d(a) {\r\n                        var b = a.stage.canvas.width, c = a.stage.canvas.height, d = b / a.scaleX / 2, e = c / a.scaleY / 2;\r\n                        return {translateX: a.translateX + d - d * a.scaleX, translateY: a.translateY + e - e * a.scaleY}\r\n                    }\r\n\r\n                    null != j && null != k ? this.setSize(b, c) : this.setSize(200, 160);\r\n                    var e = this.canvas.getContext("2d");\r\n                    if (a.childs.length > 0) {\r\n                        e.save(), e.clearRect(0, 0, this.canvas.width, this.canvas.height), a.childs.forEach(function (a) {\r\n                            1 == a.visible && (a.save(), a.centerAndZoom(null, null, e), a.repaint(e), a.restore())\r\n                        });\r\n                        var f = d(a.childs[0]), g = f.translateX * (this.canvas.width / a.canvas.width) * a.childs[0].scaleX, h = f.translateY * (this.canvas.height / a.canvas.height) * a.childs[0].scaleY, i = a.getBound(), j = a.canvas.width / a.childs[0].scaleX / i.width, k = a.canvas.height / a.childs[0].scaleY / i.height;\r\n                        j > 1 && (j = 1), k > 1 && (j = 1), g *= j, h *= k, i.left < 0 && (g -= Math.abs(i.left) * (this.width / i.width)), i.top < 0 && (h -= Math.abs(i.top) * (this.height / i.height)), e.save(), e.lineWidth = 1, e.strokeStyle = "rgba(255,0,0,1)", e.strokeRect(-g, -h, e.canvas.width * j, e.canvas.height * k), e.restore();\r\n                        var l = null;\r\n                        try {\r\n                            l = e.getImageData(0, 0, e.canvas.width, e.canvas.height)\r\n                        } catch (m) {\r\n                        }\r\n                        return l\r\n                    }\r\n                    return null\r\n                }, paint: function () {\r\n                    if (null != this.eagleImageDatas) {\r\n                        var b = a.graphics;\r\n                        b.save(), b.fillStyle = "rgba(211,211,211,0.3)", b.fillRect(a.canvas.width - this.canvas.width - 2 * this.hgap, a.canvas.height - this.canvas.height - 1, a.canvas.width - this.canvas.width, this.canvas.height + 1), b.fill(), b.save(), b.lineWidth = 1, b.strokeStyle = "rgba(0,0,0,1)", b.rect(a.canvas.width - this.canvas.width - 2 * this.hgap, a.canvas.height - this.canvas.height - 1, a.canvas.width - this.canvas.width, this.canvas.height + 1), b.stroke(), b.restore(), b.putImageData(this.eagleImageDatas, a.canvas.width - this.canvas.width - this.hgap, a.canvas.height - this.canvas.height), b.restore()\r\n                    } else this.eagleImageDatas = this.getData(a)\r\n                }, eventHandler: function (a, b, c) {\r\n                    var d = b.x, e = b.y;\r\n                    if (d > c.canvas.width - this.canvas.width && e > c.canvas.height - this.canvas.height) {\r\n                        if (d = b.x - this.canvas.width, e = b.y - this.canvas.height, "mousedown" == a && (this.lastTranslateX = c.childs[0].translateX, this.lastTranslateY = c.childs[0].translateY), "mousedrag" == a && c.childs.length > 0) {\r\n                            var f = b.dx, g = b.dy, h = c.getBound(), i = this.canvas.width / c.childs[0].scaleX / h.width, j = this.canvas.height / c.childs[0].scaleY / h.height;\r\n                            c.childs[0].translateX = this.lastTranslateX - f / i, c.childs[0].translateY = this.lastTranslateY - g / j\r\n                        }\r\n                    } else;\r\n                }\r\n            }\r\n        }\r\n\r\n        function stage(c) {\r\n            function d(b) {\r\n                var c = jtopo.util.getEventPosition(b), d = jtopo.util.getOffsetPosition(n.canvas);\r\n                return c.offsetLeft = c.pageX - d.left, c.offsetTop = c.pageY - d.top, c.x = c.offsetLeft, c.y = c.offsetTop, c.target = null, c\r\n            }\r\n\r\n            function e(a) {\r\n                document.onselectstart = function () {\r\n                    return !1\r\n                }, this.mouseOver = !0;\r\n                var b = d(a);\r\n                n.dispatchEventToScenes("mouseover", b), n.dispatchEvent("mouseover", b)\r\n            }\r\n\r\n            function f(a) {\r\n                p = setTimeout(function () {\r\n                    o = !0\r\n                }, 500), document.onselectstart = function () {\r\n                    return !0\r\n                };\r\n                var b = d(a);\r\n                n.dispatchEventToScenes("mouseout", b), n.dispatchEvent("mouseout", b), n.needRepaint = 0 == n.animate ? !1 : !0\r\n            }\r\n\r\n            function g(a) {\r\n                var b = d(a);\r\n                n.mouseDown = !0, n.mouseDownX = b.x, n.mouseDownY = b.y, n.dispatchEventToScenes("mousedown", b), n.dispatchEvent("mousedown", b)\r\n            }\r\n\r\n            function h(a) {\r\n                var b = d(a);\r\n                n.dispatchEventToScenes("mouseup", b), n.dispatchEvent("mouseup", b), n.mouseDown = !1, n.needRepaint = 0 == n.animate ? !1 : !0\r\n            }\r\n\r\n            function i(a) {\r\n                p && (window.clearTimeout(p), p = null), o = !1;\r\n                var b = d(a);\r\n                n.mouseDown ? 0 == a.button && (b.dx = b.x - n.mouseDownX, b.dy = b.y - n.mouseDownY, n.dispatchEventToScenes("mousedrag", b), n.dispatchEvent("mousedrag", b), 1 == n.eagleEye.visible && n.eagleEye.update()) : (n.dispatchEventToScenes("mousemove", b), n.dispatchEvent("mousemove", b))\r\n            }\r\n\r\n            function j(a) {\r\n                var b = d(a);\r\n                n.dispatchEventToScenes("click", b), n.dispatchEvent("click", b)\r\n            }\r\n\r\n            function k(a) {\r\n                var b = d(a);\r\n                n.dispatchEventToScenes("dbclick", b), n.dispatchEvent("dbclick", b)\r\n            }\r\n\r\n            function l(a) {\r\n                var b = d(a);\r\n                n.dispatchEventToScenes("mousewheel", b), n.dispatchEvent("mousewheel", b), null != n.wheelZoom && (a.preventDefault ? a.preventDefault() : (a = a || window.event, a.returnValue = !1), 1 == n.eagleEye.visible && n.eagleEye.update())\r\n            }\r\n\r\n            function m(b) {\r\n                jtopo.util.isIE || !window.addEventListener ? (b.onmouseout = f, b.onmouseover = e, b.onmousedown = g, b.onmouseup = h, b.onmousemove = i, b.onclick = j, b.ondblclick = k, b.onmousewheel = l, b.touchstart = g, b.touchmove = i, b.touchend = h) : (b.addEventListener("mouseout", f), b.addEventListener("mouseover", e), b.addEventListener("mousedown", g), b.addEventListener("mouseup", h), b.addEventListener("mousemove", i), b.addEventListener("click", j), b.addEventListener("dblclick", k), jtopo.util.isFirefox ? b.addEventListener("DOMMouseScroll", l) : b.addEventListener("mousewheel", l)), window.addEventListener && (window.addEventListener("keydown", function (b) {\r\n                    n.dispatchEventToScenes("keydown", jtopo.util.cloneEvent(b));\r\n                    var c = b.keyCode;\r\n                    (37 == c || 38 == c || 39 == c || 40 == c) && (b.preventDefault ? b.preventDefault() : (b = b || window.event, b.returnValue = !1))\r\n                }, !0), window.addEventListener("keyup", function (b) {\r\n                    n.dispatchEventToScenes("keyup", jtopo.util.cloneEvent(b));\r\n                    var c = b.keyCode;\r\n                    (37 == c || 38 == c || 39 == c || 40 == c) && (b.preventDefault ? b.preventDefault() : (b = b || window.event, b.returnValue = !1))\r\n                }, !0))\r\n            }\r\n\r\n            jtopo.stage = this;\r\n            var n = this;\r\n            var self = this;\r\n            this.initialize = function (c) {\r\n                m(c), this.canvas = c, this.graphics = c.getContext("2d"), this.childs = [], this.frames = 24, this.messageBus = new jtopo.util.MessageBus, this.eagleEye = b(this), this.wheelZoom = null, this.mouseDownX = 0, this.mouseDownY = 0, this.mouseDown = !1, this.mouseOver = !1, this.needRepaint = !0, this.serializedProperties = ["frames", "wheelZoom"]\r\n            }, null != c && this.initialize(c);\r\n            var o = !0, p = null;\r\n            document.oncontextmenu = function () {\r\n                return o\r\n            }, this.dispatchEventToScenes = function (a, b) {\r\n                if (0 != this.frames && (this.needRepaint = !0), 1 == this.eagleEye.visible && -1 != a.indexOf("mouse")) {\r\n                    var c = b.x, d = b.y;\r\n                    if (c > this.width - this.eagleEye.width && d > this.height - this.eagleEye.height)return void this.eagleEye.eventHandler(a, b, this)\r\n                }\r\n                this.childs.forEach(function (c) {\r\n                    if (1 == c.visible) {\r\n                        var d = c[a + "Handler"];\r\n                        if (null == d)throw new Error("Function not found:" + a + "Handler");\r\n                        d.call(c, b)\r\n                    }\r\n                })\r\n            }, this.add = function (a) {\r\n                for (var b = 0; b < this.childs.length; b++)if (this.childs[b] === a)return;\r\n                a.addTo(this), this.childs.push(a)\r\n            }, this.remove = function (a) {\r\n                if (null == a)throw new Error("Stage.remove出错: 参数为null!");\r\n                for (var b = 0; b < this.childs.length; b++)if (this.childs[b] === a)return a.stage = null, this.childs = this.childs.del(b), this;\r\n                return this\r\n            }, this.clear = function () {\r\n                this.childs = []\r\n            }, this.addEventListener = function (eventName, fn) {\r\n                var self = this;\r\n                var b = function (e) {\r\n                    fn.call(self, e);\r\n                };\r\n                this.messageBus.subscribe(eventName, fn);\r\n                return this;\r\n            }, this.removeEventListener = function (a, f) {\r\n                this.messageBus.unsubscribe(a, f)\r\n            }, this.removeAllEventListener = function () {\r\n                this.messageBus = new jtopo.util.MessageBus\r\n            }, this.dispatchEvent = function (a, b) {\r\n                return this.messageBus.publish(a, b), this\r\n            };\r\n            var q = "click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,mousewheel,touchstart,touchmove,touchend,keydown,keyup".split(","), r = this;\r\n            q.forEach(function (a) {\r\n                r[a] = function (b) {\r\n                    null != b ? this.addEventListener(a, b) : this.dispatchEvent(a)\r\n                }\r\n            }), this.saveImageInfo = function (a, b) {\r\n                var c = this.eagleEye.getImage(a, b), d = window.open("about:blank");\r\n                return d.document.write("<img src=\'" + c + "\' alt=\'from canvas\'/>"), this\r\n            }, this.saveAsLocalImage = function (a, b) {\r\n                var c = this.eagleEye.getImage(a, b);\r\n                return c.replace("image/png", "image/octet-stream"), window.location.href = c, this\r\n            }, this.paint = function () {\r\n                null != this.canvas && (this.graphics.save(), this.graphics.clearRect(0, 0, this.width, this.height), this.childs.forEach(function (a) {\r\n                    1 == a.visible && a.repaint(n.graphics)\r\n                }), 1 == this.eagleEye.visible && this.eagleEye.paint(this), this.graphics.restore())\r\n            }, this.repaint = function () {\r\n                0 != this.frames && (this.frames < 0 && 0 == this.needRepaint || (this.paint(), this.frames < 0 && (this.needRepaint = !1)))\r\n            }, this.zoom = function (a) {\r\n                this.childs.forEach(function (b) {\r\n                    0 != b.visible && b.zoom(a)\r\n                })\r\n            }, this.zoomOut = function (a) {\r\n                this.childs.forEach(function (b) {\r\n                    0 != b.visible && b.zoomOut(a)\r\n                })\r\n            }, this.zoomIn = function (a) {\r\n                this.childs.forEach(function (b) {\r\n                    0 != b.visible && b.zoomIn(a)\r\n                })\r\n            }, this.centerAndZoom = function () {\r\n                this.childs.forEach(function (a) {\r\n                    0 != a.visible && a.centerAndZoom()\r\n                })\r\n            }, this.setCenter = function (a, b) {\r\n                var c = this;\r\n                this.childs.forEach(function (d) {\r\n                    var e = a - c.canvas.width / 2, f = b - c.canvas.height / 2;\r\n                    d.translateX = -e, d.translateY = -f\r\n                })\r\n            }, this.getBound = function () {\r\n                var a = {left: Number.MAX_VALUE, right: Number.MIN_VALUE, top: Number.MAX_VALUE, bottom: Number.MIN_VALUE};\r\n                return this.childs.forEach(function (b) {\r\n                    var c = b.getElementsBound();\r\n                    c.left < a.left && (a.left = c.left, a.leftNode = c.leftNode), c.top < a.top && (a.top = c.top, a.topNode = c.topNode), c.right > a.right && (a.right = c.right, a.rightNode = c.rightNode), c.bottom > a.bottom && (a.bottom = c.bottom, a.bottomNode = c.bottomNode)\r\n                }), a.width = a.right - a.left, a.height = a.bottom - a.top, a\r\n            }, this.toJson = function () {\r\n                {\r\n                    var b = this, c = \'{"version":"\' + jtopo.version + \'",\';\r\n                    this.serializedProperties.length\r\n                }\r\n                return this.serializedProperties.forEach(function (a) {\r\n                    var d = b[a];\r\n                    "string" == typeof d && (d = \'"\' + d + \'"\'), c += \'"\' + a + \'":\' + d + ","\r\n                }), c += \'"childs":[\', this.childs.forEach(function (a) {\r\n                    c += a.toJson()\r\n                }), c += "]", c += "}"\r\n            }, function () {\r\n                0 == n.frames ? setTimeout(arguments.callee, 100) : n.frames < 0 ? (n.repaint(), setTimeout(arguments.callee, 1e3 / -n.frames)) : (n.repaint(), setTimeout(arguments.callee, 1e3 / n.frames))\r\n            }(), setTimeout(function () {\r\n                n.mousewheel(function (a) {\r\n                    var b = null == a.wheelDelta ? a.detail : a.wheelDelta;\r\n                    null != self.wheelZoom && (b > 0 ? self.zoomIn(self.wheelZoom) : self.zoomOut(self.wheelZoom))\r\n                }), n.paint()\r\n            }, 300), setTimeout(function () {\r\n                n.paint()\r\n            }, 1e3), setTimeout(function () {\r\n                n.paint()\r\n            }, 3e3)\r\n        }\r\n\r\n        stage.prototype = {\r\n            get width() {\r\n                return this.canvas.width\r\n            }, get height() {\r\n                return this.canvas.height\r\n            }, set cursor(a) {\r\n                this.canvas.style.cursor = a\r\n            }, get cursor() {\r\n                return this.canvas.style.cursor\r\n            }, set mode(a) {\r\n                this.childs.forEach(function (b) {\r\n                    b.mode = a\r\n                })\r\n            }\r\n        }, jtopo.Stage = stage\r\n    }(JTopo),\r\n    function (jtopo) {\r\n        function scene(c) {\r\n            function d(a, b, c, d) {\r\n                return function (e) {\r\n                    e.beginPath(), e.strokeStyle = "rgba(0,0,236,0.5)", e.fillStyle = "rgba(0,0,236,0.1)", e.rect(a, b, c, d), e.fill(), e.stroke(), e.closePath()\r\n                }\r\n            }\r\n\r\n            var scene_self = this;\r\n            this.initialize = function () {\r\n                scene.prototype.initialize.apply(this, arguments);\r\n                this.messageBus = new jtopo.util.MessageBus;\r\n                this.elementType = "scene";\r\n                this.childs = [];\r\n                this.zIndexMap = {};\r\n                this.zIndexArray = [];\r\n                this.backgroundColor = "255,255,255";\r\n                this.visible = !0;\r\n                this.alpha = 0;\r\n                this.scaleX = 1;\r\n                this.scaleY = 1;\r\n                this.mode = jtopo.SceneMode.normal;\r\n                this.translate = !0;\r\n                this.translateX = 0;\r\n                this.translateY = 0;\r\n                this.lastTranslateX = 0;\r\n                this.lastTranslateY = 0;\r\n                this.mouseDown = !1;\r\n                this.mouseDownX = null;\r\n                this.mouseDownY = null;\r\n                this.mouseDownEvent = null;\r\n                this.areaSelect = !0;\r\n                this.operations = [];\r\n                this.selectedElements = [];\r\n                this.paintAll = !1;\r\n                var c = "background,backgroundColor,mode,paintAll,areaSelect,translate,translateX,translateY,lastTranslatedX,lastTranslatedY,alpha,visible,scaleX,scaleY".split(",");\r\n                this.serializedProperties = this.serializedProperties.concat(c);\r\n            };\r\n            this.initialize();\r\n            this.setBackground = function (a) {\r\n                this.background = a\r\n            };\r\n            this.addTo = function (a) {\r\n                this.stage !== a && null != a && (this.stage = a)\r\n            };\r\n            null != c && (c.add(this), this.addTo(c)), this.show = function () {\r\n                this.visible = !0\r\n            };\r\n            this.hide = function () {\r\n                this.visible = !1\r\n            };\r\n            this.paint = function (a) {\r\n                if (0 != this.visible && null != this.stage) {\r\n                    if (a.save(), this.paintBackgroud(a), a.restore(), a.save(), a.scale(this.scaleX, this.scaleY), 1 == this.translate) {\r\n                        var b = this.getOffsetTranslate(a);\r\n                        a.translate(b.translateX, b.translateY)\r\n                    }\r\n                    this.paintChilds(a), a.restore(), a.save(), this.paintOperations(a, this.operations), a.restore()\r\n                }\r\n            };\r\n            this.repaint = function (a) {\r\n                0 != this.visible && this.paint(a)\r\n            };\r\n            this.paintBackgroud = function (a) {\r\n                null != this.background ? a.drawImage(this.background, 0, 0, a.canvas.width, a.canvas.height) : (a.beginPath(), a.fillStyle = "rgba(" + this.backgroundColor + "," + this.alpha + ")", a.fillRect(0, 0, a.canvas.width, a.canvas.height), a.closePath())\r\n            };\r\n            this.getDisplayedElements = function () {\r\n                for (var a = [], b = 0; b < this.zIndexArray.length; b++)for (var c = this.zIndexArray[b], d = this.zIndexMap[c], e = 0; e < d.length; e++) {\r\n                    var f = d[e];\r\n                    this.isVisiable(f) && a.push(f)\r\n                }\r\n                return a\r\n            };\r\n            this.getDisplayedNodes = function () {\r\n                for (var b = [], c = 0; c < this.childs.length; c++) {\r\n                    var d = this.childs[c];\r\n                    d instanceof jtopo.Node && this.isVisiable(d) && b.push(d)\r\n                }\r\n                return b\r\n            };\r\n            this.paintChilds = function (context) {\r\n                for (var i = 0; i < this.zIndexArray.length; i++) {\r\n                    var zIndex = this.zIndexArray[i];\r\n                    var zIndexElements = this.zIndexMap[zIndex];\r\n                    for (var j = 0; j < zIndexElements.length; j++) {\r\n                        var element = zIndexElements[j];\r\n                        if (1 == this.paintAll || this.isVisiable(element)) {\r\n                            context.save();\r\n                            if (1 == element.transformAble) {\r\n                                var center = element.getCenterLocation();\r\n                                context.translate(center.x, center.y);\r\n                                if (element.rotate) {\r\n                                    context.rotate(element.rotate);\r\n                                }\r\n                                if (element.scaleX && element.scaleY) {\r\n                                    context.scale(element.scaleX, element.scaleY)\r\n                                } else if (element.scaleX) {\r\n                                    context.scale(element.scaleX, 1);\r\n                                } else if (element.scaleY) {\r\n                                    context.scale(1, element.scaleY);\r\n                                }\r\n                            }\r\n                            if (1 == element.shadow) {\r\n                                context.shadowBlur = element.shadowBlur;\r\n                                context.shadowColor = element.shadowColor;\r\n                                context.shadowOffsetX = element.shadowOffsetX;\r\n                                context.shadowOffsetY = element.shadowOffsetY;\r\n                            }\r\n                            if (element instanceof jtopo.InteractiveElement) {\r\n                                if (element.selected && 1 == element.showSelected) {\r\n                                    element.paintSelected(context)\r\n                                }\r\n                                if (1 == element.isMouseOver) {\r\n                                    element.paintMouseover(context)\r\n                                }\r\n                            }\r\n                            element.paint(context);\r\n                            context.restore();\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            this.getOffsetTranslate = function (a) {\r\n                var b = this.stage.canvas.width, c = this.stage.canvas.height;\r\n                null != a && "move" != a && (b = a.canvas.width, c = a.canvas.height);\r\n                var d = b / this.scaleX / 2, e = c / this.scaleY / 2, f = {translateX: this.translateX + (d - d * this.scaleX), translateY: this.translateY + (e - e * this.scaleY)};\r\n                return f\r\n            };\r\n            this.isVisiable = function (b) {\r\n                if (1 != b.visible)return !1;\r\n                if (b instanceof jtopo.Link)return !0;\r\n                var c = this.getOffsetTranslate(), d = b.x + c.translateX, e = b.y + c.translateY;\r\n                d *= this.scaleX, e *= this.scaleY;\r\n                var f = d + b.width * this.scaleX, g = e + b.height * this.scaleY;\r\n                return d > this.stage.canvas.width || e > this.stage.canvas.height || 0 > f || 0 > g ? !1 : !0\r\n            };\r\n            this.paintOperations = function (a, b) {\r\n                for (var c = 0; c < b.length; c++)b[c](a)\r\n            };\r\n            this.findElements = function (a) {\r\n                for (var b = [], c = 0; c < this.childs.length; c++)1 == a(this.childs[c]) && b.push(this.childs[c]);\r\n                return b\r\n            };\r\n            this.getElementsByClass = function (a) {\r\n                return this.findElements(function (b) {\r\n                    return b instanceof a\r\n                })\r\n            };\r\n            this.addOperation = function (a) {\r\n                return this.operations.push(a), this\r\n            };\r\n            this.clearOperations = function () {\r\n                return this.operations = [], this\r\n            };\r\n            this.getElementByXY = function (b, c) {\r\n                for (var d = null, e = this.zIndexArray.length - 1; e >= 0; e--)for (var f = this.zIndexArray[e], g = this.zIndexMap[f], h = g.length - 1; h >= 0; h--) {\r\n                    var i = g[h];\r\n                    if (i instanceof jtopo.InteractiveElement && this.isVisiable(i) && i.isInBound(b, c))return d = i\r\n                }\r\n                return d\r\n            };\r\n            this.add = function (a) {\r\n                this.childs.push(a);\r\n                if (null == this.zIndexMap[a.zIndex]) {\r\n                    this.zIndexMap[a.zIndex] = [];\r\n                    this.zIndexArray.push(a.zIndex);\r\n                    this.zIndexArray.sort(function (a, b) {\r\n                        return a - b\r\n                    });\r\n                }\r\n                this.zIndexMap["" + a.zIndex].push(a);\r\n            };\r\n            this.remove = function (item) {\r\n                this.childs = jtopo.util.removeFromArray(this.childs, item);\r\n                var elements = this.zIndexMap[item.zIndex];\r\n                if (elements) {\r\n                    this.zIndexMap[item.zIndex] = jtopo.util.removeFromArray(elements, item);\r\n                }\r\n                item.removeHandler(this);\r\n            };\r\n            this.clear = function () {\r\n                var self = this;\r\n                this.childs.forEach(function (child) {\r\n                    child.removeHandler(self);\r\n                });\r\n                this.childs = [];\r\n                this.operations = [];\r\n                this.zIndexArray = [];\r\n                this.zIndexMap = {};\r\n            };\r\n            this.addToSelected = function (a) {\r\n                this.selectedElements.push(a)\r\n            };\r\n            this.cancleAllSelected = function (a) {\r\n                for (var b = 0; b < this.selectedElements.length; b++)this.selectedElements[b].unselectedHandler(a);\r\n                this.selectedElements = []\r\n            };\r\n            this.notInSelectedNodes = function (a) {\r\n                for (var b = 0; b < this.selectedElements.length; b++)if (a === this.selectedElements[b])return !1;\r\n                return !0\r\n            };\r\n            this.removeFromSelected = function (a) {\r\n                for (var b = 0; b < this.selectedElements.length; b++) {\r\n                    var c = this.selectedElements[b];\r\n                    a === c && (this.selectedElements = this.selectedElements.del(b))\r\n                }\r\n            };\r\n            this.toSceneEvent = function (b) {\r\n                var c = jtopo.util.clone(b);\r\n                if (c.x /= this.scaleX, c.y /= this.scaleY, 1 == this.translate) {\r\n                    var d = this.getOffsetTranslate();\r\n                    c.x -= d.translateX, c.y -= d.translateY\r\n                }\r\n                return null != c.dx && (c.dx /= this.scaleX, c.dy /= this.scaleY), null != this.currentElement && (c.target = this.currentElement), c.scene = this, c\r\n            };\r\n            this.selectElement = function (a) {\r\n                var b = scene_self.getElementByXY(a.x, a.y);\r\n                if (null != b)if (a.target = b, b.mousedownHander(a), b.selectedHandler(a), scene_self.notInSelectedNodes(b))a.ctrlKey || scene_self.cancleAllSelected(), scene_self.addToSelected(b); else {\r\n                    1 == a.ctrlKey && (b.unselectedHandler(), this.removeFromSelected(b));\r\n                    for (var c = 0; c < this.selectedElements.length; c++) {\r\n                        var d = this.selectedElements[c];\r\n                        d.selectedHandler(a)\r\n                    }\r\n                } else a.ctrlKey || scene_self.cancleAllSelected();\r\n                this.currentElement = b\r\n            };\r\n            this.mousedownHandler = function (b) {\r\n                var c = this.toSceneEvent(b);\r\n                if (this.mouseDown = !0, this.mouseDownX = c.x, this.mouseDownY = c.y, this.mouseDownEvent = c, this.mode == jtopo.SceneMode.normal)this.selectElement(c), (null == this.currentElement || this.currentElement instanceof jtopo.Link) && 1 == this.translate && (this.lastTranslateX = this.translateX, this.lastTranslateY = this.translateY); else {\r\n                    if (this.mode == jtopo.SceneMode.drag && 1 == this.translate)return this.lastTranslateX = this.translateX, void(this.lastTranslateY = this.translateY);\r\n                    this.mode == jtopo.SceneMode.select ? this.selectElement(c) : this.mode == jtopo.SceneMode.edit && (this.selectElement(c), (null == this.currentElement || this.currentElement instanceof jtopo.Link) && 1 == this.translate && (this.lastTranslateX = this.translateX, this.lastTranslateY = this.translateY))\r\n                }\r\n                scene_self.dispatchEvent("mousedown", c)\r\n            };\r\n            this.mouseupHandler = function (b) {\r\n                this.stage.cursor != jtopo.MouseCursor.normal && (this.stage.cursor = jtopo.MouseCursor.normal), scene_self.clearOperations();\r\n                var c = this.toSceneEvent(b);\r\n                null != this.currentElement && (c.target = scene_self.currentElement, this.currentElement.mouseupHandler(c)), this.dispatchEvent("mouseup", c), this.mouseDown = !1\r\n            };\r\n            this.dragElements = function (b) {\r\n                if (null != this.currentElement && 1 == this.currentElement.dragable)for (var c = 0; c < this.selectedElements.length; c++) {\r\n                    var d = this.selectedElements[c];\r\n                    if (0 != d.dragable) {\r\n                        var e = jtopo.util.clone(b);\r\n                        e.target = d, d.mousedragHandler(e)\r\n                    }\r\n                }\r\n            };\r\n            this.mousedragHandler = function (b) {\r\n                var c = this.toSceneEvent(b);\r\n                this.mode == jtopo.SceneMode.normal ? null == this.currentElement || this.currentElement instanceof jtopo.Link ? 1 == this.translate && (this.stage.cursor = jtopo.MouseCursor.closed_hand, this.translateX = this.lastTranslateX + c.dx, this.translateY = this.lastTranslateY + c.dy) : this.dragElements(c) : this.mode == jtopo.SceneMode.drag ? 1 == this.translate && (this.stage.cursor = jtopo.MouseCursor.closed_hand, this.translateX = this.lastTranslateX + c.dx, this.translateY = this.lastTranslateY + c.dy) : this.mode == jtopo.SceneMode.select ? null != this.currentElement ? 1 == this.currentElement.dragable && this.dragElements(c) : 1 == this.areaSelect && this.areaSelectHandle(c) : this.mode == jtopo.SceneMode.edit && (null == this.currentElement || this.currentElement instanceof jtopo.Link ? 1 == this.translate && (this.stage.cursor = jtopo.MouseCursor.closed_hand, this.translateX = this.lastTranslateX + c.dx, this.translateY = this.lastTranslateY + c.dy) : this.dragElements(c)), this.dispatchEvent("mousedrag", c)\r\n            };\r\n            this.areaSelectHandle = function (a) {\r\n                var b = a.offsetLeft, c = a.offsetTop, f = this.mouseDownEvent.offsetLeft, g = this.mouseDownEvent.offsetTop, h = b >= f ? f : b, i = c >= g ? g : c, j = Math.abs(a.dx) * this.scaleX, k = Math.abs(a.dy) * this.scaleY, l = new d(h, i, j, k);\r\n                scene_self.clearOperations().addOperation(l), b = a.x, c = a.y, f = this.mouseDownEvent.x, g = this.mouseDownEvent.y, h = b >= f ? f : b, i = c >= g ? g : c, j = Math.abs(a.dx), k = Math.abs(a.dy);\r\n                for (var m = h + j, n = i + k, o = 0; o < scene_self.childs.length; o++) {\r\n                    var p = scene_self.childs[o];\r\n                    p.x > h && p.x + p.width < m && p.y > i && p.y + p.height < n && scene_self.notInSelectedNodes(p) && (p.selectedHandler(a), scene_self.addToSelected(p))\r\n                }\r\n            };\r\n            this.mousemoveHandler = function (b) {\r\n                this.mousecoord = {\r\n                    x: b.x,\r\n                    y: b.y\r\n                };\r\n                var c = this.toSceneEvent(b);\r\n                if (this.mode == jtopo.SceneMode.drag) {\r\n                    return void(this.stage.cursor = jtopo.MouseCursor.open_hand);\r\n                }\r\n                if (this.mode == jtopo.SceneMode.normal) {\r\n                    this.stage.cursor = jtopo.MouseCursor.normal;\r\n                } else if (this.mode == jtopo.SceneMode.select) {\r\n                    this.stage.cursor = jtopo.MouseCursor.normal;\r\n                }\r\n\r\n                var d = scene_self.getElementByXY(c.x, c.y);\r\n                if (null != d) {\r\n                    if (scene_self.mouseOverelement && scene_self.mouseOverelement !== d) {\r\n                        c.target = d, scene_self.mouseOverelement.mouseoutHandler(c)\r\n                    }\r\n                    scene_self.mouseOverelement = d;\r\n                    if (0 == d.isMouseOver) {\r\n                        c.target = d;\r\n                        d.mouseoverHandler(c);\r\n                        scene_self.dispatchEvent("mouseover", c);\r\n                    } else {\r\n                        c.target = d;\r\n                        d.mousemoveHandler(c);\r\n                        scene_self.dispatchEvent("mousemove", c);\r\n                    }\r\n                } else {\r\n                    if (scene_self.mouseOverelement) {\r\n                        c.target = d;\r\n                        scene_self.mouseOverelement.mouseoutHandler(c);\r\n                        scene_self.mouseOverelement = null;\r\n                        scene_self.dispatchEvent("mouseout", c);\r\n                    } else {\r\n                        c.target = null;\r\n                        scene_self.dispatchEvent("mousemove", c)\r\n                    }\r\n                }\r\n            }, this.mouseoverHandler = function (a) {\r\n                var b = this.toSceneEvent(a);\r\n                this.dispatchEvent("mouseover", b)\r\n            }, this.mouseoutHandler = function (a) {\r\n                var b = this.toSceneEvent(a);\r\n                this.dispatchEvent("mouseout", b)\r\n            }, this.clickHandler = function (a) {\r\n                var b = this.toSceneEvent(a);\r\n                this.currentElement && (b.target = this.currentElement, this.currentElement.clickHandler(b)), this.dispatchEvent("click", b)\r\n            }, this.dbclickHandler = function (a) {\r\n                var b = this.toSceneEvent(a);\r\n                this.currentElement ? (b.target = this.currentElement, this.currentElement.dbclickHandler(b)) : scene_self.cancleAllSelected(), this.dispatchEvent("dbclick", b)\r\n            }, this.mousewheelHandler = function (a) {\r\n                var b = this.toSceneEvent(a);\r\n                this.dispatchEvent("mousewheel", b)\r\n            }, this.touchstart = this.mousedownHander, this.touchmove = this.mousedragHandler, this.touchend = this.mousedownHander, this.keydownHandler = function (a) {\r\n                this.dispatchEvent("keydown", a)\r\n            }, this.keyupHandler = function (a) {\r\n                this.dispatchEvent("keyup", a)\r\n            }, this.addEventListener = function (eventName, fn) {\r\n                var self = this;\r\n                var b = function (e) {\r\n                    fn.call(self, e);\r\n                };\r\n                this.messageBus.subscribe(eventName, fn);\r\n                return this;\r\n            }, this.removeEventListener = function (a, f) {\r\n                this.messageBus.unsubscribe(a, f)\r\n            }, this.removeAllEventListener = function () {\r\n                this.messageBus = new jtopo.util.MessageBus\r\n            }, this.dispatchEvent = function (a, b) {\r\n                return this.messageBus.publish(a, b), this\r\n            };\r\n            var f = "click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,mousewheel,touchstart,touchmove,touchend,keydown,keyup".split(","), g = this;\r\n            return f.forEach(function (a) {\r\n                g[a] = function (b) {\r\n                    null != b ? this.addEventListener(a, b) : this.dispatchEvent(a)\r\n                }\r\n            }), this.zoom = function (a, b) {\r\n                null != a && 0 != a && (this.scaleX = a), null != b && 0 != b && (this.scaleY = b)\r\n            }, this.zoomOut = function (a) {\r\n                0 != a && (null == a && (a = .8), this.scaleX /= a, this.scaleY /= a)\r\n            }, this.zoomIn = function (a) {\r\n                0 != a && (null == a && (a = .8), this.scaleX *= a, this.scaleY *= a)\r\n            }, this.getBound = function () {\r\n                return {left: 0, top: 0, right: this.stage.canvas.width, bottom: this.stage.canvas.height, width: this.stage.canvas.width, height: this.stage.canvas.height}\r\n            }, this.getElementsBound = function () {\r\n                return jtopo.util.getElementsBound(this.childs)\r\n            }, this.translateToCenter = function (a) {\r\n                var b = this.getElementsBound(), c = this.stage.canvas.width / 2 - (b.left + b.right) / 2, d = this.stage.canvas.height / 2 - (b.top + b.bottom) / 2;\r\n                a && (c = a.canvas.width / 2 - (b.left + b.right) / 2, d = a.canvas.height / 2 - (b.top + b.bottom) / 2), this.translateX = c, this.translateY = d\r\n            }, this.setCenter = function (a, b) {\r\n                var c = a - this.stage.canvas.width / 2, d = b - this.stage.canvas.height / 2;\r\n                this.translateX = -c, this.translateY = -d\r\n            }, this.centerAndZoom = function (a, b, c) {\r\n                if (this.translateToCenter(c), null == a || null == b) {\r\n                    var d = this.getElementsBound(), e = d.right - d.left, f = d.bottom - d.top, g = this.stage.canvas.width / e, h = this.stage.canvas.height / f;\r\n                    c && (g = c.canvas.width / e, h = c.canvas.height / f);\r\n                    var i = Math.min(g, h);\r\n                    if (i > 1)return;\r\n                    this.zoom(i, i)\r\n                }\r\n                this.zoom(a, b)\r\n            }, this.getCenterLocation = function () {\r\n                return {x: scene_self.stage.canvas.width / 2, y: scene_self.stage.canvas.height / 2}\r\n            }, this.doLayout = function (a) {\r\n                a && a(this, this.childs)\r\n            }, this.toJson = function () {\r\n                {\r\n                    var a = this, b = "{";\r\n                    this.serializedProperties.length\r\n                }\r\n                this.serializedProperties.forEach(function (c) {\r\n                    var d = a[c];\r\n                    "background" == c && (d = a._background.src), "string" == typeof d && (d = \'"\' + d + \'"\'), b += \'"\' + c + \'":\' + d + ","\r\n                }), b += \'"childs":[\';\r\n                var c = this.childs.length;\r\n                return this.childs.forEach(function (a, d) {\r\n                    b += a.toJson(), c > d + 1 && (b += ",")\r\n                }), b += "]", b += "}"\r\n            }, scene_self\r\n        }\r\n\r\n        scene.prototype = new jtopo.Element;\r\n        var c = {};\r\n        Object.defineProperties(scene.prototype, {\r\n            background: {\r\n                get: function () {\r\n                    return this._background\r\n                }, set: function (a) {\r\n                    if ("string" == typeof a) {\r\n                        var b = c[a];\r\n                        null == b && (b = new Image, b.src = a, b.onload = function () {\r\n                            c[a] = b\r\n                        }), this._background = b\r\n                    } else this._background = a\r\n                }\r\n            }\r\n        }), jtopo.Scene = scene\r\n    }(JTopo),\r\n    function (jtopo) {\r\n        function DisplayElement() {\r\n            this.initialize = function () {\r\n                DisplayElement.prototype.initialize.apply(this, arguments);\r\n                this.elementType = "displayElement";\r\n                this.x = 0;\r\n                this.y = 0;\r\n                this.width = 32;\r\n                this.height = 32;\r\n                this.visible = !0;\r\n                this.alpha = 1;\r\n                this.rotate = 0;\r\n                this.scaleX = 1;\r\n                this.scaleY = 1;\r\n                this.strokeColor = "22,124,255";\r\n                this.borderColor = "22,124,255";\r\n                this.fillColor = "22,124,255";\r\n                this.shadow = !1;\r\n                this.shadowBlur = 5;\r\n                this.shadowColor = "rgba(0,0,0,0.5)";\r\n                this.shadowOffsetX = 3;\r\n                this.shadowOffsetY = 6;\r\n                this.transformAble = !1;\r\n                this.zIndex = 0;\r\n                var a = "x,y,width,height,visible,alpha,rotate,scaleX,scaleY,strokeColor,fillColor,shadow,shadowColor,shadowOffsetX,shadowOffsetY,transformAble,zIndex".split(",");\r\n                this.serializedProperties = this.serializedProperties.concat(a)\r\n            };\r\n            this.initialize();\r\n            this.paint = function (a) {\r\n                a.beginPath();\r\n                a.fillStyle = "rgba(" + this.fillColor + "," + this.alpha + ")";\r\n                a.rect(-this.width / 2, -this.height / 2, this.width, this.height);\r\n                a.fill();\r\n                a.stroke();\r\n                a.closePath();\r\n            };\r\n            this.getLocation = function () {\r\n                return {\r\n                    x: this.x,\r\n                    y: this.y\r\n                }\r\n            };\r\n            this.setLocation = function (a, b) {\r\n                if (this.qtopo && this.qtopo.attr && this.qtopo.attr.position) {\r\n                    this.qtopo.attr.position[0] = a;\r\n                    this.qtopo.attr.position[1] = b;\r\n                }\r\n                return this.x = a, this.y = b, this\r\n            };\r\n            this.getCenterLocation = function () {\r\n                return {\r\n                    x: this.x + this.width / 2,\r\n                    y: this.y + this.height / 2\r\n                }\r\n            };\r\n            this.setCenterLocation = function (a, b) {\r\n                this.x = a - this.width / 2;\r\n                this.y = b - this.height / 2;\r\n                return this;\r\n            };\r\n            this.getSize = function () {\r\n                return {\r\n                    width: this.width,\r\n                    height: this.heith\r\n                }\r\n            };\r\n            this.setSize = function (a, b) {\r\n                this.width = a;\r\n                this.height = b;\r\n                return this;\r\n            };\r\n            this.getBound = function () {\r\n                return {\r\n                    left: this.x,\r\n                    top: this.y,\r\n                    right: this.x + this.width,\r\n                    bottom: this.y + this.height,\r\n                    width: this.width,\r\n                    height: this.height\r\n                }\r\n            };\r\n            this.setBound = function (a, b, c, d) {\r\n                this.setLocation(a, b);\r\n                this.setSize(c, d);\r\n                return this;\r\n            };\r\n            this.getDisplayBound = function () {\r\n                return {\r\n                    left: this.x,\r\n                    top: this.y,\r\n                    right: this.x + this.width * this.scaleX,\r\n                    bottom: this.y + this.height * this.scaleY\r\n                }\r\n            };\r\n            this.getDisplaySize = function () {\r\n                return {\r\n                    width: this.width * this.scaleX,\r\n                    height: this.height * this.scaleY\r\n                }\r\n            };\r\n            this.getPosition = function (a) {\r\n                var position,\r\n                    c = this.getBound();\r\n                switch (a) {\r\n                    case "Top_Left":\r\n                        position = {x: c.left, y: c.top};\r\n                        break;\r\n                    case "Top_Center":\r\n                        position = {x: this.cx, y: c.top};\r\n                        break;\r\n                    case "Top_Right":\r\n                        position = {x: c.right, y: c.top};\r\n                        break;\r\n                    case "Middle_Left":\r\n                        position = {x: c.left, y: this.cy};\r\n                        break;\r\n                    case "Middle_Center":\r\n                        position = {x: this.cx, y: this.cy};\r\n                        break;\r\n                    case "Middle_Right":\r\n                        position = {x: c.right, y: this.cy};\r\n                        break;\r\n                    case "Bottom_Left":\r\n                        position = {x: c.left, y: c.bottom};\r\n                        break;\r\n                    case "Bottom_Center":\r\n                        position = {x: this.cx, y: c.bottom};\r\n                        break;\r\n                    case  "Bottom_Right":\r\n                        position = {x: c.right, y: c.bottom};\r\n                        break;\r\n                    default:\r\n                        position = {x: c.left, y: c.top};\r\n                }\r\n                return position;\r\n            };\r\n        }\r\n\r\n        function interactiveElement() {\r\n            this.initialize = function () {\r\n                interactiveElement.prototype.initialize.apply(this, arguments);\r\n                this.elementType = "interactiveElement";\r\n                this.dragable = !1;\r\n                this.selected = !1;\r\n                this.showSelected = !0;\r\n                this.selectedLocation = null;\r\n                this.isMouseOver = !1;\r\n                var a = "dragable,selected,showSelected,isMouseOver".split(",");\r\n                this.serializedProperties = this.serializedProperties.concat(a);\r\n            };\r\n            this.initialize();\r\n            this.paintSelected = function (a) {\r\n                if (0 != this.showSelected) {\r\n                    a.save();\r\n                    a.beginPath();\r\n                    a.strokeStyle = "rgba(168,202,255, 0.9)";\r\n                    a.fillStyle = "rgba(168,202,236,0.7)";\r\n                    a.rect(-this.width / 2 - 3, -this.height / 2 - 3, this.width + 6, this.height + 6);\r\n                    a.fill();\r\n                    a.stroke();\r\n                    a.closePath();\r\n                    a.restore();\r\n                }\r\n                return this;\r\n            };\r\n            this.paintMouseover = function (a) {\r\n                return this.paintSelected(a);\r\n            };\r\n            this.isInBound = function (pointX, pointY) {\r\n                return pointX > this.x && pointX < this.x + this.width * Math.abs(this.scaleX) && pointY > this.y && pointY < this.y + this.height * Math.abs(this.scaleY)\r\n            };\r\n            this.selectedHandler = function () {\r\n                this.selected = !0;\r\n                this.selectedLocation = {\r\n                    x: this.x,\r\n                    y: this.y\r\n                };\r\n                return this;\r\n            };\r\n            this.unselectedHandler = function () {\r\n                this.selected = !1;\r\n                this.selectedLocation = null;\r\n                return this;\r\n            };\r\n            this.dbclickHandler = function (a) {\r\n                this.dispatchEvent("dbclick", a);\r\n                return this;\r\n            };\r\n            this.clickHandler = function (a) {\r\n                this.dispatchEvent("click", a);\r\n                return this;\r\n            };\r\n            this.mousedownHander = function (a) {\r\n                this.dispatchEvent("mousedown", a);\r\n                return this;\r\n            };\r\n            this.mouseupHandler = function (a) {\r\n                this.dispatchEvent("mouseup", a);\r\n                return this;\r\n            };\r\n            this.mouseoverHandler = function (a) {\r\n                this.isMouseOver = !0;\r\n                this.dispatchEvent("mouseover", a);\r\n                return this;\r\n            };\r\n            this.mousemoveHandler = function (a) {\r\n                this.dispatchEvent("mousemove", a);\r\n                return this;\r\n            };\r\n            this.mouseoutHandler = function (a) {\r\n                this.isMouseOver = !1;\r\n                this.dispatchEvent("mouseout", a);\r\n                return this;\r\n            };\r\n            this.mousedragHandler = function (a) {\r\n                var b = this.selectedLocation.x + a.dx;\r\n                var c = this.selectedLocation.y + a.dy;\r\n                this.setLocation(b, c);\r\n                this.dispatchEvent("mousedrag", a);\r\n                return this;\r\n            };\r\n            this.addEventListener = function (event, fn) {\r\n                if (!this.messageBus) {\r\n                    this.messageBus = new jtopo.util.MessageBus;\r\n                }\r\n                this.messageBus.subscribe(event, fn);\r\n                return this;\r\n            };\r\n            this.dispatchEvent = function (event, e) {\r\n                if (this.messageBus) {\r\n                    this.messageBus.publish(event, e);\r\n                    return this;\r\n                }\r\n            };\r\n            this.removeEventListener = function (event, fn) {\r\n                this.messageBus.unsubscribe(event, fn);\r\n            };\r\n            this.removeAllEventListener = function () {\r\n                this.messageBus = new jtopo.util.MessageBus\r\n            };\r\n            var self = this;\r\n            "click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,touchstart,touchmove,touchend".split(",")\r\n                .forEach(function (eventName) {\r\n                    self[eventName] = function (e) {\r\n                        if (null != e) {\r\n                            this.addEventListener(eventName, e);\r\n                        } else {\r\n                            this.dispatchEvent(eventName);\r\n                        }\r\n                    }\r\n                });\r\n        }\r\n\r\n        function EditableElement() {\r\n            this.initialize = function () {\r\n                EditableElement.prototype.initialize.apply(this, arguments);\r\n                this.editAble = !1;\r\n                this.selectedPoint = null;\r\n            };\r\n            this.getCtrlPosition = function (a) {\r\n                var b = 5;\r\n                var c = 5;\r\n                var d = this.getPosition(a);\r\n                return {\r\n                    left: d.x - b,\r\n                    top: d.y - c,\r\n                    right: d.x + b,\r\n                    bottom: d.y + c\r\n                }\r\n            };\r\n            this.selectedHandler = function (b) {\r\n                EditableElement.prototype.selectedHandler.apply(this, arguments), this.selectedSize = {\r\n                    width: this.width,\r\n                    height: this.height\r\n                };\r\n                if (b.scene.mode == jtopo.SceneMode.edit) {\r\n                    this.editAble = !0\r\n                }\r\n            };\r\n            this.unselectedHandler = function () {\r\n                EditableElement.prototype.unselectedHandler.apply(this, arguments);\r\n                this.selectedSize = null;\r\n                this.editAble = !1;\r\n            };\r\n            var b = ["Top_Left", "Top_Center", "Top_Right", "Middle_Left", "Middle_Right", "Bottom_Left", "Bottom_Center", "Bottom_Right"];\r\n            this.paintCtrl = function (cx) {\r\n                if (0 != this.editAble) {\r\n                    cx.save();\r\n                    for (var c = 0; c < b.length; c++) {\r\n                        var d = this.getCtrlPosition(b[c]);\r\n                        d.left -= this.cx;\r\n                        d.right -= this.cx;\r\n                        d.top -= this.cy;\r\n                        d.bottom -= this.cy;\r\n                        var e = d.right - d.left;\r\n                        var f = d.bottom - d.top;\r\n                        cx.beginPath();\r\n                        cx.strokeStyle = "rgba(0,0,0,0.8)";\r\n                        cx.rect(d.left, d.top, e, f);\r\n                        cx.stroke();\r\n                        cx.closePath();\r\n                        cx.beginPath();\r\n                        cx.strokeStyle = "rgba(255,255,255,0.3)";\r\n                        cx.rect(d.left + 1, d.top + 1, e - 2, f - 2);\r\n                        cx.stroke();\r\n                        cx.closePath();\r\n                    }\r\n                    cx.restore();\r\n                }\r\n            };\r\n            this.isInBound = function (a, c) {\r\n                if (this.selectedPoint = null, 1 == this.editAble)for (var e = 0; e < b.length; e++) {\r\n                    var f = this.getCtrlPosition(b[e]);\r\n                    if (a > f.left && a < f.right && c > f.top && c < f.bottom)return this.selectedPoint = b[e], !0\r\n                }\r\n                return EditableElement.prototype.isInBound.apply(this, arguments)\r\n            };\r\n            this.mousedragHandler = function (a) {\r\n                if (null == this.selectedPoint) {\r\n                    var b = this.selectedLocation.x + a.dx, c = this.selectedLocation.y + a.dy;\r\n                    this.setLocation(b, c), this.dispatchEvent("mousedrag", a)\r\n                } else {\r\n                    if ("Top_Left" == this.selectedPoint) {\r\n                        var d = this.selectedSize.width - a.dx, e = this.selectedSize.height - a.dy, b = this.selectedLocation.x + a.dx, c = this.selectedLocation.y + a.dy;\r\n                        b < this.x + this.width && (this.x = b, this.width = d), c < this.y + this.height && (this.y = c, this.height = e)\r\n                    } else if ("Top_Center" == this.selectedPoint) {\r\n                        var e = this.selectedSize.height - a.dy, c = this.selectedLocation.y + a.dy;\r\n                        c < this.y + this.height && (this.y = c, this.height = e)\r\n                    } else if ("Top_Right" == this.selectedPoint) {\r\n                        var d = this.selectedSize.width + a.dx, c = this.selectedLocation.y + a.dy;\r\n                        c < this.y + this.height && (this.y = c, this.height = this.selectedSize.height - a.dy), d > 1 && (this.width = d)\r\n                    } else if ("Middle_Left" == this.selectedPoint) {\r\n                        var d = this.selectedSize.width - a.dx, b = this.selectedLocation.x + a.dx;\r\n                        b < this.x + this.width && (this.x = b), d > 1 && (this.width = d)\r\n                    } else if ("Middle_Right" == this.selectedPoint) {\r\n                        var d = this.selectedSize.width + a.dx;\r\n                        d > 1 && (this.width = d)\r\n                    } else if ("Bottom_Left" == this.selectedPoint) {\r\n                        var d = this.selectedSize.width - a.dx, b = this.selectedLocation.x + a.dx;\r\n                        d > 1 && (this.x = b, this.width = d);\r\n                        var e = this.selectedSize.height + a.dy;\r\n                        e > 1 && (this.height = e)\r\n                    } else if ("Bottom_Center" == this.selectedPoint) {\r\n                        var e = this.selectedSize.height + a.dy;\r\n                        e > 1 && (this.height = e)\r\n                    } else if ("Bottom_Right" == this.selectedPoint) {\r\n                        var d = this.selectedSize.width + a.dx;\r\n                        d > 1 && (this.width = d);\r\n                        var e = this.selectedSize.height + a.dy;\r\n                        e > 1 && (this.height = e)\r\n                    }\r\n                    this.dispatchEvent("resize", a)\r\n                }\r\n            }\r\n        }\r\n\r\n        DisplayElement.prototype = new jtopo.Element, Object.defineProperties(DisplayElement.prototype, {\r\n            cx: {\r\n                get: function () {\r\n                    return this.x + this.width / 2\r\n                }, set: function (a) {\r\n                    this.x = a - this.width / 2\r\n                }\r\n            }, cy: {\r\n                get: function () {\r\n                    return this.y + this.height / 2\r\n                }, set: function (a) {\r\n                    this.y = a - this.height / 2\r\n                }\r\n            }\r\n        });\r\n        interactiveElement.prototype = new DisplayElement;\r\n        EditableElement.prototype = new interactiveElement;\r\n        jtopo.DisplayElement = DisplayElement;\r\n        jtopo.InteractiveElement = interactiveElement;\r\n        jtopo.EditableElement = EditableElement;\r\n    }(JTopo),\r\n    function (jtopo) {\r\n        function baseNode(c) {\r\n            this.initialize = function (c) {\r\n                baseNode.prototype.initialize.apply(this, arguments), this.elementType = "node", this.zIndex = jtopo.zIndex_Node, this.text = c, this.font = "12px Consolas", this.fontColor = "255,255,255", this.borderWidth = 0, this.borderColor = "255,255,255", this.borderRadius = null, this.dragable = !0, this.textPosition = "Bottom_Center", this.textOffsetX = 0, this.textOffsetY = 0, this.transformAble = !0, this.inLinks = null, this.outLinks = null;\r\n                var d = "text,font,fontColor,textPosition,textOffsetX,textOffsetY,borderRadius".split(",");\r\n                this.serializedProperties = this.serializedProperties.concat(d)\r\n            }, this.initialize(c), this.paint = function (a) {\r\n                if (this.image) {\r\n                    var b = a.globalAlpha;\r\n                    a.globalAlpha = this.alpha, null != this.alarmImage && null != this.alarm ? a.drawImage(this.alarmImage, -this.width / 2, -this.height / 2, this.width, this.height) : a.drawImage(this.image, -this.width / 2, -this.height / 2, this.width, this.height), a.globalAlpha = b\r\n                } else a.beginPath(), a.fillStyle = "rgba(" + this.fillColor + "," + this.alpha + ")", null == this.borderRadius || 0 == this.borderRadius ? a.rect(-this.width / 2, -this.height / 2, this.width, this.height) : a.JTopoRoundRect(-this.width / 2, -this.height / 2, this.width, this.height, this.borderRadius), a.fill(), a.closePath();\r\n                this.paintText(a), this.paintBorder(a), this.paintCtrl(a), this.paintAlarmText(a)\r\n            }, this.paintAlarmText = function (a) {\r\n                if (null != this.alarm && "" != this.alarm) {\r\n                    var b = this.alarmColor || "255,0,0", c = this.alarmAlpha || .5;\r\n                    a.beginPath(), a.font = this.alarmFont || "10px 微软雅黑";\r\n                    var d = a.measureText(this.alarm).width + 6, e = a.measureText("田").width + 6, f = this.width / 2 - d / 2, g = -this.height / 2 - e - 8;\r\n                    a.strokeStyle = "rgba(" + b + ", " + c + ")", a.fillStyle = "rgba(" + b + ", " + c + ")", a.lineCap = "round", a.lineWidth = 1, a.moveTo(f, g), a.lineTo(f + d, g), a.lineTo(f + d, g + e), a.lineTo(f + d / 2 + 6, g + e), a.lineTo(f + d / 2, g + e + 8), a.lineTo(f + d / 2 - 6, g + e), a.lineTo(f, g + e), a.lineTo(f, g), a.fill(), a.stroke(), a.closePath(), a.beginPath(), a.strokeStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")", a.fillStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")", a.fillText(this.alarm, f + 2, g + e - 4), a.closePath()\r\n                }\r\n            }, this.paintText = function (a) {\r\n                var b = this.text;\r\n                if (null != b && "" != b) {\r\n                    a.beginPath(), a.font = this.font;\r\n                    var c = a.measureText(b).width, d = a.measureText("田").width;\r\n                    a.fillStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")";\r\n                    var e = this.getTextPostion(this.textPosition, c, d);\r\n                    a.fillText(b, e.x, e.y), a.closePath()\r\n                }\r\n            }, this.paintBorder = function (a) {\r\n                if (0 != this.borderWidth) {\r\n                    a.beginPath(), a.lineWidth = this.borderWidth, a.strokeStyle = "rgba(" + this.borderColor + "," + this.alpha + ")";\r\n                    var b = this.borderWidth / 2;\r\n                    null == this.borderRadius || 0 == this.borderRadius ? a.rect(-this.width / 2 - b, -this.height / 2 - b, this.width + this.borderWidth, this.height + this.borderWidth) : a.JTopoRoundRect(-this.width / 2 - b, -this.height / 2 - b, this.width + this.borderWidth, this.height + this.borderWidth, this.borderRadius), a.stroke(), a.closePath()\r\n                }\r\n            }, this.getTextPostion = function (position, maxWidth, fontWidth, height) {\r\n                var d = null;\r\n                switch (position) {\r\n                    case "Bottom_Center":\r\n                        d = {\r\n                            x: -this.width / 2 + (this.width - maxWidth) / 2,\r\n                            y: this.height / 2 + fontWidth\r\n                        };\r\n                        break;\r\n                    case "Top_Center":\r\n                        d = {\r\n                            x: -this.width / 2 + (this.width - maxWidth) / 2,\r\n                            y: -this.height / 2 - fontWidth / 2 - fontWidth * (height - 1)\r\n                        };\r\n                        break;\r\n                    case "Top_Right":\r\n                        d = {\r\n                            x: this.width / 2,\r\n                            y: -this.height / 2 - fontWidth / 2\r\n                        };\r\n                        break;\r\n                    case "Top_Left":\r\n                        d = {\r\n                            x: -this.width / 2 - maxWidth,\r\n                            y: -this.height / 2 - fontWidth / 2\r\n                        };\r\n                        break;\r\n                    case "Bottom_Right":\r\n                        d = {\r\n                            x: this.width / 2,\r\n                            y: this.height / 2 + fontWidth\r\n                        };\r\n                        break;\r\n                    case "Bottom_Left":\r\n                        d = {\r\n                            x: -this.width / 2 - maxWidth,\r\n                            y: this.height / 2 + fontWidth\r\n                        };\r\n                        break;\r\n                    case "Middle_Center":\r\n                        d = {\r\n                            x: -this.width / 2 + (this.width - maxWidth) / 2,\r\n                            y: fontWidth / 2\r\n                        };\r\n                        break;\r\n                    case "Middle_Right":\r\n                        d = {\r\n                            x: this.width / 2,\r\n                            y: fontWidth / 2\r\n                        };\r\n                        break;\r\n                    case "Middle_Left":\r\n                        d = {\r\n                            x: -this.width / 2 - maxWidth,\r\n                            y: fontWidth / 2\r\n                        };\r\n                        break;\r\n                    default:\r\n                        d = {\r\n                            x: -this.width / 2 - maxWidth,\r\n                            y: fontWidth / 2\r\n                        };\r\n                }\r\n                if (null != this.textOffsetX) {\r\n                    d.x += this.textOffsetX\r\n                }\r\n                if (null != this.textOffsetY) {\r\n                    d.y += this.textOffsetY\r\n                }\r\n                return d;\r\n            }, this.setImage = function (a, b) {\r\n                if (null == a)throw new Error("Node.setImage(): 参数Image对象为空!");\r\n                var c = this;\r\n                if ("string" == typeof a) {\r\n                    var d = j[a];\r\n                    null == d ? (d = new Image, d.src = a, d.onload = function () {\r\n                        j[a] = d, 1 == b && c.setSize(d.width, d.height), c.image = d, c.alarmColor = null == c.alarmColor ? "255,0,0" : c.alarmColor\r\n                    }) : (b && this.setSize(d.width, d.height), c.image = d, c.alarmColor = null == c.alarmColor ? "255,0,0" : c.alarmColor)\r\n                } else this.image = a, c.alarmColor = null == c.alarmColor ? "255,0,0" : c.alarmColor, 1 == b && this.setSize(a.width, a.height)\r\n            };\r\n            this.removeHandler = function (scene) {\r\n                var self = this;\r\n                if (this.outLinks) {\r\n                    this.outLinks.forEach(function (c) {\r\n                        if (c.nodeA === self) {\r\n                            scene.remove(c)\r\n                        }\r\n                    });\r\n                    this.outLinks = null;\r\n                }\r\n                if (this.inLinks) {\r\n                    this.inLinks.forEach(function (c) {\r\n                        c.nodeZ === self && scene.remove(c)\r\n                    });\r\n                    this.inLinks = null;\r\n                }\r\n            }\r\n        }\r\n\r\n        function Node() {\r\n            Node.prototype.initialize.apply(this, arguments)\r\n        }\r\n\r\n        function TextNode(a) {\r\n            this.initialize(), this.text = a, this.elementType = "TextNode", this.paint = function (a) {\r\n                a.beginPath(), a.font = this.font, this.width = a.measureText(this.text).width, this.height = a.measureText("田").width, a.strokeStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")", a.fillStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")", a.fillText(this.text, -this.width / 2, this.height / 2), a.closePath(), this.paintBorder(a), this.paintCtrl(a), this.paintAlarmText(a)\r\n            }\r\n        }\r\n\r\n        function LinkNode(a, b, c) {\r\n            this.initialize(), this.text = a, this.href = b, this.target = c, this.elementType = "LinkNode", this.isVisited = !1, this.visitedColor = null, this.paint = function (a) {\r\n                a.beginPath(), a.font = this.font, this.width = a.measureText(this.text).width, this.height = a.measureText("田").width, this.isVisited && null != this.visitedColor ? (a.strokeStyle = "rgba(" + this.visitedColor + ", " + this.alpha + ")", a.fillStyle = "rgba(" + this.visitedColor + ", " + this.alpha + ")") : (a.strokeStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")", a.fillStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")"), a.fillText(this.text, -this.width / 2, this.height / 2), this.isMouseOver && (a.moveTo(-this.width / 2, this.height), a.lineTo(this.width / 2, this.height), a.stroke()), a.closePath(), this.paintBorder(a), this.paintCtrl(a), this.paintAlarmText(a)\r\n            }, this.mousemove(function () {\r\n                var a = document.getElementsByTagName("canvas");\r\n                if (a && a.length > 0)for (var b = 0; b < a.length; b++)a[b].style.cursor = "pointer"\r\n            }), this.mouseout(function () {\r\n                var a = document.getElementsByTagName("canvas");\r\n                if (a && a.length > 0)for (var b = 0; b < a.length; b++)a[b].style.cursor = "default"\r\n            }), this.click(function () {\r\n                "_blank" == this.target ? window.open(this.href) : location = this.href, this.isVisited = !0\r\n            })\r\n        }\r\n\r\n        function CircleNode(a) {\r\n            this.initialize(arguments), this._radius = 20, this.beginDegree = 0, this.endDegree = 2 * Math.PI, this.text = a, this.paint = function (a) {\r\n                a.save(), a.beginPath(), a.fillStyle = "rgba(" + this.fillColor + "," + this.alpha + ")", a.arc(0, 0, this.radius, this.beginDegree, this.endDegree, !0), a.fill(), a.closePath(), a.restore(), this.paintText(a), this.paintBorder(a), this.paintCtrl(a), this.paintAlarmText(a)\r\n            }, this.paintSelected = function (a) {\r\n                a.save(), a.beginPath(), a.strokeStyle = "rgba(168,202,255, 0.9)", a.fillStyle = "rgba(168,202,236,0.7)", a.arc(0, 0, this.radius + 3, this.beginDegree, this.endDegree, !0), a.fill(), a.stroke(), a.closePath(), a.restore()\r\n            }\r\n        }\r\n\r\n        function g(a, b, c) {\r\n            this.initialize();\r\n            this.frameImages = a || [];\r\n            this.frameIndex = 0;\r\n            this.isStop = !0;\r\n            var d = b || 1e3;\r\n            this.repeatPlay = !1;\r\n            var e = this;\r\n            this.nextFrame = function () {\r\n                if (!this.isStop && null != this.frameImages.length) {\r\n                    this.frameIndex++;\r\n                    if (this.frameIndex >= this.frameImages.length) {\r\n                        if (!this.repeatPlay)return;\r\n                        this.frameIndex = 0;\r\n                    }\r\n                    this.setImage(this.frameImages[this.frameIndex], c);\r\n                    setTimeout(function () {\r\n                        e.nextFrame();\r\n                    }, d / a.length);\r\n                }\r\n            }\r\n        }\r\n\r\n        function h(a, b, c, d, e) {\r\n            this.initialize();\r\n            var f = this;\r\n            this.setImage(a), this.frameIndex = 0, this.isPause = !0, this.repeatPlay = !1;\r\n            var g = d || 1e3;\r\n            e = e || 0, this.paint = function (a) {\r\n                if (this.image) {\r\n                    var b = this.width, d = this.height;\r\n                    a.save(), a.beginPath(), a.fillStyle = "rgba(" + this.fillColor + "," + this.alpha + ")";\r\n                    var f = (Math.floor(this.frameIndex / c) + e) * d, g = Math.floor(this.frameIndex % c) * b;\r\n                    a.drawImage(this.image, g, f, b, d, -b / 2, -d / 2, b, d), a.fill(), a.closePath(), a.restore(), this.paintText(a), this.paintBorder(a), this.paintCtrl(a), this.paintAlarmText(a)\r\n                }\r\n            }, this.nextFrame = function () {\r\n                if (!this.isStop) {\r\n                    if (this.frameIndex++, this.frameIndex >= b * c) {\r\n                        if (!this.repeatPlay)return;\r\n                        this.frameIndex = 0\r\n                    }\r\n                    setTimeout(function () {\r\n                        f.isStop || f.nextFrame()\r\n                    }, g / (b * c))\r\n                }\r\n            }\r\n        }\r\n\r\n        function AnimateNode() {\r\n            var a = null;\r\n            return a = arguments.length <= 3 ? new g(arguments[0], arguments[1], arguments[2]) : new h(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]), a.stop = function () {\r\n                a.isStop = !0\r\n            }, a.play = function () {\r\n                a.isStop = !1, a.frameIndex = 0, a.nextFrame()\r\n            }, a\r\n        }\r\n\r\n        var j = {};\r\n        baseNode.prototype = new jtopo.EditableElement;\r\n        Node.prototype = new baseNode;\r\n        Object.defineProperties(Node.prototype, {\r\n            alarmColor: {\r\n                get: function () {\r\n                    return this._alarmColor\r\n                }, set: function (color) {\r\n                    this._alarmColor = color;\r\n                    if (null != this.image) {\r\n                        var c = jtopo.util.genImageAlarm(this.image, color);\r\n                        if (c) {\r\n                            this.alarmImage = c;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        TextNode.prototype = new Node;\r\n        LinkNode.prototype = new TextNode;\r\n        CircleNode.prototype = new Node;\r\n        Object.defineProperties(CircleNode.prototype, {\r\n            radius: {\r\n                get: function () {\r\n                    return this._radius\r\n                }, set: function (a) {\r\n                    this._radius = a;\r\n                    var b = 2 * this.radius, c = 2 * this.radius;\r\n                    this.width = b, this.height = c\r\n                }\r\n            }, width: {\r\n                get: function () {\r\n                    return this._width\r\n                }, set: function (a) {\r\n                    this._radius = a / 2, this._width = a\r\n                }\r\n            }, height: {\r\n                get: function () {\r\n                    return this._height\r\n                }, set: function (a) {\r\n                    this._radius = a / 2, this._height = a\r\n                }\r\n            }\r\n        });\r\n        g.prototype = new Node;\r\n        h.prototype = new Node;\r\n        AnimateNode.prototype = new Node;\r\n        jtopo.Node = Node;\r\n        jtopo.TextNode = TextNode;\r\n        jtopo.LinkNode = LinkNode;\r\n        jtopo.CircleNode = CircleNode;\r\n        jtopo.AnimateNode = AnimateNode;\r\n    }(JTopo),\r\n    function (jtopo) {\r\n        function getPublicLink(elementA, elementB) {\r\n            var result = [];\r\n            if (null == elementA || null == elementB)return result;\r\n            if (elementA && elementB && elementA.outLinks && elementB.inLinks)\r\n                for (var i = 0; i < elementA.outLinks.length; i++) {\r\n                    var outLink = elementA.outLinks[i];\r\n                    for (var f = 0; f < elementB.inLinks.length; f++) {\r\n                        var inlink = elementB.inLinks[f];\r\n                        if (outLink === inlink) {\r\n                            result.push(inlink);\r\n                        }\r\n                    }\r\n                }\r\n            return result\r\n        }\r\n\r\n        function getLinksBetween(start, end) {\r\n            var d = getPublicLink(start, end);\r\n            var e = getPublicLink(end, start);\r\n            return d.concat(e);\r\n        }\r\n\r\n        function getLinkNotThis(link) {\r\n            var b = getLinksBetween(link.nodeA, link.nodeZ);\r\n            return b = b.filter(function (b) {\r\n                return link !== b\r\n            })\r\n        }\r\n\r\n        function getNums(a, b) {\r\n            return getLinksBetween(a, b).length\r\n        }\r\n\r\n        function Link(b, c, g) {\r\n            function h(start, end) {\r\n                var link = jtopo.util.lineF(start.cx, start.cy, end.cx, end.cy);\r\n                var bound = start.getBound();\r\n                return jtopo.util.intersectionLineBound(link, bound);\r\n            }\r\n\r\n            this.initialize = function (b, c, d) {\r\n                if (Link.prototype.initialize.apply(this, arguments), this.elementType = "link", this.zIndex = jtopo.zIndex_Link, 0 != arguments.length) {\r\n                    this.text = d;\r\n                    this.nodeA = b;\r\n                    this.nodeZ = c;\r\n                    this.nodeA && null == this.nodeA.outLinks && (this.nodeA.outLinks = []);\r\n                    this.nodeA && null == this.nodeA.inLinks && (this.nodeA.inLinks = []);\r\n                    this.nodeZ && null == this.nodeZ.inLinks && (this.nodeZ.inLinks = []);\r\n                    this.nodeZ && null == this.nodeZ.outLinks && (this.nodeZ.outLinks = []);\r\n                    null != this.nodeA && this.nodeA.outLinks.push(this);\r\n                    null != this.nodeZ && this.nodeZ.inLinks.push(this);\r\n                    this.caculateIndex();\r\n                    this.font = "12px Consolas";\r\n                    this.fontColor = "255,255,255";\r\n                    this.lineWidth = 2;\r\n                    this.lineJoin = "miter";\r\n                    this.transformAble = !1;\r\n                    this.bundleOffset = 20;\r\n                    this.bundleGap = 12;\r\n                    this.textOffsetX = 0;\r\n                    this.textOffsetY = 0;\r\n                    this.arrowsRadius = null;\r\n                    this.arrowsOffset = 0;\r\n                    this.dashedPattern = null;\r\n                    this.path = [];\r\n                    var e = "text,font,fontColor,lineWidth,lineJoin".split(",");\r\n                    this.serializedProperties = this.serializedProperties.concat(e)\r\n                }\r\n            }, this.caculateIndex = function () {\r\n                var a = getNums(this.nodeA, this.nodeZ);\r\n                a > 0 && (this.nodeIndex = a - 1)\r\n            }, this.initialize(b, c, g), this.removeHandler = function () {\r\n                var a = this;\r\n                this.nodeA && this.nodeA.outLinks && (this.nodeA.outLinks = this.nodeA.outLinks.filter(function (b) {\r\n                    return b !== a\r\n                })), this.nodeZ && this.nodeZ.inLinks && (this.nodeZ.inLinks = this.nodeZ.inLinks.filter(function (b) {\r\n                    return b !== a\r\n                }));\r\n                var b = getLinkNotThis(this);\r\n                b.forEach(function (a, b) {\r\n                    a.nodeIndex = b\r\n                })\r\n            }, this.getStartPosition = function () {\r\n                var a = {x: this.nodeA.cx, y: this.nodeA.cy};\r\n                return a\r\n            }, this.getEndPosition = function () {\r\n                var a;\r\n                return null != this.arrowsRadius && (a = h(this.nodeZ, this.nodeA)), null == a && (a = {x: this.nodeZ.cx, y: this.nodeZ.cy}), a\r\n            }, this.getPath = function () {\r\n                var a = [], b = this.getStartPosition(), c = this.getEndPosition();\r\n                if (this.nodeA === this.nodeZ)return [b, c];\r\n                var d = getNums(this.nodeA, this.nodeZ);\r\n                if (1 == d)return [b, c];\r\n                var f = Math.atan2(c.y - b.y, c.x - b.x), g = {x: b.x + this.bundleOffset * Math.cos(f), y: b.y + this.bundleOffset * Math.sin(f)}, h = {\r\n                    x: c.x + this.bundleOffset * Math.cos(f - Math.PI),\r\n                    y: c.y + this.bundleOffset * Math.sin(f - Math.PI)\r\n                }, i = f - Math.PI / 2, j = f - Math.PI / 2, k = d * this.bundleGap / 2 - this.bundleGap / 2, l = this.bundleGap * this.nodeIndex, m = {\r\n                    x: g.x + l * Math.cos(i),\r\n                    y: g.y + l * Math.sin(i)\r\n                }, n = {x: h.x + l * Math.cos(j), y: h.y + l * Math.sin(j)};\r\n                return m = {x: m.x + k * Math.cos(i - Math.PI), y: m.y + k * Math.sin(i - Math.PI)}, n = {x: n.x + k * Math.cos(j - Math.PI), y: n.y + k * Math.sin(j - Math.PI)}, a.push({\r\n                    x: b.x,\r\n                    y: b.y\r\n                }), a.push({x: m.x, y: m.y}), a.push({x: n.x, y: n.y}), a.push({x: c.x, y: c.y}), a\r\n            }, this.paintPath = function (a, b) {\r\n                if (this.nodeA === this.nodeZ)return void this.paintLoop(a);\r\n                a.beginPath(), a.moveTo(b[0].x, b[0].y);\r\n                for (var c = 1; c < b.length; c++)null == this.dashedPattern ? a.lineTo(b[c].x, b[c].y) : a.JTopoDashedLineTo(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, this.dashedPattern);\r\n                if (a.stroke(), a.closePath(), null != this.arrowsRadius) {\r\n                    var d = b[b.length - 2], e = b[b.length - 1];\r\n                    this.paintArrow(a, d, e)\r\n                }\r\n            }, this.paintLoop = function (a) {\r\n                a.beginPath();\r\n                {\r\n                    var b = this.bundleGap * (this.nodeIndex + 1) / 2;\r\n                    Math.PI + Math.PI / 2\r\n                }\r\n                a.arc(this.nodeA.x, this.nodeA.y, b, Math.PI / 2, 2 * Math.PI), a.stroke(), a.closePath()\r\n            }, this.paintArrow = function (b, c, d) {\r\n                var e = this.arrowsOffset, f = this.arrowsRadius / 2, g = c, h = d, i = Math.atan2(h.y - g.y, h.x - g.x), j = jtopo.util.getDistance(g, h) - this.arrowsRadius, k = g.x + (j + e) * Math.cos(i), l = g.y + (j + e) * Math.sin(i), m = h.x + e * Math.cos(i), n = h.y + e * Math.sin(i);\r\n                i -= Math.PI / 2;\r\n                var o = {x: k + f * Math.cos(i), y: l + f * Math.sin(i)}, p = {x: k + f * Math.cos(i - Math.PI), y: l + f * Math.sin(i - Math.PI)};\r\n                b.beginPath(), b.fillStyle = "rgba(" + this.strokeColor + "," + this.alpha + ")", b.moveTo(o.x, o.y), b.lineTo(m, n), b.lineTo(p.x, p.y), b.stroke(), b.closePath()\r\n            }, this.paint = function (a) {\r\n                if (null != this.nodeA && null != !this.nodeZ) {\r\n                    var b = this.getPath(this.nodeIndex);\r\n                    this.path = b, a.strokeStyle = "rgba(" + this.strokeColor + "," + this.alpha + ")", a.lineWidth = this.lineWidth, this.paintPath(a, b), b && b.length > 0 && this.paintText(a, b)\r\n                }\r\n            };\r\n            var i = -(Math.PI / 2 + Math.PI / 4);\r\n            this.paintText = function (a, b) {\r\n                var c = b[0], d = b[b.length - 1];\r\n                if (4 == b.length && (c = b[1], d = b[2]), this.text && this.text.length > 0) {\r\n                    var e = (d.x + c.x) / 2 + this.textOffsetX, f = (d.y + c.y) / 2 + this.textOffsetY;\r\n                    a.save(), a.beginPath(), a.font = this.font;\r\n                    var g = a.measureText(this.text).width, h = a.measureText("田").width;\r\n                    if (a.fillStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")", this.nodeA === this.nodeZ) {\r\n                        var j = this.bundleGap * (this.nodeIndex + 1) / 2, e = this.nodeA.x + j * Math.cos(i), f = this.nodeA.y + j * Math.sin(i);\r\n                        a.fillText(this.text, e, f)\r\n                    } else a.fillText(this.text, e - g / 2, f - h / 2);\r\n                    a.stroke(), a.closePath(), a.restore()\r\n                }\r\n            }, this.paintSelected = function (a) {\r\n                a.shadowBlur = 10, a.shadowColor = "rgba(0,0,0,1)", a.shadowOffsetX = 0, a.shadowOffsetY = 0\r\n            }, this.isInBound = function (b, c) {\r\n                if (this.nodeA === this.nodeZ) {\r\n                    var d = this.bundleGap * (this.nodeIndex + 1) / 2, e = jtopo.util.getDistance(this.nodeA, {x: b, y: c}) - d;\r\n                    return Math.abs(e) <= 3\r\n                }\r\n                for (var f = !1, g = 1; g < this.path.length; g++) {\r\n                    var h = this.path[g - 1], i = this.path[g];\r\n                    if (1 == jtopo.util.isPointInLine({x: b, y: c}, h, i)) {\r\n                        f = !0;\r\n                        break\r\n                    }\r\n                }\r\n                return f\r\n            }\r\n        }\r\n\r\n        function FoldLink(a, b, c) {\r\n            this.initialize = function () {\r\n                FoldLink.prototype.initialize.apply(this, arguments), this.direction = "horizontal"\r\n            }, this.initialize(a, b, c), this.getStartPosition = function () {\r\n                var a = {x: this.nodeA.cx, y: this.nodeA.cy};\r\n                return "horizontal" == this.direction ? this.nodeZ.cx > a.x ? a.x += this.nodeA.width / 2 : a.x -= this.nodeA.width / 2 : this.nodeZ.cy > a.y ? a.y += this.nodeA.height / 2 : a.y -= this.nodeA.height / 2, a\r\n            }, this.getEndPosition = function () {\r\n                var a = {x: this.nodeZ.cx, y: this.nodeZ.cy};\r\n                return "horizontal" == this.direction ? this.nodeA.cy < a.y ? a.y -= this.nodeZ.height / 2 : a.y += this.nodeZ.height / 2 : a.x = this.nodeA.cx < a.x ? this.nodeZ.x : this.nodeZ.x + this.nodeZ.width, a\r\n            }, this.getPath = function (a) {\r\n                var b = [], c = this.getStartPosition(), d = this.getEndPosition();\r\n                if (this.nodeA === this.nodeZ)return [c, d];\r\n                var f, g, h = getNums(this.nodeA, this.nodeZ), i = (h - 1) * this.bundleGap, j = this.bundleGap * a - i / 2;\r\n                return "horizontal" == this.direction ? (f = d.x + j, g = c.y - j, b.push({x: c.x, y: g}), b.push({x: f, y: g}), b.push({x: f, y: d.y})) : (f = c.x + j, g = d.y - j, b.push({\r\n                    x: f,\r\n                    y: c.y\r\n                }), b.push({x: f, y: g}), b.push({x: d.x, y: g})), b\r\n            }, this.paintText = function (a, b) {\r\n                if (this.text && this.text.length > 0) {\r\n                    var c = b[1], d = c.x + this.textOffsetX, e = c.y + this.textOffsetY;\r\n                    a.save(), a.beginPath(), a.font = this.font;\r\n                    var f = a.measureText(this.text).width, g = a.measureText("田").width;\r\n                    a.fillStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")", a.fillText(this.text, d - f / 2, e - g / 2), a.stroke(), a.closePath(), a.restore()\r\n                }\r\n            }\r\n        }\r\n\r\n        function FlexionalLink(a, b, c) {\r\n            this.initialize = function () {\r\n                FlexionalLink.prototype.initialize.apply(this, arguments), this.direction = "vertical", this.offsetGap = 44\r\n            }, this.initialize(a, b, c), this.getStartPosition = function () {\r\n                var a = {x: this.nodeA.cx, y: this.nodeA.cy};\r\n                return "horizontal" == this.direction ? a.x = this.nodeZ.cx < a.x ? this.nodeA.x : this.nodeA.x + this.nodeA.width : a.y = this.nodeZ.cy < a.y ? this.nodeA.y : this.nodeA.y + this.nodeA.height, a\r\n            }, this.getEndPosition = function () {\r\n                var a = {x: this.nodeZ.cx, y: this.nodeZ.cy};\r\n                return "horizontal" == this.direction ? a.x = this.nodeA.cx < a.x ? this.nodeZ.x : this.nodeZ.x + this.nodeZ.width : a.y = this.nodeA.cy < a.y ? this.nodeZ.y : this.nodeZ.y + this.nodeZ.height, a\r\n            }, this.getPath = function (a) {\r\n                var b = this.getStartPosition(), c = this.getEndPosition();\r\n                if (this.nodeA === this.nodeZ)return [b, c];\r\n                var d = [], f = getNums(this.nodeA, this.nodeZ), g = (f - 1) * this.bundleGap, h = this.bundleGap * a - g / 2, i = this.offsetGap;\r\n                return "horizontal" == this.direction ? (this.nodeA.cx > this.nodeZ.cx && (i = -i), d.push({x: b.x, y: b.y + h}), d.push({x: b.x + i, y: b.y + h}), d.push({\r\n                    x: c.x - i,\r\n                    y: c.y + h\r\n                }), d.push({x: c.x, y: c.y + h})) : (this.nodeA.cy > this.nodeZ.cy && (i = -i), d.push({x: b.x + h, y: b.y}), d.push({x: b.x + h, y: b.y + i}), d.push({\r\n                    x: c.x + h,\r\n                    y: c.y - i\r\n                }), d.push({x: c.x + h, y: c.y})), d\r\n            }\r\n        }\r\n\r\n        function CurveLink(a, b, c) {\r\n            this.initialize = function () {\r\n                CurveLink.prototype.initialize.apply(this, arguments)\r\n            }, this.initialize(a, b, c), this.paintPath = function (a, b) {\r\n                if (this.nodeA === this.nodeZ)return void this.paintLoop(a);\r\n                a.beginPath(), a.moveTo(b[0].x, b[0].y);\r\n                for (var c = 1; c < b.length; c++) {\r\n                    var d = b[c - 1], e = b[c], f = (d.x + e.x) / 2, g = (d.y + e.y) / 2;\r\n                    g += (e.y - d.y) / 2, a.strokeStyle = "rgba(" + this.strokeColor + "," + this.alpha + ")", a.lineWidth = this.lineWidth, a.moveTo(d.x, d.cy), a.quadraticCurveTo(f, g, e.x, e.y), a.stroke()\r\n                }\r\n                if (a.stroke(), a.closePath(), null != this.arrowsRadius) {\r\n                    var h = b[b.length - 2], i = b[b.length - 1];\r\n                    this.paintArrow(a, h, i)\r\n                }\r\n            }\r\n        }\r\n\r\n        Link.prototype = new jtopo.InteractiveElement;\r\n        FoldLink.prototype = new Link;\r\n        FlexionalLink.prototype = new Link;\r\n        CurveLink.prototype = new Link;\r\n        jtopo.Link = Link;\r\n        jtopo.FoldLink = FoldLink;\r\n        jtopo.FlexionalLink = FlexionalLink;\r\n        jtopo.CurveLink = CurveLink;\r\n    }(JTopo),\r\n    function (jtopo) {\r\n        function container(c) {\r\n            this.initialize = function (c) {\r\n                container.prototype.initialize.apply(this, null),\r\n                    this.elementType = "container",\r\n                    this.zIndex = jtopo.zIndex_Container,\r\n                    this.width = 100,\r\n                    this.height = 100,\r\n                    this.childs = [],\r\n                    this.alpha = .5,\r\n                    this.dragable = !0,\r\n                    this.childDragble = !0,\r\n                    this.visible = !0,\r\n                    this.fillColor = "10,100,80",\r\n                    this.borderWidth = 0,\r\n                    this.borderColor = "255,255,255",\r\n                    this.borderRadius = null,\r\n                    this.font = "12px Consolas",\r\n                    this.fontColor = "255,255,255",\r\n                    this.text = c,\r\n                    this.textPosition = "Bottom_Center",\r\n                    this.textOffsetX = 0,\r\n                    this.textOffsetY = 0,\r\n                    this.layout = new jtopo.layout.AutoBoundLayout\r\n            }, this.initialize(c), this.add = function (a) {\r\n                this.childs.push(a), a.dragable = this.childDragble\r\n            }, this.remove = function (a) {\r\n                for (var b = 0; b < this.childs.length; b++)if (this.childs[b] === a) {\r\n                    a.parentContainer = null, this.childs = this.childs.del(b), a.lastParentContainer = this;\r\n                    break\r\n                }\r\n            }, this.removeAll = function () {\r\n                this.childs = []\r\n            }, this.setLocation = function (a, b) {\r\n                var c = a - this.x, d = b - this.y;\r\n                this.x = a, this.y = b;\r\n                if (this.qtopo && this.qtopo.attr && this.qtopo.attr.position) {\r\n                    this.qtopo.attr.position[0] = a;\r\n                    this.qtopo.attr.position[1] = b;\r\n                }\r\n                for (var e = 0; e < this.childs.length; e++) {\r\n                    var f = this.childs[e];\r\n                    f.setLocation(f.x + c, f.y + d)\r\n                }\r\n            }, this.doLayout = function (a) {\r\n                a && a(this, this.childs)\r\n            }, this.paint = function (a) {\r\n                if (this.visible) {\r\n                    if (this.layout) {\r\n                        this.layout(this, this.childs);\r\n                    }\r\n                    a.beginPath();\r\n                    a.fillStyle = "rgba(" + this.fillColor + "," + this.alpha + ")";\r\n                    if (null == this.borderRadius || 0 == this.borderRadius) {\r\n                        a.rect(this.x, this.y, this.width, this.height);\r\n                    } else {\r\n                        a.JTopoRoundRect(this.x, this.y, this.width, this.height, this.borderRadius);\r\n                    }\r\n                    a.fill();\r\n                    a.closePath();\r\n                    this.paintText(a);\r\n                    this.paintBorder(a);\r\n                }\r\n            }, this.paintBorder = function (a) {\r\n                if (0 != this.borderWidth) {\r\n                    a.beginPath(), a.lineWidth = this.borderWidth, a.strokeStyle = "rgba(" + this.borderColor + "," + this.alpha + ")";\r\n                    var b = this.borderWidth / 2;\r\n                    null == this.borderRadius || 0 == this.borderRadius ? a.rect(this.x - b, this.y - b, this.width + this.borderWidth, this.height + this.borderWidth) : a.JTopoRoundRect(this.x - b, this.y - b, this.width + this.borderWidth, this.height + this.borderWidth, this.borderRadius), a.stroke(), a.closePath()\r\n                }\r\n            }, this.paintText = function (a) {\r\n                var b = this.text;\r\n                if (null != b && "" != b) {\r\n                    a.beginPath(), a.font = this.font;\r\n                    var c = a.measureText(b).width, d = a.measureText("田").width;\r\n                    a.fillStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")";\r\n                    var e = this.getTextPostion(this.textPosition, c, d);\r\n                    a.fillText(b, e.x, e.y), a.closePath()\r\n                }\r\n            }, this.getTextPostion = function (textPosition, maxWidth, fontWidth, height) {\r\n                var d = null;\r\n                return null == textPosition || "Bottom_Center" == textPosition ? d = {\r\n                    x: this.x + this.width / 2 - maxWidth / 2,\r\n                    y: this.y + this.height + fontWidth\r\n                } : "Top_Center" == textPosition ? d = {\r\n                    x: this.x + this.width / 2 - maxWidth / 2,\r\n                    y: this.y - fontWidth / 2 - fontWidth * (height - 1)\r\n                } : "Top_Right" == textPosition ? d = {x: this.x + this.width - maxWidth, y: this.y - fontWidth / 2} : "Top_Left" == textPosition ? d = {\r\n                    x: this.x,\r\n                    y: this.y - fontWidth / 2\r\n                } : "Bottom_Right" == textPosition ? d = {\r\n                    x: this.x + this.width - maxWidth,\r\n                    y: this.y + this.height + fontWidth\r\n                } : "Bottom_Left" == textPosition ? d = {x: this.x, y: this.y + this.height + fontWidth} : "Middle_Center" == textPosition ? d = {\r\n                    x: this.x + this.width / 2 - maxWidth / 2,\r\n                    y: this.y + this.height / 2 + fontWidth / 2\r\n                } : "Middle_Right" == textPosition ? d = {x: this.x + this.width - maxWidth, y: this.y + this.height / 2 + fontWidth / 2} : "Middle_Left" == textPosition && (d = {\r\n                    x: this.x,\r\n                    y: this.y + this.height / 2 + fontWidth / 2\r\n                }), null != this.textOffsetX && (d.x += this.textOffsetX), null != this.textOffsetY && (d.y += this.textOffsetY), d\r\n            }, this.paintMouseover = function () {\r\n            }, this.paintSelected = function (a) {\r\n                a.shadowBlur = 10, a.shadowColor = "rgba(0,0,0,1)", a.shadowOffsetX = 0, a.shadowOffsetY = 0\r\n            }\r\n        }\r\n\r\n        container.prototype = new jtopo.InteractiveElement;\r\n        jtopo.Container = container;\r\n    }(JTopo),\r\n    function (jtopo) {\r\n        function getNodesCenter(a) {\r\n            var b = 0, c = 0;\r\n            a.forEach(function (a) {\r\n                b += a.cx, c += a.cy\r\n            });\r\n            var d = {x: b / a.length, y: c / a.length};\r\n            return d\r\n        }\r\n\r\n        function circleLayoutNodes(nodeArray, animateConfig) {\r\n            null == animateConfig && (animateConfig = {});\r\n            {\r\n                var e = animateConfig.cx,\r\n                    f = animateConfig.cy,\r\n                    g = animateConfig.minRadius,\r\n                    h = animateConfig.nodeDiameter,\r\n                    i = animateConfig.hScale || 1,\r\n                    j = animateConfig.vScale || 1;\r\n                animateConfig.beginAngle || 0, animateConfig.endAngle || 2 * Math.PI\r\n            }\r\n            if (null == e || null == f) {\r\n                var k = getNodesCenter(nodeArray);\r\n                e = k.x, f = k.y\r\n            }\r\n            var l = 0, m = [], n = [];\r\n            nodeArray.forEach(function (node) {\r\n                null == animateConfig.nodeDiameter ? (node.diameter && (h = node.diameter),\r\n                    h = node.radius ? 2 * node.radius : Math.sqrt(2 * node.width * node.height),\r\n                    n.push(h)) : n.push(h), l += h\r\n            }), nodeArray.forEach(function (a, b) {\r\n                var c = n[b] / l;\r\n                m.push(Math.PI * c)\r\n            });\r\n            var o = (nodeArray.length, m[0] + m[1]), p = n[0] / 2 + n[1] / 2, q = p / 2 / Math.sin(o / 2);\r\n            null != g && g > q && (q = g);\r\n            var r = q * i, s = q * j, t = animateConfig.animate;\r\n            if (t) {\r\n                var time = t.time || 1e3, v = 0;\r\n                nodeArray.forEach(function (node, c) {\r\n                    v += 0 == c ? m[c] : m[c - 1] + m[c];\r\n                    var d = e + Math.cos(v) * r, g = f + Math.sin(v) * s;\r\n                    jtopo.Animate.stepByStep(node, {x: d - node.width / 2, y: g - node.height / 2}, time).start()\r\n                })\r\n            } else {\r\n                var v = 0;\r\n                nodeArray.forEach(function (a, b) {\r\n                    v += 0 == b ? m[b] : m[b - 1] + m[b];\r\n                    var c = e + Math.cos(v) * r, d = f + Math.sin(v) * s;\r\n                    a.cx = c, a.cy = d\r\n                })\r\n            }\r\n            return {cx: e, cy: f, radius: r, radiusA: r, radiusB: s}\r\n        }\r\n\r\n        function GridLayout(row, column) {\r\n            return function (container) {\r\n                var childs = container.childs;\r\n                if (!(childs.length <= 0)) {\r\n                    var cBound = container.getBound();\r\n                    var childNode = childs[0];\r\n                    var columSpace = (cBound.width - childNode.width) / column;\r\n                    var rowSpace = (cBound.height - childNode.height) / row;\r\n                    for (var childIndex = 0, rowsIndex = 0; row > rowsIndex; rowsIndex++) {\r\n                        for (var columnIndex = 0; column > columnIndex; columnIndex++) {\r\n                            var node = childs[childIndex++];\r\n                            var x = cBound.left + columSpace / 2 + columnIndex * columSpace;\r\n                            var y = cBound.top + rowSpace / 2 + rowsIndex * rowSpace;\r\n                            node.setLocation(x, y);\r\n                            if (childIndex >= childs.length) {\r\n                                return\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n\r\n        function FlowLayout(row, column) {\r\n            if (null == column) {\r\n                column = 0;\r\n            }\r\n            if (null == row) {\r\n                row = 0;\r\n            }\r\n            return function (container) {\r\n                var childs = container.childs;\r\n                if (!(childs.length <= 0)) {\r\n                    var bound = container.getBound();\r\n                    var left = bound.left;\r\n                    var top = bound.top;\r\n                    for (var i = 0; i < childs.length; i++) {\r\n                        var child = childs[i];\r\n                        if (left + child.width >= bound.right) {\r\n                            left = bound.left;\r\n                            top += row + child.height;\r\n                        }\r\n                        child.setLocation(left, top);\r\n                        left += column + child.width;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        function AutoBoundLayout() {\r\n            return function (container, children) {\r\n                if (children.length > 0) {\r\n                    var left = 1e7,\r\n                        right = -1e7,\r\n                        top = 1e7,\r\n                        bottom = -1e7,\r\n                        width = right - left,\r\n                        height = bottom - top;\r\n                    for (var i = 0; i < children.length; i++) {\r\n                        var child = children[i];\r\n                        child.x <= left && (left = child.x);\r\n                        (child.x + child.width) >= right && (right = child.x + child.width);\r\n                        child.y <= top && (top = child.y);\r\n                        (child.y + child.height) >= bottom && (bottom = child.y + child.height);\r\n                        width = right - left;\r\n                        height = bottom - top;\r\n                    }\r\n                    container.x = left;\r\n                    container.y = top;\r\n                    container.width = width;\r\n                    container.height = height;\r\n                } else {\r\n                    container.width = 100;\r\n                    container.height = 100;\r\n                }\r\n                if (container.qtopo) {\r\n                    container.qtopo.attr.size[0] = container.width;\r\n                    container.qtopo.attr.size[1] = container.height;\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 找到可以作为根的节点\r\n         * */\r\n        function getRootNodes(elements) {\r\n            return elements.filter(function (element) {\r\n                return (element instanceof jtopo.Node) &&\r\n                    (!element.inLinks || element.inLinks.length == 0) &&\r\n                    (element.outLinks && element.outLinks.length > 0);\r\n            });\r\n        }\r\n\r\n        function getGap(arr) {\r\n            var totalWidth = 0, totalHeight = 0;\r\n            arr.forEach(function (a) {\r\n                totalWidth += a.width;\r\n                totalHeight += a.height;\r\n            });\r\n            return {\r\n                width: totalWidth / arr.length,\r\n                height: totalHeight / arr.length\r\n            }\r\n        }\r\n\r\n        function i(a, b, c, d) {\r\n            b.x += c, b.y += d;\r\n            for (var e = getRootChilds(a, b), f = 0; f < e.length; f++)i(a, e[f], c, d)\r\n        }\r\n\r\n        function j(a, b) {\r\n            function c(b, e) {\r\n                var f = getRootChilds(a, b);\r\n                null == d[e] && (d[e] = {}, d[e].nodes = [], d[e].childs = []), d[e].nodes.push(b), d[e].childs.push(f);\r\n                for (var g = 0; g < f.length; g++)c(f[g], e + 1), f[g].parent = b\r\n            }\r\n\r\n            var d = [];\r\n            return c(b, 0), d\r\n        }\r\n\r\n        function TreeLayout(direction, gap, top) {\r\n            return function (scene) {\r\n                function f(childs, root) {\r\n                    var h = jtopo.layout.getTreeDeep(childs, root);\r\n                    var k = j(childs, root);\r\n                    var l = k["" + h].nodes;\r\n                    for (var m = 0; m < l.length; m++) {\r\n                        var n = l[m], o = (m + 1) * (gap + 10), p = h * top;\r\n                        "down" == direction || ("up" == direction ? p = -p : "left" == direction ? (o = -h * top, p = (m + 1) * (gap + 10)) : "right" == direction && (o = h * top, p = (m + 1) * (gap + 10))), n.setLocation(o, p)\r\n                    }\r\n                    for (var q = h - 1; q >= 0; q--)for (var r = k["" + q].nodes, s = k["" + q].childs, m = 0; m < r.length; m++) {\r\n                        var t = r[m], u = s[m];\r\n                        if ("down" == direction ? t.y = q * top : "up" == direction ? t.y = -q * top : "left" == direction ? t.x = -q * top : "right" == direction && (t.x = q * top), u.length > 0 ? "down" == direction || "up" == direction ? t.x = (u[0].x + u[u.length - 1].x) / 2 : ("left" == direction || "right" == direction) && (t.y = (u[0].y + u[u.length - 1].y) / 2) : m > 0 && ("down" == direction || "up" == direction ? t.x = r[m - 1].x + r[m - 1].width + gap : ("left" == direction || "right" == direction) && (t.y = r[m - 1].y + r[m - 1].height + gap)), m > 0)if ("down" == direction || "up" == direction) {\r\n                            if (t.x < r[m - 1].x + r[m - 1].width)for (var v = r[m - 1].x + r[m - 1].width + gap, w = Math.abs(v - t.x), x = m; x < r.length; x++)i(scene.childs, r[x], w, 0)\r\n                        } else if (("left" == direction || "right" == direction) && t.y < r[m - 1].y + r[m - 1].height)for (var y = r[m - 1].y + r[m - 1].height + gap, z = Math.abs(y - t.y), x = m; x < r.length; x++)i(scene.childs, r[x], 0, z)\r\n                    }\r\n                }\r\n\r\n                var realGap = null;\r\n                if (null == gap) {\r\n                    realGap = getGap(scene.childs);\r\n                    gap = realGap.width;\r\n                    if ("left" == direction || "right" == direction) {\r\n                        gap = realGap.width + 10;\r\n                    }\r\n                }\r\n                if (null == top) {\r\n                    if (null == realGap) {\r\n                        realGap = getGap(scene.childs)\r\n                    }\r\n                    top = 2 * realGap.height;\r\n                }\r\n                direction = direction || "down";\r\n                var roots = jtopo.layout.getRootNodes(scene.childs);\r\n                if (roots.length > 0) {\r\n                    f(scene.childs, roots[0]);\r\n                    var bound = jtopo.util.getElementsBound(scene.childs);\r\n                    var center = scene.getCenterLocation();\r\n                    var startX = center.x - (bound.left + bound.right) / 2,\r\n                        startY = center.y - (bound.top + bound.bottom) / 2;\r\n                    scene.childs.forEach(function (element) {\r\n                        if (element instanceof jtopo.Node) {\r\n                            element.x += startX;\r\n                            element.y += startY;\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        }\r\n\r\n        //必须得是有向无环图才可以布局\r\n        function CircleLayout(radius) {\r\n            return function (scene) {\r\n                function locationSet(allChilds, root, ra) {\r\n                    var rootsArr = getRootChilds(allChilds, root);\r\n                    if (0 != rootsArr.length) {\r\n                        if (null == ra) {\r\n                            ra = radius;\r\n                        }\r\n                        var step = 2 * Math.PI / rootsArr.length;\r\n                        rootsArr.forEach(function (child, i) {\r\n                            child.setLocation(\r\n                                root.x + ra * Math.cos(step * i),\r\n                                root.y + ra * Math.sin(step * i)\r\n                            );\r\n                            locationSet(allChilds, child, ra / 2);\r\n                        })\r\n                    }\r\n                }\r\n\r\n                var roots = jtopo.layout.getRootNodes(scene.childs);\r\n                if (roots.length > 0) {\r\n                    locationSet(scene.childs, roots[0]);\r\n                    var bound = jtopo.util.getElementsBound(scene.childs);\r\n                    var center = scene.getCenterLocation();\r\n                    var left = center.x - (bound.left + bound.right) / 2;\r\n                    var top = center.y - (bound.top + bound.bottom) / 2;\r\n                    scene.childs.forEach(function (b) {\r\n                        if (b instanceof jtopo.Node) {\r\n                            b.x += left;\r\n                            b.y += top;\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        }\r\n\r\n        function m(a, b, c, d, e, f) {\r\n            for (var g = [], h = 0; c > h; h++)for (var i = 0; d > i; i++)g.push({x: a + i * e, y: b + h * f});\r\n            return g\r\n        }\r\n\r\n        function circlePosition(centerX, centerY, total, raidus, beginAngle, endAngle) {\r\n            var begin = beginAngle ? beginAngle : 0;\r\n            var end = endAngle ? endAngle : 2 * Math.PI;\r\n            var totalAngle = end - begin;\r\n            var step = totalAngle / total;\r\n            var position = [];\r\n            begin += step / 2;\r\n            for (var i = begin; end >= i; i += step) {\r\n                position.push({\r\n                    x: centerX + Math.cos(i) * raidus,\r\n                    y: centerY + Math.sin(i) * raidus\r\n                });\r\n            }\r\n            return position\r\n        }\r\n\r\n        function treePostion(a, b, c, d, e, f) {\r\n            var g = f || "bottom", h = [];\r\n            if ("bottom" == g)for (var i = a - c / 2 * d + d / 2, j = 0; c >= j; j++)h.push({\r\n                x: i + j * d,\r\n                y: b + e\r\n            }); else if ("top" == g)for (var i = a - c / 2 * d + d / 2, j = 0; c >= j; j++)h.push({\r\n                x: i + j * d,\r\n                y: b - e\r\n            }); else if ("right" == g)for (var i = b - c / 2 * d + d / 2, j = 0; c >= j; j++)h.push({\r\n                x: a + e,\r\n                y: i + j * d\r\n            }); else if ("left" == g)for (var i = b - c / 2 * d + d / 2, j = 0; c >= j; j++)h.push({x: a - e, y: i + j * d});\r\n            return h\r\n        }\r\n\r\n        function gridPosition(a, b, c, d, e, f) {\r\n            for (var g = [], h = 0; c > h; h++)for (var i = 0; d > i; i++)g.push({x: a + i * e, y: b + h * f});\r\n            return g\r\n        }\r\n\r\n        function adjustPosition(root, rootChilds) {\r\n            if (root.layout) {\r\n                var layout = root.layout;\r\n                var locationArr = null;\r\n                switch (layout.type) {\r\n                    case \'circle\':\r\n                        var radius = layout.radius || Math.max(root.width, root.height);\r\n                        locationArr = circlePosition(\r\n                            root.cx,\r\n                            root.cy,\r\n                            rootChilds.length,\r\n                            radius,\r\n                            root.layout.beginAngle,\r\n                            root.layout.endAngle\r\n                        );\r\n                        break;\r\n                    case \'tree\':\r\n                        locationArr = treePostion(\r\n                            root.cx,\r\n                            root.cy,\r\n                            rootChilds.length,\r\n                            layout.width || 50,\r\n                            layout.height || 50,\r\n                            layout.direction\r\n                        );\r\n                        break;\r\n                    case \'grid\':\r\n                        locationArr = gridPosition(\r\n                            root.x,\r\n                            root.y,\r\n                            layout.rows,\r\n                            layout.cols,\r\n                            layout.horizontal || 0,\r\n                            layout.vertical || 0\r\n                        );\r\n                        break;\r\n                }\r\n                for (var i = 0; i < rootChilds.length; i++) {\r\n                    rootChilds[i].setCenterLocation(locationArr[i].x, locationArr[i].y);\r\n                }\r\n            }\r\n        }\r\n\r\n        function getRootChilds(allChilds, rootNode) {\r\n            var rootChilds;\r\n            if (rootNode.outLinks instanceof Array && rootNode.outLinks.length > 0) {\r\n                rootChilds = rootNode.outLinks.map(function (link) {\r\n                    return link.nodeZ;\r\n                });\r\n            }\r\n            return rootChilds || [];\r\n        }\r\n\r\n        function layoutNode(scene, root, recursion) {\r\n            var rootChilds = getRootChilds(scene.childs, root);\r\n            if (0 != rootChilds.length) {\r\n                adjustPosition(root, rootChilds);\r\n                if (1 == recursion) {\r\n                    for (var e = 0; e < rootChilds.length; e++) {\r\n                        layoutNode(scene, rootChilds[e], recursion);\r\n                    }\r\n                }\r\n            }\r\n            return null\r\n        }\r\n\r\n        function springLayout(b, c) {\r\n            function d(a, b) {\r\n                var c = a.x - b.x, d = a.y - b.y;\r\n                i += c * f, j += d * f, i *= g, j *= g, j += h, b.x += i, b.y += j\r\n            }\r\n\r\n            function e() {\r\n                if (!(++k > 150)) {\r\n                    for (var a = 0; a < l.length; a++)l[a] != b && d(b, l[a], l);\r\n                    setTimeout(e, 1e3 / 24)\r\n                }\r\n            }\r\n\r\n            var f = .01, g = .95, h = -5, i = 0, j = 0, k = 0, l = c.getElementsByClass(jtopo.Node);\r\n            e()\r\n        }\r\n\r\n        function getTreeDeep(childs, root) {\r\n            function reDeep(childs, root, deep) {\r\n                var rootChilds = getRootChilds(childs, root);\r\n                if (deep > d) {\r\n                    d = deep;\r\n                }\r\n                for (var g = 0; g < rootChilds.length; g++) {\r\n                    reDeep(childs, rootChilds[g], deep + 1);\r\n                }\r\n            }\r\n\r\n            var d = 0;\r\n            reDeep(childs, root, 0);\r\n            return d;\r\n        }\r\n\r\n        jtopo.layout = jtopo.Layout = {\r\n            layoutNode: layoutNode,\r\n            getNodeChilds: getRootChilds,\r\n            adjustPosition: adjustPosition,\r\n            springLayout: springLayout,\r\n            getTreeDeep: getTreeDeep,\r\n            getRootNodes: getRootNodes,\r\n            GridLayout: GridLayout,\r\n            FlowLayout: FlowLayout,\r\n            AutoBoundLayout: AutoBoundLayout,\r\n            CircleLayout: CircleLayout,\r\n            TreeLayout: TreeLayout,\r\n            getNodesCenter: getNodesCenter,\r\n            circleLayoutNodes: circleLayoutNodes\r\n        }\r\n    }(JTopo),\r\n    function (jtopo) {\r\n        function PieChartNode() {\r\n            var b = new jtopo.CircleNode;\r\n            return b.radius = 150, b.colors = ["#3666B0", "#2CA8E0", "#77D1F6"], b.datas = [.3, .3, .4], b.titles = ["A", "B", "C"], b.paint = function (a) {\r\n                var c = 2 * b.radius, d = 2 * b.radius;\r\n                b.width = c, b.height = d;\r\n                for (var e = 0, f = 0; f < this.datas.length; f++) {\r\n                    var g = this.datas[f] * Math.PI * 2;\r\n                    a.save(), a.beginPath(), a.fillStyle = b.colors[f], a.moveTo(0, 0), a.arc(0, 0, this.radius, e, e + g, !1), a.fill(), a.closePath(), a.restore(), a.beginPath(), a.font = this.font;\r\n                    var h = this.titles[f] + ": " + (100 * this.datas[f]).toFixed(2) + "%", i = a.measureText(h).width, j = (a.measureText("田").width, (e + e + g) / 2), k = this.radius * Math.cos(j), l = this.radius * Math.sin(j);\r\n                    j > Math.PI / 2 && j <= Math.PI ? k -= i : j > Math.PI && j < 2 * Math.PI * 3 / 4 ? k -= i : j > 2 * Math.PI * .75, a.fillStyle = "#FFFFFF", a.fillText(h, k, l), a.moveTo(this.radius * Math.cos(j), this.radius * Math.sin(j)), j > Math.PI / 2 && j < 2 * Math.PI * 3 / 4 && (k -= i), j > Math.PI, a.fill(), a.stroke(), a.closePath(), e += g\r\n                }\r\n            }, b\r\n        }\r\n\r\n        function BarChartNode() {\r\n            var b = new jtopo.Node;\r\n            return b.showSelected = !1, b.width = 250, b.height = 180, b.colors = ["#3666B0", "#2CA8E0", "#77D1F6"], b.datas = [.3, .3, .4], b.titles = ["A", "B", "C"], b.paint = function (a) {\r\n                var c = 3, d = (this.width - c) / this.datas.length;\r\n                a.save(), a.beginPath(), a.fillStyle = "#FFFFFF", a.strokeStyle = "#FFFFFF", a.moveTo(-this.width / 2 - 1, -this.height / 2), a.lineTo(-this.width / 2 - 1, this.height / 2 + 3), a.lineTo(this.width / 2 + c + 1, this.height / 2 + 3), a.stroke(), a.closePath(), a.restore();\r\n                for (var e = 0; e < this.datas.length; e++) {\r\n                    a.save(), a.beginPath(), a.fillStyle = b.colors[e];\r\n                    var f = this.datas[e], g = e * (d + c) - this.width / 2, h = this.height - f - this.height / 2;\r\n                    a.fillRect(g, h, d, f);\r\n                    var i = "" + parseInt(this.datas[e]), j = a.measureText(i).width, k = a.measureText("田").width;\r\n                    a.fillStyle = "#FFFFFF", a.fillText(i, g + (d - j) / 2, h - k), a.fillText(this.titles[e], g + (d - j) / 2, this.height / 2 + k), a.fill(), a.closePath(), a.restore()\r\n                }\r\n            }, b\r\n        }\r\n\r\n        jtopo.BarChartNode = BarChartNode;\r\n        jtopo.PieChartNode = PieChartNode;\r\n    }(JTopo),\r\n    function (jtopo) {\r\n        function b(b, c) {\r\n            var d, e = null;\r\n            return {\r\n                stop: function () {\r\n                    return d ? (window.clearInterval(d), e && e.publish("stop"), this) : this\r\n                }, start: function () {\r\n                    var a = this;\r\n                    return d = setInterval(function () {\r\n                        b.call(a)\r\n                    }, c), this\r\n                }, onStop: function (b) {\r\n                    return null == e && (e = new jtopo.util.MessageBus), e.subscribe("stop", b), this\r\n                }\r\n            }\r\n        }\r\n\r\n        function ef_gravity(a, c) {\r\n            c = c || {};\r\n            var d = c.gravity || .1, e = c.dx || 0, f = c.dy || 5, g = c.stop, h = c.interval || 30, i = new b(function () {\r\n                g && g() ? (f = .5, this.stop()) : (f += d, a.setLocation(a.x + e, a.y + f))\r\n            }, h);\r\n            return i\r\n        }\r\n\r\n        function an_stepByStep(target, attr, time, e, f) {\r\n            var g = 1e3 / 24, h = {};\r\n            for (var i in attr) {\r\n                var j = attr[i], k = j - target[i];\r\n                h[i] = {\r\n                    oldValue: target[i], targetValue: j, step: k / time * g, isDone: function (b) {\r\n                        var c = this.step > 0 && target[b] >= this.targetValue || this.step < 0 && target[b] <= this.targetValue;\r\n                        return c\r\n                    }\r\n                }\r\n            }\r\n            var l = new b(function () {\r\n                var b = !0;\r\n                for (var d in attr)h[d].isDone(d) || (target[d] += h[d].step, b = !1);\r\n                if (b) {\r\n                    if (!e)return this.stop();\r\n                    for (var d in attr)if (f) {\r\n                        var g = h[d].targetValue;\r\n                        h[d].targetValue = h[d].oldValue, h[d].oldValue = g, h[d].step = -h[d].step\r\n                    } else target[d] = h[d].oldValue\r\n                }\r\n                return this\r\n            }, g);\r\n            return l\r\n        }\r\n\r\n        function ef_spring(a) {\r\n            null == a && (a = {});\r\n            var b = a.spring || .1, c = a.friction || .8, d = a.grivity || 0, e = (a.wind || 0, a.minLength || 0);\r\n            return {\r\n                items: [], timer: null, isPause: !1, addNode: function (a, b) {\r\n                    var c = {node: a, target: b, vx: 0, vy: 0};\r\n                    return this.items.push(c), this\r\n                }, play: function (a) {\r\n                    this.stop(), a = null == a ? 1e3 / 24 : a;\r\n                    var b = this;\r\n                    this.timer = setInterval(function () {\r\n                        b.nextFrame()\r\n                    }, a)\r\n                }, stop: function () {\r\n                    null != this.timer && window.clearInterval(this.timer)\r\n                }, nextFrame: function () {\r\n                    for (var a = 0; a < this.items.length; a++) {\r\n                        var f = this.items[a], g = f.node, h = f.target, i = f.vx, j = f.vy, k = h.x - g.x, l = h.y - g.y, m = Math.atan2(l, k);\r\n                        if (0 != e) {\r\n                            var n = h.x - Math.cos(m) * e, o = h.y - Math.sin(m) * e;\r\n                            i += (n - g.x) * b, j += (o - g.y) * b\r\n                        } else i += k * b, j += l * b;\r\n                        i *= c, j *= c, j += d, g.x += i, g.y += j, f.vx = i, f.vy = j\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        function an_rotate(a, b) {\r\n            function c() {\r\n                return e = setInterval(function () {\r\n                    return o ? void f.stop() : (a.rotate += g || .2, void(a.rotate > 2 * Math.PI && (a.rotate = 0)))\r\n                }, 100), f\r\n            }\r\n\r\n            function d() {\r\n                return window.clearInterval(e), f.onStop && f.onStop(a), f\r\n            }\r\n\r\n            var e = (b.context, null), f = {}, g = b.v;\r\n            return f.run = c, f.stop = d, f.onStop = function (a) {\r\n                return f.onStop = a, f\r\n            }, f\r\n        }\r\n\r\n        function an_gravity(a, b) {\r\n            function c() {\r\n                return window.clearInterval(g), h.onStop && h.onStop(a), h\r\n            }\r\n\r\n            function d() {\r\n                var d = b.dx || 0, i = b.dy || 2;\r\n                return g = setInterval(function () {\r\n                    return o ? void h.stop() : (i += f, void(a.y + a.height < e.stage.canvas.height ? a.setLocation(a.x + d, a.y + i) : (i = 0, c())))\r\n                }, 20), h\r\n            }\r\n\r\n            var e = b.context, f = b.gravity || .1, g = null, h = {};\r\n            return h.run = d, h.stop = c, h.onStop = function (a) {\r\n                return h.onStop = a, h\r\n            }, h\r\n        }\r\n\r\n        function an_dividedTwoPiece(b, c) {\r\n            function d(c, d, e, f, g) {\r\n                var h = new jtopo.Node;\r\n                return h.setImage(b.image), h.setSize(b.width, b.height), h.setLocation(c, d), h.showSelected = !1, h.dragable = !1, h.paint = function (a) {\r\n                    a.save(), a.arc(0, 0, e, f, g), a.clip(), a.beginPath(), null != this.image ? a.drawImage(this.image, -this.width / 2, -this.height / 2) : (a.fillStyle = "rgba(" + this.style.fillStyle + "," + this.alpha + ")", a.rect(-this.width / 2, -this.height / 2, this.width / 2, this.height / 2), a.fill()), a.closePath(), a.restore()\r\n                }, h\r\n            }\r\n\r\n            function e(c, e) {\r\n                var f = c, g = c + Math.PI, h = d(b.x, b.y, b.width, f, g), j = d(b.x - 2 + 4 * Math.random(), b.y, b.width, f + Math.PI, f);\r\n                b.visible = !1, e.add(h), e.add(j), jtopo.Animate.gravity(h, {context: e, dx: .3}).run().onStop(function () {\r\n                    e.remove(h), e.remove(j), i.stop()\r\n                }), jtopo.Animate.gravity(j, {context: e, dx: -.2}).run()\r\n            }\r\n\r\n            function f() {\r\n                return e(c.angle, h), i\r\n            }\r\n\r\n            function g() {\r\n                return i.onStop && i.onStop(b), i\r\n            }\r\n\r\n            var h = c.context, i = (b.style, {});\r\n            return i.onStop = function (a) {\r\n                return i.onStop = a, i\r\n            }, i.run = f, i.stop = g, i\r\n        }\r\n\r\n        function an_repeatThrow(a, b) {\r\n            function c(a) {\r\n                a.visible = !0, a.rotate = Math.random();\r\n                var b = g.stage.canvas.width / 2;\r\n                a.x = b + Math.random() * (b - 100) - Math.random() * (b - 100), a.y = g.stage.canvas.height, a.vx = 5 * Math.random() - 5 * Math.random(), a.vy = -25\r\n            }\r\n\r\n            function d() {\r\n                return c(a), h = setInterval(function () {\r\n                    return o ? void i.stop() : (a.vy += f, a.x += a.vx, a.y += a.vy, void((a.x < 0 || a.x > g.stage.canvas.width || a.y > g.stage.canvas.height) && (i.onStop && i.onStop(a), c(a))))\r\n                }, 50), i\r\n            }\r\n\r\n            function e() {\r\n                window.clearInterval(h)\r\n            }\r\n\r\n            var f = .8, g = b.context, h = null, i = {};\r\n            return i.onStop = function (a) {\r\n                return i.onStop = a, i\r\n            }, i.run = d, i.stop = e, i\r\n        }\r\n\r\n        function an_stopAll() {\r\n            o = !0\r\n        }\r\n\r\n        function an_startAll() {\r\n            o = !1\r\n        }\r\n\r\n        function an_cycle(b, c) {\r\n            function d() {\r\n                return n = setInterval(function () {\r\n                    if (o)return void m.stop();\r\n                    var a = f.y + h + Math.sin(k) * j;\r\n                    b.setLocation(b.x, a), k += l\r\n                }, 100), m\r\n            }\r\n\r\n            function e() {\r\n                window.clearInterval(n)\r\n            }\r\n\r\n            var f = c.p1, g = c.p2, h = (c.context, f.x + (g.x - f.x) / 2), i = f.y + (g.y - f.y) / 2, j = jtopo.util.getDistance(f, g) / 2, k = Math.atan2(i, h), l = c.speed || .2, m = {}, n = null;\r\n            return m.run = d, m.stop = e, m\r\n        }\r\n\r\n        function an_move(a, b) {\r\n            function c() {\r\n                return h = setInterval(function () {\r\n                    if (o)return void g.stop();\r\n                    var b = e.x - a.x, c = e.y - a.y, h = b * f, i = c * f;\r\n                    a.x += h, a.y += i, .01 > h && .1 > i && d()\r\n                }, 100), g\r\n            }\r\n\r\n            function d() {\r\n                window.clearInterval(h)\r\n            }\r\n\r\n            var e = b.position, f = (b.context, b.easing || .2), g = {}, h = null;\r\n            return g.onStop = function (a) {\r\n                return g.onStop = a, g\r\n            }, g.run = c, g.stop = d, g\r\n        }\r\n\r\n        function an_scale(a, b) {\r\n            function c() {\r\n                return j = setInterval(function () {\r\n                    a.scaleX += f, a.scaleY += f, a.scaleX >= e && d()\r\n                }, 100), i\r\n            }\r\n\r\n            function d() {\r\n                i.onStop && i.onStop(a), a.scaleX = g, a.scaleY = h, window.clearInterval(j)\r\n            }\r\n\r\n            var e = (b.position, b.context, b.scale || 1), f = .06, g = a.scaleX, h = a.scaleY, i = {}, j = null;\r\n            return i.onStop = function (a) {\r\n                return i.onStop = a, i\r\n            }, i.run = c, i.stop = d, i\r\n        }\r\n\r\n        jtopo.Animate = {}, jtopo.Effect = {};\r\n        var o = !1;\r\n        jtopo.Effect.spring = ef_spring;\r\n        jtopo.Effect.gravity = ef_gravity;\r\n        jtopo.Animate.stepByStep = an_stepByStep;\r\n        jtopo.Animate.rotate = an_rotate;\r\n        jtopo.Animate.scale = an_scale;\r\n        jtopo.Animate.move = an_move;\r\n        jtopo.Animate.cycle = an_cycle;\r\n        jtopo.Animate.repeatThrow = an_repeatThrow;\r\n        jtopo.Animate.dividedTwoPiece = an_dividedTwoPiece;\r\n        jtopo.Animate.gravity = an_gravity;\r\n        jtopo.Animate.startAll = an_startAll;\r\n        jtopo.Animate.stopAll = an_stopAll;\r\n    }(JTopo),\r\n    function (jtopo) {\r\n        function b(a, b) {\r\n            var c = [];\r\n            if (0 == a.length)return c;\r\n            var d = b.match(/^\\s*(\\w+)\\s*$/);\r\n            if (null != d) {\r\n                var e = a.filter(function (a) {\r\n                    return a.elementType == d[1]\r\n                });\r\n                null != e && e.length > 0 && (c = c.concat(e))\r\n            } else {\r\n                var f = !1;\r\n                if (d = b.match(/\\s*(\\w+)\\s*\\[\\s*(\\w+)\\s*([>=<])\\s*[\'"](\\S+)[\'"]\\s*\\]\\s*/), (null == d || d.length < 5) && (d = b.match(/\\s*(\\w+)\\s*\\[\\s*(\\w+)\\s*([>=<])\\s*(\\d+(\\.\\d+)?)\\s*\\]\\s*/), f = !0), null != d && d.length >= 5) {\r\n                    var g = d[1], h = d[2], i = d[3], j = d[4];\r\n                    e = a.filter(function (a) {\r\n                        if (a.elementType != g)return !1;\r\n                        var b = a[h];\r\n                        return 1 == f && (b = parseInt(b)), "=" == i ? b == j : ">" == i ? b > j : "<" == i ? j > b : "<=" == i ? j >= b : ">=" == i ? b >= j : "!=" == i ? b != j : !1\r\n                    }), null != e && e.length > 0 && (c = c.concat(e))\r\n                }\r\n            }\r\n            return c\r\n        }\r\n\r\n        function c(a) {\r\n            if (a.find = function (a) {\r\n                    return find.call(this, a)\r\n                }, e.forEach(function (b) {\r\n                    a[b] = function (a) {\r\n                        for (var c = 0; c < this.length; c++)this[c][b](a);\r\n                        return this\r\n                    }\r\n                }), a.length > 0) {\r\n                var b = a[0];\r\n                for (var c in b) {\r\n                    var f = b[c];\r\n                    "function" == typeof f && !function (b) {\r\n                        a[c] = function () {\r\n                            for (var c = [], d = 0; d < a.length; d++)c.push(b.apply(a[d], arguments));\r\n                            return c\r\n                        }\r\n                    }(f)\r\n                }\r\n            }\r\n            return a.attr = function (a, b) {\r\n                if (null != a && null != b)for (var c = 0; c < this.length; c++)this[c][a] = b; else {\r\n                    if (null != a && "string" == typeof a) {\r\n                        for (var d = [], c = 0; c < this.length; c++)d.push(this[c][a]);\r\n                        return d\r\n                    }\r\n                    if (null != a)for (var c = 0; c < this.length; c++)for (var e in a)this[c][e] = a[e]\r\n                }\r\n                return this\r\n            }, a\r\n        }\r\n\r\n        function find(d) {\r\n            debugger;\r\n            var e = [];\r\n            var f = [];\r\n            if (this instanceof jtopo.Stage) {\r\n                e = this.childs;\r\n                f = f.concat(e);\r\n            } else if (this instanceof jtopo.Scene) {\r\n                e = [this];\r\n            } else {\r\n                f = this;\r\n                e.forEach(function (a) {\r\n                    f = f.concat(a.childs)\r\n                });\r\n            }\r\n            var g = null;\r\n            if ("function" == typeof d) {\r\n                f.filter(d)\r\n            } else {\r\n                b(f, d);\r\n            }\r\n            return c(g);\r\n        }\r\n\r\n        var e = "click,mousedown,mouseup,mouseover,mouseout,mousedrag,keydown,keyup".split(",");\r\n        jtopo.Stage.prototype.find = find;\r\n        jtopo.Scene.prototype.find = find;\r\n    }(JTopo),\r\n    function (win) {\r\n        function logObject(a, b) {\r\n            this.x = a;\r\n            this.y = b;\r\n        }\r\n\r\n        function Tortoise(a) {\r\n            this.p = new logObject(0, 0);\r\n            this.w = new logObject(1, 0);\r\n            this.paint = a;\r\n        }\r\n\r\n        function shift(a, b, c) {\r\n            return function (d) {\r\n                for (var e = 0; b > e; e++)a(), c && d.turn(c), d.move(3)\r\n            }\r\n        }\r\n\r\n        function spin(a, b) {\r\n            var c = 2 * Math.PI;\r\n            return function (d) {\r\n                for (var e = 0; b > e; e++)a(), d.turn(c / b)\r\n            }\r\n        }\r\n\r\n        function scale(a, b, c) {\r\n            return function (d) {\r\n                for (var e = 0; b > e; e++)a(), d.resize(c)\r\n            }\r\n        }\r\n\r\n        function polygon(a) {\r\n            var b = 2 * Math.PI;\r\n            return function (c) {\r\n                for (var d = 0; a > d; d++)c.forward(1), c.turn(b / a)\r\n            }\r\n        }\r\n\r\n        function star(a) {\r\n            var b = 4 * Math.PI;\r\n            return function (c) {\r\n                for (var d = 0; a > d; d++)c.forward(1), c.turn(b / a)\r\n            }\r\n        }\r\n\r\n        function spiral(a, b, c, d) {\r\n            return function (e) {\r\n                for (var f = 0; b > f; f++)a(), e.forward(1), e.turn(c), e.resize(d)\r\n            }\r\n        }\r\n\r\n        var Logo = {};\r\n        Tortoise.prototype.forward = function (a) {\r\n            var b = this.p, c = this.w;\r\n            return b.x = b.x + a * c.x, b.y = b.y + a * c.y, this.paint && this.paint(b.x, b.y), this\r\n        };\r\n        Tortoise.prototype.move = function (a) {\r\n            var b = this.p, c = this.w;\r\n            return b.x = b.x + a * c.x, b.y = b.y + a * c.y, this\r\n        };\r\n        Tortoise.prototype.moveTo = function (a, b) {\r\n            return this.p.x = a, this.p.y = b, this\r\n        };\r\n        Tortoise.prototype.turn = function (a) {\r\n            var b = (this.p, this.w);\r\n            var c = Math.cos(a) * b.x - Math.sin(a) * b.y;\r\n            var d = Math.sin(a) * b.x + Math.cos(a) * b.y;\r\n            b.x = c;\r\n            b.y = d;\r\n            return this;\r\n        };\r\n        Tortoise.prototype.resize = function (a) {\r\n            var b = this.w;\r\n            b.x = b.x * a;\r\n            b.y = b.y * a;\r\n            return this;\r\n        };\r\n        Tortoise.prototype.save = function () {\r\n            return null == this._stack && (this._stack = []), this._stack.push([this.p, this.w]), this\r\n        };\r\n        Tortoise.prototype.restore = function () {\r\n            if (null != this._stack && this._stack.length > 0) {\r\n                var a = this._stack.pop();\r\n                this.p = a[0], this.w = a[1]\r\n            }\r\n            return this\r\n        };\r\n        Logo.Tortoise = Tortoise;\r\n        Logo.shift = shift;\r\n        Logo.spin = spin;\r\n        Logo.polygon = polygon;\r\n        Logo.spiral = spiral;\r\n        Logo.star = star;\r\n        Logo.scale = scale;\r\n        win.Logo = Logo;\r\n    }(window);//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvanRvcG8vanRvcG8tbWluLmpzPzM0OWEiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsU0FBUztBQUNULFNBQVM7QUFDVCxtREFBbUQ7QUFDbkQ7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLFNBQVM7QUFDVCxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0EsYUFBYSxVQUFVO0FBQ3ZCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsV0FBVztBQUNsQztBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLCtEQUErRDtBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLCtCQUErQixtQkFBbUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixnQkFBZ0I7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQSxtRUFBbUUsMENBQTBDLG1CQUFtQjtBQUNoSTtBQUNBLDhFQUE4RSwyQkFBMkIsc0NBQXNDLHFCQUFxQjtBQUNwSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsZ0JBQWdCO0FBQ3ZDLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0EsdVhBQXVYLDJFQUEyRTtBQUNsYyxnQkFBZ0I7QUFDaEI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsaUJBQWlCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxTQUFTO0FBQ1QsU0FBUztBQUNULFNBQVM7QUFDVDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLCtCQUErQix3QkFBd0I7QUFDdkQ7QUFDQSxhQUFhO0FBQ2I7QUFDQSwrQkFBK0Isd0JBQXdCO0FBQ3ZEO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUIsb0JBQW9CO0FBQ3JDLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLDZCQUE2QixvRUFBb0UsY0FBYztBQUN0SjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsd0JBQXdCO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQiw2QkFBNkI7QUFDNUQ7QUFDQTtBQUNBLG1DQUFtQywyQkFBMkI7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkVBQTJFO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsY0FBYztBQUM3QztBQUNBO0FBQ0EsdUNBQXVDLHdCQUF3QjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUUsUUFBUSwrRUFBK0UsUUFBUTtBQUNsSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixrQ0FBa0M7QUFDakU7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLGtDQUFrQztBQUNqRTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0Isa0NBQWtDO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzTUFBc007QUFDdE07QUFDQSxtQ0FBbUMsa0NBQWtDO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtWQUErVjtBQUMvVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0dBQW9HLGtDQUFrQztBQUN0STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFELDhCQUE4QjtBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2Isd0JBQXdCO0FBQ3hCLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYix3QkFBd0I7QUFDeEIsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLG9CQUFvQjtBQUNyQyxhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGNBQWM7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRkFBaUYsY0FBYztBQUMvRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EscURBQXFELGNBQWM7QUFDbkUsYUFBYTtBQUNiO0FBQ0EscURBQXFELGNBQWM7QUFDbkUsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLDhCQUE4QjtBQUM3RDtBQUNBLG1DQUFtQyw2QkFBNkI7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYix5QkFBeUI7QUFDekI7QUFDQSxhQUFhO0FBQ2I7QUFDQSx3R0FBd0csbUNBQW1DO0FBQzNJLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCxtRkFBbUY7QUFDbEo7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCLE9BQU87QUFDeEIsNEJBQTRCLHVFQUF1RSxPQUFPLHVFQUF1RTtBQUNqTDtBQUNBO0FBQ0EsaUJBQWlCLFdBQVcsZUFBZSxXQUFXLGVBQWUsV0FBVyxlQUFlO0FBQy9GLGFBQWE7QUFDYjtBQUNBO0FBQ0EsK0JBQStCLGNBQWM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx5QkFBeUIsK0NBQStDLE9BQU87QUFDL0U7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQSwrR0FBK0csV0FBVztBQUMxSDtBQUNBO0FBQ0EsdUNBQXVDLHNCQUFzQjtBQUM3RDtBQUNBLHVEQUF1RCxXQUFXO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYix5QkFBeUI7QUFDekI7QUFDQSxhQUFhO0FBQ2IseUJBQXlCO0FBQ3pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLDJGQUEyRixhQUFhLFdBQVcsV0FBVyxXQUFXLGFBQWE7QUFDdEo7QUFDQTtBQUNBLGlCQUFpQixXQUFXLFdBQVcsV0FBVyxhQUFhO0FBQy9ELGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYix5QkFBeUI7QUFDekI7QUFDQSxhQUFhO0FBQ2IseUJBQXlCO0FBQ3pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLDRHQUE0RyxtQkFBbUIsV0FBVyx1QkFBdUI7QUFDaks7QUFDQTtBQUNBLGlCQUFpQixXQUFXLG1CQUFtQix5REFBeUQsbUJBQW1CLFdBQVcsdUJBQXVCO0FBQzdKO0FBQ0E7QUFDQSxpQkFBaUIsV0FBVyxtQkFBbUI7QUFDL0M7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLCtCQUErQixjQUFjO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYiwrQkFBK0Isd0JBQXdCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0Isd0JBQXdCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCLHNDQUFzQyw2REFBNkQ7QUFDcEg7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCLHdDQUF3QywrQ0FBK0M7QUFDeEc7QUFDQTtBQUNBLGlCQUFpQix5Q0FBeUMsK0VBQStFO0FBQ3pJO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLHFCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0Esd0RBQXdEO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsOENBQThDO0FBQ2xHLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLG9CQUFvQjtBQUNwQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkRBQTJELGlCQUFpQjtBQUM1RSxpREFBaUQsc0JBQXNCO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsbUJBQW1CO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLHFCQUFxQjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxvREFBb0QsY0FBYztBQUNsRTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEM7QUFDMUMsK0JBQStCLGNBQWM7QUFDN0M7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxjQUFjO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxRQUFRLCtEQUErRCxjQUFjO0FBQzVIO0FBQ0E7QUFDQSwrSUFBK0ksY0FBYztBQUM3Six5QkFBeUIsNEtBQTRLLGNBQWM7QUFDbk47QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLG1DQUFtQyxPQUFPLG9CQUFvQixPQUFPLGFBQWEsMkJBQTJCO0FBQzdHO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsVUFBVTtBQUN6QztBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx3RUFBd0UsUUFBUTtBQUNoRjtBQUNBO0FBQ0EsYUFBYSxFQUFFLCtEQUErRCxRQUFRO0FBQ3RGO0FBQ0E7QUFDQSxhQUFhLEVBQUUsaUVBQWlFLFFBQVE7QUFDeEY7QUFDQTtBQUNBLGFBQWEsRUFBRSxnRUFBZ0UsUUFBUSxhQUFhLHVCQUF1QjtBQUMzSDtBQUNBOztBQUVBO0FBQ0EsbUNBQW1DLE9BQU8sb0JBQW9CLE9BQU8sYUFBYSwyQkFBMkI7QUFDN0c7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQix1QkFBdUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyx1QkFBdUI7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLG1DQUFtQyxjQUFjO0FBQ2pEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHVCQUF1QjtBQUN0RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyx1QkFBdUI7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHVCQUF1QjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCLG1DQUFtQyx1QkFBdUI7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsNkNBQTZDO0FBQzdDO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBLDhFQUE4RSxtQkFBbUI7QUFDakc7QUFDQSxpQkFBaUIsNkJBQTZCLG9CQUFvQjtBQUNsRTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLCtDQUErQztBQUMvQztBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsNExBQTRMO0FBQzVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSx1RUFBdUU7QUFDdkU7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsc0dBQXNHO0FBQ3RHO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUEsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsdUNBQXVDLGlCQUFpQjtBQUN4RDtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsY0FBYztBQUNqRTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRCxpQkFBaUIsb0JBQW9CO0FBQy9GO0FBQ0EsK0NBQStDLGlCQUFpQjtBQUNoRTtBQUNBO0FBQ0EsaURBQWlELGlCQUFpQjtBQUNsRTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwrQkFBK0IsT0FBTztBQUN0QztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixPQUFPO0FBQ3RDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLCtCQUErQixPQUFPO0FBQ3RDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLE9BQU87QUFDdEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsT0FBTztBQUN0QztBQUNBOztBQUVBO0FBQ0E7QUFDQSwrQkFBK0IsT0FBTztBQUN0QztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLIiwiZmlsZSI6IjEwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIWZ1bmN0aW9uICh3aW5kb3cpIHtcclxuICAgIGZ1bmN0aW9uIEVsZW1lbnQoKSB7XHJcbiAgICAgICAgdGhpcy5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRUeXBlID0gXCJlbGVtZW50XCIsIHRoaXMuc2VyaWFsaXplZFByb3BlcnRpZXMgPSBbXCJlbGVtZW50VHlwZVwiXSwgdGhpcy5wcm9wZXJ0aWVzU3RhY2sgPSBbXSwgdGhpcy5faWQgPSBcIlwiICsgKG5ldyBEYXRlKS5nZXRUaW1lKClcclxuICAgICAgICB9LCB0aGlzLmRpc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgfSwgdGhpcy5yZW1vdmVIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIH0sIHRoaXMuYXR0ciA9IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgIGlmIChudWxsICE9IGEgJiYgbnVsbCAhPSBiKXRoaXNbYV0gPSBiOyBlbHNlIGlmIChudWxsICE9IGEpcmV0dXJuIHRoaXNbYV07XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzXHJcbiAgICAgICAgfSwgdGhpcy5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgYSA9IHRoaXMsIGIgPSB7fTtcclxuICAgICAgICAgICAgdGhpcy5zZXJpYWxpemVkUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XHJcbiAgICAgICAgICAgICAgICBiW2NdID0gYVtjXVxyXG4gICAgICAgICAgICB9KSwgdGhpcy5wcm9wZXJ0aWVzU3RhY2sucHVzaChiKVxyXG4gICAgICAgIH0sIHRoaXMucmVzdG9yZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5wcm9wZXJ0aWVzU3RhY2sgJiYgMCAhPSB0aGlzLnByb3BlcnRpZXNTdGFjay5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcywgYiA9IHRoaXMucHJvcGVydGllc1N0YWNrLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXJpYWxpemVkUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYVtjXSA9IGJbY11cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCB0aGlzLnRvSnNvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGEgPSB0aGlzLCBiID0gXCJ7XCIsIGMgPSB0aGlzLnNlcmlhbGl6ZWRQcm9wZXJ0aWVzLmxlbmd0aDtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplZFByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAoZCwgZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGYgPSBhW2RdO1xyXG4gICAgICAgICAgICAgICAgXCJzdHJpbmdcIiA9PSB0eXBlb2YgZiAmJiAoZiA9ICdcIicgKyBmICsgJ1wiJyksIGIgKz0gJ1wiJyArIGQgKyAnXCI6JyArIGYsIGMgPiBlICsgMSAmJiAoYiArPSBcIixcIilcclxuICAgICAgICAgICAgfSksIGIgKz0gXCJ9XCJcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyphPXRoaXMueCAtIHRoaXMuYm9yZGVyV2lkdGggLyAyIGI9dGhpcy55IC0gdGhpcy5ib3JkZXJXaWR0aCAvIDIsKi9cclxuICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUuSlRvcG9Sb3VuZFJlY3QgPSBmdW5jdGlvbiAoYSwgYiwgd19ib3JkZXJXaWR0aCwgaF9ib3JkZXJXaWR0aCwgYm9yZGVyUmFkaXVzKSB7XHJcbiAgICAgICAgLy/nlLvlhYPntKDlnIbop5LovrnmoYZcclxuICAgICAgICBcInVuZGVmaW5lZFwiID09IHR5cGVvZiBib3JkZXJSYWRpdXMgJiYgKGJvcmRlclJhZGl1cyA9IDUpLFxyXG4gICAgICAgICAgICB0aGlzLmJlZ2luUGF0aCgpLFxyXG4gICAgICAgICAgICB0aGlzLm1vdmVUbyhhICsgYm9yZGVyUmFkaXVzLCBiKSxcclxuICAgICAgICAgICAgdGhpcy5saW5lVG8oYSArIHdfYm9yZGVyV2lkdGggLSBib3JkZXJSYWRpdXMsIGIpLFxyXG4gICAgICAgICAgICB0aGlzLnF1YWRyYXRpY0N1cnZlVG8oYSArIHdfYm9yZGVyV2lkdGgsIGIsIGEgKyB3X2JvcmRlcldpZHRoLCBiICsgYm9yZGVyUmFkaXVzKSxcclxuICAgICAgICAgICAgdGhpcy5saW5lVG8oYSArIHdfYm9yZGVyV2lkdGgsIGIgKyBoX2JvcmRlcldpZHRoIC0gYm9yZGVyUmFkaXVzKSxcclxuICAgICAgICAgICAgdGhpcy5xdWFkcmF0aWNDdXJ2ZVRvKGEgKyB3X2JvcmRlcldpZHRoLCBiICsgaF9ib3JkZXJXaWR0aCwgYSArIHdfYm9yZGVyV2lkdGggLSBib3JkZXJSYWRpdXMsIGIgKyBoX2JvcmRlcldpZHRoKSxcclxuICAgICAgICAgICAgdGhpcy5saW5lVG8oYSArIGJvcmRlclJhZGl1cywgYiArIGhfYm9yZGVyV2lkdGgpLFxyXG4gICAgICAgICAgICB0aGlzLnF1YWRyYXRpY0N1cnZlVG8oYSwgYiArIGhfYm9yZGVyV2lkdGgsIGEsIGIgKyBoX2JvcmRlcldpZHRoIC0gYm9yZGVyUmFkaXVzKSxcclxuICAgICAgICAgICAgdGhpcy5saW5lVG8oYSwgYiArIGJvcmRlclJhZGl1cyksXHJcbiAgICAgICAgICAgIHRoaXMucXVhZHJhdGljQ3VydmVUbyhhLCBiLCBhICsgYm9yZGVyUmFkaXVzLCBiKSxcclxuICAgICAgICAgICAgdGhpcy5jbG9zZVBhdGgoKVxyXG4gICAgfTtcclxuICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUuSlRvcG9EYXNoZWRMaW5lVG8gPSBmdW5jdGlvbiAoc1gsIHNZLCBlWCwgZVksIGRhc2hlZFBhdHRlcm4pIHtcclxuICAgICAgICAvL+eUu+iZmue6v1xyXG4gICAgICAgIGlmIChcInVuZGVmaW5lZFwiID09IHR5cGVvZiBkYXNoZWRQYXR0ZXJuKSB7XHJcbiAgICAgICAgICAgIGRhc2hlZFBhdHRlcm4gPSA1O1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZFggPSBlWCAtIHNYO1xyXG4gICAgICAgIHZhciBkWSA9IGVZIC0gc1k7XHJcbiAgICAgICAgdmFyIGxlbmd0aCA9IE1hdGguZmxvb3IoTWF0aC5zcXJ0KGRYICogZFggKyBkWSAqIGRZKSk7XHJcbiAgICAgICAgdmFyIGRhc2hMID0gMCA+PSBkYXNoZWRQYXR0ZXJuID8gbGVuZ3RoIDogbGVuZ3RoIC8gZGFzaGVkUGF0dGVybjtcclxuICAgICAgICB2YXIgdFkgPSBkWSAvIGxlbmd0aCAqIGRhc2hlZFBhdHRlcm47XHJcbiAgICAgICAgdmFyIHRYID0gZFggLyBsZW5ndGggKiBkYXNoZWRQYXR0ZXJuO1xyXG4gICAgICAgIHRoaXMuYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgZm9yICh2YXIgbSA9IDA7IGRhc2hMID4gbTsgbSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChtICUgMikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5saW5lVG8oc1ggKyBtICogdFgsIHNZICsgbSAqIHRZKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW92ZVRvKHNYICsgbSAqIHRYLCBzWSArIG0gKiB0WSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdHJva2UoKTtcclxuICAgIH07XHJcbiAgICB2YXIgSlRvcG8gPSB7XHJcbiAgICAgICAgdmVyc2lvbjogXCIwLjQuOF8wMVwiLFxyXG4gICAgICAgIHpJbmRleF9Db250YWluZXI6IDEsXHJcbiAgICAgICAgekluZGV4X0xpbms6IDIsXHJcbiAgICAgICAgekluZGV4X05vZGU6IDMsXHJcbiAgICAgICAgU2NlbmVNb2RlOiB7bm9ybWFsOiBcIm5vcm1hbFwiLCBkcmFnOiBcImRyYWdcIiwgZWRpdDogXCJlZGl0XCIsIHNlbGVjdDogXCJzZWxlY3RcIn0sXHJcbiAgICAgICAgTW91c2VDdXJzb3I6IHtcclxuICAgICAgICAgICAgbm9ybWFsOiBcImRlZmF1bHRcIixcclxuICAgICAgICAgICAgcG9pbnRlcjogXCJwb2ludGVyXCIsXHJcbiAgICAgICAgICAgIHRvcF9sZWZ0OiBcIm53LXJlc2l6ZVwiLFxyXG4gICAgICAgICAgICB0b3BfY2VudGVyOiBcIm4tcmVzaXplXCIsXHJcbiAgICAgICAgICAgIHRvcF9yaWdodDogXCJuZS1yZXNpemVcIixcclxuICAgICAgICAgICAgbWlkZGxlX2xlZnQ6IFwiZS1yZXNpemVcIixcclxuICAgICAgICAgICAgbWlkZGxlX3JpZ2h0OiBcImUtcmVzaXplXCIsXHJcbiAgICAgICAgICAgIGJvdHRvbV9sZWZ0OiBcIm5lLXJlc2l6ZVwiLFxyXG4gICAgICAgICAgICBib3R0b21fY2VudGVyOiBcIm4tcmVzaXplXCIsXHJcbiAgICAgICAgICAgIGJvdHRvbV9yaWdodDogXCJudy1yZXNpemVcIixcclxuICAgICAgICAgICAgbW92ZTogXCJtb3ZlXCIsXHJcbiAgICAgICAgICAgIG9wZW5faGFuZDogXCJkZWZhdWx0XCIsXHJcbiAgICAgICAgICAgIGNsb3NlZF9oYW5kOiBcImRlZmF1bHRcIlxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY3JlYXRlU3RhZ2VGcm9tSnNvbjogZnVuY3Rpb24gKGpzb25TdHIsIGNhbnZhcykge1xyXG4gICAgICAgICAgICBldmFsKFwidmFyIGpzb25PYmogPSBcIiArIGpzb25TdHIpO1xyXG4gICAgICAgICAgICB2YXIgc3RhZ2UgPSBuZXcgSlRvcG8uU3RhZ2UoY2FudmFzKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBqc29uT2JqKVwiY2hpbGRzXCIgIT0gayAmJiAoc3RhZ2Vba10gPSBqc29uT2JqW2tdKTtcclxuICAgICAgICAgICAgdmFyIHNjZW5lcyA9IGpzb25PYmouY2hpbGRzO1xyXG4gICAgICAgICAgICByZXR1cm4gc2NlbmVzLmZvckVhY2goZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gbmV3IEpUb3BvLlNjZW5lKHN0YWdlKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGMgaW4gYSlcImNoaWxkc1wiICE9IGMgJiYgKGJbY10gPSBhW2NdKSwgXCJiYWNrZ3JvdW5kXCIgPT0gYyAmJiAoYi5iYWNrZ3JvdW5kID0gYVtjXSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGEuY2hpbGRzO1xyXG4gICAgICAgICAgICAgICAgZC5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBudWxsLCBkID0gYS5lbGVtZW50VHlwZTtcclxuICAgICAgICAgICAgICAgICAgICBcIm5vZGVcIiA9PSBkID8gYyA9IG5ldyBKVG9wby5Ob2RlIDogXCJDaXJjbGVOb2RlXCIgPT0gZCAmJiAoYyA9IG5ldyBKVG9wby5DaXJjbGVOb2RlKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBlIGluIGEpY1tlXSA9IGFbZV07XHJcbiAgICAgICAgICAgICAgICAgICAgYi5hZGQoYylcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pLCBzdGFnZVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBKVG9wby5FbGVtZW50ID0gRWxlbWVudDtcclxuICAgIHdpbmRvdy5KVG9wbyA9IEpUb3BvO1xyXG59KHdpbmRvdyksIGZ1bmN0aW9uIChKVG9wbykge1xyXG4gICAgZnVuY3Rpb24gTWVzc2FnZUJ1cyhhKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gYTtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VNYXAgPSB7fTtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VDb3VudCA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgTWVzc2FnZUJ1cy5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gKGV2ZW5OYW1lLCBmbikge1xyXG4gICAgICAgIHZhciBkID0gdGhpcy5tZXNzYWdlTWFwW2V2ZW5OYW1lXTtcclxuICAgICAgICBpZiAobnVsbCA9PSBkKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZU1hcFtldmVuTmFtZV0gPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlTWFwW2V2ZW5OYW1lXS5wdXNoKGZuKTtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VDb3VudCsrO1xyXG4gICAgfTtcclxuICAgIE1lc3NhZ2VCdXMucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gKGV2ZW5OYW1lLCBmbikge1xyXG4gICAgICAgIHZhciBldmVudCA9IHRoaXMubWVzc2FnZU1hcFtldmVuTmFtZV07XHJcbiAgICAgICAgaWYgKG51bGwgIT0gZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGZuICYmICdmdW5jdGlvbicgPT0gdHlwZW9mIGZuKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBldmVudC5pbmRleE9mKGZuKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZU1hcFtldmVuTmFtZV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMubWVzc2FnZU1hcFtldmVuTmFtZV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VDb3VudC0tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIE1lc3NhZ2VCdXMucHJvdG90eXBlLnB1Ymxpc2ggPSBmdW5jdGlvbiAoZXZlbk5hbWUsIGUsIGJvb2xlYW4pIHtcclxuICAgICAgICB2YXIgZXZlbnRNYXAgPSB0aGlzLm1lc3NhZ2VNYXBbZXZlbk5hbWVdO1xyXG4gICAgICAgIGlmIChudWxsICE9IGV2ZW50TWFwKSB7XHJcbiAgICAgICAgICAgIGV2ZW50TWFwLmZvckVhY2goZnVuY3Rpb24gKGZuKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYm9vbGVhbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbihlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LnF0b3BvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuKGUsIGUudGFyZ2V0LnF0b3BvKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbihlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBmdW5jdGlvbiBnZXREaXN0YW5jZShwb2ludEEsIHBvaW50QiwgYywgZCkge1xyXG4gICAgICAgIHZhciB3aWR0aCwgaGVpZ2h0O1xyXG4gICAgICAgIGlmIChudWxsID09IGMgJiYgbnVsbCA9PSBkKSB7XHJcbiAgICAgICAgICAgIGlmIChwb2ludEEgJiYgcG9pbnRCKSB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aCA9IHBvaW50Qi54IC0gcG9pbnRBLng7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBwb2ludEIueSAtIHBvaW50QS55O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgd2lkdGggPSBjIC0gcG9pbnRBO1xyXG4gICAgICAgICAgICBoZWlnaHQgPSBkIC0gcG9pbnRCO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHdpZHRoICogd2lkdGggKyBoZWlnaHQgKiBoZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldEVsZW1lbnRzQm91bmQoZWxlbWVudHMpIHtcclxuICAgICAgICB2YXIgYiA9IHtcclxuICAgICAgICAgICAgbGVmdDogTnVtYmVyLk1BWF9WQUxVRSxcclxuICAgICAgICAgICAgcmlnaHQ6IE51bWJlci5NSU5fVkFMVUUsXHJcbiAgICAgICAgICAgIHRvcDogTnVtYmVyLk1BWF9WQUxVRSxcclxuICAgICAgICAgICAgYm90dG9tOiBOdW1iZXIuTUlOX1ZBTFVFXHJcbiAgICAgICAgfTtcclxuICAgICAgICBlbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmICghKGVsZW1lbnQgaW5zdGFuY2VvZiBKVG9wby5MaW5rKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGIubGVmdCA+IGVsZW1lbnQueCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGIubGVmdCA9IGVsZW1lbnQueDtcclxuICAgICAgICAgICAgICAgICAgICBiLmxlZnROb2RlID0gZWxlbWVudDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChiLnJpZ2h0IDwgZWxlbWVudC54ICsgZWxlbWVudC53aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGIucmlnaHQgPSBlbGVtZW50LnggKyBlbGVtZW50LndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGIucmlnaHROb2RlID0gZWxlbWVudDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChiLnRvcCA+IGVsZW1lbnQueSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGIudG9wID0gZWxlbWVudC55O1xyXG4gICAgICAgICAgICAgICAgICAgIGIudG9wTm9kZSA9IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoYi5ib3R0b20gPCBlbGVtZW50LnkgKyBlbGVtZW50LmhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGIuYm90dG9tID0gZWxlbWVudC55ICsgZWxlbWVudC5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYi5ib3R0b21Ob2RlID0gZWxlbWVudDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGIud2lkdGggPSBiLnJpZ2h0IC0gYi5sZWZ0O1xyXG4gICAgICAgIGIuaGVpZ2h0ID0gYi5ib3R0b20gLSBiLnRvcDtcclxuICAgICAgICByZXR1cm4gYjtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRFdmVudFBvc2l0aW9uKGEpIHtcclxuICAgICAgICBhID0gY2xvbmVFdmVudChhKTtcclxuICAgICAgICBpZiAoIWEucGFnZVgpIHtcclxuICAgICAgICAgICAgYS5wYWdlWCA9IGEuY2xpZW50WCArIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCAtIGRvY3VtZW50LmJvZHkuY2xpZW50TGVmdDtcclxuICAgICAgICAgICAgYS5wYWdlWSA9IGEuY2xpZW50WSArIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wIC0gZG9jdW1lbnQuYm9keS5jbGllbnRUb3A7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJvdGF0ZVBvaW50KGFYLCBhWSwgYlgsIGJZLCBjKSB7XHJcbiAgICAgICAgdmFyIHdpZHRoID0gYlggLSBhWDtcclxuICAgICAgICB2YXIgaGVpZ2h0ID0gYlkgLSBhWTtcclxuICAgICAgICB2YXIgZGl0YW5jZSA9IE1hdGguc3FydCh3aWR0aCAqIHdpZHRoICsgaGVpZ2h0ICogaGVpZ2h0KTtcclxuICAgICAgICB2YXIgaSA9IE1hdGguYXRhbjIoaGVpZ2h0LCB3aWR0aCkgKyBjO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHg6IGFYICsgTWF0aC5jb3MoaSkgKiBkaXRhbmNlLFxyXG4gICAgICAgICAgICB5OiBhWSArIE1hdGguc2luKGkpICogZGl0YW5jZVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByb3RhdGVQb2ludHMocm9vdCwgY2hpbGRzLCBiZWdpbkFuZ2xlKSB7XHJcbiAgICAgICAgZm9yICh2YXIgZCA9IFtdLCBlID0gMDsgZSA8IGNoaWxkcy5sZW5ndGg7IGUrKykge1xyXG4gICAgICAgICAgICBkLnB1c2gocm90YXRlUG9pbnQocm9vdC54LCByb290LnksIGNoaWxkc1tlXS54LCBjaGlsZHNbZV0ueSwgYmVnaW5BbmdsZSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZFxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNsb25lRXZlbnQoYSkge1xyXG4gICAgICAgIHZhciBiID0ge307XHJcbiAgICAgICAgZm9yICh2YXIgYyBpbiBhKSB7XHJcbiAgICAgICAgICAgIGlmIChcInJldHVyblZhbHVlXCIgIT0gYyAmJiBcImtleUxvY2F0aW9uXCIgIT0gYykge1xyXG4gICAgICAgICAgICAgICAgYltjXSA9IGFbY107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGJcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjbG9uZShvYmplY3QpIHtcclxuICAgICAgICB2YXIgYiA9IHt9O1xyXG4gICAgICAgIGZvciAodmFyIGMgaW4gb2JqZWN0KSB7XHJcbiAgICAgICAgICAgIGJbY10gPSBvYmplY3RbY107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBiXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaXNQb2ludEluUmVjdChyZWN0LCBwb2ludHMpIHtcclxuICAgICAgICB2YXIgWCA9IHBvaW50cy54O1xyXG4gICAgICAgIHZhciBZID0gcG9pbnRzLnk7XHJcbiAgICAgICAgdmFyIFcgPSBwb2ludHMud2lkdGg7XHJcbiAgICAgICAgdmFyIEggPSBwb2ludHMuaGVpZ2h0O1xyXG4gICAgICAgIHJldHVybiByZWN0LnggPiBYICYmIHJlY3QueCA8IFggKyBXICYmIHJlY3QueSA+IFkgJiYgcmVjdC55IDwgWSArIEg7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaXNQb2ludEluTGluZShwb2ludHMsIHN0YXJ0LCBlbmQpIHtcclxuICAgICAgICB2YXIgbGluZSA9IEpUb3BvLnV0aWwuZ2V0RGlzdGFuY2Uoc3RhcnQsIGVuZCk7XHJcbiAgICAgICAgdmFyIHRvU3RhcnQgPSBKVG9wby51dGlsLmdldERpc3RhbmNlKHN0YXJ0LCBwb2ludHMpO1xyXG4gICAgICAgIHZhciB0b0VuZCA9IEpUb3BvLnV0aWwuZ2V0RGlzdGFuY2UoZW5kLCBwb2ludHMpO1xyXG4gICAgICAgIHJldHVybiBNYXRoLmFicyh0b1N0YXJ0ICsgdG9FbmQgLSBsaW5lKSA8PSAwLjU7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcmVtb3ZlRnJvbUFycmF5KGFyciwgaXRlbSkge1xyXG4gICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgYXJyLmxlbmd0aDsgYysrKSB7XHJcbiAgICAgICAgICAgIHZhciBkID0gYXJyW2NdO1xyXG4gICAgICAgICAgICBpZiAoZCA9PT0gaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgYXJyID0gYXJyLmRlbChjKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFyclxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJhbmRvbUNvbG9yKCkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKDI1NSAqIE1hdGgucmFuZG9tKCkpICsgXCIsXCIgKyBNYXRoLmZsb29yKDI1NSAqIE1hdGgucmFuZG9tKCkpICsgXCIsXCIgKyBNYXRoLmZsb29yKDI1NSAqIE1hdGgucmFuZG9tKCkpXHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIGxvYWRTdGFnZUZyb21Kc29uKGpzb24sIGNhbnZhcykge1xyXG4gICAgICAgIHZhciBvYmogPSBldmFsKGpzb24pLCBzdGFnZSA9IG5ldyBKVG9wby5TdGFnZShjYW52YXMpO1xyXG4gICAgICAgIGZvciAodmFyIGsgaW4gc3RhZ2VPYmopaWYgKFwic2NlbmVzXCIgIT0gaylzdGFnZVtrXSA9IG9ialtrXTsgZWxzZSBmb3IgKHZhciBzY2VuZXMgPSBvYmouc2NlbmVzLCBpID0gMDsgaSA8IHNjZW5lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgc2NlbmVPYmogPSBzY2VuZXNbaV0sIHNjZW5lID0gbmV3IEpUb3BvLlNjZW5lKHN0YWdlKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzY2VuZU9iailpZiAoXCJlbGVtZW50c1wiICE9IHApc2NlbmVbcF0gPSBzY2VuZU9ialtwXTsgZWxzZSBmb3IgKHZhciBub2RlTWFwID0ge30sIGVsZW1lbnRzID0gc2NlbmVPYmouZWxlbWVudHMsIG0gPSAwOyBtIDwgZWxlbWVudHMubGVuZ3RoOyBtKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50T2JqID0gZWxlbWVudHNbbV0sIHR5cGUgPSBlbGVtZW50T2JqLmVsZW1lbnRUeXBlLCBlbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgXCJOb2RlXCIgPT0gdHlwZSAmJiAoZWxlbWVudCA9IG5ldyBKVG9wby5Ob2RlKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIG1rIGluIGVsZW1lbnRPYmopZWxlbWVudFtta10gPSBlbGVtZW50T2JqW21rXTtcclxuICAgICAgICAgICAgICAgIG5vZGVNYXBbZWxlbWVudC50ZXh0XSA9IGVsZW1lbnQsIHNjZW5lLmFkZChlbGVtZW50KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb25zb2xlLmxvZyhzdGFnZSksIHN0YWdlXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY2hhbmdlQ29sb3IoY3R4LCBpbWFnZSwgY29sb3IpIHtcclxuICAgICAgICB2YXIgY29sb3JBcnIgPSBjb2xvci5zcGxpdChcIixcIik7XHJcbiAgICAgICAgdmFyIFIgPSBwYXJzZUludChjb2xvckFyclswXSk7XHJcbiAgICAgICAgdmFyIEcgPSBwYXJzZUludChjb2xvckFyclsxXSk7XHJcbiAgICAgICAgdmFyIEIgPSBwYXJzZUludChjb2xvckFyclsyXSk7XHJcbiAgICAgICAgdmFyIGltYWdlV2lkdGggPSBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDtcclxuICAgICAgICB2YXIgaW1hZ2VIZWlnaHQgPSBjYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xyXG4gICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICBjdHguZHJhd0ltYWdlKGltYWdlLCAwLCAwKTtcclxuICAgICAgICB2YXIgSW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcclxuICAgICAgICB2YXIgZGF0YSA9IEltYWdlRGF0YS5kYXRhO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpbWFnZVdpZHRoID4gaTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBpbWFnZUhlaWdodCA+IGo7IGorKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG4gPSA0ICogKGkgKyBqICogaW1hZ2VXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICBpZigwICE9IGRhdGFbbiArIDNdKXtcclxuICAgICAgICAgICAgICAgICAgICBpZihudWxsICE9IFIpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW24gKyAwXSArPSBSO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZihudWxsICE9IEcpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW24gKyAxXSArPSBHO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZihudWxsICE9IEIpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW24gKyAyXSArPSBCO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKEltYWdlRGF0YSwgMCwgMCwgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XHJcbiAgICAgICAgcmV0dXJuIGNhbnZhcy50b0RhdGFVUkwoKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZW5JbWFnZUFsYXJtKGltYWdlLCBjb2xvcikge1xyXG4gICAgICAgIHZhciBzcmMgPSBpbWFnZS5zcmMgKyBjb2xvcjtcclxuICAgICAgICBpZiAoYWxhcm1JbWFnZUNhY2hlW3NyY10pcmV0dXJuIGFsYXJtSW1hZ2VDYWNoZVtzcmNdO1xyXG4gICAgICAgIHZhciBuZXdJbWFnZSA9IG5ldyBJbWFnZTtcclxuICAgICAgICBuZXdJbWFnZS5zcmMgPSBjaGFuZ2VDb2xvcihncmFwaGljcywgaW1hZ2UsIGNvbG9yKTtcclxuICAgICAgICBhbGFybUltYWdlQ2FjaGVbc3JjXSA9IG5ld0ltYWdlO1xyXG4gICAgICAgIHJldHVybiBuZXdJbWFnZTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRPZmZzZXRQb3NpdGlvbihhKSB7XHJcbiAgICAgICAgaWYgKCFhKXJldHVybiB7bGVmdDogMCwgdG9wOiAwfTtcclxuICAgICAgICB2YXIgYiA9IDAsIGMgPSAwO1xyXG4gICAgICAgIGlmIChcImdldEJvdW5kaW5nQ2xpZW50UmVjdFwiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCl2YXIgZCA9IGEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGUgPSBhLm93bmVyRG9jdW1lbnQsIGYgPSBlLmJvZHksIGcgPSBlLmRvY3VtZW50RWxlbWVudCwgaCA9IGcuY2xpZW50VG9wIHx8IGYuY2xpZW50VG9wIHx8IDAsIGkgPSBnLmNsaWVudExlZnQgfHwgZi5jbGllbnRMZWZ0IHx8IDAsIGIgPSBkLnRvcCArIChzZWxmLnBhZ2VZT2Zmc2V0IHx8IGcgJiYgZy5zY3JvbGxUb3AgfHwgZi5zY3JvbGxUb3ApIC0gaCwgYyA9IGQubGVmdCArIChzZWxmLnBhZ2VYT2Zmc2V0IHx8IGcgJiYgZy5zY3JvbGxMZWZ0IHx8IGYuc2Nyb2xsTGVmdCkgLSBpOyBlbHNlIGRvIGIgKz0gYS5vZmZzZXRUb3AgfHwgMCwgYyArPSBhLm9mZnNldExlZnQgfHwgMCwgYSA9IGEub2Zmc2V0UGFyZW50OyB3aGlsZSAoYSk7XHJcbiAgICAgICAgcmV0dXJuIHtsZWZ0OiBjLCB0b3A6IGJ9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbGluZUYoeDEsIHkxLCB4MiwgeTIpIHtcclxuICAgICAgICBmdW5jdGlvbiBlKGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGEgKiBmICsgZ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGYgPSAoeTIgLSB5MSkgLyAoeDIgLSB4MSksIGcgPSB5MSAtIHgxICogZjtcclxuICAgICAgICByZXR1cm4gZS5rID0gZiwgZS5iID0gZywgZS54MSA9IHgxLCBlLngyID0geDIsIGUueTEgPSB5MSwgZS55MiA9IHkyLCBlXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaW5SYW5nZShhLCBiLCBjKSB7XHJcbiAgICAgICAgdmFyIGQgPSBNYXRoLmFicyhiIC0gYyksIGUgPSBNYXRoLmFicyhiIC0gYSksIGYgPSBNYXRoLmFicyhjIC0gYSksIGcgPSBNYXRoLmFicyhkIC0gKGUgKyBmKSk7XHJcbiAgICAgICAgcmV0dXJuIDFlLTYgPiBnID8gITAgOiAhMVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGlzUG9pbnRJbkxpbmVTZWcoYSwgYiwgYykge1xyXG4gICAgICAgIHJldHVybiBpblJhbmdlKGEsIGMueDEsIGMueDIpICYmIGluUmFuZ2UoYiwgYy55MSwgYy55MilcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBpbnRlcnNlY3Rpb24oYSwgYikge1xyXG4gICAgICAgIHZhciBjLCBkO1xyXG4gICAgICAgIHJldHVybiBhLmsgPT0gYi5rID8gbnVsbCA6ICgxIC8gMCA9PSBhLmsgfHwgYS5rID09IC0xIC8gMCA/IChjID0gYS54MSwgZCA9IGIoYS54MSkpIDogMSAvIDAgPT0gYi5rIHx8IGIuayA9PSAtMSAvIDAgPyAoYyA9IGIueDEsIGQgPSBhKGIueDEpKSA6IChjID0gKGIuYiAtIGEuYikgLyAoYS5rIC0gYi5rKSwgZCA9IGEoYykpLCAwID09IGlzUG9pbnRJbkxpbmVTZWcoYywgZCwgYSkgPyBudWxsIDogMCA9PSBpc1BvaW50SW5MaW5lU2VnKGMsIGQsIGIpID8gbnVsbCA6IHtcclxuICAgICAgICAgICAgeDogYyxcclxuICAgICAgICAgICAgeTogZFxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaW50ZXJzZWN0aW9uTGluZUJvdW5kKGxpbmssIGJvdW5kKSB7XHJcbiAgICAgICAgdmFyIGMgPSBKVG9wby51dGlsLmxpbmVGKGJvdW5kLmxlZnQsIGJvdW5kLnRvcCwgYm91bmQubGVmdCwgYm91bmQuYm90dG9tKTtcclxuICAgICAgICB2YXIgZCA9IEpUb3BvLnV0aWwuaW50ZXJzZWN0aW9uKGxpbmssIGMpO1xyXG4gICAgICAgIGlmIChudWxsID09IGQpIHtcclxuICAgICAgICAgICAgYyA9IEpUb3BvLnV0aWwubGluZUYoYm91bmQubGVmdCwgYm91bmQudG9wLCBib3VuZC5yaWdodCwgYm91bmQudG9wKTtcclxuICAgICAgICAgICAgZCA9IEpUb3BvLnV0aWwuaW50ZXJzZWN0aW9uKGxpbmssIGMpO1xyXG4gICAgICAgICAgICBpZiAobnVsbCA9PSBkKSB7XHJcbiAgICAgICAgICAgICAgICBjID0gSlRvcG8udXRpbC5saW5lRihib3VuZC5yaWdodCwgYm91bmQudG9wLCBib3VuZC5yaWdodCwgYm91bmQuYm90dG9tKTtcclxuICAgICAgICAgICAgICAgIGQgPSBKVG9wby51dGlsLmludGVyc2VjdGlvbihsaW5rLCBjKTtcclxuICAgICAgICAgICAgICAgIGlmIChudWxsID09IGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjID0gSlRvcG8udXRpbC5saW5lRihib3VuZC5sZWZ0LCBib3VuZC5ib3R0b20sIGJvdW5kLnJpZ2h0LCBib3VuZC5ib3R0b20pO1xyXG4gICAgICAgICAgICAgICAgICAgIGQgPSBKVG9wby51dGlsLmludGVyc2VjdGlvbihsaW5rLCBjKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGQ7XHJcbiAgICB9XHJcblxyXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGEsIDFlMyAvIDI0KVxyXG4gICAgICAgIH07XHJcbiAgICBBcnJheS5wcm90b3R5cGUuZGVsID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICBpZiAoXCJudW1iZXJcIiAhPSB0eXBlb2YgaXRlbSkge1xyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmluZGV4T2YoaXRlbSk7XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoaXRlbSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNwbGljZShpdGVtLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgaWYgKCFbXS5pbmRleE9mKSB7XHJcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzW2ldID09PSBhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHdpbmRvdy5jb25zb2xlIHx8ICh3aW5kb3cuY29uc29sZSA9IHtcclxuICAgICAgICBsb2c6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB9LCBpbmZvOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgfSwgZGVidWc6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB9LCB3YXJuOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgfSwgZXJyb3I6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLCBncmFwaGljcyA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIiksIGFsYXJtSW1hZ2VDYWNoZSA9IHt9O1xyXG4gICAgSlRvcG8udXRpbCA9IHtcclxuICAgICAgICByb3RhdGVQb2ludDogcm90YXRlUG9pbnQsXHJcbiAgICAgICAgcm90YXRlUG9pbnRzOiByb3RhdGVQb2ludHMsXHJcbiAgICAgICAgZ2V0RGlzdGFuY2U6IGdldERpc3RhbmNlLFxyXG4gICAgICAgIGdldEV2ZW50UG9zaXRpb246IGdldEV2ZW50UG9zaXRpb24sXHJcbiAgICAgICAgTWVzc2FnZUJ1czogTWVzc2FnZUJ1cyxcclxuICAgICAgICBpc0ZpcmVmb3g6IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIkZpcmVmb3hcIikgPiAwLFxyXG4gICAgICAgIGlzSUU6ICEoIXdpbmRvdy5hdHRhY2hFdmVudCB8fCAtMSAhPT0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiT3BlcmFcIikpLFxyXG4gICAgICAgIGlzQ2hyb21lOiBudWxsICE9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5tYXRjaCgvY2hyb21lLyksXHJcbiAgICAgICAgY2xvbmU6IGNsb25lLFxyXG4gICAgICAgIGlzUG9pbnRJblJlY3Q6IGlzUG9pbnRJblJlY3QsXHJcbiAgICAgICAgaXNQb2ludEluTGluZTogaXNQb2ludEluTGluZSxcclxuICAgICAgICByZW1vdmVGcm9tQXJyYXk6IHJlbW92ZUZyb21BcnJheSxcclxuICAgICAgICBjbG9uZUV2ZW50OiBjbG9uZUV2ZW50LFxyXG4gICAgICAgIHJhbmRvbUNvbG9yOiByYW5kb21Db2xvcixcclxuICAgICAgICBsb2FkU3RhZ2VGcm9tSnNvbjogbG9hZFN0YWdlRnJvbUpzb24sXHJcbiAgICAgICAgZ2V0RWxlbWVudHNCb3VuZDogZ2V0RWxlbWVudHNCb3VuZCxcclxuICAgICAgICBnZW5JbWFnZUFsYXJtOiBnZW5JbWFnZUFsYXJtLFxyXG4gICAgICAgIGdldE9mZnNldFBvc2l0aW9uOiBnZXRPZmZzZXRQb3NpdGlvbixcclxuICAgICAgICBsaW5lRjogbGluZUYsXHJcbiAgICAgICAgaW50ZXJzZWN0aW9uOiBpbnRlcnNlY3Rpb24sXHJcbiAgICAgICAgaW50ZXJzZWN0aW9uTGluZUJvdW5kOiBpbnRlcnNlY3Rpb25MaW5lQm91bmRcclxuICAgIH1cclxufShKVG9wbyksXHJcbiAgICBmdW5jdGlvbiAoanRvcG8pIHtcclxuICAgICAgICBmdW5jdGlvbiBiKGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGhnYXA6IDE2LCB2aXNpYmxlOiAhMSwgZXhwb3J0Q2FudmFzOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLCBnZXRJbWFnZTogZnVuY3Rpb24gKGIsIGMpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEuZ2V0Qm91bmQoKSwgZSA9IDEsIGYgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwb3J0Q2FudmFzLndpZHRoID0gYS5jYW52YXMud2lkdGgsIHRoaXMuZXhwb3J0Q2FudmFzLmhlaWdodCA9IGEuY2FudmFzLmhlaWdodCwgbnVsbCAhPSBiICYmIG51bGwgIT0gYyA/ICh0aGlzLmV4cG9ydENhbnZhcy53aWR0aCA9IGIsIHRoaXMuZXhwb3J0Q2FudmFzLmhlaWdodCA9IGMsIGUgPSBiIC8gZC53aWR0aCwgZiA9IGMgLyBkLmhlaWdodCkgOiAoZC53aWR0aCA+IGEuY2FudmFzLndpZHRoICYmICh0aGlzLmV4cG9ydENhbnZhcy53aWR0aCA9IGQud2lkdGgpLCBkLmhlaWdodCA+IGEuY2FudmFzLmhlaWdodCAmJiAodGhpcy5leHBvcnRDYW52YXMuaGVpZ2h0ID0gZC5oZWlnaHQpKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IHRoaXMuZXhwb3J0Q2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5jaGlsZHMubGVuZ3RoID4gMCAmJiAoZy5zYXZlKCksIGcuY2xlYXJSZWN0KDAsIDAsIHRoaXMuZXhwb3J0Q2FudmFzLndpZHRoLCB0aGlzLmV4cG9ydENhbnZhcy5oZWlnaHQpLCBhLmNoaWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDEgPT0gYS52aXNpYmxlICYmIChhLnNhdmUoKSwgYS50cmFuc2xhdGVYID0gMCwgYS50cmFuc2xhdGVZID0gMCwgYS5zY2FsZVggPSAxLCBhLnNjYWxlWSA9IDEsIGcuc2NhbGUoZSwgZiksIGQubGVmdCA8IDAgJiYgKGEudHJhbnNsYXRlWCA9IE1hdGguYWJzKGQubGVmdCkpLCBkLnRvcCA8IDAgJiYgKGEudHJhbnNsYXRlWSA9IE1hdGguYWJzKGQudG9wKSksIGEucGFpbnRBbGwgPSAhMCwgYS5yZXBhaW50KGcpLCBhLnBhaW50QWxsID0gITEsIGEucmVzdG9yZSgpKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLCBnLnJlc3RvcmUoKSksIHRoaXMuZXhwb3J0Q2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKVxyXG4gICAgICAgICAgICAgICAgfSwgY2FudmFzOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLCB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVhZ2xlSW1hZ2VEYXRhcyA9IHRoaXMuZ2V0RGF0YShhKVxyXG4gICAgICAgICAgICAgICAgfSwgc2V0U2l6ZTogZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5jYW52YXMud2lkdGggPSBhLCB0aGlzLmhlaWdodCA9IHRoaXMuY2FudmFzLmhlaWdodCA9IGJcclxuICAgICAgICAgICAgICAgIH0sIGdldERhdGE6IGZ1bmN0aW9uIChiLCBjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5zdGFnZS5jYW52YXMud2lkdGgsIGMgPSBhLnN0YWdlLmNhbnZhcy5oZWlnaHQsIGQgPSBiIC8gYS5zY2FsZVggLyAyLCBlID0gYyAvIGEuc2NhbGVZIC8gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHt0cmFuc2xhdGVYOiBhLnRyYW5zbGF0ZVggKyBkIC0gZCAqIGEuc2NhbGVYLCB0cmFuc2xhdGVZOiBhLnRyYW5zbGF0ZVkgKyBlIC0gZSAqIGEuc2NhbGVZfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBqICYmIG51bGwgIT0gayA/IHRoaXMuc2V0U2l6ZShiLCBjKSA6IHRoaXMuc2V0U2l6ZSgyMDAsIDE2MCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuY2hpbGRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5zYXZlKCksIGUuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpLCBhLmNoaWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxID09IGEudmlzaWJsZSAmJiAoYS5zYXZlKCksIGEuY2VudGVyQW5kWm9vbShudWxsLCBudWxsLCBlKSwgYS5yZXBhaW50KGUpLCBhLnJlc3RvcmUoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZChhLmNoaWxkc1swXSksIGcgPSBmLnRyYW5zbGF0ZVggKiAodGhpcy5jYW52YXMud2lkdGggLyBhLmNhbnZhcy53aWR0aCkgKiBhLmNoaWxkc1swXS5zY2FsZVgsIGggPSBmLnRyYW5zbGF0ZVkgKiAodGhpcy5jYW52YXMuaGVpZ2h0IC8gYS5jYW52YXMuaGVpZ2h0KSAqIGEuY2hpbGRzWzBdLnNjYWxlWSwgaSA9IGEuZ2V0Qm91bmQoKSwgaiA9IGEuY2FudmFzLndpZHRoIC8gYS5jaGlsZHNbMF0uc2NhbGVYIC8gaS53aWR0aCwgayA9IGEuY2FudmFzLmhlaWdodCAvIGEuY2hpbGRzWzBdLnNjYWxlWSAvIGkuaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqID4gMSAmJiAoaiA9IDEpLCBrID4gMSAmJiAoaiA9IDEpLCBnICo9IGosIGggKj0gaywgaS5sZWZ0IDwgMCAmJiAoZyAtPSBNYXRoLmFicyhpLmxlZnQpICogKHRoaXMud2lkdGggLyBpLndpZHRoKSksIGkudG9wIDwgMCAmJiAoaCAtPSBNYXRoLmFicyhpLnRvcCkgKiAodGhpcy5oZWlnaHQgLyBpLmhlaWdodCkpLCBlLnNhdmUoKSwgZS5saW5lV2lkdGggPSAxLCBlLnN0cm9rZVN0eWxlID0gXCJyZ2JhKDI1NSwwLDAsMSlcIiwgZS5zdHJva2VSZWN0KC1nLCAtaCwgZS5jYW52YXMud2lkdGggKiBqLCBlLmNhbnZhcy5oZWlnaHQgKiBrKSwgZS5yZXN0b3JlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBlLmdldEltYWdlRGF0YSgwLCAwLCBlLmNhbnZhcy53aWR0aCwgZS5jYW52YXMuaGVpZ2h0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGxcclxuICAgICAgICAgICAgICAgIH0sIHBhaW50OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5lYWdsZUltYWdlRGF0YXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhLmdyYXBoaWNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiLnNhdmUoKSwgYi5maWxsU3R5bGUgPSBcInJnYmEoMjExLDIxMSwyMTEsMC4zKVwiLCBiLmZpbGxSZWN0KGEuY2FudmFzLndpZHRoIC0gdGhpcy5jYW52YXMud2lkdGggLSAyICogdGhpcy5oZ2FwLCBhLmNhbnZhcy5oZWlnaHQgLSB0aGlzLmNhbnZhcy5oZWlnaHQgLSAxLCBhLmNhbnZhcy53aWR0aCAtIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQgKyAxKSwgYi5maWxsKCksIGIuc2F2ZSgpLCBiLmxpbmVXaWR0aCA9IDEsIGIuc3Ryb2tlU3R5bGUgPSBcInJnYmEoMCwwLDAsMSlcIiwgYi5yZWN0KGEuY2FudmFzLndpZHRoIC0gdGhpcy5jYW52YXMud2lkdGggLSAyICogdGhpcy5oZ2FwLCBhLmNhbnZhcy5oZWlnaHQgLSB0aGlzLmNhbnZhcy5oZWlnaHQgLSAxLCBhLmNhbnZhcy53aWR0aCAtIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQgKyAxKSwgYi5zdHJva2UoKSwgYi5yZXN0b3JlKCksIGIucHV0SW1hZ2VEYXRhKHRoaXMuZWFnbGVJbWFnZURhdGFzLCBhLmNhbnZhcy53aWR0aCAtIHRoaXMuY2FudmFzLndpZHRoIC0gdGhpcy5oZ2FwLCBhLmNhbnZhcy5oZWlnaHQgLSB0aGlzLmNhbnZhcy5oZWlnaHQpLCBiLnJlc3RvcmUoKVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLmVhZ2xlSW1hZ2VEYXRhcyA9IHRoaXMuZ2V0RGF0YShhKVxyXG4gICAgICAgICAgICAgICAgfSwgZXZlbnRIYW5kbGVyOiBmdW5jdGlvbiAoYSwgYiwgYykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gYi54LCBlID0gYi55O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkID4gYy5jYW52YXMud2lkdGggLSB0aGlzLmNhbnZhcy53aWR0aCAmJiBlID4gYy5jYW52YXMuaGVpZ2h0IC0gdGhpcy5jYW52YXMuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID0gYi54IC0gdGhpcy5jYW52YXMud2lkdGgsIGUgPSBiLnkgLSB0aGlzLmNhbnZhcy5oZWlnaHQsIFwibW91c2Vkb3duXCIgPT0gYSAmJiAodGhpcy5sYXN0VHJhbnNsYXRlWCA9IGMuY2hpbGRzWzBdLnRyYW5zbGF0ZVgsIHRoaXMubGFzdFRyYW5zbGF0ZVkgPSBjLmNoaWxkc1swXS50cmFuc2xhdGVZKSwgXCJtb3VzZWRyYWdcIiA9PSBhICYmIGMuY2hpbGRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYi5keCwgZyA9IGIuZHksIGggPSBjLmdldEJvdW5kKCksIGkgPSB0aGlzLmNhbnZhcy53aWR0aCAvIGMuY2hpbGRzWzBdLnNjYWxlWCAvIGgud2lkdGgsIGogPSB0aGlzLmNhbnZhcy5oZWlnaHQgLyBjLmNoaWxkc1swXS5zY2FsZVkgLyBoLmhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuY2hpbGRzWzBdLnRyYW5zbGF0ZVggPSB0aGlzLmxhc3RUcmFuc2xhdGVYIC0gZiAvIGksIGMuY2hpbGRzWzBdLnRyYW5zbGF0ZVkgPSB0aGlzLmxhc3RUcmFuc2xhdGVZIC0gZyAvIGpcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc3RhZ2UoYykge1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBkKGIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjID0ganRvcG8udXRpbC5nZXRFdmVudFBvc2l0aW9uKGIpLCBkID0ganRvcG8udXRpbC5nZXRPZmZzZXRQb3NpdGlvbihuLmNhbnZhcyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYy5vZmZzZXRMZWZ0ID0gYy5wYWdlWCAtIGQubGVmdCwgYy5vZmZzZXRUb3AgPSBjLnBhZ2VZIC0gZC50b3AsIGMueCA9IGMub2Zmc2V0TGVmdCwgYy55ID0gYy5vZmZzZXRUb3AsIGMudGFyZ2V0ID0gbnVsbCwgY1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBlKGEpIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50Lm9uc2VsZWN0c3RhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExXHJcbiAgICAgICAgICAgICAgICB9LCB0aGlzLm1vdXNlT3ZlciA9ICEwO1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBkKGEpO1xyXG4gICAgICAgICAgICAgICAgbi5kaXNwYXRjaEV2ZW50VG9TY2VuZXMoXCJtb3VzZW92ZXJcIiwgYiksIG4uZGlzcGF0Y2hFdmVudChcIm1vdXNlb3ZlclwiLCBiKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBmKGEpIHtcclxuICAgICAgICAgICAgICAgIHAgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBvID0gITBcclxuICAgICAgICAgICAgICAgIH0sIDUwMCksIGRvY3VtZW50Lm9uc2VsZWN0c3RhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBkKGEpO1xyXG4gICAgICAgICAgICAgICAgbi5kaXNwYXRjaEV2ZW50VG9TY2VuZXMoXCJtb3VzZW91dFwiLCBiKSwgbi5kaXNwYXRjaEV2ZW50KFwibW91c2VvdXRcIiwgYiksIG4ubmVlZFJlcGFpbnQgPSAwID09IG4uYW5pbWF0ZSA/ICExIDogITBcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZyhhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYiA9IGQoYSk7XHJcbiAgICAgICAgICAgICAgICBuLm1vdXNlRG93biA9ICEwLCBuLm1vdXNlRG93blggPSBiLngsIG4ubW91c2VEb3duWSA9IGIueSwgbi5kaXNwYXRjaEV2ZW50VG9TY2VuZXMoXCJtb3VzZWRvd25cIiwgYiksIG4uZGlzcGF0Y2hFdmVudChcIm1vdXNlZG93blwiLCBiKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBoKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gZChhKTtcclxuICAgICAgICAgICAgICAgIG4uZGlzcGF0Y2hFdmVudFRvU2NlbmVzKFwibW91c2V1cFwiLCBiKSwgbi5kaXNwYXRjaEV2ZW50KFwibW91c2V1cFwiLCBiKSwgbi5tb3VzZURvd24gPSAhMSwgbi5uZWVkUmVwYWludCA9IDAgPT0gbi5hbmltYXRlID8gITEgOiAhMFxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpKGEpIHtcclxuICAgICAgICAgICAgICAgIHAgJiYgKHdpbmRvdy5jbGVhclRpbWVvdXQocCksIHAgPSBudWxsKSwgbyA9ICExO1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBkKGEpO1xyXG4gICAgICAgICAgICAgICAgbi5tb3VzZURvd24gPyAwID09IGEuYnV0dG9uICYmIChiLmR4ID0gYi54IC0gbi5tb3VzZURvd25YLCBiLmR5ID0gYi55IC0gbi5tb3VzZURvd25ZLCBuLmRpc3BhdGNoRXZlbnRUb1NjZW5lcyhcIm1vdXNlZHJhZ1wiLCBiKSwgbi5kaXNwYXRjaEV2ZW50KFwibW91c2VkcmFnXCIsIGIpLCAxID09IG4uZWFnbGVFeWUudmlzaWJsZSAmJiBuLmVhZ2xlRXllLnVwZGF0ZSgpKSA6IChuLmRpc3BhdGNoRXZlbnRUb1NjZW5lcyhcIm1vdXNlbW92ZVwiLCBiKSwgbi5kaXNwYXRjaEV2ZW50KFwibW91c2Vtb3ZlXCIsIGIpKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBqKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gZChhKTtcclxuICAgICAgICAgICAgICAgIG4uZGlzcGF0Y2hFdmVudFRvU2NlbmVzKFwiY2xpY2tcIiwgYiksIG4uZGlzcGF0Y2hFdmVudChcImNsaWNrXCIsIGIpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGsoYSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBkKGEpO1xyXG4gICAgICAgICAgICAgICAgbi5kaXNwYXRjaEV2ZW50VG9TY2VuZXMoXCJkYmNsaWNrXCIsIGIpLCBuLmRpc3BhdGNoRXZlbnQoXCJkYmNsaWNrXCIsIGIpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGwoYSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBkKGEpO1xyXG4gICAgICAgICAgICAgICAgbi5kaXNwYXRjaEV2ZW50VG9TY2VuZXMoXCJtb3VzZXdoZWVsXCIsIGIpLCBuLmRpc3BhdGNoRXZlbnQoXCJtb3VzZXdoZWVsXCIsIGIpLCBudWxsICE9IG4ud2hlZWxab29tICYmIChhLnByZXZlbnREZWZhdWx0ID8gYS5wcmV2ZW50RGVmYXVsdCgpIDogKGEgPSBhIHx8IHdpbmRvdy5ldmVudCwgYS5yZXR1cm5WYWx1ZSA9ICExKSwgMSA9PSBuLmVhZ2xlRXllLnZpc2libGUgJiYgbi5lYWdsZUV5ZS51cGRhdGUoKSlcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gbShiKSB7XHJcbiAgICAgICAgICAgICAgICBqdG9wby51dGlsLmlzSUUgfHwgIXdpbmRvdy5hZGRFdmVudExpc3RlbmVyID8gKGIub25tb3VzZW91dCA9IGYsIGIub25tb3VzZW92ZXIgPSBlLCBiLm9ubW91c2Vkb3duID0gZywgYi5vbm1vdXNldXAgPSBoLCBiLm9ubW91c2Vtb3ZlID0gaSwgYi5vbmNsaWNrID0gaiwgYi5vbmRibGNsaWNrID0gaywgYi5vbm1vdXNld2hlZWwgPSBsLCBiLnRvdWNoc3RhcnQgPSBnLCBiLnRvdWNobW92ZSA9IGksIGIudG91Y2hlbmQgPSBoKSA6IChiLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCBmKSwgYi5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGUpLCBiLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZyksIGIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgaCksIGIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBpKSwgYi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaiksIGIuYWRkRXZlbnRMaXN0ZW5lcihcImRibGNsaWNrXCIsIGspLCBqdG9wby51dGlsLmlzRmlyZWZveCA/IGIuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTU1vdXNlU2Nyb2xsXCIsIGwpIDogYi5hZGRFdmVudExpc3RlbmVyKFwibW91c2V3aGVlbFwiLCBsKSksIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyICYmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgICAgICBuLmRpc3BhdGNoRXZlbnRUb1NjZW5lcyhcImtleWRvd25cIiwganRvcG8udXRpbC5jbG9uZUV2ZW50KGIpKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGIua2V5Q29kZTtcclxuICAgICAgICAgICAgICAgICAgICAoMzcgPT0gYyB8fCAzOCA9PSBjIHx8IDM5ID09IGMgfHwgNDAgPT0gYykgJiYgKGIucHJldmVudERlZmF1bHQgPyBiLnByZXZlbnREZWZhdWx0KCkgOiAoYiA9IGIgfHwgd2luZG93LmV2ZW50LCBiLnJldHVyblZhbHVlID0gITEpKVxyXG4gICAgICAgICAgICAgICAgfSwgITApLCB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGZ1bmN0aW9uIChiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbi5kaXNwYXRjaEV2ZW50VG9TY2VuZXMoXCJrZXl1cFwiLCBqdG9wby51dGlsLmNsb25lRXZlbnQoYikpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gYi5rZXlDb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICgzNyA9PSBjIHx8IDM4ID09IGMgfHwgMzkgPT0gYyB8fCA0MCA9PSBjKSAmJiAoYi5wcmV2ZW50RGVmYXVsdCA/IGIucHJldmVudERlZmF1bHQoKSA6IChiID0gYiB8fCB3aW5kb3cuZXZlbnQsIGIucmV0dXJuVmFsdWUgPSAhMSkpXHJcbiAgICAgICAgICAgICAgICB9LCAhMCkpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGp0b3BvLnN0YWdlID0gdGhpcztcclxuICAgICAgICAgICAgdmFyIG4gPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChjKSB7XHJcbiAgICAgICAgICAgICAgICBtKGMpLCB0aGlzLmNhbnZhcyA9IGMsIHRoaXMuZ3JhcGhpY3MgPSBjLmdldENvbnRleHQoXCIyZFwiKSwgdGhpcy5jaGlsZHMgPSBbXSwgdGhpcy5mcmFtZXMgPSAyNCwgdGhpcy5tZXNzYWdlQnVzID0gbmV3IGp0b3BvLnV0aWwuTWVzc2FnZUJ1cywgdGhpcy5lYWdsZUV5ZSA9IGIodGhpcyksIHRoaXMud2hlZWxab29tID0gbnVsbCwgdGhpcy5tb3VzZURvd25YID0gMCwgdGhpcy5tb3VzZURvd25ZID0gMCwgdGhpcy5tb3VzZURvd24gPSAhMSwgdGhpcy5tb3VzZU92ZXIgPSAhMSwgdGhpcy5uZWVkUmVwYWludCA9ICEwLCB0aGlzLnNlcmlhbGl6ZWRQcm9wZXJ0aWVzID0gW1wiZnJhbWVzXCIsIFwid2hlZWxab29tXCJdXHJcbiAgICAgICAgICAgIH0sIG51bGwgIT0gYyAmJiB0aGlzLmluaXRpYWxpemUoYyk7XHJcbiAgICAgICAgICAgIHZhciBvID0gITAsIHAgPSBudWxsO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9cclxuICAgICAgICAgICAgfSwgdGhpcy5kaXNwYXRjaEV2ZW50VG9TY2VuZXMgPSBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgaWYgKDAgIT0gdGhpcy5mcmFtZXMgJiYgKHRoaXMubmVlZFJlcGFpbnQgPSAhMCksIDEgPT0gdGhpcy5lYWdsZUV5ZS52aXNpYmxlICYmIC0xICE9IGEuaW5kZXhPZihcIm1vdXNlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBiLngsIGQgPSBiLnk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGMgPiB0aGlzLndpZHRoIC0gdGhpcy5lYWdsZUV5ZS53aWR0aCAmJiBkID4gdGhpcy5oZWlnaHQgLSB0aGlzLmVhZ2xlRXllLmhlaWdodClyZXR1cm4gdm9pZCB0aGlzLmVhZ2xlRXllLmV2ZW50SGFuZGxlcihhLCBiLCB0aGlzKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHMuZm9yRWFjaChmdW5jdGlvbiAoYykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgxID09IGMudmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGNbYSArIFwiSGFuZGxlclwiXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gZCl0aHJvdyBuZXcgRXJyb3IoXCJGdW5jdGlvbiBub3QgZm91bmQ6XCIgKyBhICsgXCJIYW5kbGVyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkLmNhbGwoYywgYilcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9LCB0aGlzLmFkZCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IHRoaXMuY2hpbGRzLmxlbmd0aDsgYisrKWlmICh0aGlzLmNoaWxkc1tiXSA9PT0gYSlyZXR1cm47XHJcbiAgICAgICAgICAgICAgICBhLmFkZFRvKHRoaXMpLCB0aGlzLmNoaWxkcy5wdXNoKGEpXHJcbiAgICAgICAgICAgIH0sIHRoaXMucmVtb3ZlID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChudWxsID09IGEpdGhyb3cgbmV3IEVycm9yKFwiU3RhZ2UucmVtb3Zl5Ye66ZSZOiDlj4LmlbDkuLpudWxsIVwiKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgdGhpcy5jaGlsZHMubGVuZ3RoOyBiKyspaWYgKHRoaXMuY2hpbGRzW2JdID09PSBhKXJldHVybiBhLnN0YWdlID0gbnVsbCwgdGhpcy5jaGlsZHMgPSB0aGlzLmNoaWxkcy5kZWwoYiksIHRoaXM7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1xyXG4gICAgICAgICAgICB9LCB0aGlzLmNsZWFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHMgPSBbXVxyXG4gICAgICAgICAgICB9LCB0aGlzLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBmbikge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoc2VsZiwgZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlQnVzLnN1YnNjcmliZShldmVudE5hbWUsIGZuKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9LCB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoYSwgZikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlQnVzLnVuc3Vic2NyaWJlKGEsIGYpXHJcbiAgICAgICAgICAgIH0sIHRoaXMucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZUJ1cyA9IG5ldyBqdG9wby51dGlsLk1lc3NhZ2VCdXNcclxuICAgICAgICAgICAgfSwgdGhpcy5kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VCdXMucHVibGlzaChhLCBiKSwgdGhpc1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB2YXIgcSA9IFwiY2xpY2ssZGJjbGljayxtb3VzZWRvd24sbW91c2V1cCxtb3VzZW92ZXIsbW91c2VvdXQsbW91c2Vtb3ZlLG1vdXNlZHJhZyxtb3VzZXdoZWVsLHRvdWNoc3RhcnQsdG91Y2htb3ZlLHRvdWNoZW5kLGtleWRvd24sa2V5dXBcIi5zcGxpdChcIixcIiksIHIgPSB0aGlzO1xyXG4gICAgICAgICAgICBxLmZvckVhY2goZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHJbYV0gPSBmdW5jdGlvbiAoYikge1xyXG4gICAgICAgICAgICAgICAgICAgIG51bGwgIT0gYiA/IHRoaXMuYWRkRXZlbnRMaXN0ZW5lcihhLCBiKSA6IHRoaXMuZGlzcGF0Y2hFdmVudChhKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KSwgdGhpcy5zYXZlSW1hZ2VJbmZvID0gZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5lYWdsZUV5ZS5nZXRJbWFnZShhLCBiKSwgZCA9IHdpbmRvdy5vcGVuKFwiYWJvdXQ6YmxhbmtcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5kb2N1bWVudC53cml0ZShcIjxpbWcgc3JjPSdcIiArIGMgKyBcIicgYWx0PSdmcm9tIGNhbnZhcycvPlwiKSwgdGhpc1xyXG4gICAgICAgICAgICB9LCB0aGlzLnNhdmVBc0xvY2FsSW1hZ2UgPSBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmVhZ2xlRXllLmdldEltYWdlKGEsIGIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGMucmVwbGFjZShcImltYWdlL3BuZ1wiLCBcImltYWdlL29jdGV0LXN0cmVhbVwiKSwgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBjLCB0aGlzXHJcbiAgICAgICAgICAgIH0sIHRoaXMucGFpbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBudWxsICE9IHRoaXMuY2FudmFzICYmICh0aGlzLmdyYXBoaWNzLnNhdmUoKSwgdGhpcy5ncmFwaGljcy5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpLCB0aGlzLmNoaWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgMSA9PSBhLnZpc2libGUgJiYgYS5yZXBhaW50KG4uZ3JhcGhpY3MpXHJcbiAgICAgICAgICAgICAgICB9KSwgMSA9PSB0aGlzLmVhZ2xlRXllLnZpc2libGUgJiYgdGhpcy5lYWdsZUV5ZS5wYWludCh0aGlzKSwgdGhpcy5ncmFwaGljcy5yZXN0b3JlKCkpXHJcbiAgICAgICAgICAgIH0sIHRoaXMucmVwYWludCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIDAgIT0gdGhpcy5mcmFtZXMgJiYgKHRoaXMuZnJhbWVzIDwgMCAmJiAwID09IHRoaXMubmVlZFJlcGFpbnQgfHwgKHRoaXMucGFpbnQoKSwgdGhpcy5mcmFtZXMgPCAwICYmICh0aGlzLm5lZWRSZXBhaW50ID0gITEpKSlcclxuICAgICAgICAgICAgfSwgdGhpcy56b29tID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRzLmZvckVhY2goZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAwICE9IGIudmlzaWJsZSAmJiBiLnpvb20oYSlcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0sIHRoaXMuem9vbU91dCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgMCAhPSBiLnZpc2libGUgJiYgYi56b29tT3V0KGEpXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9LCB0aGlzLnpvb21JbiA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgMCAhPSBiLnZpc2libGUgJiYgYi56b29tSW4oYSlcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0sIHRoaXMuY2VudGVyQW5kWm9vbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRzLmZvckVhY2goZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAwICE9IGEudmlzaWJsZSAmJiBhLmNlbnRlckFuZFpvb20oKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSwgdGhpcy5zZXRDZW50ZXIgPSBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHMuZm9yRWFjaChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlID0gYSAtIGMuY2FudmFzLndpZHRoIC8gMiwgZiA9IGIgLSBjLmNhbnZhcy5oZWlnaHQgLyAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGQudHJhbnNsYXRlWCA9IC1lLCBkLnRyYW5zbGF0ZVkgPSAtZlxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSwgdGhpcy5nZXRCb3VuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhID0ge2xlZnQ6IE51bWJlci5NQVhfVkFMVUUsIHJpZ2h0OiBOdW1iZXIuTUlOX1ZBTFVFLCB0b3A6IE51bWJlci5NQVhfVkFMVUUsIGJvdHRvbTogTnVtYmVyLk1JTl9WQUxVRX07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHMuZm9yRWFjaChmdW5jdGlvbiAoYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gYi5nZXRFbGVtZW50c0JvdW5kKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYy5sZWZ0IDwgYS5sZWZ0ICYmIChhLmxlZnQgPSBjLmxlZnQsIGEubGVmdE5vZGUgPSBjLmxlZnROb2RlKSwgYy50b3AgPCBhLnRvcCAmJiAoYS50b3AgPSBjLnRvcCwgYS50b3BOb2RlID0gYy50b3BOb2RlKSwgYy5yaWdodCA+IGEucmlnaHQgJiYgKGEucmlnaHQgPSBjLnJpZ2h0LCBhLnJpZ2h0Tm9kZSA9IGMucmlnaHROb2RlKSwgYy5ib3R0b20gPiBhLmJvdHRvbSAmJiAoYS5ib3R0b20gPSBjLmJvdHRvbSwgYS5ib3R0b21Ob2RlID0gYy5ib3R0b21Ob2RlKVxyXG4gICAgICAgICAgICAgICAgfSksIGEud2lkdGggPSBhLnJpZ2h0IC0gYS5sZWZ0LCBhLmhlaWdodCA9IGEuYm90dG9tIC0gYS50b3AsIGFcclxuICAgICAgICAgICAgfSwgdGhpcy50b0pzb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLCBjID0gJ3tcInZlcnNpb25cIjpcIicgKyBqdG9wby52ZXJzaW9uICsgJ1wiLCc7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJpYWxpemVkUHJvcGVydGllcy5sZW5ndGhcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZWRQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGJbYV07XHJcbiAgICAgICAgICAgICAgICAgICAgXCJzdHJpbmdcIiA9PSB0eXBlb2YgZCAmJiAoZCA9ICdcIicgKyBkICsgJ1wiJyksIGMgKz0gJ1wiJyArIGEgKyAnXCI6JyArIGQgKyBcIixcIlxyXG4gICAgICAgICAgICAgICAgfSksIGMgKz0gJ1wiY2hpbGRzXCI6WycsIHRoaXMuY2hpbGRzLmZvckVhY2goZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjICs9IGEudG9Kc29uKClcclxuICAgICAgICAgICAgICAgIH0pLCBjICs9IFwiXVwiLCBjICs9IFwifVwiXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIDAgPT0gbi5mcmFtZXMgPyBzZXRUaW1lb3V0KGFyZ3VtZW50cy5jYWxsZWUsIDEwMCkgOiBuLmZyYW1lcyA8IDAgPyAobi5yZXBhaW50KCksIHNldFRpbWVvdXQoYXJndW1lbnRzLmNhbGxlZSwgMWUzIC8gLW4uZnJhbWVzKSkgOiAobi5yZXBhaW50KCksIHNldFRpbWVvdXQoYXJndW1lbnRzLmNhbGxlZSwgMWUzIC8gbi5mcmFtZXMpKVxyXG4gICAgICAgICAgICB9KCksIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgbi5tb3VzZXdoZWVsKGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBudWxsID09IGEud2hlZWxEZWx0YSA/IGEuZGV0YWlsIDogYS53aGVlbERlbHRhO1xyXG4gICAgICAgICAgICAgICAgICAgIG51bGwgIT0gc2VsZi53aGVlbFpvb20gJiYgKGIgPiAwID8gc2VsZi56b29tSW4oc2VsZi53aGVlbFpvb20pIDogc2VsZi56b29tT3V0KHNlbGYud2hlZWxab29tKSlcclxuICAgICAgICAgICAgICAgIH0pLCBuLnBhaW50KClcclxuICAgICAgICAgICAgfSwgMzAwKSwgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBuLnBhaW50KClcclxuICAgICAgICAgICAgfSwgMWUzKSwgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBuLnBhaW50KClcclxuICAgICAgICAgICAgfSwgM2UzKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhZ2UucHJvdG90eXBlID0ge1xyXG4gICAgICAgICAgICBnZXQgd2lkdGgoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jYW52YXMud2lkdGhcclxuICAgICAgICAgICAgfSwgZ2V0IGhlaWdodCgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNhbnZhcy5oZWlnaHRcclxuICAgICAgICAgICAgfSwgc2V0IGN1cnNvcihhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5zdHlsZS5jdXJzb3IgPSBhXHJcbiAgICAgICAgICAgIH0sIGdldCBjdXJzb3IoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jYW52YXMuc3R5bGUuY3Vyc29yXHJcbiAgICAgICAgICAgIH0sIHNldCBtb2RlKGEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRzLmZvckVhY2goZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgICAgICBiLm1vZGUgPSBhXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwganRvcG8uU3RhZ2UgPSBzdGFnZVxyXG4gICAgfShKVG9wbyksXHJcbiAgICBmdW5jdGlvbiAoanRvcG8pIHtcclxuICAgICAgICBmdW5jdGlvbiBzY2VuZShjKSB7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGQoYSwgYiwgYywgZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5iZWdpblBhdGgoKSwgZS5zdHJva2VTdHlsZSA9IFwicmdiYSgwLDAsMjM2LDAuNSlcIiwgZS5maWxsU3R5bGUgPSBcInJnYmEoMCwwLDIzNiwwLjEpXCIsIGUucmVjdChhLCBiLCBjLCBkKSwgZS5maWxsKCksIGUuc3Ryb2tlKCksIGUuY2xvc2VQYXRoKClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHNjZW5lX3NlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBzY2VuZS5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlQnVzID0gbmV3IGp0b3BvLnV0aWwuTWVzc2FnZUJ1cztcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFR5cGUgPSBcInNjZW5lXCI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy56SW5kZXhNYXAgPSB7fTtcclxuICAgICAgICAgICAgICAgIHRoaXMuekluZGV4QXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gXCIyNTUsMjU1LDI1NVwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gITA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFscGhhID0gMDtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVZID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZSA9IGp0b3BvLlNjZW5lTW9kZS5ub3JtYWw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zbGF0ZSA9ICEwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc2xhdGVYID0gMDtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJhbnNsYXRlWSA9IDA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RUcmFuc2xhdGVYID0gMDtcclxuICAgICAgICAgICAgICAgIHRoaXMubGFzdFRyYW5zbGF0ZVkgPSAwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3VzZURvd24gPSAhMTtcclxuICAgICAgICAgICAgICAgIHRoaXMubW91c2VEb3duWCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vdXNlRG93blkgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3VzZURvd25FdmVudCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFyZWFTZWxlY3QgPSAhMDtcclxuICAgICAgICAgICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEVsZW1lbnRzID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhaW50QWxsID0gITE7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IFwiYmFja2dyb3VuZCxiYWNrZ3JvdW5kQ29sb3IsbW9kZSxwYWludEFsbCxhcmVhU2VsZWN0LHRyYW5zbGF0ZSx0cmFuc2xhdGVYLHRyYW5zbGF0ZVksbGFzdFRyYW5zbGF0ZWRYLGxhc3RUcmFuc2xhdGVkWSxhbHBoYSx2aXNpYmxlLHNjYWxlWCxzY2FsZVlcIi5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcmlhbGl6ZWRQcm9wZXJ0aWVzID0gdGhpcy5zZXJpYWxpemVkUHJvcGVydGllcy5jb25jYXQoYyk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldEJhY2tncm91bmQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kID0gYVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmFkZFRvID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2UgIT09IGEgJiYgbnVsbCAhPSBhICYmICh0aGlzLnN0YWdlID0gYSlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgbnVsbCAhPSBjICYmIChjLmFkZCh0aGlzKSwgdGhpcy5hZGRUbyhjKSksIHRoaXMuc2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9ICEwXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuaGlkZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9ICExXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKDAgIT0gdGhpcy52aXNpYmxlICYmIG51bGwgIT0gdGhpcy5zdGFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhLnNhdmUoKSwgdGhpcy5wYWludEJhY2tncm91ZChhKSwgYS5yZXN0b3JlKCksIGEuc2F2ZSgpLCBhLnNjYWxlKHRoaXMuc2NhbGVYLCB0aGlzLnNjYWxlWSksIDEgPT0gdGhpcy50cmFuc2xhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLmdldE9mZnNldFRyYW5zbGF0ZShhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYS50cmFuc2xhdGUoYi50cmFuc2xhdGVYLCBiLnRyYW5zbGF0ZVkpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFpbnRDaGlsZHMoYSksIGEucmVzdG9yZSgpLCBhLnNhdmUoKSwgdGhpcy5wYWludE9wZXJhdGlvbnMoYSwgdGhpcy5vcGVyYXRpb25zKSwgYS5yZXN0b3JlKClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5yZXBhaW50ID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIDAgIT0gdGhpcy52aXNpYmxlICYmIHRoaXMucGFpbnQoYSlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5wYWludEJhY2tncm91ZCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBudWxsICE9IHRoaXMuYmFja2dyb3VuZCA/IGEuZHJhd0ltYWdlKHRoaXMuYmFja2dyb3VuZCwgMCwgMCwgYS5jYW52YXMud2lkdGgsIGEuY2FudmFzLmhlaWdodCkgOiAoYS5iZWdpblBhdGgoKSwgYS5maWxsU3R5bGUgPSBcInJnYmEoXCIgKyB0aGlzLmJhY2tncm91bmRDb2xvciArIFwiLFwiICsgdGhpcy5hbHBoYSArIFwiKVwiLCBhLmZpbGxSZWN0KDAsIDAsIGEuY2FudmFzLndpZHRoLCBhLmNhbnZhcy5oZWlnaHQpLCBhLmNsb3NlUGF0aCgpKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmdldERpc3BsYXllZEVsZW1lbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9IFtdLCBiID0gMDsgYiA8IHRoaXMuekluZGV4QXJyYXkubGVuZ3RoOyBiKyspZm9yICh2YXIgYyA9IHRoaXMuekluZGV4QXJyYXlbYl0sIGQgPSB0aGlzLnpJbmRleE1hcFtjXSwgZSA9IDA7IGUgPCBkLmxlbmd0aDsgZSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBkW2VdO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNWaXNpYWJsZShmKSAmJiBhLnB1c2goZilcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBhXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0RGlzcGxheWVkTm9kZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gW10sIGMgPSAwOyBjIDwgdGhpcy5jaGlsZHMubGVuZ3RoOyBjKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuY2hpbGRzW2NdO1xyXG4gICAgICAgICAgICAgICAgICAgIGQgaW5zdGFuY2VvZiBqdG9wby5Ob2RlICYmIHRoaXMuaXNWaXNpYWJsZShkKSAmJiBiLnB1c2goZClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBiXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnRDaGlsZHMgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnpJbmRleEFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHpJbmRleCA9IHRoaXMuekluZGV4QXJyYXlbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHpJbmRleEVsZW1lbnRzID0gdGhpcy56SW5kZXhNYXBbekluZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHpJbmRleEVsZW1lbnRzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gekluZGV4RWxlbWVudHNbal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09IHRoaXMucGFpbnRBbGwgfHwgdGhpcy5pc1Zpc2lhYmxlKGVsZW1lbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09IGVsZW1lbnQudHJhbnNmb3JtQWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBlbGVtZW50LmdldENlbnRlckxvY2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC50cmFuc2xhdGUoY2VudGVyLngsIGNlbnRlci55KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5yb3RhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5yb3RhdGUoZWxlbWVudC5yb3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5zY2FsZVggJiYgZWxlbWVudC5zY2FsZVkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5zY2FsZShlbGVtZW50LnNjYWxlWCwgZWxlbWVudC5zY2FsZVkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LnNjYWxlWCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNjYWxlKGVsZW1lbnQuc2NhbGVYLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuc2NhbGVZKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2NhbGUoMSwgZWxlbWVudC5zY2FsZVkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09IGVsZW1lbnQuc2hhZG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5zaGFkb3dCbHVyID0gZWxlbWVudC5zaGFkb3dCbHVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2hhZG93Q29sb3IgPSBlbGVtZW50LnNoYWRvd0NvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2hhZG93T2Zmc2V0WCA9IGVsZW1lbnQuc2hhZG93T2Zmc2V0WDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNoYWRvd09mZnNldFkgPSBlbGVtZW50LnNoYWRvd09mZnNldFk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIGp0b3BvLkludGVyYWN0aXZlRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnNlbGVjdGVkICYmIDEgPT0gZWxlbWVudC5zaG93U2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5wYWludFNlbGVjdGVkKGNvbnRleHQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgxID09IGVsZW1lbnQuaXNNb3VzZU92ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5wYWludE1vdXNlb3Zlcihjb250ZXh0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucGFpbnQoY29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnJlc3RvcmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRPZmZzZXRUcmFuc2xhdGUgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnN0YWdlLmNhbnZhcy53aWR0aCwgYyA9IHRoaXMuc3RhZ2UuY2FudmFzLmhlaWdodDtcclxuICAgICAgICAgICAgICAgIG51bGwgIT0gYSAmJiBcIm1vdmVcIiAhPSBhICYmIChiID0gYS5jYW52YXMud2lkdGgsIGMgPSBhLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGQgPSBiIC8gdGhpcy5zY2FsZVggLyAyLCBlID0gYyAvIHRoaXMuc2NhbGVZIC8gMiwgZiA9IHt0cmFuc2xhdGVYOiB0aGlzLnRyYW5zbGF0ZVggKyAoZCAtIGQgKiB0aGlzLnNjYWxlWCksIHRyYW5zbGF0ZVk6IHRoaXMudHJhbnNsYXRlWSArIChlIC0gZSAqIHRoaXMuc2NhbGVZKX07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZlxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmlzVmlzaWFibGUgPSBmdW5jdGlvbiAoYikge1xyXG4gICAgICAgICAgICAgICAgaWYgKDEgIT0gYi52aXNpYmxlKXJldHVybiAhMTtcclxuICAgICAgICAgICAgICAgIGlmIChiIGluc3RhbmNlb2YganRvcG8uTGluaylyZXR1cm4gITA7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuZ2V0T2Zmc2V0VHJhbnNsYXRlKCksIGQgPSBiLnggKyBjLnRyYW5zbGF0ZVgsIGUgPSBiLnkgKyBjLnRyYW5zbGF0ZVk7XHJcbiAgICAgICAgICAgICAgICBkICo9IHRoaXMuc2NhbGVYLCBlICo9IHRoaXMuc2NhbGVZO1xyXG4gICAgICAgICAgICAgICAgdmFyIGYgPSBkICsgYi53aWR0aCAqIHRoaXMuc2NhbGVYLCBnID0gZSArIGIuaGVpZ2h0ICogdGhpcy5zY2FsZVk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZCA+IHRoaXMuc3RhZ2UuY2FudmFzLndpZHRoIHx8IGUgPiB0aGlzLnN0YWdlLmNhbnZhcy5oZWlnaHQgfHwgMCA+IGYgfHwgMCA+IGcgPyAhMSA6ICEwXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnRPcGVyYXRpb25zID0gZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgYi5sZW5ndGg7IGMrKyliW2NdKGEpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZmluZEVsZW1lbnRzID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSBbXSwgYyA9IDA7IGMgPCB0aGlzLmNoaWxkcy5sZW5ndGg7IGMrKykxID09IGEodGhpcy5jaGlsZHNbY10pICYmIGIucHVzaCh0aGlzLmNoaWxkc1tjXSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYlxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmdldEVsZW1lbnRzQnlDbGFzcyA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maW5kRWxlbWVudHMoZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiBpbnN0YW5jZW9mIGFcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuYWRkT3BlcmF0aW9uID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wZXJhdGlvbnMucHVzaChhKSwgdGhpc1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyT3BlcmF0aW9ucyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wZXJhdGlvbnMgPSBbXSwgdGhpc1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmdldEVsZW1lbnRCeVhZID0gZnVuY3Rpb24gKGIsIGMpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGQgPSBudWxsLCBlID0gdGhpcy56SW5kZXhBcnJheS5sZW5ndGggLSAxOyBlID49IDA7IGUtLSlmb3IgKHZhciBmID0gdGhpcy56SW5kZXhBcnJheVtlXSwgZyA9IHRoaXMuekluZGV4TWFwW2ZdLCBoID0gZy5sZW5ndGggLSAxOyBoID49IDA7IGgtLSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gZ1toXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSBpbnN0YW5jZW9mIGp0b3BvLkludGVyYWN0aXZlRWxlbWVudCAmJiB0aGlzLmlzVmlzaWFibGUoaSkgJiYgaS5pc0luQm91bmQoYiwgYykpcmV0dXJuIGQgPSBpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmFkZCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcy5wdXNoKGEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gdGhpcy56SW5kZXhNYXBbYS56SW5kZXhdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy56SW5kZXhNYXBbYS56SW5kZXhdID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy56SW5kZXhBcnJheS5wdXNoKGEuekluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnpJbmRleEFycmF5LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgLSBiXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnpJbmRleE1hcFtcIlwiICsgYS56SW5kZXhdLnB1c2goYSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRzID0ganRvcG8udXRpbC5yZW1vdmVGcm9tQXJyYXkodGhpcy5jaGlsZHMsIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gdGhpcy56SW5kZXhNYXBbaXRlbS56SW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy56SW5kZXhNYXBbaXRlbS56SW5kZXhdID0ganRvcG8udXRpbC5yZW1vdmVGcm9tQXJyYXkoZWxlbWVudHMsIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaXRlbS5yZW1vdmVIYW5kbGVyKHRoaXMpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHMuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZC5yZW1vdmVIYW5kbGVyKHNlbGYpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVyYXRpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLnpJbmRleEFycmF5ID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLnpJbmRleE1hcCA9IHt9O1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmFkZFRvU2VsZWN0ZWQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEVsZW1lbnRzLnB1c2goYSlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5jYW5jbGVBbGxTZWxlY3RlZCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5sZW5ndGg7IGIrKyl0aGlzLnNlbGVjdGVkRWxlbWVudHNbYl0udW5zZWxlY3RlZEhhbmRsZXIoYSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRWxlbWVudHMgPSBbXVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLm5vdEluU2VsZWN0ZWROb2RlcyA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5sZW5ndGg7IGIrKylpZiAoYSA9PT0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzW2JdKXJldHVybiAhMTtcclxuICAgICAgICAgICAgICAgIHJldHVybiAhMFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUZyb21TZWxlY3RlZCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5sZW5ndGg7IGIrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzW2JdO1xyXG4gICAgICAgICAgICAgICAgICAgIGEgPT09IGMgJiYgKHRoaXMuc2VsZWN0ZWRFbGVtZW50cyA9IHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5kZWwoYikpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMudG9TY2VuZUV2ZW50ID0gZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjID0ganRvcG8udXRpbC5jbG9uZShiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjLnggLz0gdGhpcy5zY2FsZVgsIGMueSAvPSB0aGlzLnNjYWxlWSwgMSA9PSB0aGlzLnRyYW5zbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5nZXRPZmZzZXRUcmFuc2xhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBjLnggLT0gZC50cmFuc2xhdGVYLCBjLnkgLT0gZC50cmFuc2xhdGVZXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSBjLmR4ICYmIChjLmR4IC89IHRoaXMuc2NhbGVYLCBjLmR5IC89IHRoaXMuc2NhbGVZKSwgbnVsbCAhPSB0aGlzLmN1cnJlbnRFbGVtZW50ICYmIChjLnRhcmdldCA9IHRoaXMuY3VycmVudEVsZW1lbnQpLCBjLnNjZW5lID0gdGhpcywgY1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdEVsZW1lbnQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBzY2VuZV9zZWxmLmdldEVsZW1lbnRCeVhZKGEueCwgYS55KTtcclxuICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGIpaWYgKGEudGFyZ2V0ID0gYiwgYi5tb3VzZWRvd25IYW5kZXIoYSksIGIuc2VsZWN0ZWRIYW5kbGVyKGEpLCBzY2VuZV9zZWxmLm5vdEluU2VsZWN0ZWROb2RlcyhiKSlhLmN0cmxLZXkgfHwgc2NlbmVfc2VsZi5jYW5jbGVBbGxTZWxlY3RlZCgpLCBzY2VuZV9zZWxmLmFkZFRvU2VsZWN0ZWQoYik7IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIDEgPT0gYS5jdHJsS2V5ICYmIChiLnVuc2VsZWN0ZWRIYW5kbGVyKCksIHRoaXMucmVtb3ZlRnJvbVNlbGVjdGVkKGIpKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5sZW5ndGg7IGMrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuc2VsZWN0ZWRFbGVtZW50c1tjXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZC5zZWxlY3RlZEhhbmRsZXIoYSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgYS5jdHJsS2V5IHx8IHNjZW5lX3NlbGYuY2FuY2xlQWxsU2VsZWN0ZWQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVsZW1lbnQgPSBiXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMubW91c2Vkb3duSGFuZGxlciA9IGZ1bmN0aW9uIChiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMudG9TY2VuZUV2ZW50KGIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW91c2VEb3duID0gITAsIHRoaXMubW91c2VEb3duWCA9IGMueCwgdGhpcy5tb3VzZURvd25ZID0gYy55LCB0aGlzLm1vdXNlRG93bkV2ZW50ID0gYywgdGhpcy5tb2RlID09IGp0b3BvLlNjZW5lTW9kZS5ub3JtYWwpdGhpcy5zZWxlY3RFbGVtZW50KGMpLCAobnVsbCA9PSB0aGlzLmN1cnJlbnRFbGVtZW50IHx8IHRoaXMuY3VycmVudEVsZW1lbnQgaW5zdGFuY2VvZiBqdG9wby5MaW5rKSAmJiAxID09IHRoaXMudHJhbnNsYXRlICYmICh0aGlzLmxhc3RUcmFuc2xhdGVYID0gdGhpcy50cmFuc2xhdGVYLCB0aGlzLmxhc3RUcmFuc2xhdGVZID0gdGhpcy50cmFuc2xhdGVZKTsgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZSA9PSBqdG9wby5TY2VuZU1vZGUuZHJhZyAmJiAxID09IHRoaXMudHJhbnNsYXRlKXJldHVybiB0aGlzLmxhc3RUcmFuc2xhdGVYID0gdGhpcy50cmFuc2xhdGVYLCB2b2lkKHRoaXMubGFzdFRyYW5zbGF0ZVkgPSB0aGlzLnRyYW5zbGF0ZVkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZSA9PSBqdG9wby5TY2VuZU1vZGUuc2VsZWN0ID8gdGhpcy5zZWxlY3RFbGVtZW50KGMpIDogdGhpcy5tb2RlID09IGp0b3BvLlNjZW5lTW9kZS5lZGl0ICYmICh0aGlzLnNlbGVjdEVsZW1lbnQoYyksIChudWxsID09IHRoaXMuY3VycmVudEVsZW1lbnQgfHwgdGhpcy5jdXJyZW50RWxlbWVudCBpbnN0YW5jZW9mIGp0b3BvLkxpbmspICYmIDEgPT0gdGhpcy50cmFuc2xhdGUgJiYgKHRoaXMubGFzdFRyYW5zbGF0ZVggPSB0aGlzLnRyYW5zbGF0ZVgsIHRoaXMubGFzdFRyYW5zbGF0ZVkgPSB0aGlzLnRyYW5zbGF0ZVkpKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2NlbmVfc2VsZi5kaXNwYXRjaEV2ZW50KFwibW91c2Vkb3duXCIsIGMpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMubW91c2V1cEhhbmRsZXIgPSBmdW5jdGlvbiAoYikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZS5jdXJzb3IgIT0ganRvcG8uTW91c2VDdXJzb3Iubm9ybWFsICYmICh0aGlzLnN0YWdlLmN1cnNvciA9IGp0b3BvLk1vdXNlQ3Vyc29yLm5vcm1hbCksIHNjZW5lX3NlbGYuY2xlYXJPcGVyYXRpb25zKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMudG9TY2VuZUV2ZW50KGIpO1xyXG4gICAgICAgICAgICAgICAgbnVsbCAhPSB0aGlzLmN1cnJlbnRFbGVtZW50ICYmIChjLnRhcmdldCA9IHNjZW5lX3NlbGYuY3VycmVudEVsZW1lbnQsIHRoaXMuY3VycmVudEVsZW1lbnQubW91c2V1cEhhbmRsZXIoYykpLCB0aGlzLmRpc3BhdGNoRXZlbnQoXCJtb3VzZXVwXCIsIGMpLCB0aGlzLm1vdXNlRG93biA9ICExXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZHJhZ0VsZW1lbnRzID0gZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChudWxsICE9IHRoaXMuY3VycmVudEVsZW1lbnQgJiYgMSA9PSB0aGlzLmN1cnJlbnRFbGVtZW50LmRyYWdhYmxlKWZvciAodmFyIGMgPSAwOyBjIDwgdGhpcy5zZWxlY3RlZEVsZW1lbnRzLmxlbmd0aDsgYysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLnNlbGVjdGVkRWxlbWVudHNbY107XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKDAgIT0gZC5kcmFnYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGp0b3BvLnV0aWwuY2xvbmUoYik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0ID0gZCwgZC5tb3VzZWRyYWdIYW5kbGVyKGUpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLm1vdXNlZHJhZ0hhbmRsZXIgPSBmdW5jdGlvbiAoYikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLnRvU2NlbmVFdmVudChiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZSA9PSBqdG9wby5TY2VuZU1vZGUubm9ybWFsID8gbnVsbCA9PSB0aGlzLmN1cnJlbnRFbGVtZW50IHx8IHRoaXMuY3VycmVudEVsZW1lbnQgaW5zdGFuY2VvZiBqdG9wby5MaW5rID8gMSA9PSB0aGlzLnRyYW5zbGF0ZSAmJiAodGhpcy5zdGFnZS5jdXJzb3IgPSBqdG9wby5Nb3VzZUN1cnNvci5jbG9zZWRfaGFuZCwgdGhpcy50cmFuc2xhdGVYID0gdGhpcy5sYXN0VHJhbnNsYXRlWCArIGMuZHgsIHRoaXMudHJhbnNsYXRlWSA9IHRoaXMubGFzdFRyYW5zbGF0ZVkgKyBjLmR5KSA6IHRoaXMuZHJhZ0VsZW1lbnRzKGMpIDogdGhpcy5tb2RlID09IGp0b3BvLlNjZW5lTW9kZS5kcmFnID8gMSA9PSB0aGlzLnRyYW5zbGF0ZSAmJiAodGhpcy5zdGFnZS5jdXJzb3IgPSBqdG9wby5Nb3VzZUN1cnNvci5jbG9zZWRfaGFuZCwgdGhpcy50cmFuc2xhdGVYID0gdGhpcy5sYXN0VHJhbnNsYXRlWCArIGMuZHgsIHRoaXMudHJhbnNsYXRlWSA9IHRoaXMubGFzdFRyYW5zbGF0ZVkgKyBjLmR5KSA6IHRoaXMubW9kZSA9PSBqdG9wby5TY2VuZU1vZGUuc2VsZWN0ID8gbnVsbCAhPSB0aGlzLmN1cnJlbnRFbGVtZW50ID8gMSA9PSB0aGlzLmN1cnJlbnRFbGVtZW50LmRyYWdhYmxlICYmIHRoaXMuZHJhZ0VsZW1lbnRzKGMpIDogMSA9PSB0aGlzLmFyZWFTZWxlY3QgJiYgdGhpcy5hcmVhU2VsZWN0SGFuZGxlKGMpIDogdGhpcy5tb2RlID09IGp0b3BvLlNjZW5lTW9kZS5lZGl0ICYmIChudWxsID09IHRoaXMuY3VycmVudEVsZW1lbnQgfHwgdGhpcy5jdXJyZW50RWxlbWVudCBpbnN0YW5jZW9mIGp0b3BvLkxpbmsgPyAxID09IHRoaXMudHJhbnNsYXRlICYmICh0aGlzLnN0YWdlLmN1cnNvciA9IGp0b3BvLk1vdXNlQ3Vyc29yLmNsb3NlZF9oYW5kLCB0aGlzLnRyYW5zbGF0ZVggPSB0aGlzLmxhc3RUcmFuc2xhdGVYICsgYy5keCwgdGhpcy50cmFuc2xhdGVZID0gdGhpcy5sYXN0VHJhbnNsYXRlWSArIGMuZHkpIDogdGhpcy5kcmFnRWxlbWVudHMoYykpLCB0aGlzLmRpc3BhdGNoRXZlbnQoXCJtb3VzZWRyYWdcIiwgYylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5hcmVhU2VsZWN0SGFuZGxlID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gYS5vZmZzZXRMZWZ0LCBjID0gYS5vZmZzZXRUb3AsIGYgPSB0aGlzLm1vdXNlRG93bkV2ZW50Lm9mZnNldExlZnQsIGcgPSB0aGlzLm1vdXNlRG93bkV2ZW50Lm9mZnNldFRvcCwgaCA9IGIgPj0gZiA/IGYgOiBiLCBpID0gYyA+PSBnID8gZyA6IGMsIGogPSBNYXRoLmFicyhhLmR4KSAqIHRoaXMuc2NhbGVYLCBrID0gTWF0aC5hYnMoYS5keSkgKiB0aGlzLnNjYWxlWSwgbCA9IG5ldyBkKGgsIGksIGosIGspO1xyXG4gICAgICAgICAgICAgICAgc2NlbmVfc2VsZi5jbGVhck9wZXJhdGlvbnMoKS5hZGRPcGVyYXRpb24obCksIGIgPSBhLngsIGMgPSBhLnksIGYgPSB0aGlzLm1vdXNlRG93bkV2ZW50LngsIGcgPSB0aGlzLm1vdXNlRG93bkV2ZW50LnksIGggPSBiID49IGYgPyBmIDogYiwgaSA9IGMgPj0gZyA/IGcgOiBjLCBqID0gTWF0aC5hYnMoYS5keCksIGsgPSBNYXRoLmFicyhhLmR5KTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIG0gPSBoICsgaiwgbiA9IGkgKyBrLCBvID0gMDsgbyA8IHNjZW5lX3NlbGYuY2hpbGRzLmxlbmd0aDsgbysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBzY2VuZV9zZWxmLmNoaWxkc1tvXTtcclxuICAgICAgICAgICAgICAgICAgICBwLnggPiBoICYmIHAueCArIHAud2lkdGggPCBtICYmIHAueSA+IGkgJiYgcC55ICsgcC5oZWlnaHQgPCBuICYmIHNjZW5lX3NlbGYubm90SW5TZWxlY3RlZE5vZGVzKHApICYmIChwLnNlbGVjdGVkSGFuZGxlcihhKSwgc2NlbmVfc2VsZi5hZGRUb1NlbGVjdGVkKHApKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLm1vdXNlbW92ZUhhbmRsZXIgPSBmdW5jdGlvbiAoYikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3VzZWNvb3JkID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IGIueCxcclxuICAgICAgICAgICAgICAgICAgICB5OiBiLnlcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMudG9TY2VuZUV2ZW50KGIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZSA9PSBqdG9wby5TY2VuZU1vZGUuZHJhZykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkKHRoaXMuc3RhZ2UuY3Vyc29yID0ganRvcG8uTW91c2VDdXJzb3Iub3Blbl9oYW5kKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGUgPT0ganRvcG8uU2NlbmVNb2RlLm5vcm1hbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2UuY3Vyc29yID0ganRvcG8uTW91c2VDdXJzb3Iubm9ybWFsO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1vZGUgPT0ganRvcG8uU2NlbmVNb2RlLnNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2UuY3Vyc29yID0ganRvcG8uTW91c2VDdXJzb3Iubm9ybWFsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBkID0gc2NlbmVfc2VsZi5nZXRFbGVtZW50QnlYWShjLngsIGMueSk7XHJcbiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjZW5lX3NlbGYubW91c2VPdmVyZWxlbWVudCAmJiBzY2VuZV9zZWxmLm1vdXNlT3ZlcmVsZW1lbnQgIT09IGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYy50YXJnZXQgPSBkLCBzY2VuZV9zZWxmLm1vdXNlT3ZlcmVsZW1lbnQubW91c2VvdXRIYW5kbGVyKGMpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHNjZW5lX3NlbGYubW91c2VPdmVyZWxlbWVudCA9IGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT0gZC5pc01vdXNlT3Zlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjLnRhcmdldCA9IGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQubW91c2VvdmVySGFuZGxlcihjKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmVfc2VsZi5kaXNwYXRjaEV2ZW50KFwibW91c2VvdmVyXCIsIGMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGMudGFyZ2V0ID0gZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZC5tb3VzZW1vdmVIYW5kbGVyKGMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2VuZV9zZWxmLmRpc3BhdGNoRXZlbnQoXCJtb3VzZW1vdmVcIiwgYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NlbmVfc2VsZi5tb3VzZU92ZXJlbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGMudGFyZ2V0ID0gZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmVfc2VsZi5tb3VzZU92ZXJlbGVtZW50Lm1vdXNlb3V0SGFuZGxlcihjKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmVfc2VsZi5tb3VzZU92ZXJlbGVtZW50ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmVfc2VsZi5kaXNwYXRjaEV2ZW50KFwibW91c2VvdXRcIiwgYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYy50YXJnZXQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2VuZV9zZWxmLmRpc3BhdGNoRXZlbnQoXCJtb3VzZW1vdmVcIiwgYylcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMubW91c2VvdmVySGFuZGxlciA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMudG9TY2VuZUV2ZW50KGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwibW91c2VvdmVyXCIsIGIpXHJcbiAgICAgICAgICAgIH0sIHRoaXMubW91c2VvdXRIYW5kbGVyID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy50b1NjZW5lRXZlbnQoYSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoXCJtb3VzZW91dFwiLCBiKVxyXG4gICAgICAgICAgICB9LCB0aGlzLmNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMudG9TY2VuZUV2ZW50KGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RWxlbWVudCAmJiAoYi50YXJnZXQgPSB0aGlzLmN1cnJlbnRFbGVtZW50LCB0aGlzLmN1cnJlbnRFbGVtZW50LmNsaWNrSGFuZGxlcihiKSksIHRoaXMuZGlzcGF0Y2hFdmVudChcImNsaWNrXCIsIGIpXHJcbiAgICAgICAgICAgIH0sIHRoaXMuZGJjbGlja0hhbmRsZXIgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnRvU2NlbmVFdmVudChhKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVsZW1lbnQgPyAoYi50YXJnZXQgPSB0aGlzLmN1cnJlbnRFbGVtZW50LCB0aGlzLmN1cnJlbnRFbGVtZW50LmRiY2xpY2tIYW5kbGVyKGIpKSA6IHNjZW5lX3NlbGYuY2FuY2xlQWxsU2VsZWN0ZWQoKSwgdGhpcy5kaXNwYXRjaEV2ZW50KFwiZGJjbGlja1wiLCBiKVxyXG4gICAgICAgICAgICB9LCB0aGlzLm1vdXNld2hlZWxIYW5kbGVyID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy50b1NjZW5lRXZlbnQoYSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoXCJtb3VzZXdoZWVsXCIsIGIpXHJcbiAgICAgICAgICAgIH0sIHRoaXMudG91Y2hzdGFydCA9IHRoaXMubW91c2Vkb3duSGFuZGVyLCB0aGlzLnRvdWNobW92ZSA9IHRoaXMubW91c2VkcmFnSGFuZGxlciwgdGhpcy50b3VjaGVuZCA9IHRoaXMubW91c2Vkb3duSGFuZGVyLCB0aGlzLmtleWRvd25IYW5kbGVyID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChcImtleWRvd25cIiwgYSlcclxuICAgICAgICAgICAgfSwgdGhpcy5rZXl1cEhhbmRsZXIgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwia2V5dXBcIiwgYSlcclxuICAgICAgICAgICAgfSwgdGhpcy5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZm4pIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICAgICAgICAgIHZhciBiID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBmbi5jYWxsKHNlbGYsIGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZUJ1cy5zdWJzY3JpYmUoZXZlbnROYW1lLCBmbik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfSwgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKGEsIGYpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZUJ1cy51bnN1YnNjcmliZShhLCBmKVxyXG4gICAgICAgICAgICB9LCB0aGlzLnJlbW92ZUFsbEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VCdXMgPSBuZXcganRvcG8udXRpbC5NZXNzYWdlQnVzXHJcbiAgICAgICAgICAgIH0sIHRoaXMuZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlQnVzLnB1Ymxpc2goYSwgYiksIHRoaXNcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdmFyIGYgPSBcImNsaWNrLGRiY2xpY2ssbW91c2Vkb3duLG1vdXNldXAsbW91c2VvdmVyLG1vdXNlb3V0LG1vdXNlbW92ZSxtb3VzZWRyYWcsbW91c2V3aGVlbCx0b3VjaHN0YXJ0LHRvdWNobW92ZSx0b3VjaGVuZCxrZXlkb3duLGtleXVwXCIuc3BsaXQoXCIsXCIpLCBnID0gdGhpcztcclxuICAgICAgICAgICAgcmV0dXJuIGYuZm9yRWFjaChmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgZ1thXSA9IGZ1bmN0aW9uIChiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBiID8gdGhpcy5hZGRFdmVudExpc3RlbmVyKGEsIGIpIDogdGhpcy5kaXNwYXRjaEV2ZW50KGEpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLCB0aGlzLnpvb20gPSBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgbnVsbCAhPSBhICYmIDAgIT0gYSAmJiAodGhpcy5zY2FsZVggPSBhKSwgbnVsbCAhPSBiICYmIDAgIT0gYiAmJiAodGhpcy5zY2FsZVkgPSBiKVxyXG4gICAgICAgICAgICB9LCB0aGlzLnpvb21PdXQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgMCAhPSBhICYmIChudWxsID09IGEgJiYgKGEgPSAuOCksIHRoaXMuc2NhbGVYIC89IGEsIHRoaXMuc2NhbGVZIC89IGEpXHJcbiAgICAgICAgICAgIH0sIHRoaXMuem9vbUluID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIDAgIT0gYSAmJiAobnVsbCA9PSBhICYmIChhID0gLjgpLCB0aGlzLnNjYWxlWCAqPSBhLCB0aGlzLnNjYWxlWSAqPSBhKVxyXG4gICAgICAgICAgICB9LCB0aGlzLmdldEJvdW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtsZWZ0OiAwLCB0b3A6IDAsIHJpZ2h0OiB0aGlzLnN0YWdlLmNhbnZhcy53aWR0aCwgYm90dG9tOiB0aGlzLnN0YWdlLmNhbnZhcy5oZWlnaHQsIHdpZHRoOiB0aGlzLnN0YWdlLmNhbnZhcy53aWR0aCwgaGVpZ2h0OiB0aGlzLnN0YWdlLmNhbnZhcy5oZWlnaHR9XHJcbiAgICAgICAgICAgIH0sIHRoaXMuZ2V0RWxlbWVudHNCb3VuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBqdG9wby51dGlsLmdldEVsZW1lbnRzQm91bmQodGhpcy5jaGlsZHMpXHJcbiAgICAgICAgICAgIH0sIHRoaXMudHJhbnNsYXRlVG9DZW50ZXIgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLmdldEVsZW1lbnRzQm91bmQoKSwgYyA9IHRoaXMuc3RhZ2UuY2FudmFzLndpZHRoIC8gMiAtIChiLmxlZnQgKyBiLnJpZ2h0KSAvIDIsIGQgPSB0aGlzLnN0YWdlLmNhbnZhcy5oZWlnaHQgLyAyIC0gKGIudG9wICsgYi5ib3R0b20pIC8gMjtcclxuICAgICAgICAgICAgICAgIGEgJiYgKGMgPSBhLmNhbnZhcy53aWR0aCAvIDIgLSAoYi5sZWZ0ICsgYi5yaWdodCkgLyAyLCBkID0gYS5jYW52YXMuaGVpZ2h0IC8gMiAtIChiLnRvcCArIGIuYm90dG9tKSAvIDIpLCB0aGlzLnRyYW5zbGF0ZVggPSBjLCB0aGlzLnRyYW5zbGF0ZVkgPSBkXHJcbiAgICAgICAgICAgIH0sIHRoaXMuc2V0Q2VudGVyID0gZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjID0gYSAtIHRoaXMuc3RhZ2UuY2FudmFzLndpZHRoIC8gMiwgZCA9IGIgLSB0aGlzLnN0YWdlLmNhbnZhcy5oZWlnaHQgLyAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc2xhdGVYID0gLWMsIHRoaXMudHJhbnNsYXRlWSA9IC1kXHJcbiAgICAgICAgICAgIH0sIHRoaXMuY2VudGVyQW5kWm9vbSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFuc2xhdGVUb0NlbnRlcihjKSwgbnVsbCA9PSBhIHx8IG51bGwgPT0gYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5nZXRFbGVtZW50c0JvdW5kKCksIGUgPSBkLnJpZ2h0IC0gZC5sZWZ0LCBmID0gZC5ib3R0b20gLSBkLnRvcCwgZyA9IHRoaXMuc3RhZ2UuY2FudmFzLndpZHRoIC8gZSwgaCA9IHRoaXMuc3RhZ2UuY2FudmFzLmhlaWdodCAvIGY7XHJcbiAgICAgICAgICAgICAgICAgICAgYyAmJiAoZyA9IGMuY2FudmFzLndpZHRoIC8gZSwgaCA9IGMuY2FudmFzLmhlaWdodCAvIGYpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gTWF0aC5taW4oZywgaCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAxKXJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnpvb20oaSwgaSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuem9vbShhLCBiKVxyXG4gICAgICAgICAgICB9LCB0aGlzLmdldENlbnRlckxvY2F0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHt4OiBzY2VuZV9zZWxmLnN0YWdlLmNhbnZhcy53aWR0aCAvIDIsIHk6IHNjZW5lX3NlbGYuc3RhZ2UuY2FudmFzLmhlaWdodCAvIDJ9XHJcbiAgICAgICAgICAgIH0sIHRoaXMuZG9MYXlvdXQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgYSAmJiBhKHRoaXMsIHRoaXMuY2hpbGRzKVxyXG4gICAgICAgICAgICB9LCB0aGlzLnRvSnNvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMsIGIgPSBcIntcIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcmlhbGl6ZWRQcm9wZXJ0aWVzLmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXJpYWxpemVkUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBhW2NdO1xyXG4gICAgICAgICAgICAgICAgICAgIFwiYmFja2dyb3VuZFwiID09IGMgJiYgKGQgPSBhLl9iYWNrZ3JvdW5kLnNyYyksIFwic3RyaW5nXCIgPT0gdHlwZW9mIGQgJiYgKGQgPSAnXCInICsgZCArICdcIicpLCBiICs9ICdcIicgKyBjICsgJ1wiOicgKyBkICsgXCIsXCJcclxuICAgICAgICAgICAgICAgIH0pLCBiICs9ICdcImNoaWxkc1wiOlsnO1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmNoaWxkcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHMuZm9yRWFjaChmdW5jdGlvbiAoYSwgZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGIgKz0gYS50b0pzb24oKSwgYyA+IGQgKyAxICYmIChiICs9IFwiLFwiKVxyXG4gICAgICAgICAgICAgICAgfSksIGIgKz0gXCJdXCIsIGIgKz0gXCJ9XCJcclxuICAgICAgICAgICAgfSwgc2NlbmVfc2VsZlxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2NlbmUucHJvdG90eXBlID0gbmV3IGp0b3BvLkVsZW1lbnQ7XHJcbiAgICAgICAgdmFyIGMgPSB7fTtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhzY2VuZS5wcm90b3R5cGUsIHtcclxuICAgICAgICAgICAgYmFja2dyb3VuZDoge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JhY2tncm91bmRcclxuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgYSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGNbYV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgPT0gYiAmJiAoYiA9IG5ldyBJbWFnZSwgYi5zcmMgPSBhLCBiLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNbYV0gPSBiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLl9iYWNrZ3JvdW5kID0gYlxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9iYWNrZ3JvdW5kID0gYVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSksIGp0b3BvLlNjZW5lID0gc2NlbmVcclxuICAgIH0oSlRvcG8pLFxyXG4gICAgZnVuY3Rpb24gKGp0b3BvKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gRGlzcGxheUVsZW1lbnQoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIERpc3BsYXlFbGVtZW50LnByb3RvdHlwZS5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRUeXBlID0gXCJkaXNwbGF5RWxlbWVudFwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy54ID0gMDtcclxuICAgICAgICAgICAgICAgIHRoaXMueSA9IDA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gMzI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhlaWdodCA9IDMyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gITA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFscGhhID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMucm90YXRlID0gMDtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVZID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3Ryb2tlQ29sb3IgPSBcIjIyLDEyNCwyNTVcIjtcclxuICAgICAgICAgICAgICAgIHRoaXMuYm9yZGVyQ29sb3IgPSBcIjIyLDEyNCwyNTVcIjtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsbENvbG9yID0gXCIyMiwxMjQsMjU1XCI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNoYWRvdyA9ICExO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaGFkb3dCbHVyID0gNTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hhZG93Q29sb3IgPSBcInJnYmEoMCwwLDAsMC41KVwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaGFkb3dPZmZzZXRYID0gMztcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hhZG93T2Zmc2V0WSA9IDY7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybUFibGUgPSAhMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuekluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgIHZhciBhID0gXCJ4LHksd2lkdGgsaGVpZ2h0LHZpc2libGUsYWxwaGEscm90YXRlLHNjYWxlWCxzY2FsZVksc3Ryb2tlQ29sb3IsZmlsbENvbG9yLHNoYWRvdyxzaGFkb3dDb2xvcixzaGFkb3dPZmZzZXRYLHNoYWRvd09mZnNldFksdHJhbnNmb3JtQWJsZSx6SW5kZXhcIi5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcmlhbGl6ZWRQcm9wZXJ0aWVzID0gdGhpcy5zZXJpYWxpemVkUHJvcGVydGllcy5jb25jYXQoYSlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplKCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgYS5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgIGEuZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5maWxsQ29sb3IgKyBcIixcIiArIHRoaXMuYWxwaGEgKyBcIilcIjtcclxuICAgICAgICAgICAgICAgIGEucmVjdCgtdGhpcy53aWR0aCAvIDIsIC10aGlzLmhlaWdodCAvIDIsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIGEuZmlsbCgpO1xyXG4gICAgICAgICAgICAgICAgYS5zdHJva2UoKTtcclxuICAgICAgICAgICAgICAgIGEuY2xvc2VQYXRoKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0TG9jYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IHRoaXMueCxcclxuICAgICAgICAgICAgICAgICAgICB5OiB0aGlzLnlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5zZXRMb2NhdGlvbiA9IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5xdG9wbyAmJiB0aGlzLnF0b3BvLmF0dHIgJiYgdGhpcy5xdG9wby5hdHRyLnBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdG9wby5hdHRyLnBvc2l0aW9uWzBdID0gYTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnF0b3BvLmF0dHIucG9zaXRpb25bMV0gPSBiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMueCA9IGEsIHRoaXMueSA9IGIsIHRoaXNcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRDZW50ZXJMb2NhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy54ICsgdGhpcy53aWR0aCAvIDIsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogdGhpcy55ICsgdGhpcy5oZWlnaHQgLyAyXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2VudGVyTG9jYXRpb24gPSBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy54ID0gYSAtIHRoaXMud2lkdGggLyAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy55ID0gYiAtIHRoaXMuaGVpZ2h0IC8gMjtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWl0aFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnNldFNpemUgPSBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy53aWR0aCA9IGE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhlaWdodCA9IGI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRCb3VuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogdGhpcy54LFxyXG4gICAgICAgICAgICAgICAgICAgIHRvcDogdGhpcy55LFxyXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0OiB0aGlzLnggKyB0aGlzLndpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvdHRvbTogdGhpcy55ICsgdGhpcy5oZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnNldEJvdW5kID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0TG9jYXRpb24oYSwgYik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFNpemUoYywgZCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXREaXNwbGF5Qm91bmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMueCxcclxuICAgICAgICAgICAgICAgICAgICB0b3A6IHRoaXMueSxcclxuICAgICAgICAgICAgICAgICAgICByaWdodDogdGhpcy54ICsgdGhpcy53aWR0aCAqIHRoaXMuc2NhbGVYLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvdHRvbTogdGhpcy55ICsgdGhpcy5oZWlnaHQgKiB0aGlzLnNjYWxlWVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmdldERpc3BsYXlTaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCAqIHRoaXMuc2NhbGVYLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQgKiB0aGlzLnNjYWxlWVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmdldFBvc2l0aW9uID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5nZXRCb3VuZCgpO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlRvcF9MZWZ0XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0ge3g6IGMubGVmdCwgeTogYy50b3B9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVG9wX0NlbnRlclwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHt4OiB0aGlzLmN4LCB5OiBjLnRvcH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJUb3BfUmlnaHRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7eDogYy5yaWdodCwgeTogYy50b3B9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTWlkZGxlX0xlZnRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7eDogYy5sZWZ0LCB5OiB0aGlzLmN5fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk1pZGRsZV9DZW50ZXJcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7eDogdGhpcy5jeCwgeTogdGhpcy5jeX07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJNaWRkbGVfUmlnaHRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7eDogYy5yaWdodCwgeTogdGhpcy5jeX07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJCb3R0b21fTGVmdFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHt4OiBjLmxlZnQsIHk6IGMuYm90dG9tfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJvdHRvbV9DZW50ZXJcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7eDogdGhpcy5jeCwgeTogYy5ib3R0b219O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICBcIkJvdHRvbV9SaWdodFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHt4OiBjLnJpZ2h0LCB5OiBjLmJvdHRvbX07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0ge3g6IGMubGVmdCwgeTogYy50b3B9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW50ZXJhY3RpdmVFbGVtZW50KCkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpbnRlcmFjdGl2ZUVsZW1lbnQucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFR5cGUgPSBcImludGVyYWN0aXZlRWxlbWVudFwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnYWJsZSA9ICExO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9ICExO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93U2VsZWN0ZWQgPSAhMDtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzTW91c2VPdmVyID0gITE7XHJcbiAgICAgICAgICAgICAgICB2YXIgYSA9IFwiZHJhZ2FibGUsc2VsZWN0ZWQsc2hvd1NlbGVjdGVkLGlzTW91c2VPdmVyXCIuc3BsaXQoXCIsXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXJpYWxpemVkUHJvcGVydGllcyA9IHRoaXMuc2VyaWFsaXplZFByb3BlcnRpZXMuY29uY2F0KGEpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemUoKTtcclxuICAgICAgICAgICAgdGhpcy5wYWludFNlbGVjdGVkID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGlmICgwICE9IHRoaXMuc2hvd1NlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgICAgICBhLnN0cm9rZVN0eWxlID0gXCJyZ2JhKDE2OCwyMDIsMjU1LCAwLjkpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5maWxsU3R5bGUgPSBcInJnYmEoMTY4LDIwMiwyMzYsMC43KVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGEucmVjdCgtdGhpcy53aWR0aCAvIDIgLSAzLCAtdGhpcy5oZWlnaHQgLyAyIC0gMywgdGhpcy53aWR0aCArIDYsIHRoaXMuaGVpZ2h0ICsgNik7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5maWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5zdHJva2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBhLmNsb3NlUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGEucmVzdG9yZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnRNb3VzZW92ZXIgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFpbnRTZWxlY3RlZChhKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5pc0luQm91bmQgPSBmdW5jdGlvbiAocG9pbnRYLCBwb2ludFkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwb2ludFggPiB0aGlzLnggJiYgcG9pbnRYIDwgdGhpcy54ICsgdGhpcy53aWR0aCAqIE1hdGguYWJzKHRoaXMuc2NhbGVYKSAmJiBwb2ludFkgPiB0aGlzLnkgJiYgcG9pbnRZIDwgdGhpcy55ICsgdGhpcy5oZWlnaHQgKiBNYXRoLmFicyh0aGlzLnNjYWxlWSlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gITA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy54LFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IHRoaXMueVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnVuc2VsZWN0ZWRIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9ICExO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZExvY2F0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmRiY2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChcImRiY2xpY2tcIiwgYSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwiY2xpY2tcIiwgYSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZWRvd25IYW5kZXIgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwibW91c2Vkb3duXCIsIGEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMubW91c2V1cEhhbmRsZXIgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwibW91c2V1cFwiLCBhKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLm1vdXNlb3ZlckhhbmRsZXIgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc01vdXNlT3ZlciA9ICEwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwibW91c2VvdmVyXCIsIGEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMubW91c2Vtb3ZlSGFuZGxlciA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoXCJtb3VzZW1vdmVcIiwgYSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZW91dEhhbmRsZXIgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc01vdXNlT3ZlciA9ICExO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwibW91c2VvdXRcIiwgYSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZWRyYWdIYW5kbGVyID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5zZWxlY3RlZExvY2F0aW9uLnggKyBhLmR4O1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLnNlbGVjdGVkTG9jYXRpb24ueSArIGEuZHk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldExvY2F0aW9uKGIsIGMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwibW91c2VkcmFnXCIsIGEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCwgZm4pIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5tZXNzYWdlQnVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlQnVzID0gbmV3IGp0b3BvLnV0aWwuTWVzc2FnZUJ1cztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZUJ1cy5zdWJzY3JpYmUoZXZlbnQsIGZuKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbiAoZXZlbnQsIGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1lc3NhZ2VCdXMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VCdXMucHVibGlzaChldmVudCwgZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCwgZm4pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZUJ1cy51bnN1YnNjcmliZShldmVudCwgZm4pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUFsbEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VCdXMgPSBuZXcganRvcG8udXRpbC5NZXNzYWdlQnVzXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICAgICAgXCJjbGljayxkYmNsaWNrLG1vdXNlZG93bixtb3VzZXVwLG1vdXNlb3Zlcixtb3VzZW91dCxtb3VzZW1vdmUsbW91c2VkcmFnLHRvdWNoc3RhcnQsdG91Y2htb3ZlLHRvdWNoZW5kXCIuc3BsaXQoXCIsXCIpXHJcbiAgICAgICAgICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZltldmVudE5hbWVdID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnROYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gRWRpdGFibGVFbGVtZW50KCkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBFZGl0YWJsZUVsZW1lbnQucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWRpdEFibGUgPSAhMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQb2ludCA9IG51bGw7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q3RybFBvc2l0aW9uID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gNTtcclxuICAgICAgICAgICAgICAgIHZhciBjID0gNTtcclxuICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5nZXRQb3NpdGlvbihhKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogZC54IC0gYixcclxuICAgICAgICAgICAgICAgICAgICB0b3A6IGQueSAtIGMsXHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IGQueCArIGIsXHJcbiAgICAgICAgICAgICAgICAgICAgYm90dG9tOiBkLnkgKyBjXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRIYW5kbGVyID0gZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgIEVkaXRhYmxlRWxlbWVudC5wcm90b3R5cGUuc2VsZWN0ZWRIYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuc2VsZWN0ZWRTaXplID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHRcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBpZiAoYi5zY2VuZS5tb2RlID09IGp0b3BvLlNjZW5lTW9kZS5lZGl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0QWJsZSA9ICEwXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMudW5zZWxlY3RlZEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBFZGl0YWJsZUVsZW1lbnQucHJvdG90eXBlLnVuc2VsZWN0ZWRIYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkU2l6ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVkaXRBYmxlID0gITE7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZhciBiID0gW1wiVG9wX0xlZnRcIiwgXCJUb3BfQ2VudGVyXCIsIFwiVG9wX1JpZ2h0XCIsIFwiTWlkZGxlX0xlZnRcIiwgXCJNaWRkbGVfUmlnaHRcIiwgXCJCb3R0b21fTGVmdFwiLCBcIkJvdHRvbV9DZW50ZXJcIiwgXCJCb3R0b21fUmlnaHRcIl07XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnRDdHJsID0gZnVuY3Rpb24gKGN4KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoMCAhPSB0aGlzLmVkaXRBYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3guc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgYi5sZW5ndGg7IGMrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuZ2V0Q3RybFBvc2l0aW9uKGJbY10pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkLmxlZnQgLT0gdGhpcy5jeDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZC5yaWdodCAtPSB0aGlzLmN4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkLnRvcCAtPSB0aGlzLmN5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkLmJvdHRvbSAtPSB0aGlzLmN5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGQucmlnaHQgLSBkLmxlZnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZC5ib3R0b20gLSBkLnRvcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3guYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN4LnN0cm9rZVN0eWxlID0gXCJyZ2JhKDAsMCwwLDAuOClcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3gucmVjdChkLmxlZnQsIGQudG9wLCBlLCBmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3guc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN4LmNsb3NlUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjeC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3guc3Ryb2tlU3R5bGUgPSBcInJnYmEoMjU1LDI1NSwyNTUsMC4zKVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjeC5yZWN0KGQubGVmdCArIDEsIGQudG9wICsgMSwgZSAtIDIsIGYgLSAyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3guc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN4LmNsb3NlUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjeC5yZXN0b3JlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuaXNJbkJvdW5kID0gZnVuY3Rpb24gKGEsIGMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUG9pbnQgPSBudWxsLCAxID09IHRoaXMuZWRpdEFibGUpZm9yICh2YXIgZSA9IDA7IGUgPCBiLmxlbmd0aDsgZSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0aGlzLmdldEN0cmxQb3NpdGlvbihiW2VdKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYSA+IGYubGVmdCAmJiBhIDwgZi5yaWdodCAmJiBjID4gZi50b3AgJiYgYyA8IGYuYm90dG9tKXJldHVybiB0aGlzLnNlbGVjdGVkUG9pbnQgPSBiW2VdLCAhMFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEVkaXRhYmxlRWxlbWVudC5wcm90b3R5cGUuaXNJbkJvdW5kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZWRyYWdIYW5kbGVyID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChudWxsID09IHRoaXMuc2VsZWN0ZWRQb2ludCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5zZWxlY3RlZExvY2F0aW9uLnggKyBhLmR4LCBjID0gdGhpcy5zZWxlY3RlZExvY2F0aW9uLnkgKyBhLmR5O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TG9jYXRpb24oYiwgYyksIHRoaXMuZGlzcGF0Y2hFdmVudChcIm1vdXNlZHJhZ1wiLCBhKVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoXCJUb3BfTGVmdFwiID09IHRoaXMuc2VsZWN0ZWRQb2ludCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuc2VsZWN0ZWRTaXplLndpZHRoIC0gYS5keCwgZSA9IHRoaXMuc2VsZWN0ZWRTaXplLmhlaWdodCAtIGEuZHksIGIgPSB0aGlzLnNlbGVjdGVkTG9jYXRpb24ueCArIGEuZHgsIGMgPSB0aGlzLnNlbGVjdGVkTG9jYXRpb24ueSArIGEuZHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGIgPCB0aGlzLnggKyB0aGlzLndpZHRoICYmICh0aGlzLnggPSBiLCB0aGlzLndpZHRoID0gZCksIGMgPCB0aGlzLnkgKyB0aGlzLmhlaWdodCAmJiAodGhpcy55ID0gYywgdGhpcy5oZWlnaHQgPSBlKVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXCJUb3BfQ2VudGVyXCIgPT0gdGhpcy5zZWxlY3RlZFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5zZWxlY3RlZFNpemUuaGVpZ2h0IC0gYS5keSwgYyA9IHRoaXMuc2VsZWN0ZWRMb2NhdGlvbi55ICsgYS5keTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYyA8IHRoaXMueSArIHRoaXMuaGVpZ2h0ICYmICh0aGlzLnkgPSBjLCB0aGlzLmhlaWdodCA9IGUpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChcIlRvcF9SaWdodFwiID09IHRoaXMuc2VsZWN0ZWRQb2ludCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuc2VsZWN0ZWRTaXplLndpZHRoICsgYS5keCwgYyA9IHRoaXMuc2VsZWN0ZWRMb2NhdGlvbi55ICsgYS5keTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYyA8IHRoaXMueSArIHRoaXMuaGVpZ2h0ICYmICh0aGlzLnkgPSBjLCB0aGlzLmhlaWdodCA9IHRoaXMuc2VsZWN0ZWRTaXplLmhlaWdodCAtIGEuZHkpLCBkID4gMSAmJiAodGhpcy53aWR0aCA9IGQpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChcIk1pZGRsZV9MZWZ0XCIgPT0gdGhpcy5zZWxlY3RlZFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5zZWxlY3RlZFNpemUud2lkdGggLSBhLmR4LCBiID0gdGhpcy5zZWxlY3RlZExvY2F0aW9uLnggKyBhLmR4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiIDwgdGhpcy54ICsgdGhpcy53aWR0aCAmJiAodGhpcy54ID0gYiksIGQgPiAxICYmICh0aGlzLndpZHRoID0gZClcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFwiTWlkZGxlX1JpZ2h0XCIgPT0gdGhpcy5zZWxlY3RlZFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5zZWxlY3RlZFNpemUud2lkdGggKyBhLmR4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkID4gMSAmJiAodGhpcy53aWR0aCA9IGQpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChcIkJvdHRvbV9MZWZ0XCIgPT0gdGhpcy5zZWxlY3RlZFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5zZWxlY3RlZFNpemUud2lkdGggLSBhLmR4LCBiID0gdGhpcy5zZWxlY3RlZExvY2F0aW9uLnggKyBhLmR4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkID4gMSAmJiAodGhpcy54ID0gYiwgdGhpcy53aWR0aCA9IGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuc2VsZWN0ZWRTaXplLmhlaWdodCArIGEuZHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUgPiAxICYmICh0aGlzLmhlaWdodCA9IGUpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChcIkJvdHRvbV9DZW50ZXJcIiA9PSB0aGlzLnNlbGVjdGVkUG9pbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLnNlbGVjdGVkU2l6ZS5oZWlnaHQgKyBhLmR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlID4gMSAmJiAodGhpcy5oZWlnaHQgPSBlKVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXCJCb3R0b21fUmlnaHRcIiA9PSB0aGlzLnNlbGVjdGVkUG9pbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLnNlbGVjdGVkU2l6ZS53aWR0aCArIGEuZHg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgPiAxICYmICh0aGlzLndpZHRoID0gZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5zZWxlY3RlZFNpemUuaGVpZ2h0ICsgYS5keTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZSA+IDEgJiYgKHRoaXMuaGVpZ2h0ID0gZSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwicmVzaXplXCIsIGEpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIERpc3BsYXlFbGVtZW50LnByb3RvdHlwZSA9IG5ldyBqdG9wby5FbGVtZW50LCBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhEaXNwbGF5RWxlbWVudC5wcm90b3R5cGUsIHtcclxuICAgICAgICAgICAgY3g6IHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnggKyB0aGlzLndpZHRoIC8gMlxyXG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMueCA9IGEgLSB0aGlzLndpZHRoIC8gMlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBjeToge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMueSArIHRoaXMuaGVpZ2h0IC8gMlxyXG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMueSA9IGEgLSB0aGlzLmhlaWdodCAvIDJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGludGVyYWN0aXZlRWxlbWVudC5wcm90b3R5cGUgPSBuZXcgRGlzcGxheUVsZW1lbnQ7XHJcbiAgICAgICAgRWRpdGFibGVFbGVtZW50LnByb3RvdHlwZSA9IG5ldyBpbnRlcmFjdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAganRvcG8uRGlzcGxheUVsZW1lbnQgPSBEaXNwbGF5RWxlbWVudDtcclxuICAgICAgICBqdG9wby5JbnRlcmFjdGl2ZUVsZW1lbnQgPSBpbnRlcmFjdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAganRvcG8uRWRpdGFibGVFbGVtZW50ID0gRWRpdGFibGVFbGVtZW50O1xyXG4gICAgfShKVG9wbyksXHJcbiAgICBmdW5jdGlvbiAoanRvcG8pIHtcclxuICAgICAgICBmdW5jdGlvbiBiYXNlTm9kZShjKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChjKSB7XHJcbiAgICAgICAgICAgICAgICBiYXNlTm9kZS5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0aGlzLmVsZW1lbnRUeXBlID0gXCJub2RlXCIsIHRoaXMuekluZGV4ID0ganRvcG8uekluZGV4X05vZGUsIHRoaXMudGV4dCA9IGMsIHRoaXMuZm9udCA9IFwiMTJweCBDb25zb2xhc1wiLCB0aGlzLmZvbnRDb2xvciA9IFwiMjU1LDI1NSwyNTVcIiwgdGhpcy5ib3JkZXJXaWR0aCA9IDAsIHRoaXMuYm9yZGVyQ29sb3IgPSBcIjI1NSwyNTUsMjU1XCIsIHRoaXMuYm9yZGVyUmFkaXVzID0gbnVsbCwgdGhpcy5kcmFnYWJsZSA9ICEwLCB0aGlzLnRleHRQb3NpdGlvbiA9IFwiQm90dG9tX0NlbnRlclwiLCB0aGlzLnRleHRPZmZzZXRYID0gMCwgdGhpcy50ZXh0T2Zmc2V0WSA9IDAsIHRoaXMudHJhbnNmb3JtQWJsZSA9ICEwLCB0aGlzLmluTGlua3MgPSBudWxsLCB0aGlzLm91dExpbmtzID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHZhciBkID0gXCJ0ZXh0LGZvbnQsZm9udENvbG9yLHRleHRQb3NpdGlvbix0ZXh0T2Zmc2V0WCx0ZXh0T2Zmc2V0WSxib3JkZXJSYWRpdXNcIi5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcmlhbGl6ZWRQcm9wZXJ0aWVzID0gdGhpcy5zZXJpYWxpemVkUHJvcGVydGllcy5jb25jYXQoZClcclxuICAgICAgICAgICAgfSwgdGhpcy5pbml0aWFsaXplKGMpLCB0aGlzLnBhaW50ID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmltYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhLmdsb2JhbEFscGhhO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuZ2xvYmFsQWxwaGEgPSB0aGlzLmFscGhhLCBudWxsICE9IHRoaXMuYWxhcm1JbWFnZSAmJiBudWxsICE9IHRoaXMuYWxhcm0gPyBhLmRyYXdJbWFnZSh0aGlzLmFsYXJtSW1hZ2UsIC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMiwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpIDogYS5kcmF3SW1hZ2UodGhpcy5pbWFnZSwgLXRoaXMud2lkdGggLyAyLCAtdGhpcy5oZWlnaHQgLyAyLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCksIGEuZ2xvYmFsQWxwaGEgPSBiXHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgYS5iZWdpblBhdGgoKSwgYS5maWxsU3R5bGUgPSBcInJnYmEoXCIgKyB0aGlzLmZpbGxDb2xvciArIFwiLFwiICsgdGhpcy5hbHBoYSArIFwiKVwiLCBudWxsID09IHRoaXMuYm9yZGVyUmFkaXVzIHx8IDAgPT0gdGhpcy5ib3JkZXJSYWRpdXMgPyBhLnJlY3QoLXRoaXMud2lkdGggLyAyLCAtdGhpcy5oZWlnaHQgLyAyLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCkgOiBhLkpUb3BvUm91bmRSZWN0KC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMiwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIHRoaXMuYm9yZGVyUmFkaXVzKSwgYS5maWxsKCksIGEuY2xvc2VQYXRoKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhaW50VGV4dChhKSwgdGhpcy5wYWludEJvcmRlcihhKSwgdGhpcy5wYWludEN0cmwoYSksIHRoaXMucGFpbnRBbGFybVRleHQoYSlcclxuICAgICAgICAgICAgfSwgdGhpcy5wYWludEFsYXJtVGV4dCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSB0aGlzLmFsYXJtICYmIFwiXCIgIT0gdGhpcy5hbGFybSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5hbGFybUNvbG9yIHx8IFwiMjU1LDAsMFwiLCBjID0gdGhpcy5hbGFybUFscGhhIHx8IC41O1xyXG4gICAgICAgICAgICAgICAgICAgIGEuYmVnaW5QYXRoKCksIGEuZm9udCA9IHRoaXMuYWxhcm1Gb250IHx8IFwiMTBweCDlvq7ova/pm4Xpu5FcIjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEubWVhc3VyZVRleHQodGhpcy5hbGFybSkud2lkdGggKyA2LCBlID0gYS5tZWFzdXJlVGV4dChcIueUsFwiKS53aWR0aCArIDYsIGYgPSB0aGlzLndpZHRoIC8gMiAtIGQgLyAyLCBnID0gLXRoaXMuaGVpZ2h0IC8gMiAtIGUgLSA4O1xyXG4gICAgICAgICAgICAgICAgICAgIGEuc3Ryb2tlU3R5bGUgPSBcInJnYmEoXCIgKyBiICsgXCIsIFwiICsgYyArIFwiKVwiLCBhLmZpbGxTdHlsZSA9IFwicmdiYShcIiArIGIgKyBcIiwgXCIgKyBjICsgXCIpXCIsIGEubGluZUNhcCA9IFwicm91bmRcIiwgYS5saW5lV2lkdGggPSAxLCBhLm1vdmVUbyhmLCBnKSwgYS5saW5lVG8oZiArIGQsIGcpLCBhLmxpbmVUbyhmICsgZCwgZyArIGUpLCBhLmxpbmVUbyhmICsgZCAvIDIgKyA2LCBnICsgZSksIGEubGluZVRvKGYgKyBkIC8gMiwgZyArIGUgKyA4KSwgYS5saW5lVG8oZiArIGQgLyAyIC0gNiwgZyArIGUpLCBhLmxpbmVUbyhmLCBnICsgZSksIGEubGluZVRvKGYsIGcpLCBhLmZpbGwoKSwgYS5zdHJva2UoKSwgYS5jbG9zZVBhdGgoKSwgYS5iZWdpblBhdGgoKSwgYS5zdHJva2VTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZm9udENvbG9yICsgXCIsIFwiICsgdGhpcy5hbHBoYSArIFwiKVwiLCBhLmZpbGxTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZm9udENvbG9yICsgXCIsIFwiICsgdGhpcy5hbHBoYSArIFwiKVwiLCBhLmZpbGxUZXh0KHRoaXMuYWxhcm0sIGYgKyAyLCBnICsgZSAtIDQpLCBhLmNsb3NlUGF0aCgpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMucGFpbnRUZXh0ID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy50ZXh0O1xyXG4gICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gYiAmJiBcIlwiICE9IGIpIHtcclxuICAgICAgICAgICAgICAgICAgICBhLmJlZ2luUGF0aCgpLCBhLmZvbnQgPSB0aGlzLmZvbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLm1lYXN1cmVUZXh0KGIpLndpZHRoLCBkID0gYS5tZWFzdXJlVGV4dChcIueUsFwiKS53aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBhLmZpbGxTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZm9udENvbG9yICsgXCIsIFwiICsgdGhpcy5hbHBoYSArIFwiKVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5nZXRUZXh0UG9zdGlvbih0aGlzLnRleHRQb3NpdGlvbiwgYywgZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5maWxsVGV4dChiLCBlLngsIGUueSksIGEuY2xvc2VQYXRoKClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcy5wYWludEJvcmRlciA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoMCAhPSB0aGlzLmJvcmRlcldpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5iZWdpblBhdGgoKSwgYS5saW5lV2lkdGggPSB0aGlzLmJvcmRlcldpZHRoLCBhLnN0cm9rZVN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5ib3JkZXJDb2xvciArIFwiLFwiICsgdGhpcy5hbHBoYSArIFwiKVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5ib3JkZXJXaWR0aCAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgbnVsbCA9PSB0aGlzLmJvcmRlclJhZGl1cyB8fCAwID09IHRoaXMuYm9yZGVyUmFkaXVzID8gYS5yZWN0KC10aGlzLndpZHRoIC8gMiAtIGIsIC10aGlzLmhlaWdodCAvIDIgLSBiLCB0aGlzLndpZHRoICsgdGhpcy5ib3JkZXJXaWR0aCwgdGhpcy5oZWlnaHQgKyB0aGlzLmJvcmRlcldpZHRoKSA6IGEuSlRvcG9Sb3VuZFJlY3QoLXRoaXMud2lkdGggLyAyIC0gYiwgLXRoaXMuaGVpZ2h0IC8gMiAtIGIsIHRoaXMud2lkdGggKyB0aGlzLmJvcmRlcldpZHRoLCB0aGlzLmhlaWdodCArIHRoaXMuYm9yZGVyV2lkdGgsIHRoaXMuYm9yZGVyUmFkaXVzKSwgYS5zdHJva2UoKSwgYS5jbG9zZVBhdGgoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLmdldFRleHRQb3N0aW9uID0gZnVuY3Rpb24gKHBvc2l0aW9uLCBtYXhXaWR0aCwgZm9udFdpZHRoLCBoZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQm90dG9tX0NlbnRlclwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogLXRoaXMud2lkdGggLyAyICsgKHRoaXMud2lkdGggLSBtYXhXaWR0aCkgLyAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogdGhpcy5oZWlnaHQgLyAyICsgZm9udFdpZHRoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJUb3BfQ2VudGVyXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiAtdGhpcy53aWR0aCAvIDIgKyAodGhpcy53aWR0aCAtIG1heFdpZHRoKSAvIDIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiAtdGhpcy5oZWlnaHQgLyAyIC0gZm9udFdpZHRoIC8gMiAtIGZvbnRXaWR0aCAqIChoZWlnaHQgLSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVG9wX1JpZ2h0XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLndpZHRoIC8gMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IC10aGlzLmhlaWdodCAvIDIgLSBmb250V2lkdGggLyAyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJUb3BfTGVmdFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogLXRoaXMud2lkdGggLyAyIC0gbWF4V2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiAtdGhpcy5oZWlnaHQgLyAyIC0gZm9udFdpZHRoIC8gMlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQm90dG9tX1JpZ2h0XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLndpZHRoIC8gMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IHRoaXMuaGVpZ2h0IC8gMiArIGZvbnRXaWR0aFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQm90dG9tX0xlZnRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IC10aGlzLndpZHRoIC8gMiAtIG1heFdpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogdGhpcy5oZWlnaHQgLyAyICsgZm9udFdpZHRoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJNaWRkbGVfQ2VudGVyXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiAtdGhpcy53aWR0aCAvIDIgKyAodGhpcy53aWR0aCAtIG1heFdpZHRoKSAvIDIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBmb250V2lkdGggLyAyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJNaWRkbGVfUmlnaHRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IHRoaXMud2lkdGggLyAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogZm9udFdpZHRoIC8gMlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTWlkZGxlX0xlZnRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IC10aGlzLndpZHRoIC8gMiAtIG1heFdpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogZm9udFdpZHRoIC8gMlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogLXRoaXMud2lkdGggLyAyIC0gbWF4V2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBmb250V2lkdGggLyAyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSB0aGlzLnRleHRPZmZzZXRYKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZC54ICs9IHRoaXMudGV4dE9mZnNldFhcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChudWxsICE9IHRoaXMudGV4dE9mZnNldFkpIHtcclxuICAgICAgICAgICAgICAgICAgICBkLnkgKz0gdGhpcy50ZXh0T2Zmc2V0WVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQ7XHJcbiAgICAgICAgICAgIH0sIHRoaXMuc2V0SW1hZ2UgPSBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gYSl0aHJvdyBuZXcgRXJyb3IoXCJOb2RlLnNldEltYWdlKCk6IOWPguaVsEltYWdl5a+56LGh5Li656m6IVwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcztcclxuICAgICAgICAgICAgICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBqW2FdO1xyXG4gICAgICAgICAgICAgICAgICAgIG51bGwgPT0gZCA/IChkID0gbmV3IEltYWdlLCBkLnNyYyA9IGEsIGQub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqW2FdID0gZCwgMSA9PSBiICYmIGMuc2V0U2l6ZShkLndpZHRoLCBkLmhlaWdodCksIGMuaW1hZ2UgPSBkLCBjLmFsYXJtQ29sb3IgPSBudWxsID09IGMuYWxhcm1Db2xvciA/IFwiMjU1LDAsMFwiIDogYy5hbGFybUNvbG9yXHJcbiAgICAgICAgICAgICAgICAgICAgfSkgOiAoYiAmJiB0aGlzLnNldFNpemUoZC53aWR0aCwgZC5oZWlnaHQpLCBjLmltYWdlID0gZCwgYy5hbGFybUNvbG9yID0gbnVsbCA9PSBjLmFsYXJtQ29sb3IgPyBcIjI1NSwwLDBcIiA6IGMuYWxhcm1Db2xvcilcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLmltYWdlID0gYSwgYy5hbGFybUNvbG9yID0gbnVsbCA9PSBjLmFsYXJtQ29sb3IgPyBcIjI1NSwwLDBcIiA6IGMuYWxhcm1Db2xvciwgMSA9PSBiICYmIHRoaXMuc2V0U2l6ZShhLndpZHRoLCBhLmhlaWdodClcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVIYW5kbGVyID0gZnVuY3Rpb24gKHNjZW5lKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vdXRMaW5rcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3V0TGlua3MuZm9yRWFjaChmdW5jdGlvbiAoYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5ub2RlQSA9PT0gc2VsZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmUucmVtb3ZlKGMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm91dExpbmtzID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmluTGlua3MpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluTGlua3MuZm9yRWFjaChmdW5jdGlvbiAoYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjLm5vZGVaID09PSBzZWxmICYmIHNjZW5lLnJlbW92ZShjKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5MaW5rcyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIE5vZGUoKSB7XHJcbiAgICAgICAgICAgIE5vZGUucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gVGV4dE5vZGUoYSkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemUoKSwgdGhpcy50ZXh0ID0gYSwgdGhpcy5lbGVtZW50VHlwZSA9IFwiVGV4dE5vZGVcIiwgdGhpcy5wYWludCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBhLmJlZ2luUGF0aCgpLCBhLmZvbnQgPSB0aGlzLmZvbnQsIHRoaXMud2lkdGggPSBhLm1lYXN1cmVUZXh0KHRoaXMudGV4dCkud2lkdGgsIHRoaXMuaGVpZ2h0ID0gYS5tZWFzdXJlVGV4dChcIueUsFwiKS53aWR0aCwgYS5zdHJva2VTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZm9udENvbG9yICsgXCIsIFwiICsgdGhpcy5hbHBoYSArIFwiKVwiLCBhLmZpbGxTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZm9udENvbG9yICsgXCIsIFwiICsgdGhpcy5hbHBoYSArIFwiKVwiLCBhLmZpbGxUZXh0KHRoaXMudGV4dCwgLXRoaXMud2lkdGggLyAyLCB0aGlzLmhlaWdodCAvIDIpLCBhLmNsb3NlUGF0aCgpLCB0aGlzLnBhaW50Qm9yZGVyKGEpLCB0aGlzLnBhaW50Q3RybChhKSwgdGhpcy5wYWludEFsYXJtVGV4dChhKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBMaW5rTm9kZShhLCBiLCBjKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZSgpLCB0aGlzLnRleHQgPSBhLCB0aGlzLmhyZWYgPSBiLCB0aGlzLnRhcmdldCA9IGMsIHRoaXMuZWxlbWVudFR5cGUgPSBcIkxpbmtOb2RlXCIsIHRoaXMuaXNWaXNpdGVkID0gITEsIHRoaXMudmlzaXRlZENvbG9yID0gbnVsbCwgdGhpcy5wYWludCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBhLmJlZ2luUGF0aCgpLCBhLmZvbnQgPSB0aGlzLmZvbnQsIHRoaXMud2lkdGggPSBhLm1lYXN1cmVUZXh0KHRoaXMudGV4dCkud2lkdGgsIHRoaXMuaGVpZ2h0ID0gYS5tZWFzdXJlVGV4dChcIueUsFwiKS53aWR0aCwgdGhpcy5pc1Zpc2l0ZWQgJiYgbnVsbCAhPSB0aGlzLnZpc2l0ZWRDb2xvciA/IChhLnN0cm9rZVN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy52aXNpdGVkQ29sb3IgKyBcIiwgXCIgKyB0aGlzLmFscGhhICsgXCIpXCIsIGEuZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy52aXNpdGVkQ29sb3IgKyBcIiwgXCIgKyB0aGlzLmFscGhhICsgXCIpXCIpIDogKGEuc3Ryb2tlU3R5bGUgPSBcInJnYmEoXCIgKyB0aGlzLmZvbnRDb2xvciArIFwiLCBcIiArIHRoaXMuYWxwaGEgKyBcIilcIiwgYS5maWxsU3R5bGUgPSBcInJnYmEoXCIgKyB0aGlzLmZvbnRDb2xvciArIFwiLCBcIiArIHRoaXMuYWxwaGEgKyBcIilcIiksIGEuZmlsbFRleHQodGhpcy50ZXh0LCAtdGhpcy53aWR0aCAvIDIsIHRoaXMuaGVpZ2h0IC8gMiksIHRoaXMuaXNNb3VzZU92ZXIgJiYgKGEubW92ZVRvKC10aGlzLndpZHRoIC8gMiwgdGhpcy5oZWlnaHQpLCBhLmxpbmVUbyh0aGlzLndpZHRoIC8gMiwgdGhpcy5oZWlnaHQpLCBhLnN0cm9rZSgpKSwgYS5jbG9zZVBhdGgoKSwgdGhpcy5wYWludEJvcmRlcihhKSwgdGhpcy5wYWludEN0cmwoYSksIHRoaXMucGFpbnRBbGFybVRleHQoYSlcclxuICAgICAgICAgICAgfSwgdGhpcy5tb3VzZW1vdmUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImNhbnZhc1wiKTtcclxuICAgICAgICAgICAgICAgIGlmIChhICYmIGEubGVuZ3RoID4gMClmb3IgKHZhciBiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspYVtiXS5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIlxyXG4gICAgICAgICAgICB9KSwgdGhpcy5tb3VzZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiY2FudmFzXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGEgJiYgYS5sZW5ndGggPiAwKWZvciAodmFyIGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIrKylhW2JdLnN0eWxlLmN1cnNvciA9IFwiZGVmYXVsdFwiXHJcbiAgICAgICAgICAgIH0pLCB0aGlzLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIFwiX2JsYW5rXCIgPT0gdGhpcy50YXJnZXQgPyB3aW5kb3cub3Blbih0aGlzLmhyZWYpIDogbG9jYXRpb24gPSB0aGlzLmhyZWYsIHRoaXMuaXNWaXNpdGVkID0gITBcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIENpcmNsZU5vZGUoYSkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemUoYXJndW1lbnRzKSwgdGhpcy5fcmFkaXVzID0gMjAsIHRoaXMuYmVnaW5EZWdyZWUgPSAwLCB0aGlzLmVuZERlZ3JlZSA9IDIgKiBNYXRoLlBJLCB0aGlzLnRleHQgPSBhLCB0aGlzLnBhaW50ID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGEuc2F2ZSgpLCBhLmJlZ2luUGF0aCgpLCBhLmZpbGxTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZmlsbENvbG9yICsgXCIsXCIgKyB0aGlzLmFscGhhICsgXCIpXCIsIGEuYXJjKDAsIDAsIHRoaXMucmFkaXVzLCB0aGlzLmJlZ2luRGVncmVlLCB0aGlzLmVuZERlZ3JlZSwgITApLCBhLmZpbGwoKSwgYS5jbG9zZVBhdGgoKSwgYS5yZXN0b3JlKCksIHRoaXMucGFpbnRUZXh0KGEpLCB0aGlzLnBhaW50Qm9yZGVyKGEpLCB0aGlzLnBhaW50Q3RybChhKSwgdGhpcy5wYWludEFsYXJtVGV4dChhKVxyXG4gICAgICAgICAgICB9LCB0aGlzLnBhaW50U2VsZWN0ZWQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgYS5zYXZlKCksIGEuYmVnaW5QYXRoKCksIGEuc3Ryb2tlU3R5bGUgPSBcInJnYmEoMTY4LDIwMiwyNTUsIDAuOSlcIiwgYS5maWxsU3R5bGUgPSBcInJnYmEoMTY4LDIwMiwyMzYsMC43KVwiLCBhLmFyYygwLCAwLCB0aGlzLnJhZGl1cyArIDMsIHRoaXMuYmVnaW5EZWdyZWUsIHRoaXMuZW5kRGVncmVlLCAhMCksIGEuZmlsbCgpLCBhLnN0cm9rZSgpLCBhLmNsb3NlUGF0aCgpLCBhLnJlc3RvcmUoKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnKGEsIGIsIGMpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZnJhbWVJbWFnZXMgPSBhIHx8IFtdO1xyXG4gICAgICAgICAgICB0aGlzLmZyYW1lSW5kZXggPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmlzU3RvcCA9ICEwO1xyXG4gICAgICAgICAgICB2YXIgZCA9IGIgfHwgMWUzO1xyXG4gICAgICAgICAgICB0aGlzLnJlcGVhdFBsYXkgPSAhMTtcclxuICAgICAgICAgICAgdmFyIGUgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLm5leHRGcmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc1N0b3AgJiYgbnVsbCAhPSB0aGlzLmZyYW1lSW1hZ2VzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZyYW1lSW5kZXggPj0gdGhpcy5mcmFtZUltYWdlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlcGVhdFBsYXkpcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZyYW1lSW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEltYWdlKHRoaXMuZnJhbWVJbWFnZXNbdGhpcy5mcmFtZUluZGV4XSwgYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUubmV4dEZyYW1lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZCAvIGEubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaChhLCBiLCBjLCBkLCBlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgICAgICB2YXIgZiA9IHRoaXM7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0SW1hZ2UoYSksIHRoaXMuZnJhbWVJbmRleCA9IDAsIHRoaXMuaXNQYXVzZSA9ICEwLCB0aGlzLnJlcGVhdFBsYXkgPSAhMTtcclxuICAgICAgICAgICAgdmFyIGcgPSBkIHx8IDFlMztcclxuICAgICAgICAgICAgZSA9IGUgfHwgMCwgdGhpcy5wYWludCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbWFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy53aWR0aCwgZCA9IHRoaXMuaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgIGEuc2F2ZSgpLCBhLmJlZ2luUGF0aCgpLCBhLmZpbGxTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZmlsbENvbG9yICsgXCIsXCIgKyB0aGlzLmFscGhhICsgXCIpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSAoTWF0aC5mbG9vcih0aGlzLmZyYW1lSW5kZXggLyBjKSArIGUpICogZCwgZyA9IE1hdGguZmxvb3IodGhpcy5mcmFtZUluZGV4ICUgYykgKiBiO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuZHJhd0ltYWdlKHRoaXMuaW1hZ2UsIGcsIGYsIGIsIGQsIC1iIC8gMiwgLWQgLyAyLCBiLCBkKSwgYS5maWxsKCksIGEuY2xvc2VQYXRoKCksIGEucmVzdG9yZSgpLCB0aGlzLnBhaW50VGV4dChhKSwgdGhpcy5wYWludEJvcmRlcihhKSwgdGhpcy5wYWludEN0cmwoYSksIHRoaXMucGFpbnRBbGFybVRleHQoYSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcy5uZXh0RnJhbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNTdG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZnJhbWVJbmRleCsrLCB0aGlzLmZyYW1lSW5kZXggPj0gYiAqIGMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlcGVhdFBsYXkpcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZyYW1lSW5kZXggPSAwXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmLmlzU3RvcCB8fCBmLm5leHRGcmFtZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZyAvIChiICogYykpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIEFuaW1hdGVOb2RlKCkge1xyXG4gICAgICAgICAgICB2YXIgYSA9IG51bGw7XHJcbiAgICAgICAgICAgIHJldHVybiBhID0gYXJndW1lbnRzLmxlbmd0aCA8PSAzID8gbmV3IGcoYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0sIGFyZ3VtZW50c1syXSkgOiBuZXcgaChhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdLCBhcmd1bWVudHNbM10sIGFyZ3VtZW50c1s0XSwgYXJndW1lbnRzWzVdKSwgYS5zdG9wID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgYS5pc1N0b3AgPSAhMFxyXG4gICAgICAgICAgICB9LCBhLnBsYXkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBhLmlzU3RvcCA9ICExLCBhLmZyYW1lSW5kZXggPSAwLCBhLm5leHRGcmFtZSgpXHJcbiAgICAgICAgICAgIH0sIGFcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBqID0ge307XHJcbiAgICAgICAgYmFzZU5vZGUucHJvdG90eXBlID0gbmV3IGp0b3BvLkVkaXRhYmxlRWxlbWVudDtcclxuICAgICAgICBOb2RlLnByb3RvdHlwZSA9IG5ldyBiYXNlTm9kZTtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhOb2RlLnByb3RvdHlwZSwge1xyXG4gICAgICAgICAgICBhbGFybUNvbG9yOiB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWxhcm1Db2xvclxyXG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiAoY29sb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbGFybUNvbG9yID0gY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5pbWFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGp0b3BvLnV0aWwuZ2VuSW1hZ2VBbGFybSh0aGlzLmltYWdlLCBjb2xvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFsYXJtSW1hZ2UgPSBjO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgVGV4dE5vZGUucHJvdG90eXBlID0gbmV3IE5vZGU7XHJcbiAgICAgICAgTGlua05vZGUucHJvdG90eXBlID0gbmV3IFRleHROb2RlO1xyXG4gICAgICAgIENpcmNsZU5vZGUucHJvdG90eXBlID0gbmV3IE5vZGU7XHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoQ2lyY2xlTm9kZS5wcm90b3R5cGUsIHtcclxuICAgICAgICAgICAgcmFkaXVzOiB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmFkaXVzXHJcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmFkaXVzID0gYTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IDIgKiB0aGlzLnJhZGl1cywgYyA9IDIgKiB0aGlzLnJhZGl1cztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gYiwgdGhpcy5oZWlnaHQgPSBjXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHdpZHRoOiB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fd2lkdGhcclxuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yYWRpdXMgPSBhIC8gMiwgdGhpcy5fd2lkdGggPSBhXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGhlaWdodDoge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodFxyXG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JhZGl1cyA9IGEgLyAyLCB0aGlzLl9oZWlnaHQgPSBhXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBnLnByb3RvdHlwZSA9IG5ldyBOb2RlO1xyXG4gICAgICAgIGgucHJvdG90eXBlID0gbmV3IE5vZGU7XHJcbiAgICAgICAgQW5pbWF0ZU5vZGUucHJvdG90eXBlID0gbmV3IE5vZGU7XHJcbiAgICAgICAganRvcG8uTm9kZSA9IE5vZGU7XHJcbiAgICAgICAganRvcG8uVGV4dE5vZGUgPSBUZXh0Tm9kZTtcclxuICAgICAgICBqdG9wby5MaW5rTm9kZSA9IExpbmtOb2RlO1xyXG4gICAgICAgIGp0b3BvLkNpcmNsZU5vZGUgPSBDaXJjbGVOb2RlO1xyXG4gICAgICAgIGp0b3BvLkFuaW1hdGVOb2RlID0gQW5pbWF0ZU5vZGU7XHJcbiAgICB9KEpUb3BvKSxcclxuICAgIGZ1bmN0aW9uIChqdG9wbykge1xyXG4gICAgICAgIGZ1bmN0aW9uIGdldFB1YmxpY0xpbmsoZWxlbWVudEEsIGVsZW1lbnRCKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgICAgICAgICAgaWYgKG51bGwgPT0gZWxlbWVudEEgfHwgbnVsbCA9PSBlbGVtZW50QilyZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICBpZiAoZWxlbWVudEEgJiYgZWxlbWVudEIgJiYgZWxlbWVudEEub3V0TGlua3MgJiYgZWxlbWVudEIuaW5MaW5rcylcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudEEub3V0TGlua3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb3V0TGluayA9IGVsZW1lbnRBLm91dExpbmtzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGYgPSAwOyBmIDwgZWxlbWVudEIuaW5MaW5rcy5sZW5ndGg7IGYrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5saW5rID0gZWxlbWVudEIuaW5MaW5rc1tmXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG91dExpbmsgPT09IGlubGluaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaW5saW5rKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TGlua3NCZXR3ZWVuKHN0YXJ0LCBlbmQpIHtcclxuICAgICAgICAgICAgdmFyIGQgPSBnZXRQdWJsaWNMaW5rKHN0YXJ0LCBlbmQpO1xyXG4gICAgICAgICAgICB2YXIgZSA9IGdldFB1YmxpY0xpbmsoZW5kLCBzdGFydCk7XHJcbiAgICAgICAgICAgIHJldHVybiBkLmNvbmNhdChlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldExpbmtOb3RUaGlzKGxpbmspIHtcclxuICAgICAgICAgICAgdmFyIGIgPSBnZXRMaW5rc0JldHdlZW4obGluay5ub2RlQSwgbGluay5ub2RlWik7XHJcbiAgICAgICAgICAgIHJldHVybiBiID0gYi5maWx0ZXIoZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBsaW5rICE9PSBiXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXROdW1zKGEsIGIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldExpbmtzQmV0d2VlbihhLCBiKS5sZW5ndGhcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIExpbmsoYiwgYywgZykge1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBoKHN0YXJ0LCBlbmQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBsaW5rID0ganRvcG8udXRpbC5saW5lRihzdGFydC5jeCwgc3RhcnQuY3ksIGVuZC5jeCwgZW5kLmN5KTtcclxuICAgICAgICAgICAgICAgIHZhciBib3VuZCA9IHN0YXJ0LmdldEJvdW5kKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ganRvcG8udXRpbC5pbnRlcnNlY3Rpb25MaW5lQm91bmQobGluaywgYm91bmQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoYiwgYywgZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKExpbmsucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgdGhpcy5lbGVtZW50VHlwZSA9IFwibGlua1wiLCB0aGlzLnpJbmRleCA9IGp0b3BvLnpJbmRleF9MaW5rLCAwICE9IGFyZ3VtZW50cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSBkO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZUEgPSBiO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZVogPSBjO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZUEgJiYgbnVsbCA9PSB0aGlzLm5vZGVBLm91dExpbmtzICYmICh0aGlzLm5vZGVBLm91dExpbmtzID0gW10pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZUEgJiYgbnVsbCA9PSB0aGlzLm5vZGVBLmluTGlua3MgJiYgKHRoaXMubm9kZUEuaW5MaW5rcyA9IFtdKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGVaICYmIG51bGwgPT0gdGhpcy5ub2RlWi5pbkxpbmtzICYmICh0aGlzLm5vZGVaLmluTGlua3MgPSBbXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub2RlWiAmJiBudWxsID09IHRoaXMubm9kZVoub3V0TGlua3MgJiYgKHRoaXMubm9kZVoub3V0TGlua3MgPSBbXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSB0aGlzLm5vZGVBICYmIHRoaXMubm9kZUEub3V0TGlua3MucHVzaCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICBudWxsICE9IHRoaXMubm9kZVogJiYgdGhpcy5ub2RlWi5pbkxpbmtzLnB1c2godGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWN1bGF0ZUluZGV4KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb250ID0gXCIxMnB4IENvbnNvbGFzXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb250Q29sb3IgPSBcIjI1NSwyNTUsMjU1XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saW5lV2lkdGggPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGluZUpvaW4gPSBcIm1pdGVyXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1BYmxlID0gITE7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idW5kbGVPZmZzZXQgPSAyMDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1bmRsZUdhcCA9IDEyO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dE9mZnNldFggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dE9mZnNldFkgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJyb3dzUmFkaXVzID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFycm93c09mZnNldCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXNoZWRQYXR0ZXJuID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdGggPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IFwidGV4dCxmb250LGZvbnRDb2xvcixsaW5lV2lkdGgsbGluZUpvaW5cIi5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJpYWxpemVkUHJvcGVydGllcyA9IHRoaXMuc2VyaWFsaXplZFByb3BlcnRpZXMuY29uY2F0KGUpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMuY2FjdWxhdGVJbmRleCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhID0gZ2V0TnVtcyh0aGlzLm5vZGVBLCB0aGlzLm5vZGVaKTtcclxuICAgICAgICAgICAgICAgIGEgPiAwICYmICh0aGlzLm5vZGVJbmRleCA9IGEgLSAxKVxyXG4gICAgICAgICAgICB9LCB0aGlzLmluaXRpYWxpemUoYiwgYywgZyksIHRoaXMucmVtb3ZlSGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcztcclxuICAgICAgICAgICAgICAgIHRoaXMubm9kZUEgJiYgdGhpcy5ub2RlQS5vdXRMaW5rcyAmJiAodGhpcy5ub2RlQS5vdXRMaW5rcyA9IHRoaXMubm9kZUEub3V0TGlua3MuZmlsdGVyKGZ1bmN0aW9uIChiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIgIT09IGFcclxuICAgICAgICAgICAgICAgIH0pKSwgdGhpcy5ub2RlWiAmJiB0aGlzLm5vZGVaLmluTGlua3MgJiYgKHRoaXMubm9kZVouaW5MaW5rcyA9IHRoaXMubm9kZVouaW5MaW5rcy5maWx0ZXIoZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiAhPT0gYVxyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBnZXRMaW5rTm90VGhpcyh0aGlzKTtcclxuICAgICAgICAgICAgICAgIGIuZm9yRWFjaChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgICAgIGEubm9kZUluZGV4ID0gYlxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSwgdGhpcy5nZXRTdGFydFBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGEgPSB7eDogdGhpcy5ub2RlQS5jeCwgeTogdGhpcy5ub2RlQS5jeX07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYVxyXG4gICAgICAgICAgICB9LCB0aGlzLmdldEVuZFBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSB0aGlzLmFycm93c1JhZGl1cyAmJiAoYSA9IGgodGhpcy5ub2RlWiwgdGhpcy5ub2RlQSkpLCBudWxsID09IGEgJiYgKGEgPSB7eDogdGhpcy5ub2RlWi5jeCwgeTogdGhpcy5ub2RlWi5jeX0pLCBhXHJcbiAgICAgICAgICAgIH0sIHRoaXMuZ2V0UGF0aCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhID0gW10sIGIgPSB0aGlzLmdldFN0YXJ0UG9zaXRpb24oKSwgYyA9IHRoaXMuZ2V0RW5kUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vZGVBID09PSB0aGlzLm5vZGVaKXJldHVybiBbYiwgY107XHJcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGdldE51bXModGhpcy5ub2RlQSwgdGhpcy5ub2RlWik7XHJcbiAgICAgICAgICAgICAgICBpZiAoMSA9PSBkKXJldHVybiBbYiwgY107XHJcbiAgICAgICAgICAgICAgICB2YXIgZiA9IE1hdGguYXRhbjIoYy55IC0gYi55LCBjLnggLSBiLngpLCBnID0ge3g6IGIueCArIHRoaXMuYnVuZGxlT2Zmc2V0ICogTWF0aC5jb3MoZiksIHk6IGIueSArIHRoaXMuYnVuZGxlT2Zmc2V0ICogTWF0aC5zaW4oZil9LCBoID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IGMueCArIHRoaXMuYnVuZGxlT2Zmc2V0ICogTWF0aC5jb3MoZiAtIE1hdGguUEkpLFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IGMueSArIHRoaXMuYnVuZGxlT2Zmc2V0ICogTWF0aC5zaW4oZiAtIE1hdGguUEkpXHJcbiAgICAgICAgICAgICAgICB9LCBpID0gZiAtIE1hdGguUEkgLyAyLCBqID0gZiAtIE1hdGguUEkgLyAyLCBrID0gZCAqIHRoaXMuYnVuZGxlR2FwIC8gMiAtIHRoaXMuYnVuZGxlR2FwIC8gMiwgbCA9IHRoaXMuYnVuZGxlR2FwICogdGhpcy5ub2RlSW5kZXgsIG0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogZy54ICsgbCAqIE1hdGguY29zKGkpLFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IGcueSArIGwgKiBNYXRoLnNpbihpKVxyXG4gICAgICAgICAgICAgICAgfSwgbiA9IHt4OiBoLnggKyBsICogTWF0aC5jb3MoaiksIHk6IGgueSArIGwgKiBNYXRoLnNpbihqKX07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbSA9IHt4OiBtLnggKyBrICogTWF0aC5jb3MoaSAtIE1hdGguUEkpLCB5OiBtLnkgKyBrICogTWF0aC5zaW4oaSAtIE1hdGguUEkpfSwgbiA9IHt4OiBuLnggKyBrICogTWF0aC5jb3MoaiAtIE1hdGguUEkpLCB5OiBuLnkgKyBrICogTWF0aC5zaW4oaiAtIE1hdGguUEkpfSwgYS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB4OiBiLngsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogYi55XHJcbiAgICAgICAgICAgICAgICB9KSwgYS5wdXNoKHt4OiBtLngsIHk6IG0ueX0pLCBhLnB1c2goe3g6IG4ueCwgeTogbi55fSksIGEucHVzaCh7eDogYy54LCB5OiBjLnl9KSwgYVxyXG4gICAgICAgICAgICB9LCB0aGlzLnBhaW50UGF0aCA9IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlQSA9PT0gdGhpcy5ub2RlWilyZXR1cm4gdm9pZCB0aGlzLnBhaW50TG9vcChhKTtcclxuICAgICAgICAgICAgICAgIGEuYmVnaW5QYXRoKCksIGEubW92ZVRvKGJbMF0ueCwgYlswXS55KTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAxOyBjIDwgYi5sZW5ndGg7IGMrKyludWxsID09IHRoaXMuZGFzaGVkUGF0dGVybiA/IGEubGluZVRvKGJbY10ueCwgYltjXS55KSA6IGEuSlRvcG9EYXNoZWRMaW5lVG8oYltjIC0gMV0ueCwgYltjIC0gMV0ueSwgYltjXS54LCBiW2NdLnksIHRoaXMuZGFzaGVkUGF0dGVybik7XHJcbiAgICAgICAgICAgICAgICBpZiAoYS5zdHJva2UoKSwgYS5jbG9zZVBhdGgoKSwgbnVsbCAhPSB0aGlzLmFycm93c1JhZGl1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gYltiLmxlbmd0aCAtIDJdLCBlID0gYltiLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFpbnRBcnJvdyhhLCBkLCBlKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLnBhaW50TG9vcCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBhLmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5idW5kbGVHYXAgKiAodGhpcy5ub2RlSW5kZXggKyAxKSAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5QSSArIE1hdGguUEkgLyAyXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhLmFyYyh0aGlzLm5vZGVBLngsIHRoaXMubm9kZUEueSwgYiwgTWF0aC5QSSAvIDIsIDIgKiBNYXRoLlBJKSwgYS5zdHJva2UoKSwgYS5jbG9zZVBhdGgoKVxyXG4gICAgICAgICAgICB9LCB0aGlzLnBhaW50QXJyb3cgPSBmdW5jdGlvbiAoYiwgYywgZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmFycm93c09mZnNldCwgZiA9IHRoaXMuYXJyb3dzUmFkaXVzIC8gMiwgZyA9IGMsIGggPSBkLCBpID0gTWF0aC5hdGFuMihoLnkgLSBnLnksIGgueCAtIGcueCksIGogPSBqdG9wby51dGlsLmdldERpc3RhbmNlKGcsIGgpIC0gdGhpcy5hcnJvd3NSYWRpdXMsIGsgPSBnLnggKyAoaiArIGUpICogTWF0aC5jb3MoaSksIGwgPSBnLnkgKyAoaiArIGUpICogTWF0aC5zaW4oaSksIG0gPSBoLnggKyBlICogTWF0aC5jb3MoaSksIG4gPSBoLnkgKyBlICogTWF0aC5zaW4oaSk7XHJcbiAgICAgICAgICAgICAgICBpIC09IE1hdGguUEkgLyAyO1xyXG4gICAgICAgICAgICAgICAgdmFyIG8gPSB7eDogayArIGYgKiBNYXRoLmNvcyhpKSwgeTogbCArIGYgKiBNYXRoLnNpbihpKX0sIHAgPSB7eDogayArIGYgKiBNYXRoLmNvcyhpIC0gTWF0aC5QSSksIHk6IGwgKyBmICogTWF0aC5zaW4oaSAtIE1hdGguUEkpfTtcclxuICAgICAgICAgICAgICAgIGIuYmVnaW5QYXRoKCksIGIuZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5zdHJva2VDb2xvciArIFwiLFwiICsgdGhpcy5hbHBoYSArIFwiKVwiLCBiLm1vdmVUbyhvLngsIG8ueSksIGIubGluZVRvKG0sIG4pLCBiLmxpbmVUbyhwLngsIHAueSksIGIuc3Ryb2tlKCksIGIuY2xvc2VQYXRoKClcclxuICAgICAgICAgICAgfSwgdGhpcy5wYWludCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSB0aGlzLm5vZGVBICYmIG51bGwgIT0gIXRoaXMubm9kZVopIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuZ2V0UGF0aCh0aGlzLm5vZGVJbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXRoID0gYiwgYS5zdHJva2VTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuc3Ryb2tlQ29sb3IgKyBcIixcIiArIHRoaXMuYWxwaGEgKyBcIilcIiwgYS5saW5lV2lkdGggPSB0aGlzLmxpbmVXaWR0aCwgdGhpcy5wYWludFBhdGgoYSwgYiksIGIgJiYgYi5sZW5ndGggPiAwICYmIHRoaXMucGFpbnRUZXh0KGEsIGIpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZhciBpID0gLShNYXRoLlBJIC8gMiArIE1hdGguUEkgLyA0KTtcclxuICAgICAgICAgICAgdGhpcy5wYWludFRleHQgPSBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSBiWzBdLCBkID0gYltiLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgICAgICAgICAgaWYgKDQgPT0gYi5sZW5ndGggJiYgKGMgPSBiWzFdLCBkID0gYlsyXSksIHRoaXMudGV4dCAmJiB0aGlzLnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlID0gKGQueCArIGMueCkgLyAyICsgdGhpcy50ZXh0T2Zmc2V0WCwgZiA9IChkLnkgKyBjLnkpIC8gMiArIHRoaXMudGV4dE9mZnNldFk7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5zYXZlKCksIGEuYmVnaW5QYXRoKCksIGEuZm9udCA9IHRoaXMuZm9udDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEubWVhc3VyZVRleHQodGhpcy50ZXh0KS53aWR0aCwgaCA9IGEubWVhc3VyZVRleHQoXCLnlLBcIikud2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5mb250Q29sb3IgKyBcIiwgXCIgKyB0aGlzLmFscGhhICsgXCIpXCIsIHRoaXMubm9kZUEgPT09IHRoaXMubm9kZVopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGogPSB0aGlzLmJ1bmRsZUdhcCAqICh0aGlzLm5vZGVJbmRleCArIDEpIC8gMiwgZSA9IHRoaXMubm9kZUEueCArIGogKiBNYXRoLmNvcyhpKSwgZiA9IHRoaXMubm9kZUEueSArIGogKiBNYXRoLnNpbihpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYS5maWxsVGV4dCh0aGlzLnRleHQsIGUsIGYpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGEuZmlsbFRleHQodGhpcy50ZXh0LCBlIC0gZyAvIDIsIGYgLSBoIC8gMik7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5zdHJva2UoKSwgYS5jbG9zZVBhdGgoKSwgYS5yZXN0b3JlKClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcy5wYWludFNlbGVjdGVkID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGEuc2hhZG93Qmx1ciA9IDEwLCBhLnNoYWRvd0NvbG9yID0gXCJyZ2JhKDAsMCwwLDEpXCIsIGEuc2hhZG93T2Zmc2V0WCA9IDAsIGEuc2hhZG93T2Zmc2V0WSA9IDBcclxuICAgICAgICAgICAgfSwgdGhpcy5pc0luQm91bmQgPSBmdW5jdGlvbiAoYiwgYykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubm9kZUEgPT09IHRoaXMubm9kZVopIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuYnVuZGxlR2FwICogKHRoaXMubm9kZUluZGV4ICsgMSkgLyAyLCBlID0ganRvcG8udXRpbC5nZXREaXN0YW5jZSh0aGlzLm5vZGVBLCB7eDogYiwgeTogY30pIC0gZDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoZSkgPD0gM1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZiA9ICExLCBnID0gMTsgZyA8IHRoaXMucGF0aC5sZW5ndGg7IGcrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBoID0gdGhpcy5wYXRoW2cgLSAxXSwgaSA9IHRoaXMucGF0aFtnXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoMSA9PSBqdG9wby51dGlsLmlzUG9pbnRJbkxpbmUoe3g6IGIsIHk6IGN9LCBoLCBpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmID0gITA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gRm9sZExpbmsoYSwgYiwgYykge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBGb2xkTGluay5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0aGlzLmRpcmVjdGlvbiA9IFwiaG9yaXpvbnRhbFwiXHJcbiAgICAgICAgICAgIH0sIHRoaXMuaW5pdGlhbGl6ZShhLCBiLCBjKSwgdGhpcy5nZXRTdGFydFBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGEgPSB7eDogdGhpcy5ub2RlQS5jeCwgeTogdGhpcy5ub2RlQS5jeX07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJob3Jpem9udGFsXCIgPT0gdGhpcy5kaXJlY3Rpb24gPyB0aGlzLm5vZGVaLmN4ID4gYS54ID8gYS54ICs9IHRoaXMubm9kZUEud2lkdGggLyAyIDogYS54IC09IHRoaXMubm9kZUEud2lkdGggLyAyIDogdGhpcy5ub2RlWi5jeSA+IGEueSA/IGEueSArPSB0aGlzLm5vZGVBLmhlaWdodCAvIDIgOiBhLnkgLT0gdGhpcy5ub2RlQS5oZWlnaHQgLyAyLCBhXHJcbiAgICAgICAgICAgIH0sIHRoaXMuZ2V0RW5kUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYSA9IHt4OiB0aGlzLm5vZGVaLmN4LCB5OiB0aGlzLm5vZGVaLmN5fTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcImhvcml6b250YWxcIiA9PSB0aGlzLmRpcmVjdGlvbiA/IHRoaXMubm9kZUEuY3kgPCBhLnkgPyBhLnkgLT0gdGhpcy5ub2RlWi5oZWlnaHQgLyAyIDogYS55ICs9IHRoaXMubm9kZVouaGVpZ2h0IC8gMiA6IGEueCA9IHRoaXMubm9kZUEuY3ggPCBhLnggPyB0aGlzLm5vZGVaLnggOiB0aGlzLm5vZGVaLnggKyB0aGlzLm5vZGVaLndpZHRoLCBhXHJcbiAgICAgICAgICAgIH0sIHRoaXMuZ2V0UGF0aCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYiA9IFtdLCBjID0gdGhpcy5nZXRTdGFydFBvc2l0aW9uKCksIGQgPSB0aGlzLmdldEVuZFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlQSA9PT0gdGhpcy5ub2RlWilyZXR1cm4gW2MsIGRdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGYsIGcsIGggPSBnZXROdW1zKHRoaXMubm9kZUEsIHRoaXMubm9kZVopLCBpID0gKGggLSAxKSAqIHRoaXMuYnVuZGxlR2FwLCBqID0gdGhpcy5idW5kbGVHYXAgKiBhIC0gaSAvIDI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJob3Jpem9udGFsXCIgPT0gdGhpcy5kaXJlY3Rpb24gPyAoZiA9IGQueCArIGosIGcgPSBjLnkgLSBqLCBiLnB1c2goe3g6IGMueCwgeTogZ30pLCBiLnB1c2goe3g6IGYsIHk6IGd9KSwgYi5wdXNoKHt4OiBmLCB5OiBkLnl9KSkgOiAoZiA9IGMueCArIGosIGcgPSBkLnkgLSBqLCBiLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IGYsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogYy55XHJcbiAgICAgICAgICAgICAgICB9KSwgYi5wdXNoKHt4OiBmLCB5OiBnfSksIGIucHVzaCh7eDogZC54LCB5OiBnfSkpLCBiXHJcbiAgICAgICAgICAgIH0sIHRoaXMucGFpbnRUZXh0ID0gZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRleHQgJiYgdGhpcy50ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGJbMV0sIGQgPSBjLnggKyB0aGlzLnRleHRPZmZzZXRYLCBlID0gYy55ICsgdGhpcy50ZXh0T2Zmc2V0WTtcclxuICAgICAgICAgICAgICAgICAgICBhLnNhdmUoKSwgYS5iZWdpblBhdGgoKSwgYS5mb250ID0gdGhpcy5mb250O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmID0gYS5tZWFzdXJlVGV4dCh0aGlzLnRleHQpLndpZHRoLCBnID0gYS5tZWFzdXJlVGV4dChcIueUsFwiKS53aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBhLmZpbGxTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZm9udENvbG9yICsgXCIsIFwiICsgdGhpcy5hbHBoYSArIFwiKVwiLCBhLmZpbGxUZXh0KHRoaXMudGV4dCwgZCAtIGYgLyAyLCBlIC0gZyAvIDIpLCBhLnN0cm9rZSgpLCBhLmNsb3NlUGF0aCgpLCBhLnJlc3RvcmUoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBGbGV4aW9uYWxMaW5rKGEsIGIsIGMpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgRmxleGlvbmFsTGluay5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0aGlzLmRpcmVjdGlvbiA9IFwidmVydGljYWxcIiwgdGhpcy5vZmZzZXRHYXAgPSA0NFxyXG4gICAgICAgICAgICB9LCB0aGlzLmluaXRpYWxpemUoYSwgYiwgYyksIHRoaXMuZ2V0U3RhcnRQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhID0ge3g6IHRoaXMubm9kZUEuY3gsIHk6IHRoaXMubm9kZUEuY3l9O1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaG9yaXpvbnRhbFwiID09IHRoaXMuZGlyZWN0aW9uID8gYS54ID0gdGhpcy5ub2RlWi5jeCA8IGEueCA/IHRoaXMubm9kZUEueCA6IHRoaXMubm9kZUEueCArIHRoaXMubm9kZUEud2lkdGggOiBhLnkgPSB0aGlzLm5vZGVaLmN5IDwgYS55ID8gdGhpcy5ub2RlQS55IDogdGhpcy5ub2RlQS55ICsgdGhpcy5ub2RlQS5oZWlnaHQsIGFcclxuICAgICAgICAgICAgfSwgdGhpcy5nZXRFbmRQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhID0ge3g6IHRoaXMubm9kZVouY3gsIHk6IHRoaXMubm9kZVouY3l9O1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaG9yaXpvbnRhbFwiID09IHRoaXMuZGlyZWN0aW9uID8gYS54ID0gdGhpcy5ub2RlQS5jeCA8IGEueCA/IHRoaXMubm9kZVoueCA6IHRoaXMubm9kZVoueCArIHRoaXMubm9kZVoud2lkdGggOiBhLnkgPSB0aGlzLm5vZGVBLmN5IDwgYS55ID8gdGhpcy5ub2RlWi55IDogdGhpcy5ub2RlWi55ICsgdGhpcy5ub2RlWi5oZWlnaHQsIGFcclxuICAgICAgICAgICAgfSwgdGhpcy5nZXRQYXRoID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5nZXRTdGFydFBvc2l0aW9uKCksIGMgPSB0aGlzLmdldEVuZFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlQSA9PT0gdGhpcy5ub2RlWilyZXR1cm4gW2IsIGNdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGQgPSBbXSwgZiA9IGdldE51bXModGhpcy5ub2RlQSwgdGhpcy5ub2RlWiksIGcgPSAoZiAtIDEpICogdGhpcy5idW5kbGVHYXAsIGggPSB0aGlzLmJ1bmRsZUdhcCAqIGEgLSBnIC8gMiwgaSA9IHRoaXMub2Zmc2V0R2FwO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaG9yaXpvbnRhbFwiID09IHRoaXMuZGlyZWN0aW9uID8gKHRoaXMubm9kZUEuY3ggPiB0aGlzLm5vZGVaLmN4ICYmIChpID0gLWkpLCBkLnB1c2goe3g6IGIueCwgeTogYi55ICsgaH0pLCBkLnB1c2goe3g6IGIueCArIGksIHk6IGIueSArIGh9KSwgZC5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB4OiBjLnggLSBpLFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IGMueSArIGhcclxuICAgICAgICAgICAgICAgIH0pLCBkLnB1c2goe3g6IGMueCwgeTogYy55ICsgaH0pKSA6ICh0aGlzLm5vZGVBLmN5ID4gdGhpcy5ub2RlWi5jeSAmJiAoaSA9IC1pKSwgZC5wdXNoKHt4OiBiLnggKyBoLCB5OiBiLnl9KSwgZC5wdXNoKHt4OiBiLnggKyBoLCB5OiBiLnkgKyBpfSksIGQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogYy54ICsgaCxcclxuICAgICAgICAgICAgICAgICAgICB5OiBjLnkgLSBpXHJcbiAgICAgICAgICAgICAgICB9KSwgZC5wdXNoKHt4OiBjLnggKyBoLCB5OiBjLnl9KSksIGRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQ3VydmVMaW5rKGEsIGIsIGMpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgQ3VydmVMaW5rLnByb3RvdHlwZS5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcclxuICAgICAgICAgICAgfSwgdGhpcy5pbml0aWFsaXplKGEsIGIsIGMpLCB0aGlzLnBhaW50UGF0aCA9IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlQSA9PT0gdGhpcy5ub2RlWilyZXR1cm4gdm9pZCB0aGlzLnBhaW50TG9vcChhKTtcclxuICAgICAgICAgICAgICAgIGEuYmVnaW5QYXRoKCksIGEubW92ZVRvKGJbMF0ueCwgYlswXS55KTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAxOyBjIDwgYi5sZW5ndGg7IGMrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gYltjIC0gMV0sIGUgPSBiW2NdLCBmID0gKGQueCArIGUueCkgLyAyLCBnID0gKGQueSArIGUueSkgLyAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGcgKz0gKGUueSAtIGQueSkgLyAyLCBhLnN0cm9rZVN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5zdHJva2VDb2xvciArIFwiLFwiICsgdGhpcy5hbHBoYSArIFwiKVwiLCBhLmxpbmVXaWR0aCA9IHRoaXMubGluZVdpZHRoLCBhLm1vdmVUbyhkLngsIGQuY3kpLCBhLnF1YWRyYXRpY0N1cnZlVG8oZiwgZywgZS54LCBlLnkpLCBhLnN0cm9rZSgpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoYS5zdHJva2UoKSwgYS5jbG9zZVBhdGgoKSwgbnVsbCAhPSB0aGlzLmFycm93c1JhZGl1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBoID0gYltiLmxlbmd0aCAtIDJdLCBpID0gYltiLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFpbnRBcnJvdyhhLCBoLCBpKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBMaW5rLnByb3RvdHlwZSA9IG5ldyBqdG9wby5JbnRlcmFjdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgRm9sZExpbmsucHJvdG90eXBlID0gbmV3IExpbms7XHJcbiAgICAgICAgRmxleGlvbmFsTGluay5wcm90b3R5cGUgPSBuZXcgTGluaztcclxuICAgICAgICBDdXJ2ZUxpbmsucHJvdG90eXBlID0gbmV3IExpbms7XHJcbiAgICAgICAganRvcG8uTGluayA9IExpbms7XHJcbiAgICAgICAganRvcG8uRm9sZExpbmsgPSBGb2xkTGluaztcclxuICAgICAgICBqdG9wby5GbGV4aW9uYWxMaW5rID0gRmxleGlvbmFsTGluaztcclxuICAgICAgICBqdG9wby5DdXJ2ZUxpbmsgPSBDdXJ2ZUxpbms7XHJcbiAgICB9KEpUb3BvKSxcclxuICAgIGZ1bmN0aW9uIChqdG9wbykge1xyXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRhaW5lcihjKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChjKSB7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcywgbnVsbCksXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50VHlwZSA9IFwiY29udGFpbmVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy56SW5kZXggPSBqdG9wby56SW5kZXhfQ29udGFpbmVyLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMud2lkdGggPSAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGlsZHMgPSBbXSxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFscGhhID0gLjUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnYWJsZSA9ICEwLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hpbGREcmFnYmxlID0gITAsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gITAsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxsQ29sb3IgPSBcIjEwLDEwMCw4MFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm9yZGVyV2lkdGggPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm9yZGVyQ29sb3IgPSBcIjI1NSwyNTUsMjU1XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3JkZXJSYWRpdXMgPSBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9udCA9IFwiMTJweCBDb25zb2xhc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9udENvbG9yID0gXCIyNTUsMjU1LDI1NVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IGMsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0UG9zaXRpb24gPSBcIkJvdHRvbV9DZW50ZXJcIixcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRPZmZzZXRYID0gMCxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRPZmZzZXRZID0gMCxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxheW91dCA9IG5ldyBqdG9wby5sYXlvdXQuQXV0b0JvdW5kTGF5b3V0XHJcbiAgICAgICAgICAgIH0sIHRoaXMuaW5pdGlhbGl6ZShjKSwgdGhpcy5hZGQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHMucHVzaChhKSwgYS5kcmFnYWJsZSA9IHRoaXMuY2hpbGREcmFnYmxlXHJcbiAgICAgICAgICAgIH0sIHRoaXMucmVtb3ZlID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgdGhpcy5jaGlsZHMubGVuZ3RoOyBiKyspaWYgKHRoaXMuY2hpbGRzW2JdID09PSBhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5wYXJlbnRDb250YWluZXIgPSBudWxsLCB0aGlzLmNoaWxkcyA9IHRoaXMuY2hpbGRzLmRlbChiKSwgYS5sYXN0UGFyZW50Q29udGFpbmVyID0gdGhpcztcclxuICAgICAgICAgICAgICAgICAgICBicmVha1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLnJlbW92ZUFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRzID0gW11cclxuICAgICAgICAgICAgfSwgdGhpcy5zZXRMb2NhdGlvbiA9IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IGEgLSB0aGlzLngsIGQgPSBiIC0gdGhpcy55O1xyXG4gICAgICAgICAgICAgICAgdGhpcy54ID0gYSwgdGhpcy55ID0gYjtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnF0b3BvICYmIHRoaXMucXRvcG8uYXR0ciAmJiB0aGlzLnF0b3BvLmF0dHIucG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnF0b3BvLmF0dHIucG9zaXRpb25bMF0gPSBhO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXRvcG8uYXR0ci5wb3NpdGlvblsxXSA9IGI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IHRoaXMuY2hpbGRzLmxlbmd0aDsgZSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0aGlzLmNoaWxkc1tlXTtcclxuICAgICAgICAgICAgICAgICAgICBmLnNldExvY2F0aW9uKGYueCArIGMsIGYueSArIGQpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMuZG9MYXlvdXQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgYSAmJiBhKHRoaXMsIHRoaXMuY2hpbGRzKVxyXG4gICAgICAgICAgICB9LCB0aGlzLnBhaW50ID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXlvdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXlvdXQodGhpcywgdGhpcy5jaGlsZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBhLmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5maWxsQ29sb3IgKyBcIixcIiArIHRoaXMuYWxwaGEgKyBcIilcIjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSB0aGlzLmJvcmRlclJhZGl1cyB8fCAwID09IHRoaXMuYm9yZGVyUmFkaXVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGEucmVjdCh0aGlzLngsIHRoaXMueSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGEuSlRvcG9Sb3VuZFJlY3QodGhpcy54LCB0aGlzLnksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLmJvcmRlclJhZGl1cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGEuZmlsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuY2xvc2VQYXRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWludFRleHQoYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWludEJvcmRlcihhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcy5wYWludEJvcmRlciA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoMCAhPSB0aGlzLmJvcmRlcldpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5iZWdpblBhdGgoKSwgYS5saW5lV2lkdGggPSB0aGlzLmJvcmRlcldpZHRoLCBhLnN0cm9rZVN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5ib3JkZXJDb2xvciArIFwiLFwiICsgdGhpcy5hbHBoYSArIFwiKVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5ib3JkZXJXaWR0aCAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgbnVsbCA9PSB0aGlzLmJvcmRlclJhZGl1cyB8fCAwID09IHRoaXMuYm9yZGVyUmFkaXVzID8gYS5yZWN0KHRoaXMueCAtIGIsIHRoaXMueSAtIGIsIHRoaXMud2lkdGggKyB0aGlzLmJvcmRlcldpZHRoLCB0aGlzLmhlaWdodCArIHRoaXMuYm9yZGVyV2lkdGgpIDogYS5KVG9wb1JvdW5kUmVjdCh0aGlzLnggLSBiLCB0aGlzLnkgLSBiLCB0aGlzLndpZHRoICsgdGhpcy5ib3JkZXJXaWR0aCwgdGhpcy5oZWlnaHQgKyB0aGlzLmJvcmRlcldpZHRoLCB0aGlzLmJvcmRlclJhZGl1cyksIGEuc3Ryb2tlKCksIGEuY2xvc2VQYXRoKClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcy5wYWludFRleHQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnRleHQ7XHJcbiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBiICYmIFwiXCIgIT0gYikge1xyXG4gICAgICAgICAgICAgICAgICAgIGEuYmVnaW5QYXRoKCksIGEuZm9udCA9IHRoaXMuZm9udDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEubWVhc3VyZVRleHQoYikud2lkdGgsIGQgPSBhLm1lYXN1cmVUZXh0KFwi55SwXCIpLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5mb250Q29sb3IgKyBcIiwgXCIgKyB0aGlzLmFscGhhICsgXCIpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmdldFRleHRQb3N0aW9uKHRoaXMudGV4dFBvc2l0aW9uLCBjLCBkKTtcclxuICAgICAgICAgICAgICAgICAgICBhLmZpbGxUZXh0KGIsIGUueCwgZS55KSwgYS5jbG9zZVBhdGgoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLmdldFRleHRQb3N0aW9uID0gZnVuY3Rpb24gKHRleHRQb3NpdGlvbiwgbWF4V2lkdGgsIGZvbnRXaWR0aCwgaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSB0ZXh0UG9zaXRpb24gfHwgXCJCb3R0b21fQ2VudGVyXCIgPT0gdGV4dFBvc2l0aW9uID8gZCA9IHtcclxuICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoIC8gMiAtIG1heFdpZHRoIC8gMixcclxuICAgICAgICAgICAgICAgICAgICB5OiB0aGlzLnkgKyB0aGlzLmhlaWdodCArIGZvbnRXaWR0aFxyXG4gICAgICAgICAgICAgICAgfSA6IFwiVG9wX0NlbnRlclwiID09IHRleHRQb3NpdGlvbiA/IGQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy54ICsgdGhpcy53aWR0aCAvIDIgLSBtYXhXaWR0aCAvIDIsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogdGhpcy55IC0gZm9udFdpZHRoIC8gMiAtIGZvbnRXaWR0aCAqIChoZWlnaHQgLSAxKVxyXG4gICAgICAgICAgICAgICAgfSA6IFwiVG9wX1JpZ2h0XCIgPT0gdGV4dFBvc2l0aW9uID8gZCA9IHt4OiB0aGlzLnggKyB0aGlzLndpZHRoIC0gbWF4V2lkdGgsIHk6IHRoaXMueSAtIGZvbnRXaWR0aCAvIDJ9IDogXCJUb3BfTGVmdFwiID09IHRleHRQb3NpdGlvbiA/IGQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy54LFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IHRoaXMueSAtIGZvbnRXaWR0aCAvIDJcclxuICAgICAgICAgICAgICAgIH0gOiBcIkJvdHRvbV9SaWdodFwiID09IHRleHRQb3NpdGlvbiA/IGQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy54ICsgdGhpcy53aWR0aCAtIG1heFdpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IHRoaXMueSArIHRoaXMuaGVpZ2h0ICsgZm9udFdpZHRoXHJcbiAgICAgICAgICAgICAgICB9IDogXCJCb3R0b21fTGVmdFwiID09IHRleHRQb3NpdGlvbiA/IGQgPSB7eDogdGhpcy54LCB5OiB0aGlzLnkgKyB0aGlzLmhlaWdodCArIGZvbnRXaWR0aH0gOiBcIk1pZGRsZV9DZW50ZXJcIiA9PSB0ZXh0UG9zaXRpb24gPyBkID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IHRoaXMueCArIHRoaXMud2lkdGggLyAyIC0gbWF4V2lkdGggLyAyLFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IHRoaXMueSArIHRoaXMuaGVpZ2h0IC8gMiArIGZvbnRXaWR0aCAvIDJcclxuICAgICAgICAgICAgICAgIH0gOiBcIk1pZGRsZV9SaWdodFwiID09IHRleHRQb3NpdGlvbiA/IGQgPSB7eDogdGhpcy54ICsgdGhpcy53aWR0aCAtIG1heFdpZHRoLCB5OiB0aGlzLnkgKyB0aGlzLmhlaWdodCAvIDIgKyBmb250V2lkdGggLyAyfSA6IFwiTWlkZGxlX0xlZnRcIiA9PSB0ZXh0UG9zaXRpb24gJiYgKGQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy54LFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IHRoaXMueSArIHRoaXMuaGVpZ2h0IC8gMiArIGZvbnRXaWR0aCAvIDJcclxuICAgICAgICAgICAgICAgIH0pLCBudWxsICE9IHRoaXMudGV4dE9mZnNldFggJiYgKGQueCArPSB0aGlzLnRleHRPZmZzZXRYKSwgbnVsbCAhPSB0aGlzLnRleHRPZmZzZXRZICYmIChkLnkgKz0gdGhpcy50ZXh0T2Zmc2V0WSksIGRcclxuICAgICAgICAgICAgfSwgdGhpcy5wYWludE1vdXNlb3ZlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgfSwgdGhpcy5wYWludFNlbGVjdGVkID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIGEuc2hhZG93Qmx1ciA9IDEwLCBhLnNoYWRvd0NvbG9yID0gXCJyZ2JhKDAsMCwwLDEpXCIsIGEuc2hhZG93T2Zmc2V0WCA9IDAsIGEuc2hhZG93T2Zmc2V0WSA9IDBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29udGFpbmVyLnByb3RvdHlwZSA9IG5ldyBqdG9wby5JbnRlcmFjdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAganRvcG8uQ29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgfShKVG9wbyksXHJcbiAgICBmdW5jdGlvbiAoanRvcG8pIHtcclxuICAgICAgICBmdW5jdGlvbiBnZXROb2Rlc0NlbnRlcihhKSB7XHJcbiAgICAgICAgICAgIHZhciBiID0gMCwgYyA9IDA7XHJcbiAgICAgICAgICAgIGEuZm9yRWFjaChmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgYiArPSBhLmN4LCBjICs9IGEuY3lcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZhciBkID0ge3g6IGIgLyBhLmxlbmd0aCwgeTogYyAvIGEubGVuZ3RofTtcclxuICAgICAgICAgICAgcmV0dXJuIGRcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNpcmNsZUxheW91dE5vZGVzKG5vZGVBcnJheSwgYW5pbWF0ZUNvbmZpZykge1xyXG4gICAgICAgICAgICBudWxsID09IGFuaW1hdGVDb25maWcgJiYgKGFuaW1hdGVDb25maWcgPSB7fSk7XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBlID0gYW5pbWF0ZUNvbmZpZy5jeCxcclxuICAgICAgICAgICAgICAgICAgICBmID0gYW5pbWF0ZUNvbmZpZy5jeSxcclxuICAgICAgICAgICAgICAgICAgICBnID0gYW5pbWF0ZUNvbmZpZy5taW5SYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgaCA9IGFuaW1hdGVDb25maWcubm9kZURpYW1ldGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIGkgPSBhbmltYXRlQ29uZmlnLmhTY2FsZSB8fCAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGogPSBhbmltYXRlQ29uZmlnLnZTY2FsZSB8fCAxO1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0ZUNvbmZpZy5iZWdpbkFuZ2xlIHx8IDAsIGFuaW1hdGVDb25maWcuZW5kQW5nbGUgfHwgMiAqIE1hdGguUElcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobnVsbCA9PSBlIHx8IG51bGwgPT0gZikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGsgPSBnZXROb2Rlc0NlbnRlcihub2RlQXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgZSA9IGsueCwgZiA9IGsueVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBsID0gMCwgbSA9IFtdLCBuID0gW107XHJcbiAgICAgICAgICAgIG5vZGVBcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7XHJcbiAgICAgICAgICAgICAgICBudWxsID09IGFuaW1hdGVDb25maWcubm9kZURpYW1ldGVyID8gKG5vZGUuZGlhbWV0ZXIgJiYgKGggPSBub2RlLmRpYW1ldGVyKSxcclxuICAgICAgICAgICAgICAgICAgICBoID0gbm9kZS5yYWRpdXMgPyAyICogbm9kZS5yYWRpdXMgOiBNYXRoLnNxcnQoMiAqIG5vZGUud2lkdGggKiBub2RlLmhlaWdodCksXHJcbiAgICAgICAgICAgICAgICAgICAgbi5wdXNoKGgpKSA6IG4ucHVzaChoKSwgbCArPSBoXHJcbiAgICAgICAgICAgIH0pLCBub2RlQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSBuW2JdIC8gbDtcclxuICAgICAgICAgICAgICAgIG0ucHVzaChNYXRoLlBJICogYylcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZhciBvID0gKG5vZGVBcnJheS5sZW5ndGgsIG1bMF0gKyBtWzFdKSwgcCA9IG5bMF0gLyAyICsgblsxXSAvIDIsIHEgPSBwIC8gMiAvIE1hdGguc2luKG8gLyAyKTtcclxuICAgICAgICAgICAgbnVsbCAhPSBnICYmIGcgPiBxICYmIChxID0gZyk7XHJcbiAgICAgICAgICAgIHZhciByID0gcSAqIGksIHMgPSBxICogaiwgdCA9IGFuaW1hdGVDb25maWcuYW5pbWF0ZTtcclxuICAgICAgICAgICAgaWYgKHQpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0aW1lID0gdC50aW1lIHx8IDFlMywgdiA9IDA7XHJcbiAgICAgICAgICAgICAgICBub2RlQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAobm9kZSwgYykge1xyXG4gICAgICAgICAgICAgICAgICAgIHYgKz0gMCA9PSBjID8gbVtjXSA6IG1bYyAtIDFdICsgbVtjXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGUgKyBNYXRoLmNvcyh2KSAqIHIsIGcgPSBmICsgTWF0aC5zaW4odikgKiBzO1xyXG4gICAgICAgICAgICAgICAgICAgIGp0b3BvLkFuaW1hdGUuc3RlcEJ5U3RlcChub2RlLCB7eDogZCAtIG5vZGUud2lkdGggLyAyLCB5OiBnIC0gbm9kZS5oZWlnaHQgLyAyfSwgdGltZSkuc3RhcnQoKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciB2ID0gMDtcclxuICAgICAgICAgICAgICAgIG5vZGVBcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdiArPSAwID09IGIgPyBtW2JdIDogbVtiIC0gMV0gKyBtW2JdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gZSArIE1hdGguY29zKHYpICogciwgZCA9IGYgKyBNYXRoLnNpbih2KSAqIHM7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5jeCA9IGMsIGEuY3kgPSBkXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB7Y3g6IGUsIGN5OiBmLCByYWRpdXM6IHIsIHJhZGl1c0E6IHIsIHJhZGl1c0I6IHN9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBHcmlkTGF5b3V0KHJvdywgY29sdW1uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGRzID0gY29udGFpbmVyLmNoaWxkcztcclxuICAgICAgICAgICAgICAgIGlmICghKGNoaWxkcy5sZW5ndGggPD0gMCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY0JvdW5kID0gY29udGFpbmVyLmdldEJvdW5kKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkTm9kZSA9IGNoaWxkc1swXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1TcGFjZSA9IChjQm91bmQud2lkdGggLSBjaGlsZE5vZGUud2lkdGgpIC8gY29sdW1uO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByb3dTcGFjZSA9IChjQm91bmQuaGVpZ2h0IC0gY2hpbGROb2RlLmhlaWdodCkgLyByb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgY2hpbGRJbmRleCA9IDAsIHJvd3NJbmRleCA9IDA7IHJvdyA+IHJvd3NJbmRleDsgcm93c0luZGV4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgY29sdW1uSW5kZXggPSAwOyBjb2x1bW4gPiBjb2x1bW5JbmRleDsgY29sdW1uSW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBjaGlsZHNbY2hpbGRJbmRleCsrXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0gY0JvdW5kLmxlZnQgKyBjb2x1bVNwYWNlIC8gMiArIGNvbHVtbkluZGV4ICogY29sdW1TcGFjZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gY0JvdW5kLnRvcCArIHJvd1NwYWNlIC8gMiArIHJvd3NJbmRleCAqIHJvd1NwYWNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5zZXRMb2NhdGlvbih4LCB5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZEluZGV4ID49IGNoaWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIEZsb3dMYXlvdXQocm93LCBjb2x1bW4pIHtcclxuICAgICAgICAgICAgaWYgKG51bGwgPT0gY29sdW1uKSB7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChudWxsID09IHJvdykge1xyXG4gICAgICAgICAgICAgICAgcm93ID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkcyA9IGNvbnRhaW5lci5jaGlsZHM7XHJcbiAgICAgICAgICAgICAgICBpZiAoIShjaGlsZHMubGVuZ3RoIDw9IDApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJvdW5kID0gY29udGFpbmVyLmdldEJvdW5kKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBib3VuZC5sZWZ0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3AgPSBib3VuZC50b3A7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGVmdCArIGNoaWxkLndpZHRoID49IGJvdW5kLnJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gYm91bmQubGVmdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcCArPSByb3cgKyBjaGlsZC5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0TG9jYXRpb24obGVmdCwgdG9wKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCArPSBjb2x1bW4gKyBjaGlsZC53aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIEF1dG9Cb3VuZExheW91dCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjb250YWluZXIsIGNoaWxkcmVuKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZWZ0ID0gMWU3LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByaWdodCA9IC0xZTcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IDFlNyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0gLTFlNyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSByaWdodCAtIGxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGJvdHRvbSAtIHRvcDtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGNoaWxkcmVuW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC54IDw9IGxlZnQgJiYgKGxlZnQgPSBjaGlsZC54KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGNoaWxkLnggKyBjaGlsZC53aWR0aCkgPj0gcmlnaHQgJiYgKHJpZ2h0ID0gY2hpbGQueCArIGNoaWxkLndpZHRoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQueSA8PSB0b3AgJiYgKHRvcCA9IGNoaWxkLnkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoY2hpbGQueSArIGNoaWxkLmhlaWdodCkgPj0gYm90dG9tICYmIChib3R0b20gPSBjaGlsZC55ICsgY2hpbGQuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSByaWdodCAtIGxlZnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGJvdHRvbSAtIHRvcDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnggPSBsZWZ0O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci55ID0gdG9wO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci53aWR0aCA9IDEwMDtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuaGVpZ2h0ID0gMTAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lci5xdG9wbykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5xdG9wby5hdHRyLnNpemVbMF0gPSBjb250YWluZXIud2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnF0b3BvLmF0dHIuc2l6ZVsxXSA9IGNvbnRhaW5lci5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOaJvuWIsOWPr+S7peS9nOS4uuagueeahOiKgueCuVxyXG4gICAgICAgICAqICovXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Um9vdE5vZGVzKGVsZW1lbnRzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50cy5maWx0ZXIoZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoZWxlbWVudCBpbnN0YW5jZW9mIGp0b3BvLk5vZGUpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgKCFlbGVtZW50LmluTGlua3MgfHwgZWxlbWVudC5pbkxpbmtzLmxlbmd0aCA9PSAwKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgIChlbGVtZW50Lm91dExpbmtzICYmIGVsZW1lbnQub3V0TGlua3MubGVuZ3RoID4gMCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0R2FwKGFycikge1xyXG4gICAgICAgICAgICB2YXIgdG90YWxXaWR0aCA9IDAsIHRvdGFsSGVpZ2h0ID0gMDtcclxuICAgICAgICAgICAgYXJyLmZvckVhY2goZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHRvdGFsV2lkdGggKz0gYS53aWR0aDtcclxuICAgICAgICAgICAgICAgIHRvdGFsSGVpZ2h0ICs9IGEuaGVpZ2h0O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiB0b3RhbFdpZHRoIC8gYXJyLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogdG90YWxIZWlnaHQgLyBhcnIubGVuZ3RoXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGkoYSwgYiwgYywgZCkge1xyXG4gICAgICAgICAgICBiLnggKz0gYywgYi55ICs9IGQ7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGUgPSBnZXRSb290Q2hpbGRzKGEsIGIpLCBmID0gMDsgZiA8IGUubGVuZ3RoOyBmKyspaShhLCBlW2ZdLCBjLCBkKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaihhLCBiKSB7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGMoYiwgZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGYgPSBnZXRSb290Q2hpbGRzKGEsIGIpO1xyXG4gICAgICAgICAgICAgICAgbnVsbCA9PSBkW2VdICYmIChkW2VdID0ge30sIGRbZV0ubm9kZXMgPSBbXSwgZFtlXS5jaGlsZHMgPSBbXSksIGRbZV0ubm9kZXMucHVzaChiKSwgZFtlXS5jaGlsZHMucHVzaChmKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGcgPSAwOyBnIDwgZi5sZW5ndGg7IGcrKyljKGZbZ10sIGUgKyAxKSwgZltnXS5wYXJlbnQgPSBiXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBkID0gW107XHJcbiAgICAgICAgICAgIHJldHVybiBjKGIsIDApLCBkXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBUcmVlTGF5b3V0KGRpcmVjdGlvbiwgZ2FwLCB0b3ApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzY2VuZSkge1xyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZihjaGlsZHMsIHJvb3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IGp0b3BvLmxheW91dC5nZXRUcmVlRGVlcChjaGlsZHMsIHJvb3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBrID0gaihjaGlsZHMsIHJvb3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsID0ga1tcIlwiICsgaF0ubm9kZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBsLmxlbmd0aDsgbSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gbFttXSwgbyA9IChtICsgMSkgKiAoZ2FwICsgMTApLCBwID0gaCAqIHRvcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJkb3duXCIgPT0gZGlyZWN0aW9uIHx8IChcInVwXCIgPT0gZGlyZWN0aW9uID8gcCA9IC1wIDogXCJsZWZ0XCIgPT0gZGlyZWN0aW9uID8gKG8gPSAtaCAqIHRvcCwgcCA9IChtICsgMSkgKiAoZ2FwICsgMTApKSA6IFwicmlnaHRcIiA9PSBkaXJlY3Rpb24gJiYgKG8gPSBoICogdG9wLCBwID0gKG0gKyAxKSAqIChnYXAgKyAxMCkpKSwgbi5zZXRMb2NhdGlvbihvLCBwKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBxID0gaCAtIDE7IHEgPj0gMDsgcS0tKWZvciAodmFyIHIgPSBrW1wiXCIgKyBxXS5ub2RlcywgcyA9IGtbXCJcIiArIHFdLmNoaWxkcywgbSA9IDA7IG0gPCByLmxlbmd0aDsgbSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gclttXSwgdSA9IHNbbV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcImRvd25cIiA9PSBkaXJlY3Rpb24gPyB0LnkgPSBxICogdG9wIDogXCJ1cFwiID09IGRpcmVjdGlvbiA/IHQueSA9IC1xICogdG9wIDogXCJsZWZ0XCIgPT0gZGlyZWN0aW9uID8gdC54ID0gLXEgKiB0b3AgOiBcInJpZ2h0XCIgPT0gZGlyZWN0aW9uICYmICh0LnggPSBxICogdG9wKSwgdS5sZW5ndGggPiAwID8gXCJkb3duXCIgPT0gZGlyZWN0aW9uIHx8IFwidXBcIiA9PSBkaXJlY3Rpb24gPyB0LnggPSAodVswXS54ICsgdVt1Lmxlbmd0aCAtIDFdLngpIC8gMiA6IChcImxlZnRcIiA9PSBkaXJlY3Rpb24gfHwgXCJyaWdodFwiID09IGRpcmVjdGlvbikgJiYgKHQueSA9ICh1WzBdLnkgKyB1W3UubGVuZ3RoIC0gMV0ueSkgLyAyKSA6IG0gPiAwICYmIChcImRvd25cIiA9PSBkaXJlY3Rpb24gfHwgXCJ1cFwiID09IGRpcmVjdGlvbiA/IHQueCA9IHJbbSAtIDFdLnggKyByW20gLSAxXS53aWR0aCArIGdhcCA6IChcImxlZnRcIiA9PSBkaXJlY3Rpb24gfHwgXCJyaWdodFwiID09IGRpcmVjdGlvbikgJiYgKHQueSA9IHJbbSAtIDFdLnkgKyByW20gLSAxXS5oZWlnaHQgKyBnYXApKSwgbSA+IDApaWYgKFwiZG93blwiID09IGRpcmVjdGlvbiB8fCBcInVwXCIgPT0gZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC54IDwgclttIC0gMV0ueCArIHJbbSAtIDFdLndpZHRoKWZvciAodmFyIHYgPSByW20gLSAxXS54ICsgclttIC0gMV0ud2lkdGggKyBnYXAsIHcgPSBNYXRoLmFicyh2IC0gdC54KSwgeCA9IG07IHggPCByLmxlbmd0aDsgeCsrKWkoc2NlbmUuY2hpbGRzLCByW3hdLCB3LCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChcImxlZnRcIiA9PSBkaXJlY3Rpb24gfHwgXCJyaWdodFwiID09IGRpcmVjdGlvbikgJiYgdC55IDwgclttIC0gMV0ueSArIHJbbSAtIDFdLmhlaWdodClmb3IgKHZhciB5ID0gclttIC0gMV0ueSArIHJbbSAtIDFdLmhlaWdodCArIGdhcCwgeiA9IE1hdGguYWJzKHkgLSB0LnkpLCB4ID0gbTsgeCA8IHIubGVuZ3RoOyB4KyspaShzY2VuZS5jaGlsZHMsIHJbeF0sIDAsIHopXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZWFsR2FwID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmIChudWxsID09IGdhcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlYWxHYXAgPSBnZXRHYXAoc2NlbmUuY2hpbGRzKTtcclxuICAgICAgICAgICAgICAgICAgICBnYXAgPSByZWFsR2FwLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChcImxlZnRcIiA9PSBkaXJlY3Rpb24gfHwgXCJyaWdodFwiID09IGRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnYXAgPSByZWFsR2FwLndpZHRoICsgMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gdG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gcmVhbEdhcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFsR2FwID0gZ2V0R2FwKHNjZW5lLmNoaWxkcylcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wID0gMiAqIHJlYWxHYXAuaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uIHx8IFwiZG93blwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvb3RzID0ganRvcG8ubGF5b3V0LmdldFJvb3ROb2RlcyhzY2VuZS5jaGlsZHMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvb3RzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBmKHNjZW5lLmNoaWxkcywgcm9vdHNbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBib3VuZCA9IGp0b3BvLnV0aWwuZ2V0RWxlbWVudHNCb3VuZChzY2VuZS5jaGlsZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBzY2VuZS5nZXRDZW50ZXJMb2NhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydFggPSBjZW50ZXIueCAtIChib3VuZC5sZWZ0ICsgYm91bmQucmlnaHQpIC8gMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRZID0gY2VudGVyLnkgLSAoYm91bmQudG9wICsgYm91bmQuYm90dG9tKSAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NlbmUuY2hpbGRzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBqdG9wby5Ob2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnggKz0gc3RhcnRYO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC55ICs9IHN0YXJ0WTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8v5b+F6aG75b6X5piv5pyJ5ZCR5peg546v5Zu+5omN5Y+v5Lul5biD5bGAXHJcbiAgICAgICAgZnVuY3Rpb24gQ2lyY2xlTGF5b3V0KHJhZGl1cykge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHNjZW5lKSB7XHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBsb2NhdGlvblNldChhbGxDaGlsZHMsIHJvb3QsIHJhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvb3RzQXJyID0gZ2V0Um9vdENoaWxkcyhhbGxDaGlsZHMsIHJvb3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgwICE9IHJvb3RzQXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSByYSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmEgPSByYWRpdXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSAyICogTWF0aC5QSSAvIHJvb3RzQXJyLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm9vdHNBcnIuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQsIGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnNldExvY2F0aW9uKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3QueCArIHJhICogTWF0aC5jb3Moc3RlcCAqIGkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3QueSArIHJhICogTWF0aC5zaW4oc3RlcCAqIGkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25TZXQoYWxsQ2hpbGRzLCBjaGlsZCwgcmEgLyAyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJvb3RzID0ganRvcG8ubGF5b3V0LmdldFJvb3ROb2RlcyhzY2VuZS5jaGlsZHMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvb3RzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvblNldChzY2VuZS5jaGlsZHMsIHJvb3RzWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYm91bmQgPSBqdG9wby51dGlsLmdldEVsZW1lbnRzQm91bmQoc2NlbmUuY2hpbGRzKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gc2NlbmUuZ2V0Q2VudGVyTG9jYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGVmdCA9IGNlbnRlci54IC0gKGJvdW5kLmxlZnQgKyBib3VuZC5yaWdodCkgLyAyO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3AgPSBjZW50ZXIueSAtIChib3VuZC50b3AgKyBib3VuZC5ib3R0b20pIC8gMjtcclxuICAgICAgICAgICAgICAgICAgICBzY2VuZS5jaGlsZHMuZm9yRWFjaChmdW5jdGlvbiAoYikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiBpbnN0YW5jZW9mIGp0b3BvLk5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIueCArPSBsZWZ0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYi55ICs9IHRvcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG0oYSwgYiwgYywgZCwgZSwgZikge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBnID0gW10sIGggPSAwOyBjID4gaDsgaCsrKWZvciAodmFyIGkgPSAwOyBkID4gaTsgaSsrKWcucHVzaCh7eDogYSArIGkgKiBlLCB5OiBiICsgaCAqIGZ9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGdcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNpcmNsZVBvc2l0aW9uKGNlbnRlclgsIGNlbnRlclksIHRvdGFsLCByYWlkdXMsIGJlZ2luQW5nbGUsIGVuZEFuZ2xlKSB7XHJcbiAgICAgICAgICAgIHZhciBiZWdpbiA9IGJlZ2luQW5nbGUgPyBiZWdpbkFuZ2xlIDogMDtcclxuICAgICAgICAgICAgdmFyIGVuZCA9IGVuZEFuZ2xlID8gZW5kQW5nbGUgOiAyICogTWF0aC5QSTtcclxuICAgICAgICAgICAgdmFyIHRvdGFsQW5nbGUgPSBlbmQgLSBiZWdpbjtcclxuICAgICAgICAgICAgdmFyIHN0ZXAgPSB0b3RhbEFuZ2xlIC8gdG90YWw7XHJcbiAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IFtdO1xyXG4gICAgICAgICAgICBiZWdpbiArPSBzdGVwIC8gMjtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGJlZ2luOyBlbmQgPj0gaTsgaSArPSBzdGVwKSB7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbi5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB4OiBjZW50ZXJYICsgTWF0aC5jb3MoaSkgKiByYWlkdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogY2VudGVyWSArIE1hdGguc2luKGkpICogcmFpZHVzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb25cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRyZWVQb3N0aW9uKGEsIGIsIGMsIGQsIGUsIGYpIHtcclxuICAgICAgICAgICAgdmFyIGcgPSBmIHx8IFwiYm90dG9tXCIsIGggPSBbXTtcclxuICAgICAgICAgICAgaWYgKFwiYm90dG9tXCIgPT0gZylmb3IgKHZhciBpID0gYSAtIGMgLyAyICogZCArIGQgLyAyLCBqID0gMDsgYyA+PSBqOyBqKyspaC5wdXNoKHtcclxuICAgICAgICAgICAgICAgIHg6IGkgKyBqICogZCxcclxuICAgICAgICAgICAgICAgIHk6IGIgKyBlXHJcbiAgICAgICAgICAgIH0pOyBlbHNlIGlmIChcInRvcFwiID09IGcpZm9yICh2YXIgaSA9IGEgLSBjIC8gMiAqIGQgKyBkIC8gMiwgaiA9IDA7IGMgPj0gajsgaisrKWgucHVzaCh7XHJcbiAgICAgICAgICAgICAgICB4OiBpICsgaiAqIGQsXHJcbiAgICAgICAgICAgICAgICB5OiBiIC0gZVxyXG4gICAgICAgICAgICB9KTsgZWxzZSBpZiAoXCJyaWdodFwiID09IGcpZm9yICh2YXIgaSA9IGIgLSBjIC8gMiAqIGQgKyBkIC8gMiwgaiA9IDA7IGMgPj0gajsgaisrKWgucHVzaCh7XHJcbiAgICAgICAgICAgICAgICB4OiBhICsgZSxcclxuICAgICAgICAgICAgICAgIHk6IGkgKyBqICogZFxyXG4gICAgICAgICAgICB9KTsgZWxzZSBpZiAoXCJsZWZ0XCIgPT0gZylmb3IgKHZhciBpID0gYiAtIGMgLyAyICogZCArIGQgLyAyLCBqID0gMDsgYyA+PSBqOyBqKyspaC5wdXNoKHt4OiBhIC0gZSwgeTogaSArIGogKiBkfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBoXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBncmlkUG9zaXRpb24oYSwgYiwgYywgZCwgZSwgZikge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBnID0gW10sIGggPSAwOyBjID4gaDsgaCsrKWZvciAodmFyIGkgPSAwOyBkID4gaTsgaSsrKWcucHVzaCh7eDogYSArIGkgKiBlLCB5OiBiICsgaCAqIGZ9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGdcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkanVzdFBvc2l0aW9uKHJvb3QsIHJvb3RDaGlsZHMpIHtcclxuICAgICAgICAgICAgaWYgKHJvb3QubGF5b3V0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGF5b3V0ID0gcm9vdC5sYXlvdXQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb25BcnIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChsYXlvdXQudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NpcmNsZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByYWRpdXMgPSBsYXlvdXQucmFkaXVzIHx8IE1hdGgubWF4KHJvb3Qud2lkdGgsIHJvb3QuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25BcnIgPSBjaXJjbGVQb3NpdGlvbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3QuY3gsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290LmN5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdENoaWxkcy5sZW5ndGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290LmxheW91dC5iZWdpbkFuZ2xlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdC5sYXlvdXQuZW5kQW5nbGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndHJlZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uQXJyID0gdHJlZVBvc3Rpb24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290LmN4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdC5jeSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RDaGlsZHMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0LndpZHRoIHx8IDUwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0LmhlaWdodCB8fCA1MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dC5kaXJlY3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZ3JpZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uQXJyID0gZ3JpZFBvc2l0aW9uKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdC54LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdC55LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0LnJvd3MsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXQuY29scyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dC5ob3Jpem9udGFsIHx8IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXQudmVydGljYWwgfHwgMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm9vdENoaWxkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvb3RDaGlsZHNbaV0uc2V0Q2VudGVyTG9jYXRpb24obG9jYXRpb25BcnJbaV0ueCwgbG9jYXRpb25BcnJbaV0ueSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFJvb3RDaGlsZHMoYWxsQ2hpbGRzLCByb290Tm9kZSkge1xyXG4gICAgICAgICAgICB2YXIgcm9vdENoaWxkcztcclxuICAgICAgICAgICAgaWYgKHJvb3ROb2RlLm91dExpbmtzIGluc3RhbmNlb2YgQXJyYXkgJiYgcm9vdE5vZGUub3V0TGlua3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcm9vdENoaWxkcyA9IHJvb3ROb2RlLm91dExpbmtzLm1hcChmdW5jdGlvbiAobGluaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBsaW5rLm5vZGVaO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJvb3RDaGlsZHMgfHwgW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsYXlvdXROb2RlKHNjZW5lLCByb290LCByZWN1cnNpb24pIHtcclxuICAgICAgICAgICAgdmFyIHJvb3RDaGlsZHMgPSBnZXRSb290Q2hpbGRzKHNjZW5lLmNoaWxkcywgcm9vdCk7XHJcbiAgICAgICAgICAgIGlmICgwICE9IHJvb3RDaGlsZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBhZGp1c3RQb3NpdGlvbihyb290LCByb290Q2hpbGRzKTtcclxuICAgICAgICAgICAgICAgIGlmICgxID09IHJlY3Vyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgcm9vdENoaWxkcy5sZW5ndGg7IGUrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXROb2RlKHNjZW5lLCByb290Q2hpbGRzW2VdLCByZWN1cnNpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc3ByaW5nTGF5b3V0KGIsIGMpIHtcclxuICAgICAgICAgICAgZnVuY3Rpb24gZChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IGEueCAtIGIueCwgZCA9IGEueSAtIGIueTtcclxuICAgICAgICAgICAgICAgIGkgKz0gYyAqIGYsIGogKz0gZCAqIGYsIGkgKj0gZywgaiAqPSBnLCBqICs9IGgsIGIueCArPSBpLCBiLnkgKz0galxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBlKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEoKytrID4gMTUwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgbC5sZW5ndGg7IGErKylsW2FdICE9IGIgJiYgZChiLCBsW2FdLCBsKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGUsIDFlMyAvIDI0KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgZiA9IC4wMSwgZyA9IC45NSwgaCA9IC01LCBpID0gMCwgaiA9IDAsIGsgPSAwLCBsID0gYy5nZXRFbGVtZW50c0J5Q2xhc3MoanRvcG8uTm9kZSk7XHJcbiAgICAgICAgICAgIGUoKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VHJlZURlZXAoY2hpbGRzLCByb290KSB7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlRGVlcChjaGlsZHMsIHJvb3QsIGRlZXApIHtcclxuICAgICAgICAgICAgICAgIHZhciByb290Q2hpbGRzID0gZ2V0Um9vdENoaWxkcyhjaGlsZHMsIHJvb3QpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRlZXAgPiBkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZCA9IGRlZXA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBnID0gMDsgZyA8IHJvb3RDaGlsZHMubGVuZ3RoOyBnKyspIHtcclxuICAgICAgICAgICAgICAgICAgICByZURlZXAoY2hpbGRzLCByb290Q2hpbGRzW2ddLCBkZWVwICsgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBkID0gMDtcclxuICAgICAgICAgICAgcmVEZWVwKGNoaWxkcywgcm9vdCwgMCk7XHJcbiAgICAgICAgICAgIHJldHVybiBkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAganRvcG8ubGF5b3V0ID0ganRvcG8uTGF5b3V0ID0ge1xyXG4gICAgICAgICAgICBsYXlvdXROb2RlOiBsYXlvdXROb2RlLFxyXG4gICAgICAgICAgICBnZXROb2RlQ2hpbGRzOiBnZXRSb290Q2hpbGRzLFxyXG4gICAgICAgICAgICBhZGp1c3RQb3NpdGlvbjogYWRqdXN0UG9zaXRpb24sXHJcbiAgICAgICAgICAgIHNwcmluZ0xheW91dDogc3ByaW5nTGF5b3V0LFxyXG4gICAgICAgICAgICBnZXRUcmVlRGVlcDogZ2V0VHJlZURlZXAsXHJcbiAgICAgICAgICAgIGdldFJvb3ROb2RlczogZ2V0Um9vdE5vZGVzLFxyXG4gICAgICAgICAgICBHcmlkTGF5b3V0OiBHcmlkTGF5b3V0LFxyXG4gICAgICAgICAgICBGbG93TGF5b3V0OiBGbG93TGF5b3V0LFxyXG4gICAgICAgICAgICBBdXRvQm91bmRMYXlvdXQ6IEF1dG9Cb3VuZExheW91dCxcclxuICAgICAgICAgICAgQ2lyY2xlTGF5b3V0OiBDaXJjbGVMYXlvdXQsXHJcbiAgICAgICAgICAgIFRyZWVMYXlvdXQ6IFRyZWVMYXlvdXQsXHJcbiAgICAgICAgICAgIGdldE5vZGVzQ2VudGVyOiBnZXROb2Rlc0NlbnRlcixcclxuICAgICAgICAgICAgY2lyY2xlTGF5b3V0Tm9kZXM6IGNpcmNsZUxheW91dE5vZGVzXHJcbiAgICAgICAgfVxyXG4gICAgfShKVG9wbyksXHJcbiAgICBmdW5jdGlvbiAoanRvcG8pIHtcclxuICAgICAgICBmdW5jdGlvbiBQaWVDaGFydE5vZGUoKSB7XHJcbiAgICAgICAgICAgIHZhciBiID0gbmV3IGp0b3BvLkNpcmNsZU5vZGU7XHJcbiAgICAgICAgICAgIHJldHVybiBiLnJhZGl1cyA9IDE1MCwgYi5jb2xvcnMgPSBbXCIjMzY2NkIwXCIsIFwiIzJDQThFMFwiLCBcIiM3N0QxRjZcIl0sIGIuZGF0YXMgPSBbLjMsIC4zLCAuNF0sIGIudGl0bGVzID0gW1wiQVwiLCBcIkJcIiwgXCJDXCJdLCBiLnBhaW50ID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjID0gMiAqIGIucmFkaXVzLCBkID0gMiAqIGIucmFkaXVzO1xyXG4gICAgICAgICAgICAgICAgYi53aWR0aCA9IGMsIGIuaGVpZ2h0ID0gZDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSAwLCBmID0gMDsgZiA8IHRoaXMuZGF0YXMubGVuZ3RoOyBmKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IHRoaXMuZGF0YXNbZl0gKiBNYXRoLlBJICogMjtcclxuICAgICAgICAgICAgICAgICAgICBhLnNhdmUoKSwgYS5iZWdpblBhdGgoKSwgYS5maWxsU3R5bGUgPSBiLmNvbG9yc1tmXSwgYS5tb3ZlVG8oMCwgMCksIGEuYXJjKDAsIDAsIHRoaXMucmFkaXVzLCBlLCBlICsgZywgITEpLCBhLmZpbGwoKSwgYS5jbG9zZVBhdGgoKSwgYS5yZXN0b3JlKCksIGEuYmVnaW5QYXRoKCksIGEuZm9udCA9IHRoaXMuZm9udDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IHRoaXMudGl0bGVzW2ZdICsgXCI6IFwiICsgKDEwMCAqIHRoaXMuZGF0YXNbZl0pLnRvRml4ZWQoMikgKyBcIiVcIiwgaSA9IGEubWVhc3VyZVRleHQoaCkud2lkdGgsIGogPSAoYS5tZWFzdXJlVGV4dChcIueUsFwiKS53aWR0aCwgKGUgKyBlICsgZykgLyAyKSwgayA9IHRoaXMucmFkaXVzICogTWF0aC5jb3MoaiksIGwgPSB0aGlzLnJhZGl1cyAqIE1hdGguc2luKGopO1xyXG4gICAgICAgICAgICAgICAgICAgIGogPiBNYXRoLlBJIC8gMiAmJiBqIDw9IE1hdGguUEkgPyBrIC09IGkgOiBqID4gTWF0aC5QSSAmJiBqIDwgMiAqIE1hdGguUEkgKiAzIC8gNCA/IGsgLT0gaSA6IGogPiAyICogTWF0aC5QSSAqIC43NSwgYS5maWxsU3R5bGUgPSBcIiNGRkZGRkZcIiwgYS5maWxsVGV4dChoLCBrLCBsKSwgYS5tb3ZlVG8odGhpcy5yYWRpdXMgKiBNYXRoLmNvcyhqKSwgdGhpcy5yYWRpdXMgKiBNYXRoLnNpbihqKSksIGogPiBNYXRoLlBJIC8gMiAmJiBqIDwgMiAqIE1hdGguUEkgKiAzIC8gNCAmJiAoayAtPSBpKSwgaiA+IE1hdGguUEksIGEuZmlsbCgpLCBhLnN0cm9rZSgpLCBhLmNsb3NlUGF0aCgpLCBlICs9IGdcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgYlxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQmFyQ2hhcnROb2RlKCkge1xyXG4gICAgICAgICAgICB2YXIgYiA9IG5ldyBqdG9wby5Ob2RlO1xyXG4gICAgICAgICAgICByZXR1cm4gYi5zaG93U2VsZWN0ZWQgPSAhMSwgYi53aWR0aCA9IDI1MCwgYi5oZWlnaHQgPSAxODAsIGIuY29sb3JzID0gW1wiIzM2NjZCMFwiLCBcIiMyQ0E4RTBcIiwgXCIjNzdEMUY2XCJdLCBiLmRhdGFzID0gWy4zLCAuMywgLjRdLCBiLnRpdGxlcyA9IFtcIkFcIiwgXCJCXCIsIFwiQ1wiXSwgYi5wYWludCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IDMsIGQgPSAodGhpcy53aWR0aCAtIGMpIC8gdGhpcy5kYXRhcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBhLnNhdmUoKSwgYS5iZWdpblBhdGgoKSwgYS5maWxsU3R5bGUgPSBcIiNGRkZGRkZcIiwgYS5zdHJva2VTdHlsZSA9IFwiI0ZGRkZGRlwiLCBhLm1vdmVUbygtdGhpcy53aWR0aCAvIDIgLSAxLCAtdGhpcy5oZWlnaHQgLyAyKSwgYS5saW5lVG8oLXRoaXMud2lkdGggLyAyIC0gMSwgdGhpcy5oZWlnaHQgLyAyICsgMyksIGEubGluZVRvKHRoaXMud2lkdGggLyAyICsgYyArIDEsIHRoaXMuaGVpZ2h0IC8gMiArIDMpLCBhLnN0cm9rZSgpLCBhLmNsb3NlUGF0aCgpLCBhLnJlc3RvcmUoKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdGhpcy5kYXRhcy5sZW5ndGg7IGUrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGEuc2F2ZSgpLCBhLmJlZ2luUGF0aCgpLCBhLmZpbGxTdHlsZSA9IGIuY29sb3JzW2VdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmID0gdGhpcy5kYXRhc1tlXSwgZyA9IGUgKiAoZCArIGMpIC0gdGhpcy53aWR0aCAvIDIsIGggPSB0aGlzLmhlaWdodCAtIGYgLSB0aGlzLmhlaWdodCAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5maWxsUmVjdChnLCBoLCBkLCBmKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IFwiXCIgKyBwYXJzZUludCh0aGlzLmRhdGFzW2VdKSwgaiA9IGEubWVhc3VyZVRleHQoaSkud2lkdGgsIGsgPSBhLm1lYXN1cmVUZXh0KFwi55SwXCIpLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuZmlsbFN0eWxlID0gXCIjRkZGRkZGXCIsIGEuZmlsbFRleHQoaSwgZyArIChkIC0gaikgLyAyLCBoIC0gayksIGEuZmlsbFRleHQodGhpcy50aXRsZXNbZV0sIGcgKyAoZCAtIGopIC8gMiwgdGhpcy5oZWlnaHQgLyAyICsgayksIGEuZmlsbCgpLCBhLmNsb3NlUGF0aCgpLCBhLnJlc3RvcmUoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBiXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBqdG9wby5CYXJDaGFydE5vZGUgPSBCYXJDaGFydE5vZGU7XHJcbiAgICAgICAganRvcG8uUGllQ2hhcnROb2RlID0gUGllQ2hhcnROb2RlO1xyXG4gICAgfShKVG9wbyksXHJcbiAgICBmdW5jdGlvbiAoanRvcG8pIHtcclxuICAgICAgICBmdW5jdGlvbiBiKGIsIGMpIHtcclxuICAgICAgICAgICAgdmFyIGQsIGUgPSBudWxsO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gKHdpbmRvdy5jbGVhckludGVydmFsKGQpLCBlICYmIGUucHVibGlzaChcInN0b3BcIiksIHRoaXMpIDogdGhpc1xyXG4gICAgICAgICAgICAgICAgfSwgc3RhcnQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGIuY2FsbChhKVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGMpLCB0aGlzXHJcbiAgICAgICAgICAgICAgICB9LCBvblN0b3A6IGZ1bmN0aW9uIChiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0gZSAmJiAoZSA9IG5ldyBqdG9wby51dGlsLk1lc3NhZ2VCdXMpLCBlLnN1YnNjcmliZShcInN0b3BcIiwgYiksIHRoaXNcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZWZfZ3Jhdml0eShhLCBjKSB7XHJcbiAgICAgICAgICAgIGMgPSBjIHx8IHt9O1xyXG4gICAgICAgICAgICB2YXIgZCA9IGMuZ3Jhdml0eSB8fCAuMSwgZSA9IGMuZHggfHwgMCwgZiA9IGMuZHkgfHwgNSwgZyA9IGMuc3RvcCwgaCA9IGMuaW50ZXJ2YWwgfHwgMzAsIGkgPSBuZXcgYihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBnICYmIGcoKSA/IChmID0gLjUsIHRoaXMuc3RvcCgpKSA6IChmICs9IGQsIGEuc2V0TG9jYXRpb24oYS54ICsgZSwgYS55ICsgZikpXHJcbiAgICAgICAgICAgIH0sIGgpO1xyXG4gICAgICAgICAgICByZXR1cm4gaVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYW5fc3RlcEJ5U3RlcCh0YXJnZXQsIGF0dHIsIHRpbWUsIGUsIGYpIHtcclxuICAgICAgICAgICAgdmFyIGcgPSAxZTMgLyAyNCwgaCA9IHt9O1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBqID0gYXR0cltpXSwgayA9IGogLSB0YXJnZXRbaV07XHJcbiAgICAgICAgICAgICAgICBoW2ldID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlOiB0YXJnZXRbaV0sIHRhcmdldFZhbHVlOiBqLCBzdGVwOiBrIC8gdGltZSAqIGcsIGlzRG9uZTogZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLnN0ZXAgPiAwICYmIHRhcmdldFtiXSA+PSB0aGlzLnRhcmdldFZhbHVlIHx8IHRoaXMuc3RlcCA8IDAgJiYgdGFyZ2V0W2JdIDw9IHRoaXMudGFyZ2V0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBsID0gbmV3IGIoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSAhMDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGQgaW4gYXR0ciloW2RdLmlzRG9uZShkKSB8fCAodGFyZ2V0W2RdICs9IGhbZF0uc3RlcCwgYiA9ICExKTtcclxuICAgICAgICAgICAgICAgIGlmIChiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlKXJldHVybiB0aGlzLnN0b3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBkIGluIGF0dHIpaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBoW2RdLnRhcmdldFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoW2RdLnRhcmdldFZhbHVlID0gaFtkXS5vbGRWYWx1ZSwgaFtkXS5vbGRWYWx1ZSA9IGcsIGhbZF0uc3RlcCA9IC1oW2RdLnN0ZXBcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGFyZ2V0W2RdID0gaFtkXS5vbGRWYWx1ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNcclxuICAgICAgICAgICAgfSwgZyk7XHJcbiAgICAgICAgICAgIHJldHVybiBsXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBlZl9zcHJpbmcoYSkge1xyXG4gICAgICAgICAgICBudWxsID09IGEgJiYgKGEgPSB7fSk7XHJcbiAgICAgICAgICAgIHZhciBiID0gYS5zcHJpbmcgfHwgLjEsIGMgPSBhLmZyaWN0aW9uIHx8IC44LCBkID0gYS5ncml2aXR5IHx8IDAsIGUgPSAoYS53aW5kIHx8IDAsIGEubWluTGVuZ3RoIHx8IDApO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaXRlbXM6IFtdLCB0aW1lcjogbnVsbCwgaXNQYXVzZTogITEsIGFkZE5vZGU6IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB7bm9kZTogYSwgdGFyZ2V0OiBiLCB2eDogMCwgdnk6IDB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLml0ZW1zLnB1c2goYyksIHRoaXNcclxuICAgICAgICAgICAgICAgIH0sIHBsYXk6IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wKCksIGEgPSBudWxsID09IGEgPyAxZTMgLyAyNCA6IGE7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGIubmV4dEZyYW1lKClcclxuICAgICAgICAgICAgICAgICAgICB9LCBhKVxyXG4gICAgICAgICAgICAgICAgfSwgc3RvcDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG51bGwgIT0gdGhpcy50aW1lciAmJiB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKVxyXG4gICAgICAgICAgICAgICAgfSwgbmV4dEZyYW1lOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLml0ZW1zLmxlbmd0aDsgYSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gdGhpcy5pdGVtc1thXSwgZyA9IGYubm9kZSwgaCA9IGYudGFyZ2V0LCBpID0gZi52eCwgaiA9IGYudnksIGsgPSBoLnggLSBnLngsIGwgPSBoLnkgLSBnLnksIG0gPSBNYXRoLmF0YW4yKGwsIGspO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCAhPSBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGgueCAtIE1hdGguY29zKG0pICogZSwgbyA9IGgueSAtIE1hdGguc2luKG0pICogZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gKG4gLSBnLngpICogYiwgaiArPSAobyAtIGcueSkgKiBiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpICs9IGsgKiBiLCBqICs9IGwgKiBiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpICo9IGMsIGogKj0gYywgaiArPSBkLCBnLnggKz0gaSwgZy55ICs9IGosIGYudnggPSBpLCBmLnZ5ID0galxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYW5fcm90YXRlKGEsIGIpIHtcclxuICAgICAgICAgICAgZnVuY3Rpb24gYygpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvID8gdm9pZCBmLnN0b3AoKSA6IChhLnJvdGF0ZSArPSBnIHx8IC4yLCB2b2lkKGEucm90YXRlID4gMiAqIE1hdGguUEkgJiYgKGEucm90YXRlID0gMCkpKVxyXG4gICAgICAgICAgICAgICAgfSwgMTAwKSwgZlxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBkKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5jbGVhckludGVydmFsKGUpLCBmLm9uU3RvcCAmJiBmLm9uU3RvcChhKSwgZlxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgZSA9IChiLmNvbnRleHQsIG51bGwpLCBmID0ge30sIGcgPSBiLnY7XHJcbiAgICAgICAgICAgIHJldHVybiBmLnJ1biA9IGMsIGYuc3RvcCA9IGQsIGYub25TdG9wID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmLm9uU3RvcCA9IGEsIGZcclxuICAgICAgICAgICAgfSwgZlxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYW5fZ3Jhdml0eShhLCBiKSB7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGMoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93LmNsZWFySW50ZXJ2YWwoZyksIGgub25TdG9wICYmIGgub25TdG9wKGEpLCBoXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGQoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGIuZHggfHwgMCwgaSA9IGIuZHkgfHwgMjtcclxuICAgICAgICAgICAgICAgIHJldHVybiBnID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvID8gdm9pZCBoLnN0b3AoKSA6IChpICs9IGYsIHZvaWQoYS55ICsgYS5oZWlnaHQgPCBlLnN0YWdlLmNhbnZhcy5oZWlnaHQgPyBhLnNldExvY2F0aW9uKGEueCArIGQsIGEueSArIGkpIDogKGkgPSAwLCBjKCkpKSlcclxuICAgICAgICAgICAgICAgIH0sIDIwKSwgaFxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgZSA9IGIuY29udGV4dCwgZiA9IGIuZ3Jhdml0eSB8fCAuMSwgZyA9IG51bGwsIGggPSB7fTtcclxuICAgICAgICAgICAgcmV0dXJuIGgucnVuID0gZCwgaC5zdG9wID0gYywgaC5vblN0b3AgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGgub25TdG9wID0gYSwgaFxyXG4gICAgICAgICAgICB9LCBoXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhbl9kaXZpZGVkVHdvUGllY2UoYiwgYykge1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBkKGMsIGQsIGUsIGYsIGcpIHtcclxuICAgICAgICAgICAgICAgIHZhciBoID0gbmV3IGp0b3BvLk5vZGU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaC5zZXRJbWFnZShiLmltYWdlKSwgaC5zZXRTaXplKGIud2lkdGgsIGIuaGVpZ2h0KSwgaC5zZXRMb2NhdGlvbihjLCBkKSwgaC5zaG93U2VsZWN0ZWQgPSAhMSwgaC5kcmFnYWJsZSA9ICExLCBoLnBhaW50ID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhLnNhdmUoKSwgYS5hcmMoMCwgMCwgZSwgZiwgZyksIGEuY2xpcCgpLCBhLmJlZ2luUGF0aCgpLCBudWxsICE9IHRoaXMuaW1hZ2UgPyBhLmRyYXdJbWFnZSh0aGlzLmltYWdlLCAtdGhpcy53aWR0aCAvIDIsIC10aGlzLmhlaWdodCAvIDIpIDogKGEuZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5zdHlsZS5maWxsU3R5bGUgKyBcIixcIiArIHRoaXMuYWxwaGEgKyBcIilcIiwgYS5yZWN0KC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMiwgdGhpcy53aWR0aCAvIDIsIHRoaXMuaGVpZ2h0IC8gMiksIGEuZmlsbCgpKSwgYS5jbG9zZVBhdGgoKSwgYS5yZXN0b3JlKClcclxuICAgICAgICAgICAgICAgIH0sIGhcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZShjLCBlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZiA9IGMsIGcgPSBjICsgTWF0aC5QSSwgaCA9IGQoYi54LCBiLnksIGIud2lkdGgsIGYsIGcpLCBqID0gZChiLnggLSAyICsgNCAqIE1hdGgucmFuZG9tKCksIGIueSwgYi53aWR0aCwgZiArIE1hdGguUEksIGYpO1xyXG4gICAgICAgICAgICAgICAgYi52aXNpYmxlID0gITEsIGUuYWRkKGgpLCBlLmFkZChqKSwganRvcG8uQW5pbWF0ZS5ncmF2aXR5KGgsIHtjb250ZXh0OiBlLCBkeDogLjN9KS5ydW4oKS5vblN0b3AoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlKGgpLCBlLnJlbW92ZShqKSwgaS5zdG9wKClcclxuICAgICAgICAgICAgICAgIH0pLCBqdG9wby5BbmltYXRlLmdyYXZpdHkoaiwge2NvbnRleHQ6IGUsIGR4OiAtLjJ9KS5ydW4oKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBmKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGUoYy5hbmdsZSwgaCksIGlcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZygpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpLm9uU3RvcCAmJiBpLm9uU3RvcChiKSwgaVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgaCA9IGMuY29udGV4dCwgaSA9IChiLnN0eWxlLCB7fSk7XHJcbiAgICAgICAgICAgIHJldHVybiBpLm9uU3RvcCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaS5vblN0b3AgPSBhLCBpXHJcbiAgICAgICAgICAgIH0sIGkucnVuID0gZiwgaS5zdG9wID0gZywgaVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYW5fcmVwZWF0VGhyb3coYSwgYikge1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBjKGEpIHtcclxuICAgICAgICAgICAgICAgIGEudmlzaWJsZSA9ICEwLCBhLnJvdGF0ZSA9IE1hdGgucmFuZG9tKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgYiA9IGcuc3RhZ2UuY2FudmFzLndpZHRoIC8gMjtcclxuICAgICAgICAgICAgICAgIGEueCA9IGIgKyBNYXRoLnJhbmRvbSgpICogKGIgLSAxMDApIC0gTWF0aC5yYW5kb20oKSAqIChiIC0gMTAwKSwgYS55ID0gZy5zdGFnZS5jYW52YXMuaGVpZ2h0LCBhLnZ4ID0gNSAqIE1hdGgucmFuZG9tKCkgLSA1ICogTWF0aC5yYW5kb20oKSwgYS52eSA9IC0yNVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBkKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGMoYSksIGggPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG8gPyB2b2lkIGkuc3RvcCgpIDogKGEudnkgKz0gZiwgYS54ICs9IGEudngsIGEueSArPSBhLnZ5LCB2b2lkKChhLnggPCAwIHx8IGEueCA+IGcuc3RhZ2UuY2FudmFzLndpZHRoIHx8IGEueSA+IGcuc3RhZ2UuY2FudmFzLmhlaWdodCkgJiYgKGkub25TdG9wICYmIGkub25TdG9wKGEpLCBjKGEpKSkpXHJcbiAgICAgICAgICAgICAgICB9LCA1MCksIGlcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZSgpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGgpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBmID0gLjgsIGcgPSBiLmNvbnRleHQsIGggPSBudWxsLCBpID0ge307XHJcbiAgICAgICAgICAgIHJldHVybiBpLm9uU3RvcCA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaS5vblN0b3AgPSBhLCBpXHJcbiAgICAgICAgICAgIH0sIGkucnVuID0gZCwgaS5zdG9wID0gZSwgaVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYW5fc3RvcEFsbCgpIHtcclxuICAgICAgICAgICAgbyA9ICEwXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhbl9zdGFydEFsbCgpIHtcclxuICAgICAgICAgICAgbyA9ICExXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhbl9jeWNsZShiLCBjKSB7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGQoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbiA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobylyZXR1cm4gdm9pZCBtLnN0b3AoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGYueSArIGggKyBNYXRoLnNpbihrKSAqIGo7XHJcbiAgICAgICAgICAgICAgICAgICAgYi5zZXRMb2NhdGlvbihiLngsIGEpLCBrICs9IGxcclxuICAgICAgICAgICAgICAgIH0sIDEwMCksIG1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZSgpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKG4pXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBmID0gYy5wMSwgZyA9IGMucDIsIGggPSAoYy5jb250ZXh0LCBmLnggKyAoZy54IC0gZi54KSAvIDIpLCBpID0gZi55ICsgKGcueSAtIGYueSkgLyAyLCBqID0ganRvcG8udXRpbC5nZXREaXN0YW5jZShmLCBnKSAvIDIsIGsgPSBNYXRoLmF0YW4yKGksIGgpLCBsID0gYy5zcGVlZCB8fCAuMiwgbSA9IHt9LCBuID0gbnVsbDtcclxuICAgICAgICAgICAgcmV0dXJuIG0ucnVuID0gZCwgbS5zdG9wID0gZSwgbVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYW5fbW92ZShhLCBiKSB7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGMoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobylyZXR1cm4gdm9pZCBnLnN0b3AoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGUueCAtIGEueCwgYyA9IGUueSAtIGEueSwgaCA9IGIgKiBmLCBpID0gYyAqIGY7XHJcbiAgICAgICAgICAgICAgICAgICAgYS54ICs9IGgsIGEueSArPSBpLCAuMDEgPiBoICYmIC4xID4gaSAmJiBkKClcclxuICAgICAgICAgICAgICAgIH0sIDEwMCksIGdcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZCgpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGgpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBlID0gYi5wb3NpdGlvbiwgZiA9IChiLmNvbnRleHQsIGIuZWFzaW5nIHx8IC4yKSwgZyA9IHt9LCBoID0gbnVsbDtcclxuICAgICAgICAgICAgcmV0dXJuIGcub25TdG9wID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBnLm9uU3RvcCA9IGEsIGdcclxuICAgICAgICAgICAgfSwgZy5ydW4gPSBjLCBnLnN0b3AgPSBkLCBnXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhbl9zY2FsZShhLCBiKSB7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGMoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaiA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBhLnNjYWxlWCArPSBmLCBhLnNjYWxlWSArPSBmLCBhLnNjYWxlWCA+PSBlICYmIGQoKVxyXG4gICAgICAgICAgICAgICAgfSwgMTAwKSwgaVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBkKCkge1xyXG4gICAgICAgICAgICAgICAgaS5vblN0b3AgJiYgaS5vblN0b3AoYSksIGEuc2NhbGVYID0gZywgYS5zY2FsZVkgPSBoLCB3aW5kb3cuY2xlYXJJbnRlcnZhbChqKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgZSA9IChiLnBvc2l0aW9uLCBiLmNvbnRleHQsIGIuc2NhbGUgfHwgMSksIGYgPSAuMDYsIGcgPSBhLnNjYWxlWCwgaCA9IGEuc2NhbGVZLCBpID0ge30sIGogPSBudWxsO1xyXG4gICAgICAgICAgICByZXR1cm4gaS5vblN0b3AgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGkub25TdG9wID0gYSwgaVxyXG4gICAgICAgICAgICB9LCBpLnJ1biA9IGMsIGkuc3RvcCA9IGQsIGlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGp0b3BvLkFuaW1hdGUgPSB7fSwganRvcG8uRWZmZWN0ID0ge307XHJcbiAgICAgICAgdmFyIG8gPSAhMTtcclxuICAgICAgICBqdG9wby5FZmZlY3Quc3ByaW5nID0gZWZfc3ByaW5nO1xyXG4gICAgICAgIGp0b3BvLkVmZmVjdC5ncmF2aXR5ID0gZWZfZ3Jhdml0eTtcclxuICAgICAgICBqdG9wby5BbmltYXRlLnN0ZXBCeVN0ZXAgPSBhbl9zdGVwQnlTdGVwO1xyXG4gICAgICAgIGp0b3BvLkFuaW1hdGUucm90YXRlID0gYW5fcm90YXRlO1xyXG4gICAgICAgIGp0b3BvLkFuaW1hdGUuc2NhbGUgPSBhbl9zY2FsZTtcclxuICAgICAgICBqdG9wby5BbmltYXRlLm1vdmUgPSBhbl9tb3ZlO1xyXG4gICAgICAgIGp0b3BvLkFuaW1hdGUuY3ljbGUgPSBhbl9jeWNsZTtcclxuICAgICAgICBqdG9wby5BbmltYXRlLnJlcGVhdFRocm93ID0gYW5fcmVwZWF0VGhyb3c7XHJcbiAgICAgICAganRvcG8uQW5pbWF0ZS5kaXZpZGVkVHdvUGllY2UgPSBhbl9kaXZpZGVkVHdvUGllY2U7XHJcbiAgICAgICAganRvcG8uQW5pbWF0ZS5ncmF2aXR5ID0gYW5fZ3Jhdml0eTtcclxuICAgICAgICBqdG9wby5BbmltYXRlLnN0YXJ0QWxsID0gYW5fc3RhcnRBbGw7XHJcbiAgICAgICAganRvcG8uQW5pbWF0ZS5zdG9wQWxsID0gYW5fc3RvcEFsbDtcclxuICAgIH0oSlRvcG8pLFxyXG4gICAgZnVuY3Rpb24gKGp0b3BvKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gYihhLCBiKSB7XHJcbiAgICAgICAgICAgIHZhciBjID0gW107XHJcbiAgICAgICAgICAgIGlmICgwID09IGEubGVuZ3RoKXJldHVybiBjO1xyXG4gICAgICAgICAgICB2YXIgZCA9IGIubWF0Y2goL15cXHMqKFxcdyspXFxzKiQvKTtcclxuICAgICAgICAgICAgaWYgKG51bGwgIT0gZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGUgPSBhLmZpbHRlcihmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmVsZW1lbnRUeXBlID09IGRbMV1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgbnVsbCAhPSBlICYmIGUubGVuZ3RoID4gMCAmJiAoYyA9IGMuY29uY2F0KGUpKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGYgPSAhMTtcclxuICAgICAgICAgICAgICAgIGlmIChkID0gYi5tYXRjaCgvXFxzKihcXHcrKVxccypcXFtcXHMqKFxcdyspXFxzKihbPj08XSlcXHMqWydcIl0oXFxTKylbJ1wiXVxccypcXF1cXHMqLyksIChudWxsID09IGQgfHwgZC5sZW5ndGggPCA1KSAmJiAoZCA9IGIubWF0Y2goL1xccyooXFx3KylcXHMqXFxbXFxzKihcXHcrKVxccyooWz49PF0pXFxzKihcXGQrKFxcLlxcZCspPylcXHMqXFxdXFxzKi8pLCBmID0gITApLCBudWxsICE9IGQgJiYgZC5sZW5ndGggPj0gNSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBnID0gZFsxXSwgaCA9IGRbMl0sIGkgPSBkWzNdLCBqID0gZFs0XTtcclxuICAgICAgICAgICAgICAgICAgICBlID0gYS5maWx0ZXIoZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuZWxlbWVudFR5cGUgIT0gZylyZXR1cm4gITE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYVtoXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgPT0gZiAmJiAoYiA9IHBhcnNlSW50KGIpKSwgXCI9XCIgPT0gaSA/IGIgPT0gaiA6IFwiPlwiID09IGkgPyBiID4gaiA6IFwiPFwiID09IGkgPyBqID4gYiA6IFwiPD1cIiA9PSBpID8gaiA+PSBiIDogXCI+PVwiID09IGkgPyBiID49IGogOiBcIiE9XCIgPT0gaSA/IGIgIT0gaiA6ICExXHJcbiAgICAgICAgICAgICAgICAgICAgfSksIG51bGwgIT0gZSAmJiBlLmxlbmd0aCA+IDAgJiYgKGMgPSBjLmNvbmNhdChlKSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYyhhKSB7XHJcbiAgICAgICAgICAgIGlmIChhLmZpbmQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaW5kLmNhbGwodGhpcywgYSlcclxuICAgICAgICAgICAgICAgIH0sIGUuZm9yRWFjaChmdW5jdGlvbiAoYikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFbYl0gPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IHRoaXMubGVuZ3RoOyBjKyspdGhpc1tjXVtiXShhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KSwgYS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYiA9IGFbMF07XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBjIGluIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGJbY107XHJcbiAgICAgICAgICAgICAgICAgICAgXCJmdW5jdGlvblwiID09IHR5cGVvZiBmICYmICFmdW5jdGlvbiAoYikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhW2NdID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IFtdLCBkID0gMDsgZCA8IGEubGVuZ3RoOyBkKyspYy5wdXNoKGIuYXBwbHkoYVtkXSwgYXJndW1lbnRzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfShmKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhLmF0dHIgPSBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gYSAmJiBudWxsICE9IGIpZm9yICh2YXIgYyA9IDA7IGMgPCB0aGlzLmxlbmd0aDsgYysrKXRoaXNbY11bYV0gPSBiOyBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBhICYmIFwic3RyaW5nXCIgPT0gdHlwZW9mIGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IFtdLCBjID0gMDsgYyA8IHRoaXMubGVuZ3RoOyBjKyspZC5wdXNoKHRoaXNbY11bYV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBhKWZvciAodmFyIGMgPSAwOyBjIDwgdGhpcy5sZW5ndGg7IGMrKylmb3IgKHZhciBlIGluIGEpdGhpc1tjXVtlXSA9IGFbZV1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzXHJcbiAgICAgICAgICAgIH0sIGFcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbmQoZCkge1xyXG4gICAgICAgICAgICBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgdmFyIGUgPSBbXTtcclxuICAgICAgICAgICAgdmFyIGYgPSBbXTtcclxuICAgICAgICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiBqdG9wby5TdGFnZSkge1xyXG4gICAgICAgICAgICAgICAgZSA9IHRoaXMuY2hpbGRzO1xyXG4gICAgICAgICAgICAgICAgZiA9IGYuY29uY2F0KGUpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMgaW5zdGFuY2VvZiBqdG9wby5TY2VuZSkge1xyXG4gICAgICAgICAgICAgICAgZSA9IFt0aGlzXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGYgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgZS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZiA9IGYuY29uY2F0KGEuY2hpbGRzKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGcgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoXCJmdW5jdGlvblwiID09IHR5cGVvZiBkKSB7XHJcbiAgICAgICAgICAgICAgICBmLmZpbHRlcihkKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYihmLCBkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYyhnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBlID0gXCJjbGljayxtb3VzZWRvd24sbW91c2V1cCxtb3VzZW92ZXIsbW91c2VvdXQsbW91c2VkcmFnLGtleWRvd24sa2V5dXBcIi5zcGxpdChcIixcIik7XHJcbiAgICAgICAganRvcG8uU3RhZ2UucHJvdG90eXBlLmZpbmQgPSBmaW5kO1xyXG4gICAgICAgIGp0b3BvLlNjZW5lLnByb3RvdHlwZS5maW5kID0gZmluZDtcclxuICAgIH0oSlRvcG8pLFxyXG4gICAgZnVuY3Rpb24gKHdpbikge1xyXG4gICAgICAgIGZ1bmN0aW9uIGxvZ09iamVjdChhLCBiKSB7XHJcbiAgICAgICAgICAgIHRoaXMueCA9IGE7XHJcbiAgICAgICAgICAgIHRoaXMueSA9IGI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBUb3J0b2lzZShhKSB7XHJcbiAgICAgICAgICAgIHRoaXMucCA9IG5ldyBsb2dPYmplY3QoMCwgMCk7XHJcbiAgICAgICAgICAgIHRoaXMudyA9IG5ldyBsb2dPYmplY3QoMSwgMCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnQgPSBhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hpZnQoYSwgYiwgYykge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBiID4gZTsgZSsrKWEoKSwgYyAmJiBkLnR1cm4oYyksIGQubW92ZSgzKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzcGluKGEsIGIpIHtcclxuICAgICAgICAgICAgdmFyIGMgPSAyICogTWF0aC5QSTtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBlID0gMDsgYiA+IGU7IGUrKylhKCksIGQudHVybihjIC8gYilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2NhbGUoYSwgYiwgYykge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBiID4gZTsgZSsrKWEoKSwgZC5yZXNpemUoYylcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9seWdvbihhKSB7XHJcbiAgICAgICAgICAgIHZhciBiID0gMiAqIE1hdGguUEk7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYykge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IDA7IGEgPiBkOyBkKyspYy5mb3J3YXJkKDEpLCBjLnR1cm4oYiAvIGEpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN0YXIoYSkge1xyXG4gICAgICAgICAgICB2YXIgYiA9IDQgKiBNYXRoLlBJO1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGMpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGQgPSAwOyBhID4gZDsgZCsrKWMuZm9yd2FyZCgxKSwgYy50dXJuKGIgLyBhKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzcGlyYWwoYSwgYiwgYywgZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGYgPSAwOyBiID4gZjsgZisrKWEoKSwgZS5mb3J3YXJkKDEpLCBlLnR1cm4oYyksIGUucmVzaXplKGQpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBMb2dvID0ge307XHJcbiAgICAgICAgVG9ydG9pc2UucHJvdG90eXBlLmZvcndhcmQgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICB2YXIgYiA9IHRoaXMucCwgYyA9IHRoaXMudztcclxuICAgICAgICAgICAgcmV0dXJuIGIueCA9IGIueCArIGEgKiBjLngsIGIueSA9IGIueSArIGEgKiBjLnksIHRoaXMucGFpbnQgJiYgdGhpcy5wYWludChiLngsIGIueSksIHRoaXNcclxuICAgICAgICB9O1xyXG4gICAgICAgIFRvcnRvaXNlLnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnAsIGMgPSB0aGlzLnc7XHJcbiAgICAgICAgICAgIHJldHVybiBiLnggPSBiLnggKyBhICogYy54LCBiLnkgPSBiLnkgKyBhICogYy55LCB0aGlzXHJcbiAgICAgICAgfTtcclxuICAgICAgICBUb3J0b2lzZS5wcm90b3R5cGUubW92ZVRvID0gZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucC54ID0gYSwgdGhpcy5wLnkgPSBiLCB0aGlzXHJcbiAgICAgICAgfTtcclxuICAgICAgICBUb3J0b2lzZS5wcm90b3R5cGUudHVybiA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgIHZhciBiID0gKHRoaXMucCwgdGhpcy53KTtcclxuICAgICAgICAgICAgdmFyIGMgPSBNYXRoLmNvcyhhKSAqIGIueCAtIE1hdGguc2luKGEpICogYi55O1xyXG4gICAgICAgICAgICB2YXIgZCA9IE1hdGguc2luKGEpICogYi54ICsgTWF0aC5jb3MoYSkgKiBiLnk7XHJcbiAgICAgICAgICAgIGIueCA9IGM7XHJcbiAgICAgICAgICAgIGIueSA9IGQ7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgVG9ydG9pc2UucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgICAgIHZhciBiID0gdGhpcy53O1xyXG4gICAgICAgICAgICBiLnggPSBiLnggKiBhO1xyXG4gICAgICAgICAgICBiLnkgPSBiLnkgKiBhO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9O1xyXG4gICAgICAgIFRvcnRvaXNlLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbCA9PSB0aGlzLl9zdGFjayAmJiAodGhpcy5fc3RhY2sgPSBbXSksIHRoaXMuX3N0YWNrLnB1c2goW3RoaXMucCwgdGhpcy53XSksIHRoaXNcclxuICAgICAgICB9O1xyXG4gICAgICAgIFRvcnRvaXNlLnByb3RvdHlwZS5yZXN0b3JlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAobnVsbCAhPSB0aGlzLl9zdGFjayAmJiB0aGlzLl9zdGFjay5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuX3N0YWNrLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wID0gYVswXSwgdGhpcy53ID0gYVsxXVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzXHJcbiAgICAgICAgfTtcclxuICAgICAgICBMb2dvLlRvcnRvaXNlID0gVG9ydG9pc2U7XHJcbiAgICAgICAgTG9nby5zaGlmdCA9IHNoaWZ0O1xyXG4gICAgICAgIExvZ28uc3BpbiA9IHNwaW47XHJcbiAgICAgICAgTG9nby5wb2x5Z29uID0gcG9seWdvbjtcclxuICAgICAgICBMb2dvLnNwaXJhbCA9IHNwaXJhbDtcclxuICAgICAgICBMb2dvLnN0YXIgPSBzdGFyO1xyXG4gICAgICAgIExvZ28uc2NhbGUgPSBzY2FsZTtcclxuICAgICAgICB3aW4uTG9nbyA9IExvZ287XHJcbiAgICB9KHdpbmRvdyk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9kZXZlbG9wL2NvcmUvanRvcG8vanRvcG8tbWluLmpzXG4vLyBtb2R1bGUgaWQgPSAxMFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwic291cmNlUm9vdCI6IiJ9');
},11:function(module,exports){eval('var ruler;\r\nfunction cached(fn) {\r\n    var cache = Object.create(null);\r\n    return (function cachedFn(str) {\r\n        var hit = cache[str];\r\n        return hit || (cache[str] = fn(str))\r\n    })\r\n}\r\nvar util = {\r\n        cached:cached,\r\n        /**\r\n         * 字符串转化json\r\n         * @param json\r\n         * @returns {*}\r\n         */\r\n        toJson: function (json) {\r\n            if (typeof json == \'string\') {\r\n                json = $.parseJSON(json.replace(/\'/g, \'"\'));\r\n            }\r\n            return json;\r\n        },\r\n        /**\r\n         * 首字母大写\r\n         * @param string\r\n         * @returns {XML|*|void}\r\n         */\r\n        upFirst: cached(function (str) {\r\n            return str.charAt(0).toUpperCase() + str.slice(1);\r\n        }),\r\n        extend: function (base, config) {\r\n            try {\r\n                if (typeof base == "object" && typeof config == "object") {\r\n                    deep(base, config);\r\n                }\r\n                else {\r\n                    QTopo.util.error("some extend error:", base, config);\r\n                }\r\n            } catch (e) {\r\n                QTopo.util.error("extend error", e, base, config);\r\n            }\r\n            function deep(attr, config) {\r\n                $.each(attr, function (key, value) {\r\n                    if (attr[key] && typeof attr[key] == "object" && typeof config[key] == "object") {\r\n                        if ($.isArray(attr[key]) && $.isArray(config[key])) {\r\n                            attr[key] = config[key];\r\n                        } else if ($.isFunction(attr[key]) && $.isFunction(config[key])) {\r\n                            attr[key] = config[key];\r\n                        } else {\r\n                            deep(attr[key], config[key]);\r\n                        }\r\n                    } else if (typeof attr[key] != "undefined" && typeof config[key] != "undefined") {\r\n                        attr[key] = config[key];\r\n                    }\r\n                });\r\n            }\r\n\r\n            return base;\r\n        },\r\n        /**\r\n         * 获取浏览器连接上的参数\r\n         * @param param 参数名\r\n         * @returns {*}\r\n         */\r\n        getParameter: function (param) {\r\n            var query = window.location.search;//获取URL地址中？后的所有字符\r\n            var iLen = param.length;//获取你的参数名称长度\r\n            var iStart = query.indexOf(param);//获取你该参数名称的其实索引\r\n            if (iStart == -1)//-1为没有该参数\r\n                return "";\r\n            iStart += iLen + 1;\r\n            var iEnd = query.indexOf("&", iStart);//获取第二个参数的其实索引\r\n            if (iEnd == -1)//只有一个参数\r\n                return query.substring(iStart);//获取单个参数的参数值\r\n            return query.substring(iStart, iEnd);//获取第二个参数的值\r\n        },\r\n        //仅画布全屏展示\r\n        runPrefixMethod: function (element, method) {\r\n            var usablePrefixMethod;\r\n            ["webkit", "moz", "ms", "o", ""].forEach(function (prefix) {\r\n                    if (usablePrefixMethod) return;\r\n                    if (prefix === "") {\r\n                        // 无前缀，方法首字母小写\r\n                        method = method.slice(0, 1).toLowerCase() + method.slice(1);\r\n                    }\r\n                    var typePrefixMethod = typeof element[prefix + method];\r\n                    if (typePrefixMethod + "" !== "undefined") {\r\n                        if (typePrefixMethod === "function") {\r\n                            usablePrefixMethod = element[prefix + method]();\r\n                        } else {\r\n                            usablePrefixMethod = element[prefix + method];\r\n                        }\r\n                    }\r\n                }\r\n            );\r\n        },\r\n        //浏览器全屏展示\r\n        launchFullScreen: function (element) {\r\n            if (element.requestFullscreen) {\r\n                element.requestFullscreen();\r\n            } else if (element.mozRequestFullScreen) {\r\n                element.mozRequestFullScreen();\r\n            } else if (element.webkitRequestFullscreen) {\r\n                element.webkitRequestFullscreen();\r\n            } else if (element.msRequestFullscreen) {\r\n                element.msRequestFullscreen();\r\n            }\r\n        },\r\n        //关闭浏览器全屏\r\n        exitFullScreen: function (doc) {\r\n            if (doc.exitFullscreen) {\r\n                doc.exitFullscreen();\r\n            } else if (doc.mozCancelFullScreen) {\r\n                doc.mozCancelFullScreen();\r\n            } else if (doc.webkitExitFullscreen) {\r\n                doc.webkitExitFullscreen();\r\n            }\r\n        },\r\n        //16进制转换\r\n        transHex: function (color) {\r\n            if (color && color.length == 7 && color.charAt(0) == \'#\') {\r\n                var a = parseInt(color.substr(1, 2), 16);\r\n                var b = parseInt(color.substr(3, 2), 16);\r\n                var c = parseInt(color.substr(5, 2), 16);\r\n                return a + \',\' + b + \',\' + c;\r\n            } else {\r\n                return color;\r\n            }\r\n        },\r\n        /** 数组添加元素,如果数组中不存在则存入，否则不做操作\r\n         *  @param arr 操作的数组\r\n         *  @param value 操作的元素\r\n         */\r\n        arrayPush: function (arr, value) {\r\n            if (arr.indexOf(value) < 0) {\r\n                arr.push(value);\r\n                return true;\r\n            }\r\n            return false;\r\n        },\r\n        /** 数组删除元素,如果数组中不存在则删除，否则不做操作\r\n         *  @param arr 操作的数组\r\n         *  @param value 操作的元素\r\n         */\r\n        arrayDelete: function (arr, value) {\r\n            var i = arr.indexOf(value);\r\n            if (i >= 0) {\r\n                arr.splice(i, 1);\r\n                return true;\r\n            }\r\n            return false;\r\n        }, /**\r\n         * 构造类继承关系\r\n         * @param {Function} clazz 源类\r\n         * @param {Function} baseClazz 基类\r\n         */\r\n        inherits: function (clazz, baseClazz) {\r\n            var clazzPrototype = clazz.prototype;\r\n\r\n            function F() {\r\n            }\r\n\r\n            F.prototype = baseClazz.prototype;\r\n            clazz.prototype = new F();\r\n\r\n            for (var prop in clazzPrototype) {\r\n                clazz.prototype[prop] = clazzPrototype[prop];\r\n            }\r\n            clazz.constructor = clazz;\r\n        },\r\n        //深度克隆对象\r\n        deepClone: function (obj) {\r\n            var result, oClass = util.getClass(obj);\r\n            //确定result的类型\r\n            if (oClass === "Object") {\r\n                result = {};\r\n            } else if (oClass === "Array") {\r\n                result = [];\r\n            } else {\r\n                return obj;\r\n            }\r\n            for (key in obj) {\r\n                var copy = obj[key];\r\n                if (util.getClass(copy) == "Object") {\r\n                    result[key] = arguments.callee(copy);//递归调用\r\n                } else if (util.getClass(copy) == "Array") {\r\n                    result[key] = arguments.callee(copy);\r\n                } else {\r\n                    result[key] = obj[key];\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        getClass: function (o) {\r\n            if (o === null) return "Null";\r\n            if (o === undefined) return "Undefined";\r\n            return Object.prototype.toString.call(o).slice(8, -1);\r\n        },\r\n        info: function () {\r\n            if (QTopo.log.info) {\r\n                console.info.apply(console, $.merge([util.dateFormat(new Date(), "hh:mm:ss")], arguments));\r\n            }\r\n        },\r\n        error: function () {\r\n            if (QTopo.log.error) {\r\n                console.error.apply(console, $.merge([util.dateFormat(new Date(), "hh:mm:ss")], arguments));\r\n            }\r\n        },\r\n        filterValue: function (filter, data, element) {\r\n            if ($.isArray(filter)) {\r\n                $.each(data, function (k, v) {\r\n                    if (filter.indexOf(k) < 0) {\r\n                        element.val(k, v);\r\n                    }\r\n                });\r\n            }\r\n        },\r\n        dateFormat: function (date, ftString) {\r\n            if (date instanceof Date) {\r\n                var fomat = {\r\n                    "M+": date.getMonth() + 1, //月份\r\n                    "d+": date.getDate(), //日\r\n                    "h+": date.getHours(), //小时\r\n                    "m+": date.getMinutes(), //分\r\n                    "s+": date.getSeconds(), //秒\r\n                    "q+": Math.floor((date.getMonth() + 3) / 3), //季度\r\n                    "S": date.getMilliseconds() //毫秒\r\n                };\r\n                if (/(y+)/.test(ftString)) {\r\n                    ftString = ftString.replace(RegExp.$1, (date.getFullYear() + "")\r\n                        .substr(4 - RegExp.$1.length));\r\n                }\r\n                for (var type in fomat) {\r\n                    if (new RegExp("(" + type + ")").test(ftString)) {\r\n                        var temp;\r\n                        if (RegExp.$1.length == 1) {\r\n                            temp = fomat[type];\r\n                        } else {\r\n                            temp = ("00" + fomat[type]).substr(("" + fomat[type]).length);\r\n                        }\r\n                        ftString = ftString.replace(RegExp.$1, temp);\r\n                    }\r\n                }\r\n            }\r\n            return ftString;\r\n        },\r\n        makeId: function () {\r\n            return S4() + "-" + S4() + "-" + S4();\r\n        },\r\n        isElement: function (target) {\r\n            return target && target.getType() != QTopo.constant.SCENE && target.getUseType() != QTopo.constant.CASUAL;\r\n        },\r\n        isScene: function (target) {\r\n            return !target || target.getType() == QTopo.constant.SCENE;\r\n        },\r\n        isNode: function (target) {\r\n            return target && target.getType() == QTopo.constant.NODE && target.getUseType() != QTopo.constant.CASUAL;\r\n        },\r\n        isContainer: function (target) {\r\n            return target && target.getType() == QTopo.constant.CONTAINER && target.getUseType() != QTopo.constant.CASUAL;\r\n        },\r\n        isLink: function (target) {\r\n            return target && target.getType() == QTopo.constant.LINK && target.getUseType() != QTopo.constant.CASUAL;\r\n        }\r\n    }\r\n    ;\r\nfunction S4() {\r\n    return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n}\r\nmodule.exports = util;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL3V0aWwuanM/MjkyNiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DLG9DQUFvQztBQUNwQyw4Q0FBOEM7QUFDOUM7QUFDQTtBQUNBO0FBQ0Esa0RBQWtEO0FBQ2xEO0FBQ0EsK0NBQStDO0FBQy9DLGlEQUFpRDtBQUNqRCxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsbUJBQW1CLFNBQVM7QUFDNUIsbUJBQW1CLFNBQVM7QUFDNUI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RDtBQUN6RCxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIxMS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBydWxlcjtcclxuZnVuY3Rpb24gY2FjaGVkKGZuKSB7XHJcbiAgICB2YXIgY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgcmV0dXJuIChmdW5jdGlvbiBjYWNoZWRGbihzdHIpIHtcclxuICAgICAgICB2YXIgaGl0ID0gY2FjaGVbc3RyXTtcclxuICAgICAgICByZXR1cm4gaGl0IHx8IChjYWNoZVtzdHJdID0gZm4oc3RyKSlcclxuICAgIH0pXHJcbn1cclxudmFyIHV0aWwgPSB7XHJcbiAgICAgICAgY2FjaGVkOmNhY2hlZCxcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDlrZfnrKbkuLLovazljJZqc29uXHJcbiAgICAgICAgICogQHBhcmFtIGpzb25cclxuICAgICAgICAgKiBAcmV0dXJucyB7Kn1cclxuICAgICAgICAgKi9cclxuICAgICAgICB0b0pzb246IGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YganNvbiA9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAganNvbiA9ICQucGFyc2VKU09OKGpzb24ucmVwbGFjZSgvJy9nLCAnXCInKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGpzb247XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDpppblrZfmr43lpKflhplcclxuICAgICAgICAgKiBAcGFyYW0gc3RyaW5nXHJcbiAgICAgICAgICogQHJldHVybnMge1hNTHwqfHZvaWR9XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdXBGaXJzdDogY2FjaGVkKGZ1bmN0aW9uIChzdHIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBleHRlbmQ6IGZ1bmN0aW9uIChiYXNlLCBjb25maWcpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYmFzZSA9PSBcIm9iamVjdFwiICYmIHR5cGVvZiBjb25maWcgPT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZXAoYmFzZSwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIFFUb3BvLnV0aWwuZXJyb3IoXCJzb21lIGV4dGVuZCBlcnJvcjpcIiwgYmFzZSwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgUVRvcG8udXRpbC5lcnJvcihcImV4dGVuZCBlcnJvclwiLCBlLCBiYXNlLCBjb25maWcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRlZXAoYXR0ciwgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goYXR0ciwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cltrZXldICYmIHR5cGVvZiBhdHRyW2tleV0gPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgY29uZmlnW2tleV0gPT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJC5pc0FycmF5KGF0dHJba2V5XSkgJiYgJC5pc0FycmF5KGNvbmZpZ1trZXldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cltrZXldID0gY29uZmlnW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJC5pc0Z1bmN0aW9uKGF0dHJba2V5XSkgJiYgJC5pc0Z1bmN0aW9uKGNvbmZpZ1trZXldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cltrZXldID0gY29uZmlnW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWVwKGF0dHJba2V5XSwgY29uZmlnW2tleV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYXR0cltrZXldICE9IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIGNvbmZpZ1trZXldICE9IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cltrZXldID0gY29uZmlnW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBiYXNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog6I635Y+W5rWP6KeI5Zmo6L+e5o6l5LiK55qE5Y+C5pWwXHJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIOWPguaVsOWQjVxyXG4gICAgICAgICAqIEByZXR1cm5zIHsqfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldFBhcmFtZXRlcjogZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgICAgIHZhciBxdWVyeSA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7Ly/ojrflj5ZVUkzlnLDlnYDkuK3vvJ/lkI7nmoTmiYDmnInlrZfnrKZcclxuICAgICAgICAgICAgdmFyIGlMZW4gPSBwYXJhbS5sZW5ndGg7Ly/ojrflj5bkvaDnmoTlj4LmlbDlkI3np7Dplb/luqZcclxuICAgICAgICAgICAgdmFyIGlTdGFydCA9IHF1ZXJ5LmluZGV4T2YocGFyYW0pOy8v6I635Y+W5L2g6K+l5Y+C5pWw5ZCN56ew55qE5YW25a6e57Si5byVXHJcbiAgICAgICAgICAgIGlmIChpU3RhcnQgPT0gLTEpLy8tMeS4uuayoeacieivpeWPguaVsFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICAgICAgICAgIGlTdGFydCArPSBpTGVuICsgMTtcclxuICAgICAgICAgICAgdmFyIGlFbmQgPSBxdWVyeS5pbmRleE9mKFwiJlwiLCBpU3RhcnQpOy8v6I635Y+W56ys5LqM5Liq5Y+C5pWw55qE5YW25a6e57Si5byVXHJcbiAgICAgICAgICAgIGlmIChpRW5kID09IC0xKS8v5Y+q5pyJ5LiA5Liq5Y+C5pWwXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcXVlcnkuc3Vic3RyaW5nKGlTdGFydCk7Ly/ojrflj5bljZXkuKrlj4LmlbDnmoTlj4LmlbDlgLxcclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5LnN1YnN0cmluZyhpU3RhcnQsIGlFbmQpOy8v6I635Y+W56ys5LqM5Liq5Y+C5pWw55qE5YC8XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvL+S7heeUu+W4g+WFqOWxj+WxleekulxyXG4gICAgICAgIHJ1blByZWZpeE1ldGhvZDogZnVuY3Rpb24gKGVsZW1lbnQsIG1ldGhvZCkge1xyXG4gICAgICAgICAgICB2YXIgdXNhYmxlUHJlZml4TWV0aG9kO1xyXG4gICAgICAgICAgICBbXCJ3ZWJraXRcIiwgXCJtb3pcIiwgXCJtc1wiLCBcIm9cIiwgXCJcIl0uZm9yRWFjaChmdW5jdGlvbiAocHJlZml4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzYWJsZVByZWZpeE1ldGhvZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmVmaXggPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5peg5YmN57yA77yM5pa55rOV6aaW5a2X5q+N5bCP5YaZXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IG1ldGhvZC5zbGljZSgwLCAxKS50b0xvd2VyQ2FzZSgpICsgbWV0aG9kLnNsaWNlKDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZVByZWZpeE1ldGhvZCA9IHR5cGVvZiBlbGVtZW50W3ByZWZpeCArIG1ldGhvZF07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVQcmVmaXhNZXRob2QgKyBcIlwiICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlUHJlZml4TWV0aG9kID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYWJsZVByZWZpeE1ldGhvZCA9IGVsZW1lbnRbcHJlZml4ICsgbWV0aG9kXSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNhYmxlUHJlZml4TWV0aG9kID0gZWxlbWVudFtwcmVmaXggKyBtZXRob2RdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLy/mtY/op4jlmajlhajlsY/lsZXnpLpcclxuICAgICAgICBsYXVuY2hGdWxsU2NyZWVuOiBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5yZXF1ZXN0RnVsbHNjcmVlbikge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZXF1ZXN0RnVsbHNjcmVlbigpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQubW96UmVxdWVzdEZ1bGxTY3JlZW4pIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQubW96UmVxdWVzdEZ1bGxTY3JlZW4oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5tc1JlcXVlc3RGdWxsc2NyZWVuKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLy/lhbPpl63mtY/op4jlmajlhajlsY9cclxuICAgICAgICBleGl0RnVsbFNjcmVlbjogZnVuY3Rpb24gKGRvYykge1xyXG4gICAgICAgICAgICBpZiAoZG9jLmV4aXRGdWxsc2NyZWVuKSB7XHJcbiAgICAgICAgICAgICAgICBkb2MuZXhpdEZ1bGxzY3JlZW4oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChkb2MubW96Q2FuY2VsRnVsbFNjcmVlbikge1xyXG4gICAgICAgICAgICAgICAgZG9jLm1vekNhbmNlbEZ1bGxTY3JlZW4oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChkb2Mud2Via2l0RXhpdEZ1bGxzY3JlZW4pIHtcclxuICAgICAgICAgICAgICAgIGRvYy53ZWJraXRFeGl0RnVsbHNjcmVlbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLzE26L+b5Yi26L2s5o2iXHJcbiAgICAgICAgdHJhbnNIZXg6IGZ1bmN0aW9uIChjb2xvcikge1xyXG4gICAgICAgICAgICBpZiAoY29sb3IgJiYgY29sb3IubGVuZ3RoID09IDcgJiYgY29sb3IuY2hhckF0KDApID09ICcjJykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGEgPSBwYXJzZUludChjb2xvci5zdWJzdHIoMSwgMiksIDE2KTtcclxuICAgICAgICAgICAgICAgIHZhciBiID0gcGFyc2VJbnQoY29sb3Iuc3Vic3RyKDMsIDIpLCAxNik7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHBhcnNlSW50KGNvbG9yLnN1YnN0cig1LCAyKSwgMTYpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGEgKyAnLCcgKyBiICsgJywnICsgYztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLyoqIOaVsOe7hOa3u+WKoOWFg+e0oCzlpoLmnpzmlbDnu4TkuK3kuI3lrZjlnKjliJnlrZjlhaXvvIzlkKbliJnkuI3lgZrmk43kvZxcclxuICAgICAgICAgKiAgQHBhcmFtIGFyciDmk43kvZznmoTmlbDnu4RcclxuICAgICAgICAgKiAgQHBhcmFtIHZhbHVlIOaTjeS9nOeahOWFg+e0oFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGFycmF5UHVzaDogZnVuY3Rpb24gKGFyciwgdmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKGFyci5pbmRleE9mKHZhbHVlKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIC8qKiDmlbDnu4TliKDpmaTlhYPntKAs5aaC5p6c5pWw57uE5Lit5LiN5a2Y5Zyo5YiZ5Yig6Zmk77yM5ZCm5YiZ5LiN5YGa5pON5L2cXHJcbiAgICAgICAgICogIEBwYXJhbSBhcnIg5pON5L2c55qE5pWw57uEXHJcbiAgICAgICAgICogIEBwYXJhbSB2YWx1ZSDmk43kvZznmoTlhYPntKBcclxuICAgICAgICAgKi9cclxuICAgICAgICBhcnJheURlbGV0ZTogZnVuY3Rpb24gKGFyciwgdmFsdWUpIHtcclxuICAgICAgICAgICAgdmFyIGkgPSBhcnIuaW5kZXhPZih2YWx1ZSk7XHJcbiAgICAgICAgICAgIGlmIChpID49IDApIHtcclxuICAgICAgICAgICAgICAgIGFyci5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSwgLyoqXHJcbiAgICAgICAgICog5p6E6YCg57G757un5om/5YWz57O7XHJcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2xhenog5rqQ57G7XHJcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gYmFzZUNsYXp6IOWfuuexu1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGluaGVyaXRzOiBmdW5jdGlvbiAoY2xhenosIGJhc2VDbGF6eikge1xyXG4gICAgICAgICAgICB2YXIgY2xhenpQcm90b3R5cGUgPSBjbGF6ei5wcm90b3R5cGU7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBGKCkge1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBGLnByb3RvdHlwZSA9IGJhc2VDbGF6ei5wcm90b3R5cGU7XHJcbiAgICAgICAgICAgIGNsYXp6LnByb3RvdHlwZSA9IG5ldyBGKCk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGNsYXp6UHJvdG90eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjbGF6ei5wcm90b3R5cGVbcHJvcF0gPSBjbGF6elByb3RvdHlwZVtwcm9wXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjbGF6ei5jb25zdHJ1Y3RvciA9IGNsYXp6O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLy/mt7HluqblhYvpmoblr7nosaFcclxuICAgICAgICBkZWVwQ2xvbmU6IGZ1bmN0aW9uIChvYmopIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCwgb0NsYXNzID0gdXRpbC5nZXRDbGFzcyhvYmopO1xyXG4gICAgICAgICAgICAvL+ehruWumnJlc3VsdOeahOexu+Wei1xyXG4gICAgICAgICAgICBpZiAob0NsYXNzID09PSBcIk9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB7fTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChvQ2xhc3MgPT09IFwiQXJyYXlcIikge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoa2V5IGluIG9iaikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvcHkgPSBvYmpba2V5XTtcclxuICAgICAgICAgICAgICAgIGlmICh1dGlsLmdldENsYXNzKGNvcHkpID09IFwiT2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IGFyZ3VtZW50cy5jYWxsZWUoY29weSk7Ly/pgJLlvZLosIPnlKhcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXRpbC5nZXRDbGFzcyhjb3B5KSA9PSBcIkFycmF5XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IGFyZ3VtZW50cy5jYWxsZWUoY29weSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gb2JqW2tleV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldENsYXNzOiBmdW5jdGlvbiAobykge1xyXG4gICAgICAgICAgICBpZiAobyA9PT0gbnVsbCkgcmV0dXJuIFwiTnVsbFwiO1xyXG4gICAgICAgICAgICBpZiAobyA9PT0gdW5kZWZpbmVkKSByZXR1cm4gXCJVbmRlZmluZWRcIjtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbmZvOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChRVG9wby5sb2cuaW5mbykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvLmFwcGx5KGNvbnNvbGUsICQubWVyZ2UoW3V0aWwuZGF0ZUZvcm1hdChuZXcgRGF0ZSgpLCBcImhoOm1tOnNzXCIpXSwgYXJndW1lbnRzKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChRVG9wby5sb2cuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IuYXBwbHkoY29uc29sZSwgJC5tZXJnZShbdXRpbC5kYXRlRm9ybWF0KG5ldyBEYXRlKCksIFwiaGg6bW06c3NcIildLCBhcmd1bWVudHMpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmlsdGVyVmFsdWU6IGZ1bmN0aW9uIChmaWx0ZXIsIGRhdGEsIGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKCQuaXNBcnJheShmaWx0ZXIpKSB7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goZGF0YSwgZnVuY3Rpb24gKGssIHYpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyLmluZGV4T2YoaykgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKGssIHYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBkYXRlRm9ybWF0OiBmdW5jdGlvbiAoZGF0ZSwgZnRTdHJpbmcpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGUgaW5zdGFuY2VvZiBEYXRlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZm9tYXQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJNK1wiOiBkYXRlLmdldE1vbnRoKCkgKyAxLCAvL+aciOS7vVxyXG4gICAgICAgICAgICAgICAgICAgIFwiZCtcIjogZGF0ZS5nZXREYXRlKCksIC8v5pelXHJcbiAgICAgICAgICAgICAgICAgICAgXCJoK1wiOiBkYXRlLmdldEhvdXJzKCksIC8v5bCP5pe2XHJcbiAgICAgICAgICAgICAgICAgICAgXCJtK1wiOiBkYXRlLmdldE1pbnV0ZXMoKSwgLy/liIZcclxuICAgICAgICAgICAgICAgICAgICBcInMrXCI6IGRhdGUuZ2V0U2Vjb25kcygpLCAvL+enklxyXG4gICAgICAgICAgICAgICAgICAgIFwicStcIjogTWF0aC5mbG9vcigoZGF0ZS5nZXRNb250aCgpICsgMykgLyAzKSwgLy/lraPluqZcclxuICAgICAgICAgICAgICAgICAgICBcIlNcIjogZGF0ZS5nZXRNaWxsaXNlY29uZHMoKSAvL+avq+enklxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGlmICgvKHkrKS8udGVzdChmdFN0cmluZykpIHtcclxuICAgICAgICAgICAgICAgICAgICBmdFN0cmluZyA9IGZ0U3RyaW5nLnJlcGxhY2UoUmVnRXhwLiQxLCAoZGF0ZS5nZXRGdWxsWWVhcigpICsgXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1YnN0cig0IC0gUmVnRXhwLiQxLmxlbmd0aCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgdHlwZSBpbiBmb21hdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXcgUmVnRXhwKFwiKFwiICsgdHlwZSArIFwiKVwiKS50ZXN0KGZ0U3RyaW5nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJlZ0V4cC4kMS5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGZvbWF0W3R5cGVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IChcIjAwXCIgKyBmb21hdFt0eXBlXSkuc3Vic3RyKChcIlwiICsgZm9tYXRbdHlwZV0pLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZnRTdHJpbmcgPSBmdFN0cmluZy5yZXBsYWNlKFJlZ0V4cC4kMSwgdGVtcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmdFN0cmluZztcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1ha2VJZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGlzRWxlbWVudDogZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0ICYmIHRhcmdldC5nZXRUeXBlKCkgIT0gUVRvcG8uY29uc3RhbnQuU0NFTkUgJiYgdGFyZ2V0LmdldFVzZVR5cGUoKSAhPSBRVG9wby5jb25zdGFudC5DQVNVQUw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpc1NjZW5lOiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhdGFyZ2V0IHx8IHRhcmdldC5nZXRUeXBlKCkgPT0gUVRvcG8uY29uc3RhbnQuU0NFTkU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpc05vZGU6IGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRhcmdldCAmJiB0YXJnZXQuZ2V0VHlwZSgpID09IFFUb3BvLmNvbnN0YW50Lk5PREUgJiYgdGFyZ2V0LmdldFVzZVR5cGUoKSAhPSBRVG9wby5jb25zdGFudC5DQVNVQUw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpc0NvbnRhaW5lcjogZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0ICYmIHRhcmdldC5nZXRUeXBlKCkgPT0gUVRvcG8uY29uc3RhbnQuQ09OVEFJTkVSICYmIHRhcmdldC5nZXRVc2VUeXBlKCkgIT0gUVRvcG8uY29uc3RhbnQuQ0FTVUFMO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaXNMaW5rOiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXQgJiYgdGFyZ2V0LmdldFR5cGUoKSA9PSBRVG9wby5jb25zdGFudC5MSU5LICYmIHRhcmdldC5nZXRVc2VUeXBlKCkgIT0gUVRvcG8uY29uc3RhbnQuQ0FTVUFMO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIDtcclxuZnVuY3Rpb24gUzQoKSB7XHJcbiAgICByZXR1cm4gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xyXG59XHJcbm1vZHVsZS5leHBvcnRzID0gdXRpbDtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2RldmVsb3AvdXRpbC5qc1xuLy8gbW9kdWxlIGlkID0gMTFcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sInNvdXJjZVJvb3QiOiIifQ==')},2:function(module,exports,__webpack_require__){eval("var Element = __webpack_require__(1);\r\nmodule.exports = Link;\r\nvar jtopoReset = {\r\n    paintSelected: function (a) {\r\n        a.shadowBlur = 10;\r\n        a.shadowColor = \"rgba(255,255,255,1)\";\r\n        a.shadowOffsetX = 0;\r\n        a.shadowOffsetY = 0;\r\n    }\r\n};\r\nfunction Link(jtopo) {\r\n    if (!jtopo) {\r\n        QTopo.util.error(\"create Link without jtopo\", this);\r\n        return;\r\n    }\r\n    Element.call(this, jtopo);\r\n    //记录两端的节点\r\n    this.path = {\r\n        start: this.jtopo.nodeA.qtopo,\r\n        end: this.jtopo.nodeZ.qtopo\r\n    };\r\n    //在线路两端的对象上的links属性中更新自己\r\n    if (this.path.start.links && $.isArray(this.path.start.links.out)) {\r\n        if (this.path.start.links.out.indexOf(this) < 0) {\r\n            this.path.start.links.out.push(this);\r\n        }\r\n    }\r\n    if (this.path.end.links && $.isArray(this.path.end.links.in)) {\r\n        if (this.path.end.links.in.indexOf(this) < 0) {\r\n            this.path.end.links.in.push(this);\r\n        }\r\n    }\r\n    reset(this.jtopo);\r\n}\r\nQTopo.util.inherits(Link, Element);\r\n\r\nfunction reset(jtopo) {\r\n    //被選中后的样式\r\n    jtopo.paintSelected = jtopoReset.paintSelected;\r\n}\r\nLink.prototype.getType = function () {\r\n    return QTopo.constant.LINK;\r\n};\r\nLink.prototype.setColor = function (color) {\r\n    if (color) {\r\n        this.jtopo.strokeColor = QTopo.util.transHex(color.toLowerCase());\r\n    }\r\n    this.attr.color = this.jtopo.strokeColor;\r\n};\r\nLink.prototype.setNumber = function (number) {\r\n    if ($.isNumeric(number)) {\r\n        number = parseInt(number);\r\n        if (number > 1) {\r\n            this.jtopo.text = '(+' + number + ')';\r\n        } else {\r\n            number = 1;\r\n            this.jtopo.text = '';\r\n        }\r\n        this.attr.number = number;\r\n    }\r\n};\r\nLink.prototype.setWidth = function (width) {\r\n    if ($.isNumeric(width)) {\r\n        var newWidth = parseInt(width);\r\n        this.jtopo.lineWidth = newWidth > 0 ? newWidth : 1; // 线宽\r\n    }\r\n    this.attr.width = this.jtopo.lineWidth;\r\n};\r\nLink.prototype.setArrow = function (arrow) {\r\n    if (arrow) {\r\n        if(typeof arrow.size!='undefined'){\r\n            this.jtopo.arrowsRadius = $.isNumeric(arrow.size) ? parseInt(arrow.size) : 0;\r\n        }\r\n        if(typeof arrow.offset!='undefined'){\r\n            this.jtopo.arrowsOffset = $.isNumeric(arrow.offset) ? parseInt(arrow.offset) : 0;\r\n        }\r\n        if (!this.attr.arrow) {\r\n            this.attr.arrow = {};\r\n        }\r\n\r\n        if (typeof arrow.start!='undefined') {\r\n            this.attr.arrow.start = typeof arrow.start == \"boolean\" ? arrow.start : arrow.start == \"true\";\r\n        }\r\n        if (typeof arrow.end!='undefined') {\r\n            this.attr.arrow.end = typeof arrow.end == \"boolean\" ? arrow.end : arrow.end == \"true\";\r\n        }\r\n    }\r\n    this.attr.arrow.size = this.jtopo.arrowsRadius;\r\n    this.attr.arrow.offset = this.jtopo.arrowsOffset;\r\n};\r\nLink.prototype.setGap = function (gap) {\r\n    if (gap) {\r\n        this.jtopo.bundleGap = $.isNumeric(gap) ? parseInt(gap) : 0; // 线条之间的间隔\r\n    }\r\n    this.attr.gap = this.jtopo.bundleGap;\r\n};\r\nLink.prototype.setDashed = function (dashedPattern) {\r\n    if ($.isNumeric(dashedPattern) && dashedPattern > 0) {\r\n        this.jtopo.dashedPattern = parseInt(dashedPattern);\r\n    } else {\r\n        this.jtopo.dashedPattern = null;\r\n    }\r\n    this.attr.dashed = this.jtopo.dashedPattern;\r\n};\r\n/**\r\n * 实例序列化\r\n */\r\nLink.prototype.toJson=function(){\r\n    var json=$.extend({},this.attr);\r\n    json.extra=$.extend({},this.extra);\r\n    json.start=this.path.start.get('jsonId');\r\n    json.end=this.path.end.get('jsonId');\r\n    return json;\r\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9saW5rL0xpbmsuanM/NTYwMCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQ7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvRUFBb0U7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEIsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRWxlbWVudCA9IHJlcXVpcmUoXCIuLi9FbGVtZW50LmpzXCIpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IExpbms7XHJcbnZhciBqdG9wb1Jlc2V0ID0ge1xyXG4gICAgcGFpbnRTZWxlY3RlZDogZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICBhLnNoYWRvd0JsdXIgPSAxMDtcclxuICAgICAgICBhLnNoYWRvd0NvbG9yID0gXCJyZ2JhKDI1NSwyNTUsMjU1LDEpXCI7XHJcbiAgICAgICAgYS5zaGFkb3dPZmZzZXRYID0gMDtcclxuICAgICAgICBhLnNoYWRvd09mZnNldFkgPSAwO1xyXG4gICAgfVxyXG59O1xyXG5mdW5jdGlvbiBMaW5rKGp0b3BvKSB7XHJcbiAgICBpZiAoIWp0b3BvKSB7XHJcbiAgICAgICAgUVRvcG8udXRpbC5lcnJvcihcImNyZWF0ZSBMaW5rIHdpdGhvdXQganRvcG9cIiwgdGhpcyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgRWxlbWVudC5jYWxsKHRoaXMsIGp0b3BvKTtcclxuICAgIC8v6K6w5b2V5Lik56uv55qE6IqC54K5XHJcbiAgICB0aGlzLnBhdGggPSB7XHJcbiAgICAgICAgc3RhcnQ6IHRoaXMuanRvcG8ubm9kZUEucXRvcG8sXHJcbiAgICAgICAgZW5kOiB0aGlzLmp0b3BvLm5vZGVaLnF0b3BvXHJcbiAgICB9O1xyXG4gICAgLy/lnKjnur/ot6/kuKTnq6/nmoTlr7nosaHkuIrnmoRsaW5rc+WxnuaAp+S4reabtOaWsOiHquW3sVxyXG4gICAgaWYgKHRoaXMucGF0aC5zdGFydC5saW5rcyAmJiAkLmlzQXJyYXkodGhpcy5wYXRoLnN0YXJ0LmxpbmtzLm91dCkpIHtcclxuICAgICAgICBpZiAodGhpcy5wYXRoLnN0YXJ0LmxpbmtzLm91dC5pbmRleE9mKHRoaXMpIDwgMCkge1xyXG4gICAgICAgICAgICB0aGlzLnBhdGguc3RhcnQubGlua3Mub3V0LnB1c2godGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMucGF0aC5lbmQubGlua3MgJiYgJC5pc0FycmF5KHRoaXMucGF0aC5lbmQubGlua3MuaW4pKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGF0aC5lbmQubGlua3MuaW4uaW5kZXhPZih0aGlzKSA8IDApIHtcclxuICAgICAgICAgICAgdGhpcy5wYXRoLmVuZC5saW5rcy5pbi5wdXNoKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJlc2V0KHRoaXMuanRvcG8pO1xyXG59XHJcblFUb3BvLnV0aWwuaW5oZXJpdHMoTGluaywgRWxlbWVudCk7XHJcblxyXG5mdW5jdGlvbiByZXNldChqdG9wbykge1xyXG4gICAgLy/ooqvpgbjkuK3lkI7nmoTmoLflvI9cclxuICAgIGp0b3BvLnBhaW50U2VsZWN0ZWQgPSBqdG9wb1Jlc2V0LnBhaW50U2VsZWN0ZWQ7XHJcbn1cclxuTGluay5wcm90b3R5cGUuZ2V0VHlwZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBRVG9wby5jb25zdGFudC5MSU5LO1xyXG59O1xyXG5MaW5rLnByb3RvdHlwZS5zZXRDb2xvciA9IGZ1bmN0aW9uIChjb2xvcikge1xyXG4gICAgaWYgKGNvbG9yKSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5zdHJva2VDb2xvciA9IFFUb3BvLnV0aWwudHJhbnNIZXgoY29sb3IudG9Mb3dlckNhc2UoKSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIuY29sb3IgPSB0aGlzLmp0b3BvLnN0cm9rZUNvbG9yO1xyXG59O1xyXG5MaW5rLnByb3RvdHlwZS5zZXROdW1iZXIgPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICBpZiAoJC5pc051bWVyaWMobnVtYmVyKSkge1xyXG4gICAgICAgIG51bWJlciA9IHBhcnNlSW50KG51bWJlcik7XHJcbiAgICAgICAgaWYgKG51bWJlciA+IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5qdG9wby50ZXh0ID0gJygrJyArIG51bWJlciArICcpJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBudW1iZXIgPSAxO1xyXG4gICAgICAgICAgICB0aGlzLmp0b3BvLnRleHQgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hdHRyLm51bWJlciA9IG51bWJlcjtcclxuICAgIH1cclxufTtcclxuTGluay5wcm90b3R5cGUuc2V0V2lkdGggPSBmdW5jdGlvbiAod2lkdGgpIHtcclxuICAgIGlmICgkLmlzTnVtZXJpYyh3aWR0aCkpIHtcclxuICAgICAgICB2YXIgbmV3V2lkdGggPSBwYXJzZUludCh3aWR0aCk7XHJcbiAgICAgICAgdGhpcy5qdG9wby5saW5lV2lkdGggPSBuZXdXaWR0aCA+IDAgPyBuZXdXaWR0aCA6IDE7IC8vIOe6v+WuvVxyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLndpZHRoID0gdGhpcy5qdG9wby5saW5lV2lkdGg7XHJcbn07XHJcbkxpbmsucHJvdG90eXBlLnNldEFycm93ID0gZnVuY3Rpb24gKGFycm93KSB7XHJcbiAgICBpZiAoYXJyb3cpIHtcclxuICAgICAgICBpZih0eXBlb2YgYXJyb3cuc2l6ZSE9J3VuZGVmaW5lZCcpe1xyXG4gICAgICAgICAgICB0aGlzLmp0b3BvLmFycm93c1JhZGl1cyA9ICQuaXNOdW1lcmljKGFycm93LnNpemUpID8gcGFyc2VJbnQoYXJyb3cuc2l6ZSkgOiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0eXBlb2YgYXJyb3cub2Zmc2V0IT0ndW5kZWZpbmVkJyl7XHJcbiAgICAgICAgICAgIHRoaXMuanRvcG8uYXJyb3dzT2Zmc2V0ID0gJC5pc051bWVyaWMoYXJyb3cub2Zmc2V0KSA/IHBhcnNlSW50KGFycm93Lm9mZnNldCkgOiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuYXR0ci5hcnJvdykge1xyXG4gICAgICAgICAgICB0aGlzLmF0dHIuYXJyb3cgPSB7fTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgYXJyb3cuc3RhcnQhPSd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXR0ci5hcnJvdy5zdGFydCA9IHR5cGVvZiBhcnJvdy5zdGFydCA9PSBcImJvb2xlYW5cIiA/IGFycm93LnN0YXJ0IDogYXJyb3cuc3RhcnQgPT0gXCJ0cnVlXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgYXJyb3cuZW5kIT0ndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICB0aGlzLmF0dHIuYXJyb3cuZW5kID0gdHlwZW9mIGFycm93LmVuZCA9PSBcImJvb2xlYW5cIiA/IGFycm93LmVuZCA6IGFycm93LmVuZCA9PSBcInRydWVcIjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIuYXJyb3cuc2l6ZSA9IHRoaXMuanRvcG8uYXJyb3dzUmFkaXVzO1xyXG4gICAgdGhpcy5hdHRyLmFycm93Lm9mZnNldCA9IHRoaXMuanRvcG8uYXJyb3dzT2Zmc2V0O1xyXG59O1xyXG5MaW5rLnByb3RvdHlwZS5zZXRHYXAgPSBmdW5jdGlvbiAoZ2FwKSB7XHJcbiAgICBpZiAoZ2FwKSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5idW5kbGVHYXAgPSAkLmlzTnVtZXJpYyhnYXApID8gcGFyc2VJbnQoZ2FwKSA6IDA7IC8vIOe6v+adoeS5i+mXtOeahOmXtOmalFxyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLmdhcCA9IHRoaXMuanRvcG8uYnVuZGxlR2FwO1xyXG59O1xyXG5MaW5rLnByb3RvdHlwZS5zZXREYXNoZWQgPSBmdW5jdGlvbiAoZGFzaGVkUGF0dGVybikge1xyXG4gICAgaWYgKCQuaXNOdW1lcmljKGRhc2hlZFBhdHRlcm4pICYmIGRhc2hlZFBhdHRlcm4gPiAwKSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5kYXNoZWRQYXR0ZXJuID0gcGFyc2VJbnQoZGFzaGVkUGF0dGVybik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuanRvcG8uZGFzaGVkUGF0dGVybiA9IG51bGw7XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIuZGFzaGVkID0gdGhpcy5qdG9wby5kYXNoZWRQYXR0ZXJuO1xyXG59O1xyXG4vKipcclxuICog5a6e5L6L5bqP5YiX5YyWXHJcbiAqL1xyXG5MaW5rLnByb3RvdHlwZS50b0pzb249ZnVuY3Rpb24oKXtcclxuICAgIHZhciBqc29uPSQuZXh0ZW5kKHt9LHRoaXMuYXR0cik7XHJcbiAgICBqc29uLmV4dHJhPSQuZXh0ZW5kKHt9LHRoaXMuZXh0cmEpO1xyXG4gICAganNvbi5zdGFydD10aGlzLnBhdGguc3RhcnQuZ2V0KCdqc29uSWQnKTtcclxuICAgIGpzb24uZW5kPXRoaXMucGF0aC5lbmQuZ2V0KCdqc29uSWQnKTtcclxuICAgIHJldHVybiBqc29uO1xyXG59O1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vZGV2ZWxvcC9jb3JlL2VsZW1lbnQvbGluay9MaW5rLmpzXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJzb3VyY2VSb290IjoiIn0=");
},27:function(module,exports,__webpack_require__){eval('var Element = __webpack_require__(1);\r\nmodule.exports = Container;\r\nvar jtopoReset = {\r\n    paintText: function (a) {\r\n        var text = this.text;\r\n        if (null != text && "" != text) {\r\n            a.beginPath();\r\n            a.font = this.font;\r\n            var fontWidth = a.measureText("田").width;\r\n            var maxWidth = fontWidth;\r\n            a.fillStyle = "rgba(" + this.fontColor + ",1)"; //", " + this.alpha + ")";名称永远不透明\r\n            //换行检测\r\n            var texts = text.split("\\n");\r\n            for (var i = 0; i < texts.length; i++) {\r\n                var width = a.measureText(texts[i]).width;\r\n                if (width > maxWidth) {\r\n                    maxWidth = width;\r\n                }\r\n            }\r\n            var e = this.getTextPostion(this.textPosition, maxWidth, fontWidth,texts.length);\r\n            for (var j = 0; j < texts.length; j++) {\r\n                var textWidth = a.measureText(texts[j]).width;\r\n                a.fillText(texts[j], e.x + (maxWidth - textWidth) / 2, e.y + j * fontWidth);\r\n            }\r\n\r\n            a.closePath();\r\n        }\r\n    }\r\n};\r\nfunction Container(jtopo) {\r\n    if (jtopo) {\r\n        Element.call(this, jtopo);\r\n    } else {\r\n        QTopo.util.error("create Container without jtopo", this);\r\n    }\r\n    this.children = [];\r\n    this.links = {\r\n        in: [],\r\n        out: []\r\n    };\r\n    reset(this);\r\n}\r\nQTopo.util.inherits(Container, Element);\r\nfunction reset(element) {\r\n    element.jtopo.paintText = jtopoReset.paintText;\r\n}\r\nContainer.prototype.setName = function (name) {\r\n    if (name) {\r\n        if (this.attr.namePosition != "hide") {\r\n            this.jtopo.text = name.trim();\r\n        }\r\n        this.attr.name = name.trim();\r\n    }\r\n};\r\n/**\r\n * 将元素加入分组内\r\n * @param element\r\n */\r\nContainer.prototype.add = function (element) {\r\n    var self=this;\r\n    if (!$.isArray(this.children)) {\r\n        this.children = [];\r\n    }\r\n    if ($.isArray(element)) {\r\n        $.each(element,function(i,el){\r\n            addOnce(el);\r\n        });\r\n    }else{\r\n        addOnce(element);\r\n    }\r\n    function addOnce(element){\r\n        if (element&&check(element)&&!self.isChild(element)) {\r\n            self.children.push(element);\r\n            element.parent = self;\r\n            self.jtopo.add(element.jtopo);\r\n            if (self.attr.children && typeof self.attr.children.dragble == "boolean") {\r\n                //若分组不允许移动组内元素，手动设置元素不可移动\r\n                element.setDragable(self.attr.children.dragble);\r\n            }\r\n        }\r\n    }\r\n    function check(element){\r\n        return element.getType()==QTopo.constant.NODE&&element.getUseType()!=QTopo.constant.CASUAL&&!element.parent;\r\n    }\r\n};\r\n/**\r\n * 将子元素从分组中删除\r\n * @param element\r\n */\r\nContainer.prototype.remove = function (element) {\r\n    if ($.isArray(this.children) && this.isChild(element)) {\r\n        this.children.splice(this.children.indexOf(element), 1);\r\n        delete element.parent;\r\n        this.jtopo.remove(element.jtopo);\r\n        //移除元素，应手动设回元素可移动\r\n        element.setDragable(true);\r\n    }\r\n};\r\nContainer.prototype.getChildren = function () {\r\n    var children = [];\r\n    var self = this;\r\n    if (self.jtopo && self.jtopo.childs) {\r\n        $.each(self.jtopo.childs, function (i, v) {\r\n            if (v.qtopo) {\r\n                children.push(v.qtopo);\r\n            } else {\r\n                QTopo.util.error(this, "the child not wraped by qtopo", v);\r\n            }\r\n        });\r\n    }\r\n    this.children = children;\r\n    return children;\r\n};\r\nContainer.prototype.getType = function () {\r\n    return QTopo.constant.CONTAINER;\r\n};\r\nContainer.prototype.setColor = function (color) {\r\n    if (color) {\r\n        color = QTopo.util.transHex(color.toLowerCase());\r\n        this.jtopo.fillColor = color;\r\n    }\r\n    this.attr.color = this.jtopo.fillColor;\r\n};\r\nContainer.prototype.setChildren = function (children) {\r\n    var jtopo = this.jtopo;\r\n    if (children) {\r\n        if (typeof children.dragble == "boolean") {\r\n            this.jtopo.childDragble = children.dragble;\r\n            for (var i = 0; i < this.children.length; i++) {\r\n                this.children[i].setDragable(children.dragble);\r\n            }\r\n        }\r\n    }\r\n    this.attr.children.dragble = jtopo.childDragble;\r\n};\r\n/**\r\n * 分组切换,在scene创建分组时可选是否提供切换，若无切换节点，该方法无动作\r\n * @param flag 为true则缩放为false则展开，无值则根据现状切换,\r\n */\r\nContainer.prototype.toggle = function (flag) {\r\n    if (this.toggleTo) {\r\n        var gJtopo = this.jtopo;\r\n        var nJtopo = this.toggleTo.jtopo;\r\n        var todo = typeof flag == "boolean" ? flag : gJtopo.visible;\r\n        if (todo) {\r\n            //缩放\r\n            this.hide();\r\n            this.toggleTo.show();\r\n            this.toggleTo.setPosition([gJtopo.cx - nJtopo.width / 2, gJtopo.cy - nJtopo.height / 2]);\r\n        } else {\r\n            //展开\r\n            this.show();\r\n            this.toggleTo.hide();\r\n            this.setPosition([nJtopo.cx - gJtopo.width / 2, nJtopo.cy - gJtopo.height / 2]);\r\n        }\r\n    }\r\n};\r\n/**\r\n * 判断元素是否已是子元素\r\n * @param element 判断的子元素\r\n */\r\nContainer.prototype.isChild = function (element) {\r\n    if ($.isArray(this.children)) {\r\n        var index=this.children.indexOf(element);\r\n        if (element.parent != this&& index> -1) {\r\n            QTopo.util.error("some group get error,the child\'s parent is not it and the child in its children,index is "+index, this,element);\r\n        }\r\n        return index>-1;\r\n    } else {\r\n        return false;\r\n    }\r\n};\r\n/**\r\n * 判断元素是否在分组覆盖的范围内,临时元素不考虑\r\n * @param element\r\n * @returns {boolean}\r\n */\r\nContainer.prototype.isInside = function (element) {\r\n    if (element && element.getType() != QTopo.constant.CASUAL) {\r\n        var center = element.getCenterPosition();\r\n        return !this.isChild(element) && center.x > this.x && center.x < (this.x + this.width) && center.y > this.y && center.y < (this.y + this.height);\r\n    } else {\r\n        return false;\r\n    }\r\n};\r\n/**\r\n * 实例序列化\r\n */\r\nContainer.prototype.toJson=function(){\r\n    var json=$.extend({},this.attr);\r\n    json.extra=$.extend({},this.extra);\r\n    json.children=[];\r\n    this.children.map(function(child){\r\n        json.children.push(child.get(\'jsonId\'));\r\n    });\r\n    json.toggle=this.toggleTo.toJson();\r\n    return json;\r\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9jb250YWluZXIvQ29udGFpbmVyLmpzPzNhZTMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsMkJBQTJCO0FBQ3RGO0FBQ0E7QUFDQSwyQkFBMkIsa0JBQWtCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0M7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiwwQkFBMEI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEIsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EiLCJmaWxlIjoiMjcuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRWxlbWVudCA9IHJlcXVpcmUoXCIuLi9FbGVtZW50LmpzXCIpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IENvbnRhaW5lcjtcclxudmFyIGp0b3BvUmVzZXQgPSB7XHJcbiAgICBwYWludFRleHQ6IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgdmFyIHRleHQgPSB0aGlzLnRleHQ7XHJcbiAgICAgICAgaWYgKG51bGwgIT0gdGV4dCAmJiBcIlwiICE9IHRleHQpIHtcclxuICAgICAgICAgICAgYS5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgYS5mb250ID0gdGhpcy5mb250O1xyXG4gICAgICAgICAgICB2YXIgZm9udFdpZHRoID0gYS5tZWFzdXJlVGV4dChcIueUsFwiKS53aWR0aDtcclxuICAgICAgICAgICAgdmFyIG1heFdpZHRoID0gZm9udFdpZHRoO1xyXG4gICAgICAgICAgICBhLmZpbGxTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZm9udENvbG9yICsgXCIsMSlcIjsgLy9cIiwgXCIgKyB0aGlzLmFscGhhICsgXCIpXCI75ZCN56ew5rC46L+c5LiN6YCP5piOXHJcbiAgICAgICAgICAgIC8v5o2i6KGM5qOA5rWLXHJcbiAgICAgICAgICAgIHZhciB0ZXh0cyA9IHRleHQuc3BsaXQoXCJcXG5cIik7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGEubWVhc3VyZVRleHQodGV4dHNbaV0pLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgaWYgKHdpZHRoID4gbWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBlID0gdGhpcy5nZXRUZXh0UG9zdGlvbih0aGlzLnRleHRQb3NpdGlvbiwgbWF4V2lkdGgsIGZvbnRXaWR0aCx0ZXh0cy5sZW5ndGgpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRleHRzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dFdpZHRoID0gYS5tZWFzdXJlVGV4dCh0ZXh0c1tqXSkud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBhLmZpbGxUZXh0KHRleHRzW2pdLCBlLnggKyAobWF4V2lkdGggLSB0ZXh0V2lkdGgpIC8gMiwgZS55ICsgaiAqIGZvbnRXaWR0aCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGEuY2xvc2VQYXRoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5mdW5jdGlvbiBDb250YWluZXIoanRvcG8pIHtcclxuICAgIGlmIChqdG9wbykge1xyXG4gICAgICAgIEVsZW1lbnQuY2FsbCh0aGlzLCBqdG9wbyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIFFUb3BvLnV0aWwuZXJyb3IoXCJjcmVhdGUgQ29udGFpbmVyIHdpdGhvdXQganRvcG9cIiwgdGhpcyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNoaWxkcmVuID0gW107XHJcbiAgICB0aGlzLmxpbmtzID0ge1xyXG4gICAgICAgIGluOiBbXSxcclxuICAgICAgICBvdXQ6IFtdXHJcbiAgICB9O1xyXG4gICAgcmVzZXQodGhpcyk7XHJcbn1cclxuUVRvcG8udXRpbC5pbmhlcml0cyhDb250YWluZXIsIEVsZW1lbnQpO1xyXG5mdW5jdGlvbiByZXNldChlbGVtZW50KSB7XHJcbiAgICBlbGVtZW50Lmp0b3BvLnBhaW50VGV4dCA9IGp0b3BvUmVzZXQucGFpbnRUZXh0O1xyXG59XHJcbkNvbnRhaW5lci5wcm90b3R5cGUuc2V0TmFtZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICBpZiAobmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmF0dHIubmFtZVBvc2l0aW9uICE9IFwiaGlkZVwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuanRvcG8udGV4dCA9IG5hbWUudHJpbSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmF0dHIubmFtZSA9IG5hbWUudHJpbSgpO1xyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICog5bCG5YWD57Sg5Yqg5YWl5YiG57uE5YaFXHJcbiAqIEBwYXJhbSBlbGVtZW50XHJcbiAqL1xyXG5Db250YWluZXIucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICB2YXIgc2VsZj10aGlzO1xyXG4gICAgaWYgKCEkLmlzQXJyYXkodGhpcy5jaGlsZHJlbikpIHtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XHJcbiAgICB9XHJcbiAgICBpZiAoJC5pc0FycmF5KGVsZW1lbnQpKSB7XHJcbiAgICAgICAgJC5lYWNoKGVsZW1lbnQsZnVuY3Rpb24oaSxlbCl7XHJcbiAgICAgICAgICAgIGFkZE9uY2UoZWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgYWRkT25jZShlbGVtZW50KTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGFkZE9uY2UoZWxlbWVudCl7XHJcbiAgICAgICAgaWYgKGVsZW1lbnQmJmNoZWNrKGVsZW1lbnQpJiYhc2VsZi5pc0NoaWxkKGVsZW1lbnQpKSB7XHJcbiAgICAgICAgICAgIHNlbGYuY2hpbGRyZW4ucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgZWxlbWVudC5wYXJlbnQgPSBzZWxmO1xyXG4gICAgICAgICAgICBzZWxmLmp0b3BvLmFkZChlbGVtZW50Lmp0b3BvKTtcclxuICAgICAgICAgICAgaWYgKHNlbGYuYXR0ci5jaGlsZHJlbiAmJiB0eXBlb2Ygc2VsZi5hdHRyLmNoaWxkcmVuLmRyYWdibGUgPT0gXCJib29sZWFuXCIpIHtcclxuICAgICAgICAgICAgICAgIC8v6Iul5YiG57uE5LiN5YWB6K6456e75Yqo57uE5YaF5YWD57Sg77yM5omL5Yqo6K6+572u5YWD57Sg5LiN5Y+v56e75YqoXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnNldERyYWdhYmxlKHNlbGYuYXR0ci5jaGlsZHJlbi5kcmFnYmxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGNoZWNrKGVsZW1lbnQpe1xyXG4gICAgICAgIHJldHVybiBlbGVtZW50LmdldFR5cGUoKT09UVRvcG8uY29uc3RhbnQuTk9ERSYmZWxlbWVudC5nZXRVc2VUeXBlKCkhPVFUb3BvLmNvbnN0YW50LkNBU1VBTCYmIWVsZW1lbnQucGFyZW50O1xyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICog5bCG5a2Q5YWD57Sg5LuO5YiG57uE5Lit5Yig6ZmkXHJcbiAqIEBwYXJhbSBlbGVtZW50XHJcbiAqL1xyXG5Db250YWluZXIucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICBpZiAoJC5pc0FycmF5KHRoaXMuY2hpbGRyZW4pICYmIHRoaXMuaXNDaGlsZChlbGVtZW50KSkge1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKHRoaXMuY2hpbGRyZW4uaW5kZXhPZihlbGVtZW50KSwgMSk7XHJcbiAgICAgICAgZGVsZXRlIGVsZW1lbnQucGFyZW50O1xyXG4gICAgICAgIHRoaXMuanRvcG8ucmVtb3ZlKGVsZW1lbnQuanRvcG8pO1xyXG4gICAgICAgIC8v56e76Zmk5YWD57Sg77yM5bqU5omL5Yqo6K6+5Zue5YWD57Sg5Y+v56e75YqoXHJcbiAgICAgICAgZWxlbWVudC5zZXREcmFnYWJsZSh0cnVlKTtcclxuICAgIH1cclxufTtcclxuQ29udGFpbmVyLnByb3RvdHlwZS5nZXRDaGlsZHJlbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBjaGlsZHJlbiA9IFtdO1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgaWYgKHNlbGYuanRvcG8gJiYgc2VsZi5qdG9wby5jaGlsZHMpIHtcclxuICAgICAgICAkLmVhY2goc2VsZi5qdG9wby5jaGlsZHMsIGZ1bmN0aW9uIChpLCB2KSB7XHJcbiAgICAgICAgICAgIGlmICh2LnF0b3BvKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHYucXRvcG8pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgUVRvcG8udXRpbC5lcnJvcih0aGlzLCBcInRoZSBjaGlsZCBub3Qgd3JhcGVkIGJ5IHF0b3BvXCIsIHYpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47XHJcbiAgICByZXR1cm4gY2hpbGRyZW47XHJcbn07XHJcbkNvbnRhaW5lci5wcm90b3R5cGUuZ2V0VHlwZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBRVG9wby5jb25zdGFudC5DT05UQUlORVI7XHJcbn07XHJcbkNvbnRhaW5lci5wcm90b3R5cGUuc2V0Q29sb3IgPSBmdW5jdGlvbiAoY29sb3IpIHtcclxuICAgIGlmIChjb2xvcikge1xyXG4gICAgICAgIGNvbG9yID0gUVRvcG8udXRpbC50cmFuc0hleChjb2xvci50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICB0aGlzLmp0b3BvLmZpbGxDb2xvciA9IGNvbG9yO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLmNvbG9yID0gdGhpcy5qdG9wby5maWxsQ29sb3I7XHJcbn07XHJcbkNvbnRhaW5lci5wcm90b3R5cGUuc2V0Q2hpbGRyZW4gPSBmdW5jdGlvbiAoY2hpbGRyZW4pIHtcclxuICAgIHZhciBqdG9wbyA9IHRoaXMuanRvcG87XHJcbiAgICBpZiAoY2hpbGRyZW4pIHtcclxuICAgICAgICBpZiAodHlwZW9mIGNoaWxkcmVuLmRyYWdibGUgPT0gXCJib29sZWFuXCIpIHtcclxuICAgICAgICAgICAgdGhpcy5qdG9wby5jaGlsZERyYWdibGUgPSBjaGlsZHJlbi5kcmFnYmxlO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5baV0uc2V0RHJhZ2FibGUoY2hpbGRyZW4uZHJhZ2JsZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIuY2hpbGRyZW4uZHJhZ2JsZSA9IGp0b3BvLmNoaWxkRHJhZ2JsZTtcclxufTtcclxuLyoqXHJcbiAqIOWIhue7hOWIh+aNoizlnKhzY2VuZeWIm+W7uuWIhue7hOaXtuWPr+mAieaYr+WQpuaPkOS+m+WIh+aNou+8jOiLpeaXoOWIh+aNouiKgueCue+8jOivpeaWueazleaXoOWKqOS9nFxyXG4gKiBAcGFyYW0gZmxhZyDkuLp0cnVl5YiZ57yp5pS+5Li6ZmFsc2XliJnlsZXlvIDvvIzml6DlgLzliJnmoLnmja7njrDnirbliIfmjaIsXHJcbiAqL1xyXG5Db250YWluZXIucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uIChmbGFnKSB7XHJcbiAgICBpZiAodGhpcy50b2dnbGVUbykge1xyXG4gICAgICAgIHZhciBnSnRvcG8gPSB0aGlzLmp0b3BvO1xyXG4gICAgICAgIHZhciBuSnRvcG8gPSB0aGlzLnRvZ2dsZVRvLmp0b3BvO1xyXG4gICAgICAgIHZhciB0b2RvID0gdHlwZW9mIGZsYWcgPT0gXCJib29sZWFuXCIgPyBmbGFnIDogZ0p0b3BvLnZpc2libGU7XHJcbiAgICAgICAgaWYgKHRvZG8pIHtcclxuICAgICAgICAgICAgLy/nvKnmlL5cclxuICAgICAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlVG8uc2hvdygpO1xyXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVRvLnNldFBvc2l0aW9uKFtnSnRvcG8uY3ggLSBuSnRvcG8ud2lkdGggLyAyLCBnSnRvcG8uY3kgLSBuSnRvcG8uaGVpZ2h0IC8gMl0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8v5bGV5byAXHJcbiAgICAgICAgICAgIHRoaXMuc2hvdygpO1xyXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVRvLmhpZGUoKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbihbbkp0b3BvLmN4IC0gZ0p0b3BvLndpZHRoIC8gMiwgbkp0b3BvLmN5IC0gZ0p0b3BvLmhlaWdodCAvIDJdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcbi8qKlxyXG4gKiDliKTmlq3lhYPntKDmmK/lkKblt7LmmK/lrZDlhYPntKBcclxuICogQHBhcmFtIGVsZW1lbnQg5Yik5pat55qE5a2Q5YWD57SgXHJcbiAqL1xyXG5Db250YWluZXIucHJvdG90eXBlLmlzQ2hpbGQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgaWYgKCQuaXNBcnJheSh0aGlzLmNoaWxkcmVuKSkge1xyXG4gICAgICAgIHZhciBpbmRleD10aGlzLmNoaWxkcmVuLmluZGV4T2YoZWxlbWVudCk7XHJcbiAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50ICE9IHRoaXMmJiBpbmRleD4gLTEpIHtcclxuICAgICAgICAgICAgUVRvcG8udXRpbC5lcnJvcihcInNvbWUgZ3JvdXAgZ2V0IGVycm9yLHRoZSBjaGlsZCdzIHBhcmVudCBpcyBub3QgaXQgYW5kIHRoZSBjaGlsZCBpbiBpdHMgY2hpbGRyZW4saW5kZXggaXMgXCIraW5kZXgsIHRoaXMsZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbmRleD4tMTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICog5Yik5pat5YWD57Sg5piv5ZCm5Zyo5YiG57uE6KaG55uW55qE6IyD5Zu05YaFLOS4tOaXtuWFg+e0oOS4jeiAg+iZkVxyXG4gKiBAcGFyYW0gZWxlbWVudFxyXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICovXHJcbkNvbnRhaW5lci5wcm90b3R5cGUuaXNJbnNpZGUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgaWYgKGVsZW1lbnQgJiYgZWxlbWVudC5nZXRUeXBlKCkgIT0gUVRvcG8uY29uc3RhbnQuQ0FTVUFMKSB7XHJcbiAgICAgICAgdmFyIGNlbnRlciA9IGVsZW1lbnQuZ2V0Q2VudGVyUG9zaXRpb24oKTtcclxuICAgICAgICByZXR1cm4gIXRoaXMuaXNDaGlsZChlbGVtZW50KSAmJiBjZW50ZXIueCA+IHRoaXMueCAmJiBjZW50ZXIueCA8ICh0aGlzLnggKyB0aGlzLndpZHRoKSAmJiBjZW50ZXIueSA+IHRoaXMueSAmJiBjZW50ZXIueSA8ICh0aGlzLnkgKyB0aGlzLmhlaWdodCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIOWunuS+i+W6j+WIl+WMllxyXG4gKi9cclxuQ29udGFpbmVyLnByb3RvdHlwZS50b0pzb249ZnVuY3Rpb24oKXtcclxuICAgIHZhciBqc29uPSQuZXh0ZW5kKHt9LHRoaXMuYXR0cik7XHJcbiAgICBqc29uLmV4dHJhPSQuZXh0ZW5kKHt9LHRoaXMuZXh0cmEpO1xyXG4gICAganNvbi5jaGlsZHJlbj1bXTtcclxuICAgIHRoaXMuY2hpbGRyZW4ubWFwKGZ1bmN0aW9uKGNoaWxkKXtcclxuICAgICAgICBqc29uLmNoaWxkcmVuLnB1c2goY2hpbGQuZ2V0KCdqc29uSWQnKSk7XHJcbiAgICB9KTtcclxuICAgIGpzb24udG9nZ2xlPXRoaXMudG9nZ2xlVG8udG9Kc29uKCk7XHJcbiAgICByZXR1cm4ganNvbjtcclxufTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2RldmVsb3AvY29yZS9lbGVtZW50L2NvbnRhaW5lci9Db250YWluZXIuanNcbi8vIG1vZHVsZSBpZCA9IDI3XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJzb3VyY2VSb290IjoiIn0=')},28:function(module,exports,__webpack_require__){eval("var Container=__webpack_require__(27);\r\nmodule.exports =  {\r\n    constructor:Group,\r\n    setDefault:setDefault,\r\n    getDefault:getDefault\r\n};\r\n//-\r\nvar DEFAULT = {\r\n        name: 'group',\r\n        font:{\r\n            size:16,\r\n            type:\"微软雅黑\",\r\n            color:'255,255,255'\r\n        },\r\n        color: '10,10,100',\r\n        alpha: 0.5,\r\n        dragable: true,\r\n        zIndex: 10,\r\n        jsonId:\"\",\r\n        border:{\r\n            width:0,\r\n            radius:30,//最大160 最小0\r\n            color:\"255,0,0\"\r\n        },\r\n        size:[500,500],\r\n        position:[0,0],\r\n        namePosition: 'bottom',//Bottom_Center Top_Center Middle_Left Middle_Right Hidden,\r\n        layout: {\r\n            type:\"default\"\r\n        },\r\n        children:{\r\n            showLink: false,\r\n            showName: true,\r\n            dragble: true\r\n        },\r\n        useType:QTopo.constant.container.GROUP\r\n};\r\nfunction setDefault(config){\r\n    QTopo.util.extend(DEFAULT, config || {});\r\n}\r\nfunction getDefault(){\r\n    return QTopo.util.deepClone(DEFAULT);\r\n}\r\n//-\r\n//----\r\n//----\r\nfunction Group(config) {\r\n    this.attr =  QTopo.util.extend(getDefault(), config || {});\r\n    Container.call(this, new JTopo.Container());\r\n    //函数\r\n    this.set = setJTopo;\r\n    //初始化\r\n    this.set(this.attr);\r\n}\r\nQTopo.util.inherits(Group,Container);\r\n//-\r\nvar fixedLayout=function(group, children){\r\n    if(this.qtopo){\r\n        if(group.width==0||group.height==0){\r\n            group.width=this.qtopo.attr.size[0];\r\n            group.height=this.qtopo.attr.size[1];\r\n        }\r\n        if(group.width>0&&group.height>0){\r\n            var groupBound=group.getBound();\r\n            children.map(function(child){\r\n                resetLocation(groupBound,child);\r\n            });\r\n        }else{\r\n            //若未设置高宽则运行一次自动布局设置高宽\r\n            JTopo.Layout.AutoBoundLayout()(group, children);\r\n        }\r\n    }else{\r\n        QTopo.util.error(\"the container not wrap with qtopo\",this);\r\n    }\r\n};\r\nfunction resetLocation(groupBound,child){\r\n    var childBound=child.getBound();\r\n    var location=child.getLocation();\r\n    if(childBound.bottom>groupBound.bottom){\r\n        location.y=groupBound.bottom-childBound.height;\r\n    }\r\n    if(childBound.right>groupBound.right){\r\n        location.x=groupBound.right-childBound.width;\r\n    }\r\n    if(childBound.left<groupBound.left){\r\n        location.x=groupBound.left;\r\n    }\r\n    if(childBound.top<groupBound.top){\r\n        location.y=groupBound.top;\r\n    }\r\n    child.setLocation(location.x,location.y);\r\n}\r\nfunction setJTopo(config) {\r\n    if (config) {\r\n        var self=this;\r\n        self._setAttr(config);\r\n    }\r\n}\r\n//-\r\nGroup.prototype.setLayout=function(layout){\r\n    var selected;\r\n    if (layout) {\r\n        switch (layout.type) {\r\n            case 'flow':\r\n                // 流式布局（水平,垂直间隔)\r\n                selected = JTopo.layout.FlowLayout(parseInt(layout.row), parseInt(layout.column));\r\n                this.attr.layout=layout;\r\n                break;\r\n            case 'grid':\r\n                // 网格布局(行,列)\r\n                var rows=parseInt(layout.row);\r\n                var columns=parseInt(layout.column);\r\n                if(rows*columns<this.children.length){\r\n                    QTopo.util.error(\"GridLayout's row*column need bigger than group's children length\");\r\n                    columns=rows= Math.ceil(Math.sqrt(todo.target.children.length));\r\n                }\r\n                selected = JTopo.layout.GridLayout(rows,columns);\r\n                this.attr.layout=layout;\r\n                break;\r\n            case 'fixed':\r\n                //固定长宽布局\r\n                selected = fixedLayout;\r\n                this.attr.layout=layout;\r\n                break;\r\n            default:\r\n                selected = JTopo.Layout.AutoBoundLayout();\r\n                this.attr.layout={};\r\n                this.attr.layout.type=\"default\";\r\n        }\r\n    } else {\r\n        selected = JTopo.Layout.AutoBoundLayout();\r\n        this.attr.layout={};\r\n        this.attr.layout.type=\"default\";\r\n    }\r\n    this.jtopo.layout = selected;\r\n};\r\nGroup.prototype.getDefault=getDefault;\r\n//-//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9jb250YWluZXIvR3JvdXAuanM/YjdmYSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RDtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIyOC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBDb250YWluZXI9cmVxdWlyZShcIi4vQ29udGFpbmVyLmpzXCIpO1xyXG5tb2R1bGUuZXhwb3J0cyA9ICB7XHJcbiAgICBjb25zdHJ1Y3RvcjpHcm91cCxcclxuICAgIHNldERlZmF1bHQ6c2V0RGVmYXVsdCxcclxuICAgIGdldERlZmF1bHQ6Z2V0RGVmYXVsdFxyXG59O1xyXG4vLy1cclxudmFyIERFRkFVTFQgPSB7XHJcbiAgICAgICAgbmFtZTogJ2dyb3VwJyxcclxuICAgICAgICBmb250OntcclxuICAgICAgICAgICAgc2l6ZToxNixcclxuICAgICAgICAgICAgdHlwZTpcIuW+rui9r+mbhem7kVwiLFxyXG4gICAgICAgICAgICBjb2xvcjonMjU1LDI1NSwyNTUnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb2xvcjogJzEwLDEwLDEwMCcsXHJcbiAgICAgICAgYWxwaGE6IDAuNSxcclxuICAgICAgICBkcmFnYWJsZTogdHJ1ZSxcclxuICAgICAgICB6SW5kZXg6IDEwLFxyXG4gICAgICAgIGpzb25JZDpcIlwiLFxyXG4gICAgICAgIGJvcmRlcjp7XHJcbiAgICAgICAgICAgIHdpZHRoOjAsXHJcbiAgICAgICAgICAgIHJhZGl1czozMCwvL+acgOWkpzE2MCDmnIDlsI8wXHJcbiAgICAgICAgICAgIGNvbG9yOlwiMjU1LDAsMFwiXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzaXplOls1MDAsNTAwXSxcclxuICAgICAgICBwb3NpdGlvbjpbMCwwXSxcclxuICAgICAgICBuYW1lUG9zaXRpb246ICdib3R0b20nLC8vQm90dG9tX0NlbnRlciBUb3BfQ2VudGVyIE1pZGRsZV9MZWZ0IE1pZGRsZV9SaWdodCBIaWRkZW4sXHJcbiAgICAgICAgbGF5b3V0OiB7XHJcbiAgICAgICAgICAgIHR5cGU6XCJkZWZhdWx0XCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNoaWxkcmVuOntcclxuICAgICAgICAgICAgc2hvd0xpbms6IGZhbHNlLFxyXG4gICAgICAgICAgICBzaG93TmFtZTogdHJ1ZSxcclxuICAgICAgICAgICAgZHJhZ2JsZTogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdXNlVHlwZTpRVG9wby5jb25zdGFudC5jb250YWluZXIuR1JPVVBcclxufTtcclxuZnVuY3Rpb24gc2V0RGVmYXVsdChjb25maWcpe1xyXG4gICAgUVRvcG8udXRpbC5leHRlbmQoREVGQVVMVCwgY29uZmlnIHx8IHt9KTtcclxufVxyXG5mdW5jdGlvbiBnZXREZWZhdWx0KCl7XHJcbiAgICByZXR1cm4gUVRvcG8udXRpbC5kZWVwQ2xvbmUoREVGQVVMVCk7XHJcbn1cclxuLy8tXHJcbi8vLS0tLVxyXG4vLy0tLS1cclxuZnVuY3Rpb24gR3JvdXAoY29uZmlnKSB7XHJcbiAgICB0aGlzLmF0dHIgPSAgUVRvcG8udXRpbC5leHRlbmQoZ2V0RGVmYXVsdCgpLCBjb25maWcgfHwge30pO1xyXG4gICAgQ29udGFpbmVyLmNhbGwodGhpcywgbmV3IEpUb3BvLkNvbnRhaW5lcigpKTtcclxuICAgIC8v5Ye95pWwXHJcbiAgICB0aGlzLnNldCA9IHNldEpUb3BvO1xyXG4gICAgLy/liJ3lp4vljJZcclxuICAgIHRoaXMuc2V0KHRoaXMuYXR0cik7XHJcbn1cclxuUVRvcG8udXRpbC5pbmhlcml0cyhHcm91cCxDb250YWluZXIpO1xyXG4vLy1cclxudmFyIGZpeGVkTGF5b3V0PWZ1bmN0aW9uKGdyb3VwLCBjaGlsZHJlbil7XHJcbiAgICBpZih0aGlzLnF0b3BvKXtcclxuICAgICAgICBpZihncm91cC53aWR0aD09MHx8Z3JvdXAuaGVpZ2h0PT0wKXtcclxuICAgICAgICAgICAgZ3JvdXAud2lkdGg9dGhpcy5xdG9wby5hdHRyLnNpemVbMF07XHJcbiAgICAgICAgICAgIGdyb3VwLmhlaWdodD10aGlzLnF0b3BvLmF0dHIuc2l6ZVsxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZ3JvdXAud2lkdGg+MCYmZ3JvdXAuaGVpZ2h0PjApe1xyXG4gICAgICAgICAgICB2YXIgZ3JvdXBCb3VuZD1ncm91cC5nZXRCb3VuZCgpO1xyXG4gICAgICAgICAgICBjaGlsZHJlbi5tYXAoZnVuY3Rpb24oY2hpbGQpe1xyXG4gICAgICAgICAgICAgICAgcmVzZXRMb2NhdGlvbihncm91cEJvdW5kLGNoaWxkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIC8v6Iul5pyq6K6+572u6auY5a695YiZ6L+Q6KGM5LiA5qyh6Ieq5Yqo5biD5bGA6K6+572u6auY5a69XHJcbiAgICAgICAgICAgIEpUb3BvLkxheW91dC5BdXRvQm91bmRMYXlvdXQoKShncm91cCwgY2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuICAgIH1lbHNle1xyXG4gICAgICAgIFFUb3BvLnV0aWwuZXJyb3IoXCJ0aGUgY29udGFpbmVyIG5vdCB3cmFwIHdpdGggcXRvcG9cIix0aGlzKTtcclxuICAgIH1cclxufTtcclxuZnVuY3Rpb24gcmVzZXRMb2NhdGlvbihncm91cEJvdW5kLGNoaWxkKXtcclxuICAgIHZhciBjaGlsZEJvdW5kPWNoaWxkLmdldEJvdW5kKCk7XHJcbiAgICB2YXIgbG9jYXRpb249Y2hpbGQuZ2V0TG9jYXRpb24oKTtcclxuICAgIGlmKGNoaWxkQm91bmQuYm90dG9tPmdyb3VwQm91bmQuYm90dG9tKXtcclxuICAgICAgICBsb2NhdGlvbi55PWdyb3VwQm91bmQuYm90dG9tLWNoaWxkQm91bmQuaGVpZ2h0O1xyXG4gICAgfVxyXG4gICAgaWYoY2hpbGRCb3VuZC5yaWdodD5ncm91cEJvdW5kLnJpZ2h0KXtcclxuICAgICAgICBsb2NhdGlvbi54PWdyb3VwQm91bmQucmlnaHQtY2hpbGRCb3VuZC53aWR0aDtcclxuICAgIH1cclxuICAgIGlmKGNoaWxkQm91bmQubGVmdDxncm91cEJvdW5kLmxlZnQpe1xyXG4gICAgICAgIGxvY2F0aW9uLng9Z3JvdXBCb3VuZC5sZWZ0O1xyXG4gICAgfVxyXG4gICAgaWYoY2hpbGRCb3VuZC50b3A8Z3JvdXBCb3VuZC50b3Ape1xyXG4gICAgICAgIGxvY2F0aW9uLnk9Z3JvdXBCb3VuZC50b3A7XHJcbiAgICB9XHJcbiAgICBjaGlsZC5zZXRMb2NhdGlvbihsb2NhdGlvbi54LGxvY2F0aW9uLnkpO1xyXG59XHJcbmZ1bmN0aW9uIHNldEpUb3BvKGNvbmZpZykge1xyXG4gICAgaWYgKGNvbmZpZykge1xyXG4gICAgICAgIHZhciBzZWxmPXRoaXM7XHJcbiAgICAgICAgc2VsZi5fc2V0QXR0cihjb25maWcpO1xyXG4gICAgfVxyXG59XHJcbi8vLVxyXG5Hcm91cC5wcm90b3R5cGUuc2V0TGF5b3V0PWZ1bmN0aW9uKGxheW91dCl7XHJcbiAgICB2YXIgc2VsZWN0ZWQ7XHJcbiAgICBpZiAobGF5b3V0KSB7XHJcbiAgICAgICAgc3dpdGNoIChsYXlvdXQudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdmbG93JzpcclxuICAgICAgICAgICAgICAgIC8vIOa1geW8j+W4g+WxgO+8iOawtOW5syzlnoLnm7Tpl7TpmpQpXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IEpUb3BvLmxheW91dC5GbG93TGF5b3V0KHBhcnNlSW50KGxheW91dC5yb3cpLCBwYXJzZUludChsYXlvdXQuY29sdW1uKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF0dHIubGF5b3V0PWxheW91dDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdncmlkJzpcclxuICAgICAgICAgICAgICAgIC8vIOe9keagvOW4g+WxgCjooYws5YiXKVxyXG4gICAgICAgICAgICAgICAgdmFyIHJvd3M9cGFyc2VJbnQobGF5b3V0LnJvdyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1ucz1wYXJzZUludChsYXlvdXQuY29sdW1uKTtcclxuICAgICAgICAgICAgICAgIGlmKHJvd3MqY29sdW1uczx0aGlzLmNoaWxkcmVuLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgICAgUVRvcG8udXRpbC5lcnJvcihcIkdyaWRMYXlvdXQncyByb3cqY29sdW1uIG5lZWQgYmlnZ2VyIHRoYW4gZ3JvdXAncyBjaGlsZHJlbiBsZW5ndGhcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1ucz1yb3dzPSBNYXRoLmNlaWwoTWF0aC5zcXJ0KHRvZG8udGFyZ2V0LmNoaWxkcmVuLmxlbmd0aCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQgPSBKVG9wby5sYXlvdXQuR3JpZExheW91dChyb3dzLGNvbHVtbnMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRyLmxheW91dD1sYXlvdXQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZml4ZWQnOlxyXG4gICAgICAgICAgICAgICAgLy/lm7rlrprplb/lrr3luIPlsYBcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gZml4ZWRMYXlvdXQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF0dHIubGF5b3V0PWxheW91dDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQgPSBKVG9wby5MYXlvdXQuQXV0b0JvdW5kTGF5b3V0KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF0dHIubGF5b3V0PXt9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRyLmxheW91dC50eXBlPVwiZGVmYXVsdFwiO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc2VsZWN0ZWQgPSBKVG9wby5MYXlvdXQuQXV0b0JvdW5kTGF5b3V0KCk7XHJcbiAgICAgICAgdGhpcy5hdHRyLmxheW91dD17fTtcclxuICAgICAgICB0aGlzLmF0dHIubGF5b3V0LnR5cGU9XCJkZWZhdWx0XCI7XHJcbiAgICB9XHJcbiAgICB0aGlzLmp0b3BvLmxheW91dCA9IHNlbGVjdGVkO1xyXG59O1xyXG5Hcm91cC5wcm90b3R5cGUuZ2V0RGVmYXVsdD1nZXREZWZhdWx0O1xyXG4vLy1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2RldmVsb3AvY29yZS9lbGVtZW50L2NvbnRhaW5lci9Hcm91cC5qc1xuLy8gbW9kdWxlIGlkID0gMjhcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sInNvdXJjZVJvb3QiOiIifQ==")},29:function(module,exports,__webpack_require__){eval("var Line=__webpack_require__(30);\r\nmodule.exports =  {\r\n    constructor:DirectLine,\r\n    setDefault:setDefault,\r\n    getDefault:getDefault\r\n};\r\n//-\r\nvar DEFAULT={\r\n        num: 1,\r\n        alpha:1,\r\n        color: '22,124,255',\r\n        arrow:{\r\n            size:null,\r\n            offset:0,\r\n            start:false,\r\n            end:true\r\n        },\r\n        jsonId:\"\",\r\n        gap:20,\r\n        position:{\r\n            start:[0,0],\r\n            end:[0,100]\r\n        },\r\n        path:{\r\n            start:{},\r\n            end:{}\r\n        },\r\n        width: 2,\r\n        dashed:  null,\r\n        zIndex : 80,\r\n        font:{\r\n            size:16,\r\n            type:\"微软雅黑\",\r\n            color:'255,255,255'\r\n        },\r\n        useType: QTopo.constant.line.DIRECT,\r\n        bundleOffset:60// 多条直线时，线条折线拐角处的长度\r\n};\r\nfunction setDefault(config){\r\n    QTopo.util.extend(DEFAULT, config || {});\r\n}\r\nfunction getDefault(){\r\n    return QTopo.util.deepClone(DEFAULT);\r\n}\r\n//-\r\n//----\r\nvar jtopoReset={\r\n    //双向箭头\r\n    getStartPosition:function () {\r\n        var a;\r\n        return null != this.arrowsRadius && (a = (function (thisl) {\r\n            var b = thisl.nodeA, c = thisl.nodeZ;\r\n            var d = JTopo.util.lineF(b.cx, b.cy, c.cx, c.cy);\r\n            var e = b.getBound();\r\n            return f = JTopo.util.intersectionLineBound(d, e);\r\n        })(this)), null == a && (a = {\r\n            x: this.nodeA.cx,\r\n            y: this.nodeA.cy\r\n        }), a;\r\n    },\r\n    paintPath:function (a, b) {\r\n        if (this.nodeA === this.nodeZ) return void this.paintLoop(a);\r\n        a.beginPath(),\r\n            a.moveTo(b[0].x, b[0].y);\r\n        for (var c = 1; c < b.length; c++) {\r\n            null == this.dashedPattern ? (\r\n                (null == this.PointPathColor ? a.lineTo(b[c].x, b[c].y) : a.JtopoDrawPointPath(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, a.strokeStyle, this.PointPathColor))\r\n            ) : a.JTopoDashedLineTo(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, this.dashedPattern)\r\n        }\r\n        if (a.stroke(), a.closePath(), null != this.arrowsRadius) {\r\n            if (this.qtopo.attr.arrow.end) {\r\n                this.paintArrow(a, b[0], b[b.length - 1]);\r\n            }//终点箭头\r\n            if (this.qtopo.attr.arrow.start) {\r\n                this.paintArrow(a, b[b.length - 1], b[0]);\r\n            }//起点箭头\r\n        }\r\n    }\r\n};\r\n//----\r\nfunction DirectLine(config) {\r\n    this.attr =  QTopo.util.extend(getDefault(), config || {});\r\n    //line基于不加入画布的节点之间的线生成\r\n    Line.call(this,new JTopo.Link(new JTopo.Node(), new JTopo.Node()));\r\n    //函数\r\n    this.set = setJTopo;\r\n    //初始化\r\n    this.set(this.attr);\r\n    //源码修改\r\n    reset(this);\r\n}\r\nQTopo.util.inherits(DirectLine,Line);\r\nfunction setJTopo(config) {\r\n    if (config) {\r\n        var self=this;\r\n        self._setAttr(config);\r\n    }\r\n}\r\nfunction reset(Line){\r\n    Line.jtopo.getStartPosition = jtopoReset.getStartPosition;\r\n    Line.jtopo.paintPath = jtopoReset.paintPath;\r\n}\r\nDirectLine.prototype.setBundleOffset=function(bundleOffset){\r\n    if($.isNumeric(bundleOffset)){\r\n        this.jtopo.bundleOffset=parseInt(bundleOffset);\r\n    }\r\n    this.attr.bundleOffset=this.jtopo.bundleOffset;\r\n};\r\nDirectLine.prototype.getDefault=getDefault;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9saW5lL0RpcmVjdC5qcz85OTFmIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGNBQWM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIyOS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBMaW5lPXJlcXVpcmUoXCIuL0xpbmUuanNcIik7XHJcbm1vZHVsZS5leHBvcnRzID0gIHtcclxuICAgIGNvbnN0cnVjdG9yOkRpcmVjdExpbmUsXHJcbiAgICBzZXREZWZhdWx0OnNldERlZmF1bHQsXHJcbiAgICBnZXREZWZhdWx0OmdldERlZmF1bHRcclxufTtcclxuLy8tXHJcbnZhciBERUZBVUxUPXtcclxuICAgICAgICBudW06IDEsXHJcbiAgICAgICAgYWxwaGE6MSxcclxuICAgICAgICBjb2xvcjogJzIyLDEyNCwyNTUnLFxyXG4gICAgICAgIGFycm93OntcclxuICAgICAgICAgICAgc2l6ZTpudWxsLFxyXG4gICAgICAgICAgICBvZmZzZXQ6MCxcclxuICAgICAgICAgICAgc3RhcnQ6ZmFsc2UsXHJcbiAgICAgICAgICAgIGVuZDp0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBqc29uSWQ6XCJcIixcclxuICAgICAgICBnYXA6MjAsXHJcbiAgICAgICAgcG9zaXRpb246e1xyXG4gICAgICAgICAgICBzdGFydDpbMCwwXSxcclxuICAgICAgICAgICAgZW5kOlswLDEwMF1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHBhdGg6e1xyXG4gICAgICAgICAgICBzdGFydDp7fSxcclxuICAgICAgICAgICAgZW5kOnt9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB3aWR0aDogMixcclxuICAgICAgICBkYXNoZWQ6ICBudWxsLFxyXG4gICAgICAgIHpJbmRleCA6IDgwLFxyXG4gICAgICAgIGZvbnQ6e1xyXG4gICAgICAgICAgICBzaXplOjE2LFxyXG4gICAgICAgICAgICB0eXBlOlwi5b6u6L2v6ZuF6buRXCIsXHJcbiAgICAgICAgICAgIGNvbG9yOicyNTUsMjU1LDI1NSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHVzZVR5cGU6IFFUb3BvLmNvbnN0YW50LmxpbmUuRElSRUNULFxyXG4gICAgICAgIGJ1bmRsZU9mZnNldDo2MC8vIOWkmuadoeebtOe6v+aXtu+8jOe6v+adoeaKmOe6v+aLkOinkuWkhOeahOmVv+W6plxyXG59O1xyXG5mdW5jdGlvbiBzZXREZWZhdWx0KGNvbmZpZyl7XHJcbiAgICBRVG9wby51dGlsLmV4dGVuZChERUZBVUxULCBjb25maWcgfHwge30pO1xyXG59XHJcbmZ1bmN0aW9uIGdldERlZmF1bHQoKXtcclxuICAgIHJldHVybiBRVG9wby51dGlsLmRlZXBDbG9uZShERUZBVUxUKTtcclxufVxyXG4vLy1cclxuLy8tLS0tXHJcbnZhciBqdG9wb1Jlc2V0PXtcclxuICAgIC8v5Y+M5ZCR566t5aS0XHJcbiAgICBnZXRTdGFydFBvc2l0aW9uOmZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgYTtcclxuICAgICAgICByZXR1cm4gbnVsbCAhPSB0aGlzLmFycm93c1JhZGl1cyAmJiAoYSA9IChmdW5jdGlvbiAodGhpc2wpIHtcclxuICAgICAgICAgICAgdmFyIGIgPSB0aGlzbC5ub2RlQSwgYyA9IHRoaXNsLm5vZGVaO1xyXG4gICAgICAgICAgICB2YXIgZCA9IEpUb3BvLnV0aWwubGluZUYoYi5jeCwgYi5jeSwgYy5jeCwgYy5jeSk7XHJcbiAgICAgICAgICAgIHZhciBlID0gYi5nZXRCb3VuZCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gZiA9IEpUb3BvLnV0aWwuaW50ZXJzZWN0aW9uTGluZUJvdW5kKGQsIGUpO1xyXG4gICAgICAgIH0pKHRoaXMpKSwgbnVsbCA9PSBhICYmIChhID0ge1xyXG4gICAgICAgICAgICB4OiB0aGlzLm5vZGVBLmN4LFxyXG4gICAgICAgICAgICB5OiB0aGlzLm5vZGVBLmN5XHJcbiAgICAgICAgfSksIGE7XHJcbiAgICB9LFxyXG4gICAgcGFpbnRQYXRoOmZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubm9kZUEgPT09IHRoaXMubm9kZVopIHJldHVybiB2b2lkIHRoaXMucGFpbnRMb29wKGEpO1xyXG4gICAgICAgIGEuYmVnaW5QYXRoKCksXHJcbiAgICAgICAgICAgIGEubW92ZVRvKGJbMF0ueCwgYlswXS55KTtcclxuICAgICAgICBmb3IgKHZhciBjID0gMTsgYyA8IGIubGVuZ3RoOyBjKyspIHtcclxuICAgICAgICAgICAgbnVsbCA9PSB0aGlzLmRhc2hlZFBhdHRlcm4gPyAoXHJcbiAgICAgICAgICAgICAgICAobnVsbCA9PSB0aGlzLlBvaW50UGF0aENvbG9yID8gYS5saW5lVG8oYltjXS54LCBiW2NdLnkpIDogYS5KdG9wb0RyYXdQb2ludFBhdGgoYltjIC0gMV0ueCwgYltjIC0gMV0ueSwgYltjXS54LCBiW2NdLnksIGEuc3Ryb2tlU3R5bGUsIHRoaXMuUG9pbnRQYXRoQ29sb3IpKVxyXG4gICAgICAgICAgICApIDogYS5KVG9wb0Rhc2hlZExpbmVUbyhiW2MgLSAxXS54LCBiW2MgLSAxXS55LCBiW2NdLngsIGJbY10ueSwgdGhpcy5kYXNoZWRQYXR0ZXJuKVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYS5zdHJva2UoKSwgYS5jbG9zZVBhdGgoKSwgbnVsbCAhPSB0aGlzLmFycm93c1JhZGl1cykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5xdG9wby5hdHRyLmFycm93LmVuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWludEFycm93KGEsIGJbMF0sIGJbYi5sZW5ndGggLSAxXSk7XHJcbiAgICAgICAgICAgIH0vL+e7iOeCueeureWktFxyXG4gICAgICAgICAgICBpZiAodGhpcy5xdG9wby5hdHRyLmFycm93LnN0YXJ0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhaW50QXJyb3coYSwgYltiLmxlbmd0aCAtIDFdLCBiWzBdKTtcclxuICAgICAgICAgICAgfS8v6LW354K5566t5aS0XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG4vLy0tLS1cclxuZnVuY3Rpb24gRGlyZWN0TGluZShjb25maWcpIHtcclxuICAgIHRoaXMuYXR0ciA9ICBRVG9wby51dGlsLmV4dGVuZChnZXREZWZhdWx0KCksIGNvbmZpZyB8fCB7fSk7XHJcbiAgICAvL2xpbmXln7rkuo7kuI3liqDlhaXnlLvluIPnmoToioLngrnkuYvpl7TnmoTnur/nlJ/miJBcclxuICAgIExpbmUuY2FsbCh0aGlzLG5ldyBKVG9wby5MaW5rKG5ldyBKVG9wby5Ob2RlKCksIG5ldyBKVG9wby5Ob2RlKCkpKTtcclxuICAgIC8v5Ye95pWwXHJcbiAgICB0aGlzLnNldCA9IHNldEpUb3BvO1xyXG4gICAgLy/liJ3lp4vljJZcclxuICAgIHRoaXMuc2V0KHRoaXMuYXR0cik7XHJcbiAgICAvL+a6kOeggeS/ruaUuVxyXG4gICAgcmVzZXQodGhpcyk7XHJcbn1cclxuUVRvcG8udXRpbC5pbmhlcml0cyhEaXJlY3RMaW5lLExpbmUpO1xyXG5mdW5jdGlvbiBzZXRKVG9wbyhjb25maWcpIHtcclxuICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICB2YXIgc2VsZj10aGlzO1xyXG4gICAgICAgIHNlbGYuX3NldEF0dHIoY29uZmlnKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZXNldChMaW5lKXtcclxuICAgIExpbmUuanRvcG8uZ2V0U3RhcnRQb3NpdGlvbiA9IGp0b3BvUmVzZXQuZ2V0U3RhcnRQb3NpdGlvbjtcclxuICAgIExpbmUuanRvcG8ucGFpbnRQYXRoID0ganRvcG9SZXNldC5wYWludFBhdGg7XHJcbn1cclxuRGlyZWN0TGluZS5wcm90b3R5cGUuc2V0QnVuZGxlT2Zmc2V0PWZ1bmN0aW9uKGJ1bmRsZU9mZnNldCl7XHJcbiAgICBpZigkLmlzTnVtZXJpYyhidW5kbGVPZmZzZXQpKXtcclxuICAgICAgICB0aGlzLmp0b3BvLmJ1bmRsZU9mZnNldD1wYXJzZUludChidW5kbGVPZmZzZXQpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLmJ1bmRsZU9mZnNldD10aGlzLmp0b3BvLmJ1bmRsZU9mZnNldDtcclxufTtcclxuRGlyZWN0TGluZS5wcm90b3R5cGUuZ2V0RGVmYXVsdD1nZXREZWZhdWx0O1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vZGV2ZWxvcC9jb3JlL2VsZW1lbnQvbGluZS9EaXJlY3QuanNcbi8vIG1vZHVsZSBpZCA9IDI5XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJzb3VyY2VSb290IjoiIn0=");
},3:function(module,exports,__webpack_require__){eval('var Element=__webpack_require__(1);\r\nmodule.exports =Node;\r\nfunction Node(jtopo) {\r\n    if(jtopo){\r\n        Element.call(this,jtopo);\r\n    }else{\r\n        QTopo.util.error("create Node without jtopo",this);\r\n    }\r\n    this.links={\r\n        in:[],\r\n        out:[]\r\n    };\r\n    reset(this);\r\n}\r\nQTopo.util.inherits(Node,Element);\r\nfunction reset(element){\r\n    var jtopoReset={\r\n        paintText:function (cx) {\r\n            var text = this.text;\r\n            if (null != text && "" != text) {\r\n                cx.beginPath();\r\n                cx.font = this.font;\r\n                var fontWidth = cx.measureText("田").width;\r\n                var maxWidth = fontWidth;\r\n                cx.fillStyle = "rgba(" + this.fontColor + "," + this.alpha + ")";//;名称永远不透明\r\n                //换行检测\r\n                var texts = text.split("\\n");\r\n                for (var i = 0; i < texts.length; i++) {\r\n                    var width = cx.measureText(texts[i]).width;\r\n                    if (width > maxWidth) {\r\n                        maxWidth = width;\r\n                    }\r\n                }\r\n                var e = this.getTextPostion(this.textPosition, maxWidth, fontWidth,texts.length);\r\n                for(var j = 0; j < texts.length; j++){\r\n                    var textWidth=cx.measureText(texts[j]).width;\r\n                    cx.fillText(texts[j], e.x+(maxWidth-textWidth)/2, e.y+j*fontWidth);\r\n                }\r\n\r\n                cx.closePath();\r\n            }\r\n        }\r\n    };\r\n    element.jtopo.paintText = jtopoReset.paintText;\r\n}\r\nNode.prototype.getType=function(){\r\n    return QTopo.constant.NODE;\r\n};\r\nNode.prototype.setColor = function (color) {\r\n    if (color) {\r\n        color = QTopo.util.transHex(color.toLowerCase());\r\n        this.jtopo.fillColor = color;\r\n    }\r\n    this.attr.color=this.jtopo.fillColor;\r\n};\r\nNode.prototype.setName=function(name){\r\n    if(name){\r\n        if (this.attr.namePosition != "hide") {\r\n            this.jtopo.text = (name+"").trim();\r\n        }\r\n        this.attr.name = (name+"").trim();\r\n    }\r\n};\r\n/**\r\n * 实例序列化\r\n */\r\nNode.prototype.toJson=function(){\r\n    var json=$.extend({},this.attr);\r\n    json.extra=$.extend({},this.extra);\r\n    return json;\r\n};\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9ub2RlL05vZGUuanM/OTA1OCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRixHQUFHO0FBQ3BGO0FBQ0E7QUFDQSwrQkFBK0Isa0JBQWtCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixrQkFBa0I7QUFDaEQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCLDBCQUEwQjtBQUMxQjtBQUNBIiwiZmlsZSI6IjMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRWxlbWVudD1yZXF1aXJlKFwiLi4vRWxlbWVudC5qc1wiKTtcclxubW9kdWxlLmV4cG9ydHMgPU5vZGU7XHJcbmZ1bmN0aW9uIE5vZGUoanRvcG8pIHtcclxuICAgIGlmKGp0b3BvKXtcclxuICAgICAgICBFbGVtZW50LmNhbGwodGhpcyxqdG9wbyk7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiY3JlYXRlIE5vZGUgd2l0aG91dCBqdG9wb1wiLHRoaXMpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5saW5rcz17XHJcbiAgICAgICAgaW46W10sXHJcbiAgICAgICAgb3V0OltdXHJcbiAgICB9O1xyXG4gICAgcmVzZXQodGhpcyk7XHJcbn1cclxuUVRvcG8udXRpbC5pbmhlcml0cyhOb2RlLEVsZW1lbnQpO1xyXG5mdW5jdGlvbiByZXNldChlbGVtZW50KXtcclxuICAgIHZhciBqdG9wb1Jlc2V0PXtcclxuICAgICAgICBwYWludFRleHQ6ZnVuY3Rpb24gKGN4KSB7XHJcbiAgICAgICAgICAgIHZhciB0ZXh0ID0gdGhpcy50ZXh0O1xyXG4gICAgICAgICAgICBpZiAobnVsbCAhPSB0ZXh0ICYmIFwiXCIgIT0gdGV4dCkge1xyXG4gICAgICAgICAgICAgICAgY3guYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICBjeC5mb250ID0gdGhpcy5mb250O1xyXG4gICAgICAgICAgICAgICAgdmFyIGZvbnRXaWR0aCA9IGN4Lm1lYXN1cmVUZXh0KFwi55SwXCIpLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1heFdpZHRoID0gZm9udFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgY3guZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5mb250Q29sb3IgKyBcIixcIiArIHRoaXMuYWxwaGEgKyBcIilcIjsvLzvlkI3np7DmsLjov5zkuI3pgI/mmI5cclxuICAgICAgICAgICAgICAgIC8v5o2i6KGM5qOA5rWLXHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dHMgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXh0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGN4Lm1lYXN1cmVUZXh0KHRleHRzW2ldKS53aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAod2lkdGggPiBtYXhXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5nZXRUZXh0UG9zdGlvbih0aGlzLnRleHRQb3NpdGlvbiwgbWF4V2lkdGgsIGZvbnRXaWR0aCx0ZXh0cy5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8IHRleHRzLmxlbmd0aDsgaisrKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dFdpZHRoPWN4Lm1lYXN1cmVUZXh0KHRleHRzW2pdKS53aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBjeC5maWxsVGV4dCh0ZXh0c1tqXSwgZS54KyhtYXhXaWR0aC10ZXh0V2lkdGgpLzIsIGUueStqKmZvbnRXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY3guY2xvc2VQYXRoKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZWxlbWVudC5qdG9wby5wYWludFRleHQgPSBqdG9wb1Jlc2V0LnBhaW50VGV4dDtcclxufVxyXG5Ob2RlLnByb3RvdHlwZS5nZXRUeXBlPWZ1bmN0aW9uKCl7XHJcbiAgICByZXR1cm4gUVRvcG8uY29uc3RhbnQuTk9ERTtcclxufTtcclxuTm9kZS5wcm90b3R5cGUuc2V0Q29sb3IgPSBmdW5jdGlvbiAoY29sb3IpIHtcclxuICAgIGlmIChjb2xvcikge1xyXG4gICAgICAgIGNvbG9yID0gUVRvcG8udXRpbC50cmFuc0hleChjb2xvci50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICB0aGlzLmp0b3BvLmZpbGxDb2xvciA9IGNvbG9yO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLmNvbG9yPXRoaXMuanRvcG8uZmlsbENvbG9yO1xyXG59O1xyXG5Ob2RlLnByb3RvdHlwZS5zZXROYW1lPWZ1bmN0aW9uKG5hbWUpe1xyXG4gICAgaWYobmFtZSl7XHJcbiAgICAgICAgaWYgKHRoaXMuYXR0ci5uYW1lUG9zaXRpb24gIT0gXCJoaWRlXCIpIHtcclxuICAgICAgICAgICAgdGhpcy5qdG9wby50ZXh0ID0gKG5hbWUrXCJcIikudHJpbSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmF0dHIubmFtZSA9IChuYW1lK1wiXCIpLnRyaW0oKTtcclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIOWunuS+i+W6j+WIl+WMllxyXG4gKi9cclxuTm9kZS5wcm90b3R5cGUudG9Kc29uPWZ1bmN0aW9uKCl7XHJcbiAgICB2YXIganNvbj0kLmV4dGVuZCh7fSx0aGlzLmF0dHIpO1xyXG4gICAganNvbi5leHRyYT0kLmV4dGVuZCh7fSx0aGlzLmV4dHJhKTtcclxuICAgIHJldHVybiBqc29uO1xyXG59O1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2RldmVsb3AvY29yZS9lbGVtZW50L25vZGUvTm9kZS5qc1xuLy8gbW9kdWxlIGlkID0gM1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwic291cmNlUm9vdCI6IiJ9')},30:function(module,exports,__webpack_require__){eval("var Element=__webpack_require__(1);\r\nmodule.exports =Line;\r\nfunction Line(jtopo) {\r\n    if(jtopo){\r\n        Element.call(this,jtopo);\r\n    }else{\r\n        QTopo.util.error(\"create Line without jtopo\",this);\r\n    }\r\n    this.attr.path={\r\n        start:this.jtopo.nodeA,\r\n        end:this.jtopo.nodeZ\r\n    };\r\n}\r\nQTopo.util.inherits(Line,Element);\r\nLine.prototype.setPosition=function(position){\r\n    var start=this.attr.path.start;\r\n    var end=this.attr.path.end;\r\n    if($.isArray(position.start)&&$.isNumeric(position.start[0])&&$.isNumeric(position.start[1])){\r\n        start.setLocation(parseInt(position.start[0]), parseInt(position.start[1]));\r\n    }\r\n    if($.isArray(position.end)&&$.isNumeric(position.end[0])&&$.isNumeric(position.end[1])){\r\n        end.setLocation(parseInt(position.end[0]), parseInt(position.end[1]));\r\n    }\r\n    this.attr.position={\r\n        start:[start.x,start.y],\r\n        end:[end.x,end.y]\r\n    };\r\n};\r\nLine.prototype.getType=function(){\r\n    return QTopo.constant.Line;\r\n};\r\nLine.prototype.setColor = function (color) {\r\n    if (color) {\r\n        this.jtopo.strokeColor = QTopo.util.transHex(color.toLowerCase());\r\n    }\r\n    this.attr.color=this.jtopo.strokeColor;\r\n};\r\nLine.prototype.setNum = function (num) {\r\n    if ($.isNumeric(num)) {\r\n        if(num > 1){\r\n            this.jtopo.text = '(+' + num + ')';\r\n        }else {\r\n            this.jtopo.text = '';\r\n        }\r\n        this.attr.num=num;\r\n    }\r\n};\r\nLine.prototype.setWidth=function(width){\r\n    if($.isNumeric(width)){\r\n        this.jtopo.lineWidth = width; // 线宽\r\n    }\r\n    this.attr.width=this.jtopo.lineWidth;\r\n};\r\nLine.prototype.setArrow = function(arrow){\r\n    if(arrow){\r\n        this.jtopo.arrowsRadius = $.isNumeric(arrow.size)?arrow.size:0;\r\n        this.jtopo.arrowsOffset = $.isNumeric(arrow.offset)?arrow.offset:0;\r\n    }\r\n    if(!this.attr.arrow){\r\n        this.attr.arrow={};\r\n    }\r\n    this.attr.arrow.size=this.jtopo.arrowsRadius;\r\n    this.attr.arrow.offset=this.jtopo.arrowsOffset;\r\n};\r\nLine.prototype.setGap=function(gap){\r\n    if(gap){\r\n        this.jtopo.bundleGap = $.isNumeric(gap)?gap:0; // 线条之间的间隔\r\n    }\r\n    this.attr.gap=this.jtopo.bundleGap;\r\n};\r\nLine.prototype.setDashed=function(dashedPattern){\r\n    if($.isNumeric(dashedPattern)&&dashedPattern>0){\r\n        this.jtopo.dashedPattern=parseInt(dashedPattern);\r\n    }else{\r\n        this.jtopo.dashedPattern=null;\r\n    }\r\n    this.attr.dashed=this.jtopo.dashedPattern;\r\n};\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9saW5lL0xpbmUuanM/YjkwZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0Q7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjMwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIEVsZW1lbnQ9cmVxdWlyZShcIi4uL0VsZW1lbnQuanNcIik7XHJcbm1vZHVsZS5leHBvcnRzID1MaW5lO1xyXG5mdW5jdGlvbiBMaW5lKGp0b3BvKSB7XHJcbiAgICBpZihqdG9wbyl7XHJcbiAgICAgICAgRWxlbWVudC5jYWxsKHRoaXMsanRvcG8pO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgUVRvcG8udXRpbC5lcnJvcihcImNyZWF0ZSBMaW5lIHdpdGhvdXQganRvcG9cIix0aGlzKTtcclxuICAgIH1cclxuICAgIHRoaXMuYXR0ci5wYXRoPXtcclxuICAgICAgICBzdGFydDp0aGlzLmp0b3BvLm5vZGVBLFxyXG4gICAgICAgIGVuZDp0aGlzLmp0b3BvLm5vZGVaXHJcbiAgICB9O1xyXG59XHJcblFUb3BvLnV0aWwuaW5oZXJpdHMoTGluZSxFbGVtZW50KTtcclxuTGluZS5wcm90b3R5cGUuc2V0UG9zaXRpb249ZnVuY3Rpb24ocG9zaXRpb24pe1xyXG4gICAgdmFyIHN0YXJ0PXRoaXMuYXR0ci5wYXRoLnN0YXJ0O1xyXG4gICAgdmFyIGVuZD10aGlzLmF0dHIucGF0aC5lbmQ7XHJcbiAgICBpZigkLmlzQXJyYXkocG9zaXRpb24uc3RhcnQpJiYkLmlzTnVtZXJpYyhwb3NpdGlvbi5zdGFydFswXSkmJiQuaXNOdW1lcmljKHBvc2l0aW9uLnN0YXJ0WzFdKSl7XHJcbiAgICAgICAgc3RhcnQuc2V0TG9jYXRpb24ocGFyc2VJbnQocG9zaXRpb24uc3RhcnRbMF0pLCBwYXJzZUludChwb3NpdGlvbi5zdGFydFsxXSkpO1xyXG4gICAgfVxyXG4gICAgaWYoJC5pc0FycmF5KHBvc2l0aW9uLmVuZCkmJiQuaXNOdW1lcmljKHBvc2l0aW9uLmVuZFswXSkmJiQuaXNOdW1lcmljKHBvc2l0aW9uLmVuZFsxXSkpe1xyXG4gICAgICAgIGVuZC5zZXRMb2NhdGlvbihwYXJzZUludChwb3NpdGlvbi5lbmRbMF0pLCBwYXJzZUludChwb3NpdGlvbi5lbmRbMV0pKTtcclxuICAgIH1cclxuICAgIHRoaXMuYXR0ci5wb3NpdGlvbj17XHJcbiAgICAgICAgc3RhcnQ6W3N0YXJ0Lngsc3RhcnQueV0sXHJcbiAgICAgICAgZW5kOltlbmQueCxlbmQueV1cclxuICAgIH07XHJcbn07XHJcbkxpbmUucHJvdG90eXBlLmdldFR5cGU9ZnVuY3Rpb24oKXtcclxuICAgIHJldHVybiBRVG9wby5jb25zdGFudC5MaW5lO1xyXG59O1xyXG5MaW5lLnByb3RvdHlwZS5zZXRDb2xvciA9IGZ1bmN0aW9uIChjb2xvcikge1xyXG4gICAgaWYgKGNvbG9yKSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5zdHJva2VDb2xvciA9IFFUb3BvLnV0aWwudHJhbnNIZXgoY29sb3IudG9Mb3dlckNhc2UoKSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIuY29sb3I9dGhpcy5qdG9wby5zdHJva2VDb2xvcjtcclxufTtcclxuTGluZS5wcm90b3R5cGUuc2V0TnVtID0gZnVuY3Rpb24gKG51bSkge1xyXG4gICAgaWYgKCQuaXNOdW1lcmljKG51bSkpIHtcclxuICAgICAgICBpZihudW0gPiAxKXtcclxuICAgICAgICAgICAgdGhpcy5qdG9wby50ZXh0ID0gJygrJyArIG51bSArICcpJztcclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuanRvcG8udGV4dCA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmF0dHIubnVtPW51bTtcclxuICAgIH1cclxufTtcclxuTGluZS5wcm90b3R5cGUuc2V0V2lkdGg9ZnVuY3Rpb24od2lkdGgpe1xyXG4gICAgaWYoJC5pc051bWVyaWMod2lkdGgpKXtcclxuICAgICAgICB0aGlzLmp0b3BvLmxpbmVXaWR0aCA9IHdpZHRoOyAvLyDnur/lrr1cclxuICAgIH1cclxuICAgIHRoaXMuYXR0ci53aWR0aD10aGlzLmp0b3BvLmxpbmVXaWR0aDtcclxufTtcclxuTGluZS5wcm90b3R5cGUuc2V0QXJyb3cgPSBmdW5jdGlvbihhcnJvdyl7XHJcbiAgICBpZihhcnJvdyl7XHJcbiAgICAgICAgdGhpcy5qdG9wby5hcnJvd3NSYWRpdXMgPSAkLmlzTnVtZXJpYyhhcnJvdy5zaXplKT9hcnJvdy5zaXplOjA7XHJcbiAgICAgICAgdGhpcy5qdG9wby5hcnJvd3NPZmZzZXQgPSAkLmlzTnVtZXJpYyhhcnJvdy5vZmZzZXQpP2Fycm93Lm9mZnNldDowO1xyXG4gICAgfVxyXG4gICAgaWYoIXRoaXMuYXR0ci5hcnJvdyl7XHJcbiAgICAgICAgdGhpcy5hdHRyLmFycm93PXt9O1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLmFycm93LnNpemU9dGhpcy5qdG9wby5hcnJvd3NSYWRpdXM7XHJcbiAgICB0aGlzLmF0dHIuYXJyb3cub2Zmc2V0PXRoaXMuanRvcG8uYXJyb3dzT2Zmc2V0O1xyXG59O1xyXG5MaW5lLnByb3RvdHlwZS5zZXRHYXA9ZnVuY3Rpb24oZ2FwKXtcclxuICAgIGlmKGdhcCl7XHJcbiAgICAgICAgdGhpcy5qdG9wby5idW5kbGVHYXAgPSAkLmlzTnVtZXJpYyhnYXApP2dhcDowOyAvLyDnur/mnaHkuYvpl7TnmoTpl7TpmpRcclxuICAgIH1cclxuICAgIHRoaXMuYXR0ci5nYXA9dGhpcy5qdG9wby5idW5kbGVHYXA7XHJcbn07XHJcbkxpbmUucHJvdG90eXBlLnNldERhc2hlZD1mdW5jdGlvbihkYXNoZWRQYXR0ZXJuKXtcclxuICAgIGlmKCQuaXNOdW1lcmljKGRhc2hlZFBhdHRlcm4pJiZkYXNoZWRQYXR0ZXJuPjApe1xyXG4gICAgICAgIHRoaXMuanRvcG8uZGFzaGVkUGF0dGVybj1wYXJzZUludChkYXNoZWRQYXR0ZXJuKTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMuanRvcG8uZGFzaGVkUGF0dGVybj1udWxsO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLmRhc2hlZD10aGlzLmp0b3BvLmRhc2hlZFBhdHRlcm47XHJcbn07XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vZGV2ZWxvcC9jb3JlL2VsZW1lbnQvbGluZS9MaW5lLmpzXG4vLyBtb2R1bGUgaWQgPSAzMFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwic291cmNlUm9vdCI6IiJ9")},31:function(module,exports,__webpack_require__){eval('var Link = __webpack_require__(2);\r\nmodule.exports = {\r\n    constructor: CurveLink,\r\n    setDefault: setDefault,\r\n    getDefault: getDefault\r\n};\r\n//-\r\nvar DEFAULT = {\r\n    number: 1,\r\n    alpha: 1,\r\n    color: \'22,124,255\',\r\n    arrow: {\r\n        size: 10,\r\n        offset: 0,\r\n        start: false,\r\n        end: false\r\n    },\r\n    jsonId:"",\r\n    gap: 20,\r\n    width: 2,\r\n    dashed: null,\r\n    zIndex: 100,\r\n    font: {\r\n        size: 16,\r\n        type: "微软雅黑",\r\n        color: \'255,255,255\'\r\n    },\r\n    useType: QTopo.constant.link.CURVE,\r\n    curveOffset: 200\r\n};\r\nfunction setDefault(config) {\r\n    QTopo.util.extend(DEFAULT, config || {});\r\n}\r\nfunction getDefault() {\r\n    return QTopo.util.deepClone(DEFAULT);\r\n}\r\n//------\r\nvar jtopoRest={\r\n    //改写源码绘制二次贝赛尔曲线\r\n    //修改始终点的位置，用以确定箭头方向\r\n    getStart: function () {\r\n        var a;\r\n        var b = this.nodeA, c = this.nodeZ;\r\n        var d = JTopo.util.lineF(b.cx, b.cy, c.cx, c.cy);\r\n        var e = b.getBound();\r\n        a = JTopo.util.intersectionLineBound(d, e);\r\n        return a;\r\n    },\r\n    getEnd:function () {\r\n        var a;\r\n        var b = this.nodeZ, c = this.nodeA;\r\n        var d = JTopo.util.lineF(b.cx, b.cy, c.cx, c.cy);\r\n        var e = b.getBound();\r\n        a = JTopo.util.intersectionLineBound(d, e);\r\n        return a;\r\n    },\r\n    //获取曲线的路径点，返回应是数组\r\n    getPath:function () {\r\n        var path = [], start = this.getStartPosition(), end = this.getEndPosition();\r\n        if (this.nodeA === this.nodeZ)return [start, end];\r\n        if (start && end) {\r\n            var angle = Math.atan(Math.abs(end.y - start.y) / Math.abs(end.x - start.x));\r\n            var mX = (start.x + end.x) / 2 + this.qtopo.attr.curveOffset * Math.cos(angle - Math.PI / 2);\r\n            var mY = (start.y + end.y) / 2 + this.qtopo.attr.curveOffset * Math.sin(angle - Math.PI / 2);\r\n            path.start = start;\r\n            path.end = end;\r\n            path.middle = {\r\n                x: mX,\r\n                y: mY\r\n            };\r\n            path.text =  makePoint(path.start,path.middle, path.end, 1/2);\r\n            path.angle = angle;\r\n            path.push(start);\r\n            path.push(end);\r\n        }\r\n        return path\r\n    },\r\n    //绘制曲线路径\r\n    paintPath:function (cx, path) {\r\n        if (this.nodeA === this.nodeZ)return void this.paintLoop(cx);\r\n        var start = path.start;\r\n        var end = path.end;\r\n        var middle = path.middle;\r\n        if (start && end && middle) {\r\n            cx.beginPath();\r\n            cx.moveTo(start.x, start.y);\r\n            cx.strokeStyle = "rgba(" + this.strokeColor + "," + this.alpha + ")";\r\n            cx.lineWidth = this.lineWidth;\r\n            cx.moveTo(start.x, start.y);\r\n            cx.quadraticCurveTo(middle.x, middle.y, end.x, end.y);\r\n            cx.stroke();\r\n            if (cx.stroke(), cx.closePath(), null != this.arrowsRadius) {\r\n                if (this.qtopo.attr.arrow.end) {\r\n                    this.paintArrow(cx, start, end);\r\n                }\r\n                if (this.qtopo.attr.arrow.start) {\r\n                    this.paintArrow(cx, end, start);\r\n                }\r\n            }\r\n        }\r\n    },\r\n    //线上文本位置\r\n    paintText:function (cx, path) {\r\n        if (path && path.text && this.text && this.text.length > 0) {\r\n            var textX = path.text.x + this.textOffsetX;\r\n            var textY = path.text.y + this.textOffsetY;\r\n            cx.save();\r\n            cx.beginPath();\r\n            cx.font = this.font;\r\n            var totalWidth = cx.measureText(this.text).width;\r\n            var fontWidth = cx.measureText("田").width;\r\n            cx.fillStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")";\r\n            cx.fillText(this.text, textX - totalWidth / 2, textY - fontWidth / 2);\r\n            cx.stroke();\r\n            cx.closePath();\r\n            cx.restore();\r\n        }\r\n    },\r\n    //判断点是否落在曲线上,原理基于二次贝塞尔曲线公式阶段点取样,判断点是否落在每小部分的线段上\r\n    isInBound:function (x, y) {\r\n        if (this.nodeA === this.nodeZ) {\r\n            var d = this.bundleGap * (this.nodeIndex + 1) / 2, e = a.util.getDistance(this.nodeA, {x: x, y: y}) - d;\r\n            return Math.abs(e) <= 3\r\n        }\r\n        //----\r\n        var flag = false;\r\n        var start = this.path.start;\r\n        var end = this.path.end;\r\n        var middle = this.path.middle;\r\n        var angle = this.path.angle;//起始点之间的夹角\r\n        if(start&&end&&middle&&angle){\r\n            var temp1 = start;//首次为起点\r\n            var temp2;\r\n            for (var i = 1; i <= 10; i++) {\r\n                temp2 = makePoint(start, middle, end, i / 10);//取样为10份\r\n                //判断点是否落在temp1和temp2构成的直线上\r\n                if (pointInLine({x: x, y: y}, temp1, temp2, this.width / 2, angle)) {\r\n                    flag = true;\r\n                    break\r\n                }\r\n                temp1 = temp2;\r\n            }\r\n        }\r\n        return flag\r\n    }\r\n};\r\n//----\r\n//制造一个二次贝塞尔曲线的阶段点\r\nfunction makePoint(s, m, e, t) {\r\n    return {\r\n        x: (1 - t) * (1 - t) * s.x + 2 * t * (1 - t) * m.x + t * t * e.x,\r\n        y: (1 - t) * (1 - t) * s.y + 2 * t * (1 - t) * m.y + t * t * e.y\r\n    }\r\n}\r\n//考虑到线段的粗细,需要判断点是否在矩形内，若点同时在顺时针4个点成的4条线的右侧,则为在矩形内\r\nfunction pointInLine(p, s, e, w, an) {\r\n    var rectangle = [//顺时针，从左上开始\r\n        {\r\n            x: s.x - w * Math.sin(an),\r\n            y: s.y - w * Math.cos(an)\r\n        },\r\n        {\r\n            x: e.x - w * Math.sin(an),\r\n            y: e.y - w * Math.cos(an)\r\n        },\r\n        {\r\n            x: e.x + w * Math.sin(an),\r\n            y: e.y + w * Math.cos(an)\r\n        },\r\n        {\r\n            x: s.x + w * Math.sin(an),\r\n            y: s.y + w * Math.cos(an)\r\n        }\r\n    ];\r\n    return poinRightLine(rectangle[0], rectangle[1], p) && poinRightLine(rectangle[1], rectangle[2], p) && poinRightLine(rectangle[2], rectangle[3], p) && poinRightLine(rectangle[3], rectangle[0], p);\r\n}\r\n//判断点在线的右侧?\r\nfunction poinRightLine(s, e, p) {\r\n    return ((e.x - s.x) * (-p.y + s.y) - (-e.y + s.y) * (p.x - s.x)) < 0;\r\n}\r\n//---\r\n//------\r\n//-\r\nfunction CurveLink(config) {\r\n    if (!config.start || !config.end || !config.start.jtopo || !config.end.jtopo) {\r\n        QTopo.util.error("Create Link need start and end");\r\n        return;\r\n    }\r\n    this.attr = QTopo.util.extend(getDefault(), config || {});\r\n    Link.call(this, new JTopo.CurveLink(config.start.jtopo, config.end.jtopo));\r\n    //函数\r\n    this.set = setJTopo;\r\n    //初始化\r\n    this.set(this.attr);\r\n    //改写源码绘制曲线,可由curveOffset指定弧度\r\n    reset(this);\r\n}\r\nQTopo.util.inherits(CurveLink, Link);\r\n//-\r\nfunction setJTopo(config) {\r\n    if (config) {\r\n        var self = this;\r\n        self._setAttr(config);\r\n    }\r\n}\r\nfunction reset(link) {\r\n    link.jtopo.getStartPosition =jtopoRest.getStart;\r\n    link.jtopo.getEndPosition =jtopoRest.getEnd;\r\n    link.jtopo.paintPath =jtopoRest.paintPath;\r\n    link.jtopo.getPath =jtopoRest.getPath;\r\n    link.jtopo.isInBound = jtopoRest.isInBound;\r\n    link.jtopo.paintText =jtopoRest.paintText;\r\n}\r\n//-\r\nCurveLink.prototype.setCurveOffset = function (data) {\r\n    if ($.isNumeric(data)) {\r\n        this.attr.curveOffset = parseInt(data);\r\n    }\r\n};\r\nCurveLink.prototype.getDefault = getDefault;\r\n//-//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9saW5rL0N1cnZlLmpzP2QwZTMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsbUdBQW1HLFdBQVc7QUFDOUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQSwyQkFBMkIsU0FBUztBQUNwQyw4REFBOEQ7QUFDOUQ7QUFDQSxpQ0FBaUMsV0FBVztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQ7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIzMS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBMaW5rID0gcmVxdWlyZShcIi4vTGluay5qc1wiKTtcclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgICBjb25zdHJ1Y3RvcjogQ3VydmVMaW5rLFxyXG4gICAgc2V0RGVmYXVsdDogc2V0RGVmYXVsdCxcclxuICAgIGdldERlZmF1bHQ6IGdldERlZmF1bHRcclxufTtcclxuLy8tXHJcbnZhciBERUZBVUxUID0ge1xyXG4gICAgbnVtYmVyOiAxLFxyXG4gICAgYWxwaGE6IDEsXHJcbiAgICBjb2xvcjogJzIyLDEyNCwyNTUnLFxyXG4gICAgYXJyb3c6IHtcclxuICAgICAgICBzaXplOiAxMCxcclxuICAgICAgICBvZmZzZXQ6IDAsXHJcbiAgICAgICAgc3RhcnQ6IGZhbHNlLFxyXG4gICAgICAgIGVuZDogZmFsc2VcclxuICAgIH0sXHJcbiAgICBqc29uSWQ6XCJcIixcclxuICAgIGdhcDogMjAsXHJcbiAgICB3aWR0aDogMixcclxuICAgIGRhc2hlZDogbnVsbCxcclxuICAgIHpJbmRleDogMTAwLFxyXG4gICAgZm9udDoge1xyXG4gICAgICAgIHNpemU6IDE2LFxyXG4gICAgICAgIHR5cGU6IFwi5b6u6L2v6ZuF6buRXCIsXHJcbiAgICAgICAgY29sb3I6ICcyNTUsMjU1LDI1NSdcclxuICAgIH0sXHJcbiAgICB1c2VUeXBlOiBRVG9wby5jb25zdGFudC5saW5rLkNVUlZFLFxyXG4gICAgY3VydmVPZmZzZXQ6IDIwMFxyXG59O1xyXG5mdW5jdGlvbiBzZXREZWZhdWx0KGNvbmZpZykge1xyXG4gICAgUVRvcG8udXRpbC5leHRlbmQoREVGQVVMVCwgY29uZmlnIHx8IHt9KTtcclxufVxyXG5mdW5jdGlvbiBnZXREZWZhdWx0KCkge1xyXG4gICAgcmV0dXJuIFFUb3BvLnV0aWwuZGVlcENsb25lKERFRkFVTFQpO1xyXG59XHJcbi8vLS0tLS0tXHJcbnZhciBqdG9wb1Jlc3Q9e1xyXG4gICAgLy/mlLnlhpnmupDnoIHnu5jliLbkuozmrKHotJ3otZvlsJTmm7Lnur9cclxuICAgIC8v5L+u5pS55aeL57uI54K555qE5L2N572u77yM55So5Lul56Gu5a6a566t5aS05pa55ZCRXHJcbiAgICBnZXRTdGFydDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBhO1xyXG4gICAgICAgIHZhciBiID0gdGhpcy5ub2RlQSwgYyA9IHRoaXMubm9kZVo7XHJcbiAgICAgICAgdmFyIGQgPSBKVG9wby51dGlsLmxpbmVGKGIuY3gsIGIuY3ksIGMuY3gsIGMuY3kpO1xyXG4gICAgICAgIHZhciBlID0gYi5nZXRCb3VuZCgpO1xyXG4gICAgICAgIGEgPSBKVG9wby51dGlsLmludGVyc2VjdGlvbkxpbmVCb3VuZChkLCBlKTtcclxuICAgICAgICByZXR1cm4gYTtcclxuICAgIH0sXHJcbiAgICBnZXRFbmQ6ZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBhO1xyXG4gICAgICAgIHZhciBiID0gdGhpcy5ub2RlWiwgYyA9IHRoaXMubm9kZUE7XHJcbiAgICAgICAgdmFyIGQgPSBKVG9wby51dGlsLmxpbmVGKGIuY3gsIGIuY3ksIGMuY3gsIGMuY3kpO1xyXG4gICAgICAgIHZhciBlID0gYi5nZXRCb3VuZCgpO1xyXG4gICAgICAgIGEgPSBKVG9wby51dGlsLmludGVyc2VjdGlvbkxpbmVCb3VuZChkLCBlKTtcclxuICAgICAgICByZXR1cm4gYTtcclxuICAgIH0sXHJcbiAgICAvL+iOt+WPluabsue6v+eahOi3r+W+hOeCue+8jOi/lOWbnuW6lOaYr+aVsOe7hFxyXG4gICAgZ2V0UGF0aDpmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHBhdGggPSBbXSwgc3RhcnQgPSB0aGlzLmdldFN0YXJ0UG9zaXRpb24oKSwgZW5kID0gdGhpcy5nZXRFbmRQb3NpdGlvbigpO1xyXG4gICAgICAgIGlmICh0aGlzLm5vZGVBID09PSB0aGlzLm5vZGVaKXJldHVybiBbc3RhcnQsIGVuZF07XHJcbiAgICAgICAgaWYgKHN0YXJ0ICYmIGVuZCkge1xyXG4gICAgICAgICAgICB2YXIgYW5nbGUgPSBNYXRoLmF0YW4oTWF0aC5hYnMoZW5kLnkgLSBzdGFydC55KSAvIE1hdGguYWJzKGVuZC54IC0gc3RhcnQueCkpO1xyXG4gICAgICAgICAgICB2YXIgbVggPSAoc3RhcnQueCArIGVuZC54KSAvIDIgKyB0aGlzLnF0b3BvLmF0dHIuY3VydmVPZmZzZXQgKiBNYXRoLmNvcyhhbmdsZSAtIE1hdGguUEkgLyAyKTtcclxuICAgICAgICAgICAgdmFyIG1ZID0gKHN0YXJ0LnkgKyBlbmQueSkgLyAyICsgdGhpcy5xdG9wby5hdHRyLmN1cnZlT2Zmc2V0ICogTWF0aC5zaW4oYW5nbGUgLSBNYXRoLlBJIC8gMik7XHJcbiAgICAgICAgICAgIHBhdGguc3RhcnQgPSBzdGFydDtcclxuICAgICAgICAgICAgcGF0aC5lbmQgPSBlbmQ7XHJcbiAgICAgICAgICAgIHBhdGgubWlkZGxlID0ge1xyXG4gICAgICAgICAgICAgICAgeDogbVgsXHJcbiAgICAgICAgICAgICAgICB5OiBtWVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBwYXRoLnRleHQgPSAgbWFrZVBvaW50KHBhdGguc3RhcnQscGF0aC5taWRkbGUsIHBhdGguZW5kLCAxLzIpO1xyXG4gICAgICAgICAgICBwYXRoLmFuZ2xlID0gYW5nbGU7XHJcbiAgICAgICAgICAgIHBhdGgucHVzaChzdGFydCk7XHJcbiAgICAgICAgICAgIHBhdGgucHVzaChlbmQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcGF0aFxyXG4gICAgfSxcclxuICAgIC8v57uY5Yi25puy57q/6Lev5b6EXHJcbiAgICBwYWludFBhdGg6ZnVuY3Rpb24gKGN4LCBwYXRoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubm9kZUEgPT09IHRoaXMubm9kZVopcmV0dXJuIHZvaWQgdGhpcy5wYWludExvb3AoY3gpO1xyXG4gICAgICAgIHZhciBzdGFydCA9IHBhdGguc3RhcnQ7XHJcbiAgICAgICAgdmFyIGVuZCA9IHBhdGguZW5kO1xyXG4gICAgICAgIHZhciBtaWRkbGUgPSBwYXRoLm1pZGRsZTtcclxuICAgICAgICBpZiAoc3RhcnQgJiYgZW5kICYmIG1pZGRsZSkge1xyXG4gICAgICAgICAgICBjeC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgY3gubW92ZVRvKHN0YXJ0LngsIHN0YXJ0LnkpO1xyXG4gICAgICAgICAgICBjeC5zdHJva2VTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuc3Ryb2tlQ29sb3IgKyBcIixcIiArIHRoaXMuYWxwaGEgKyBcIilcIjtcclxuICAgICAgICAgICAgY3gubGluZVdpZHRoID0gdGhpcy5saW5lV2lkdGg7XHJcbiAgICAgICAgICAgIGN4Lm1vdmVUbyhzdGFydC54LCBzdGFydC55KTtcclxuICAgICAgICAgICAgY3gucXVhZHJhdGljQ3VydmVUbyhtaWRkbGUueCwgbWlkZGxlLnksIGVuZC54LCBlbmQueSk7XHJcbiAgICAgICAgICAgIGN4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICBpZiAoY3guc3Ryb2tlKCksIGN4LmNsb3NlUGF0aCgpLCBudWxsICE9IHRoaXMuYXJyb3dzUmFkaXVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5xdG9wby5hdHRyLmFycm93LmVuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFpbnRBcnJvdyhjeCwgc3RhcnQsIGVuZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5xdG9wby5hdHRyLmFycm93LnN0YXJ0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWludEFycm93KGN4LCBlbmQsIHN0YXJ0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICAvL+e6v+S4iuaWh+acrOS9jee9rlxyXG4gICAgcGFpbnRUZXh0OmZ1bmN0aW9uIChjeCwgcGF0aCkge1xyXG4gICAgICAgIGlmIChwYXRoICYmIHBhdGgudGV4dCAmJiB0aGlzLnRleHQgJiYgdGhpcy50ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdmFyIHRleHRYID0gcGF0aC50ZXh0LnggKyB0aGlzLnRleHRPZmZzZXRYO1xyXG4gICAgICAgICAgICB2YXIgdGV4dFkgPSBwYXRoLnRleHQueSArIHRoaXMudGV4dE9mZnNldFk7XHJcbiAgICAgICAgICAgIGN4LnNhdmUoKTtcclxuICAgICAgICAgICAgY3guYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIGN4LmZvbnQgPSB0aGlzLmZvbnQ7XHJcbiAgICAgICAgICAgIHZhciB0b3RhbFdpZHRoID0gY3gubWVhc3VyZVRleHQodGhpcy50ZXh0KS53aWR0aDtcclxuICAgICAgICAgICAgdmFyIGZvbnRXaWR0aCA9IGN4Lm1lYXN1cmVUZXh0KFwi55SwXCIpLndpZHRoO1xyXG4gICAgICAgICAgICBjeC5maWxsU3R5bGUgPSBcInJnYmEoXCIgKyB0aGlzLmZvbnRDb2xvciArIFwiLCBcIiArIHRoaXMuYWxwaGEgKyBcIilcIjtcclxuICAgICAgICAgICAgY3guZmlsbFRleHQodGhpcy50ZXh0LCB0ZXh0WCAtIHRvdGFsV2lkdGggLyAyLCB0ZXh0WSAtIGZvbnRXaWR0aCAvIDIpO1xyXG4gICAgICAgICAgICBjeC5zdHJva2UoKTtcclxuICAgICAgICAgICAgY3guY2xvc2VQYXRoKCk7XHJcbiAgICAgICAgICAgIGN4LnJlc3RvcmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgLy/liKTmlq3ngrnmmK/lkKbokL3lnKjmm7Lnur/kuIos5Y6f55CG5Z+65LqO5LqM5qyh6LSd5aGe5bCU5puy57q/5YWs5byP6Zi25q6154K55Y+W5qC3LOWIpOaWreeCueaYr+WQpuiQveWcqOavj+Wwj+mDqOWIhueahOe6v+auteS4ilxyXG4gICAgaXNJbkJvdW5kOmZ1bmN0aW9uICh4LCB5KSB7XHJcbiAgICAgICAgaWYgKHRoaXMubm9kZUEgPT09IHRoaXMubm9kZVopIHtcclxuICAgICAgICAgICAgdmFyIGQgPSB0aGlzLmJ1bmRsZUdhcCAqICh0aGlzLm5vZGVJbmRleCArIDEpIC8gMiwgZSA9IGEudXRpbC5nZXREaXN0YW5jZSh0aGlzLm5vZGVBLCB7eDogeCwgeTogeX0pIC0gZDtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGUpIDw9IDNcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8tLS0tXHJcbiAgICAgICAgdmFyIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnBhdGguc3RhcnQ7XHJcbiAgICAgICAgdmFyIGVuZCA9IHRoaXMucGF0aC5lbmQ7XHJcbiAgICAgICAgdmFyIG1pZGRsZSA9IHRoaXMucGF0aC5taWRkbGU7XHJcbiAgICAgICAgdmFyIGFuZ2xlID0gdGhpcy5wYXRoLmFuZ2xlOy8v6LW35aeL54K55LmL6Ze055qE5aS56KeSXHJcbiAgICAgICAgaWYoc3RhcnQmJmVuZCYmbWlkZGxlJiZhbmdsZSl7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wMSA9IHN0YXJ0Oy8v6aaW5qyh5Li66LW354K5XHJcbiAgICAgICAgICAgIHZhciB0ZW1wMjtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gMTA7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdGVtcDIgPSBtYWtlUG9pbnQoc3RhcnQsIG1pZGRsZSwgZW5kLCBpIC8gMTApOy8v5Y+W5qC35Li6MTDku71cclxuICAgICAgICAgICAgICAgIC8v5Yik5pat54K55piv5ZCm6JC95ZyodGVtcDHlkox0ZW1wMuaehOaIkOeahOebtOe6v+S4ilxyXG4gICAgICAgICAgICAgICAgaWYgKHBvaW50SW5MaW5lKHt4OiB4LCB5OiB5fSwgdGVtcDEsIHRlbXAyLCB0aGlzLndpZHRoIC8gMiwgYW5nbGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRlbXAxID0gdGVtcDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZsYWdcclxuICAgIH1cclxufTtcclxuLy8tLS0tXHJcbi8v5Yi26YCg5LiA5Liq5LqM5qyh6LSd5aGe5bCU5puy57q/55qE6Zi25q6154K5XHJcbmZ1bmN0aW9uIG1ha2VQb2ludChzLCBtLCBlLCB0KSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHg6ICgxIC0gdCkgKiAoMSAtIHQpICogcy54ICsgMiAqIHQgKiAoMSAtIHQpICogbS54ICsgdCAqIHQgKiBlLngsXHJcbiAgICAgICAgeTogKDEgLSB0KSAqICgxIC0gdCkgKiBzLnkgKyAyICogdCAqICgxIC0gdCkgKiBtLnkgKyB0ICogdCAqIGUueVxyXG4gICAgfVxyXG59XHJcbi8v6ICD6JmR5Yiw57q/5q6155qE57KX57uGLOmcgOimgeWIpOaWreeCueaYr+WQpuWcqOefqeW9ouWGhe+8jOiLpeeCueWQjOaXtuWcqOmhuuaXtumSiDTkuKrngrnmiJDnmoQ05p2h57q/55qE5Y+z5L6nLOWImeS4uuWcqOefqeW9ouWGhVxyXG5mdW5jdGlvbiBwb2ludEluTGluZShwLCBzLCBlLCB3LCBhbikge1xyXG4gICAgdmFyIHJlY3RhbmdsZSA9IFsvL+mhuuaXtumSiO+8jOS7juW3puS4iuW8gOWni1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgeDogcy54IC0gdyAqIE1hdGguc2luKGFuKSxcclxuICAgICAgICAgICAgeTogcy55IC0gdyAqIE1hdGguY29zKGFuKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB4OiBlLnggLSB3ICogTWF0aC5zaW4oYW4pLFxyXG4gICAgICAgICAgICB5OiBlLnkgLSB3ICogTWF0aC5jb3MoYW4pXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHg6IGUueCArIHcgKiBNYXRoLnNpbihhbiksXHJcbiAgICAgICAgICAgIHk6IGUueSArIHcgKiBNYXRoLmNvcyhhbilcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgeDogcy54ICsgdyAqIE1hdGguc2luKGFuKSxcclxuICAgICAgICAgICAgeTogcy55ICsgdyAqIE1hdGguY29zKGFuKVxyXG4gICAgICAgIH1cclxuICAgIF07XHJcbiAgICByZXR1cm4gcG9pblJpZ2h0TGluZShyZWN0YW5nbGVbMF0sIHJlY3RhbmdsZVsxXSwgcCkgJiYgcG9pblJpZ2h0TGluZShyZWN0YW5nbGVbMV0sIHJlY3RhbmdsZVsyXSwgcCkgJiYgcG9pblJpZ2h0TGluZShyZWN0YW5nbGVbMl0sIHJlY3RhbmdsZVszXSwgcCkgJiYgcG9pblJpZ2h0TGluZShyZWN0YW5nbGVbM10sIHJlY3RhbmdsZVswXSwgcCk7XHJcbn1cclxuLy/liKTmlq3ngrnlnKjnur/nmoTlj7Pkvqc/XHJcbmZ1bmN0aW9uIHBvaW5SaWdodExpbmUocywgZSwgcCkge1xyXG4gICAgcmV0dXJuICgoZS54IC0gcy54KSAqICgtcC55ICsgcy55KSAtICgtZS55ICsgcy55KSAqIChwLnggLSBzLngpKSA8IDA7XHJcbn1cclxuLy8tLS1cclxuLy8tLS0tLS1cclxuLy8tXHJcbmZ1bmN0aW9uIEN1cnZlTGluayhjb25maWcpIHtcclxuICAgIGlmICghY29uZmlnLnN0YXJ0IHx8ICFjb25maWcuZW5kIHx8ICFjb25maWcuc3RhcnQuanRvcG8gfHwgIWNvbmZpZy5lbmQuanRvcG8pIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiQ3JlYXRlIExpbmsgbmVlZCBzdGFydCBhbmQgZW5kXCIpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuYXR0ciA9IFFUb3BvLnV0aWwuZXh0ZW5kKGdldERlZmF1bHQoKSwgY29uZmlnIHx8IHt9KTtcclxuICAgIExpbmsuY2FsbCh0aGlzLCBuZXcgSlRvcG8uQ3VydmVMaW5rKGNvbmZpZy5zdGFydC5qdG9wbywgY29uZmlnLmVuZC5qdG9wbykpO1xyXG4gICAgLy/lh73mlbBcclxuICAgIHRoaXMuc2V0ID0gc2V0SlRvcG87XHJcbiAgICAvL+WIneWni+WMllxyXG4gICAgdGhpcy5zZXQodGhpcy5hdHRyKTtcclxuICAgIC8v5pS55YaZ5rqQ56CB57uY5Yi25puy57q/LOWPr+eUsWN1cnZlT2Zmc2V05oyH5a6a5byn5bqmXHJcbiAgICByZXNldCh0aGlzKTtcclxufVxyXG5RVG9wby51dGlsLmluaGVyaXRzKEN1cnZlTGluaywgTGluayk7XHJcbi8vLVxyXG5mdW5jdGlvbiBzZXRKVG9wbyhjb25maWcpIHtcclxuICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi5fc2V0QXR0cihjb25maWcpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHJlc2V0KGxpbmspIHtcclxuICAgIGxpbmsuanRvcG8uZ2V0U3RhcnRQb3NpdGlvbiA9anRvcG9SZXN0LmdldFN0YXJ0O1xyXG4gICAgbGluay5qdG9wby5nZXRFbmRQb3NpdGlvbiA9anRvcG9SZXN0LmdldEVuZDtcclxuICAgIGxpbmsuanRvcG8ucGFpbnRQYXRoID1qdG9wb1Jlc3QucGFpbnRQYXRoO1xyXG4gICAgbGluay5qdG9wby5nZXRQYXRoID1qdG9wb1Jlc3QuZ2V0UGF0aDtcclxuICAgIGxpbmsuanRvcG8uaXNJbkJvdW5kID0ganRvcG9SZXN0LmlzSW5Cb3VuZDtcclxuICAgIGxpbmsuanRvcG8ucGFpbnRUZXh0ID1qdG9wb1Jlc3QucGFpbnRUZXh0O1xyXG59XHJcbi8vLVxyXG5DdXJ2ZUxpbmsucHJvdG90eXBlLnNldEN1cnZlT2Zmc2V0ID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIGlmICgkLmlzTnVtZXJpYyhkYXRhKSkge1xyXG4gICAgICAgIHRoaXMuYXR0ci5jdXJ2ZU9mZnNldCA9IHBhcnNlSW50KGRhdGEpO1xyXG4gICAgfVxyXG59O1xyXG5DdXJ2ZUxpbmsucHJvdG90eXBlLmdldERlZmF1bHQgPSBnZXREZWZhdWx0O1xyXG4vLy1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2RldmVsb3AvY29yZS9lbGVtZW50L2xpbmsvQ3VydmUuanNcbi8vIG1vZHVsZSBpZCA9IDMxXG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJzb3VyY2VSb290IjoiIn0=');
},32:function(module,exports,__webpack_require__){eval('var Link = __webpack_require__(2);\r\nmodule.exports = {\r\n    constructor: DirectLink,\r\n    setDefault: setDefault,\r\n    getDefault: getDefault\r\n};\r\n//-\r\nvar DEFAULT = {\r\n    number: 1,\r\n    alpha: 1,\r\n    color: \'22,124,255\',\r\n    arrow: {\r\n        size: 10,\r\n        offset: 0,\r\n        start: false,\r\n        end: false\r\n    },\r\n    jsonId:"",\r\n    gap: 20,\r\n    width: 3,\r\n    dashed: null,\r\n    zIndex: 100,\r\n    font: {\r\n        size: 16,\r\n        type: "微软雅黑",\r\n        color: \'255,255,255\'\r\n    },\r\n    expendAble: true,\r\n    useType: QTopo.constant.link.DIRECT,\r\n    bundleOffset: 60// 多条直线时，线条折线拐角处的长度\r\n};\r\nfunction setDefault(config) {\r\n    QTopo.util.extend(DEFAULT, config || {});\r\n}\r\nfunction getDefault() {\r\n    return QTopo.util.deepClone(DEFAULT);\r\n}\r\n//------\r\nvar jtopoReset={\r\n    //双向箭头\r\n    getStartPosition:function () {\r\n        var a;\r\n        return null != this.arrowsRadius && (a = (function (self) {\r\n            var b = self.nodeA, c = self.nodeZ;\r\n            var d = JTopo.util.lineF(b.cx, b.cy, c.cx, c.cy);\r\n            var e = b.getBound();\r\n            return f = JTopo.util.intersectionLineBound(d, e);\r\n        })(this)), null == a && (a = {\r\n            x: this.nodeA.cx,\r\n            y: this.nodeA.cy\r\n        }), a;\r\n    },\r\n    paintPath:function (a, b) {\r\n        if (this.nodeA === this.nodeZ) return void this.paintLoop(a);\r\n        a.beginPath(),\r\n            a.moveTo(b[0].x, b[0].y);\r\n        for (var c = 1; c < b.length; c++) {\r\n            null == this.dashedPattern ? (\r\n                (null == this.PointPathColor ? a.lineTo(b[c].x, b[c].y) : a.JtopoDrawPointPath(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, a.strokeStyle, this.PointPathColor))\r\n            ) : a.JTopoDashedLineTo(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, this.dashedPattern)\r\n        }\r\n        if (a.stroke(), a.closePath(), null != this.arrowsRadius) {\r\n            if (this.qtopo.attr.arrow.end) {\r\n                this.paintArrow(a, b[0], b[b.length - 1]);\r\n            }//终点箭头\r\n            if (this.qtopo.attr.arrow.start) {\r\n                this.paintArrow(a, b[b.length - 1], b[0]);\r\n            }//起点箭头\r\n        }\r\n    }\r\n};\r\n//------\r\n//-\r\nfunction DirectLink(config) {\r\n    if (!config.start || !config.end || !config.start.jtopo || !config.end.jtopo) {\r\n        QTopo.util.error("Create Link need start and end");\r\n        return;\r\n    }\r\n    this.attr = QTopo.util.extend(getDefault(), config || {});\r\n    Link.call(this, new JTopo.Link(config.start.jtopo, config.end.jtopo));\r\n    //函数\r\n    this.set = setJTopo;\r\n    //初始化\r\n    this.set(this.attr);\r\n    //源码修改\r\n    reset(this);\r\n}\r\nQTopo.util.inherits(DirectLink, Link);\r\nfunction setJTopo(config) {\r\n    if (config) {\r\n        var self = this;\r\n        self._setAttr(config);\r\n    }\r\n}\r\nfunction reset(link) {\r\n    link.jtopo.getStartPosition = jtopoReset.getStartPosition;\r\n    link.jtopo.paintPath = jtopoReset.paintPath;\r\n}\r\nDirectLink.prototype.setBundleOffset = function (bundleOffset) {\r\n    if ($.isNumeric(bundleOffset)) {\r\n        this.jtopo.bundleOffset = parseInt(bundleOffset);\r\n    }\r\n    this.attr.bundleOffset = this.jtopo.bundleOffset;\r\n};\r\nDirectLink.prototype.getDefault = getDefault;\r\nDirectLink.prototype.openToggle = function (scene) {\r\n    this.attr.expendAble = true;\r\n    var jtopo = scene.jtopo;\r\n    /**\r\n     * 直线切换\r\n     * @param flag 为true则展开为false则缩放，无值则根据现状切换,\r\n     */\r\n    this.toggle = function (flag) {\r\n        var todo = !(this.getUseType() == QTopo.constant.CASUAL && this.parent);\r\n        if (typeof flag == "boolean" && (flag ^ todo)) {\r\n            return;\r\n        }\r\n        if (todo) {\r\n            //展开\r\n            //复制属性\r\n            if (this.attr.number > 1 && this.attr.expendAble) {\r\n                var childSet = QTopo.util.deepClone(this.attr);\r\n                childSet.start = this.path.start;\r\n                childSet.end = this.path.end;\r\n                childSet.useType = QTopo.constant.CASUAL;\r\n                childSet.number = 1;\r\n                var parent = {\r\n                    attr: this.attr,\r\n                    extra: this.extra,\r\n                    path: this.path,\r\n                    addChild: function (num) {\r\n                        if ($.isNumeric(num)) {\r\n                            num = parseInt(num);\r\n                            for (var i = 0; i < num; i++) {\r\n                                var link = scene.createLink(childSet);\r\n                                parent.children.push(link);\r\n                                link.parent = parent;\r\n                                link.extra = parent.extra;\r\n                            }\r\n                        }\r\n                    },\r\n                    children: []\r\n                };\r\n                scene.remove(this);\r\n                parent.addChild(parent.attr.number);\r\n            }\r\n        } else {\r\n            //聚合\r\n            var father = this.parent;\r\n            scene.remove(father.children);\r\n            var config = father.attr;\r\n            config.start = father.path.start;\r\n            config.end = father.path.end;\r\n            scene.createLink(config).extra = father.extra;\r\n        }\r\n    };\r\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9saW5rL0RpcmVjdC5qcz9jZjVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsY0FBYztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxTQUFTO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjMyLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIExpbmsgPSByZXF1aXJlKFwiLi9MaW5rLmpzXCIpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIGNvbnN0cnVjdG9yOiBEaXJlY3RMaW5rLFxyXG4gICAgc2V0RGVmYXVsdDogc2V0RGVmYXVsdCxcclxuICAgIGdldERlZmF1bHQ6IGdldERlZmF1bHRcclxufTtcclxuLy8tXHJcbnZhciBERUZBVUxUID0ge1xyXG4gICAgbnVtYmVyOiAxLFxyXG4gICAgYWxwaGE6IDEsXHJcbiAgICBjb2xvcjogJzIyLDEyNCwyNTUnLFxyXG4gICAgYXJyb3c6IHtcclxuICAgICAgICBzaXplOiAxMCxcclxuICAgICAgICBvZmZzZXQ6IDAsXHJcbiAgICAgICAgc3RhcnQ6IGZhbHNlLFxyXG4gICAgICAgIGVuZDogZmFsc2VcclxuICAgIH0sXHJcbiAgICBqc29uSWQ6XCJcIixcclxuICAgIGdhcDogMjAsXHJcbiAgICB3aWR0aDogMyxcclxuICAgIGRhc2hlZDogbnVsbCxcclxuICAgIHpJbmRleDogMTAwLFxyXG4gICAgZm9udDoge1xyXG4gICAgICAgIHNpemU6IDE2LFxyXG4gICAgICAgIHR5cGU6IFwi5b6u6L2v6ZuF6buRXCIsXHJcbiAgICAgICAgY29sb3I6ICcyNTUsMjU1LDI1NSdcclxuICAgIH0sXHJcbiAgICBleHBlbmRBYmxlOiB0cnVlLFxyXG4gICAgdXNlVHlwZTogUVRvcG8uY29uc3RhbnQubGluay5ESVJFQ1QsXHJcbiAgICBidW5kbGVPZmZzZXQ6IDYwLy8g5aSa5p2h55u057q/5pe277yM57q/5p2h5oqY57q/5ouQ6KeS5aSE55qE6ZW/5bqmXHJcbn07XHJcbmZ1bmN0aW9uIHNldERlZmF1bHQoY29uZmlnKSB7XHJcbiAgICBRVG9wby51dGlsLmV4dGVuZChERUZBVUxULCBjb25maWcgfHwge30pO1xyXG59XHJcbmZ1bmN0aW9uIGdldERlZmF1bHQoKSB7XHJcbiAgICByZXR1cm4gUVRvcG8udXRpbC5kZWVwQ2xvbmUoREVGQVVMVCk7XHJcbn1cclxuLy8tLS0tLS1cclxudmFyIGp0b3BvUmVzZXQ9e1xyXG4gICAgLy/lj4zlkJHnrq3lpLRcclxuICAgIGdldFN0YXJ0UG9zaXRpb246ZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBhO1xyXG4gICAgICAgIHJldHVybiBudWxsICE9IHRoaXMuYXJyb3dzUmFkaXVzICYmIChhID0gKGZ1bmN0aW9uIChzZWxmKSB7XHJcbiAgICAgICAgICAgIHZhciBiID0gc2VsZi5ub2RlQSwgYyA9IHNlbGYubm9kZVo7XHJcbiAgICAgICAgICAgIHZhciBkID0gSlRvcG8udXRpbC5saW5lRihiLmN4LCBiLmN5LCBjLmN4LCBjLmN5KTtcclxuICAgICAgICAgICAgdmFyIGUgPSBiLmdldEJvdW5kKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBmID0gSlRvcG8udXRpbC5pbnRlcnNlY3Rpb25MaW5lQm91bmQoZCwgZSk7XHJcbiAgICAgICAgfSkodGhpcykpLCBudWxsID09IGEgJiYgKGEgPSB7XHJcbiAgICAgICAgICAgIHg6IHRoaXMubm9kZUEuY3gsXHJcbiAgICAgICAgICAgIHk6IHRoaXMubm9kZUEuY3lcclxuICAgICAgICB9KSwgYTtcclxuICAgIH0sXHJcbiAgICBwYWludFBhdGg6ZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICBpZiAodGhpcy5ub2RlQSA9PT0gdGhpcy5ub2RlWikgcmV0dXJuIHZvaWQgdGhpcy5wYWludExvb3AoYSk7XHJcbiAgICAgICAgYS5iZWdpblBhdGgoKSxcclxuICAgICAgICAgICAgYS5tb3ZlVG8oYlswXS54LCBiWzBdLnkpO1xyXG4gICAgICAgIGZvciAodmFyIGMgPSAxOyBjIDwgYi5sZW5ndGg7IGMrKykge1xyXG4gICAgICAgICAgICBudWxsID09IHRoaXMuZGFzaGVkUGF0dGVybiA/IChcclxuICAgICAgICAgICAgICAgIChudWxsID09IHRoaXMuUG9pbnRQYXRoQ29sb3IgPyBhLmxpbmVUbyhiW2NdLngsIGJbY10ueSkgOiBhLkp0b3BvRHJhd1BvaW50UGF0aChiW2MgLSAxXS54LCBiW2MgLSAxXS55LCBiW2NdLngsIGJbY10ueSwgYS5zdHJva2VTdHlsZSwgdGhpcy5Qb2ludFBhdGhDb2xvcikpXHJcbiAgICAgICAgICAgICkgOiBhLkpUb3BvRGFzaGVkTGluZVRvKGJbYyAtIDFdLngsIGJbYyAtIDFdLnksIGJbY10ueCwgYltjXS55LCB0aGlzLmRhc2hlZFBhdHRlcm4pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhLnN0cm9rZSgpLCBhLmNsb3NlUGF0aCgpLCBudWxsICE9IHRoaXMuYXJyb3dzUmFkaXVzKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnF0b3BvLmF0dHIuYXJyb3cuZW5kKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhaW50QXJyb3coYSwgYlswXSwgYltiLmxlbmd0aCAtIDFdKTtcclxuICAgICAgICAgICAgfS8v57uI54K5566t5aS0XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnF0b3BvLmF0dHIuYXJyb3cuc3RhcnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFpbnRBcnJvdyhhLCBiW2IubGVuZ3RoIC0gMV0sIGJbMF0pO1xyXG4gICAgICAgICAgICB9Ly/otbfngrnnrq3lpLRcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcbi8vLS0tLS0tXHJcbi8vLVxyXG5mdW5jdGlvbiBEaXJlY3RMaW5rKGNvbmZpZykge1xyXG4gICAgaWYgKCFjb25maWcuc3RhcnQgfHwgIWNvbmZpZy5lbmQgfHwgIWNvbmZpZy5zdGFydC5qdG9wbyB8fCAhY29uZmlnLmVuZC5qdG9wbykge1xyXG4gICAgICAgIFFUb3BvLnV0aWwuZXJyb3IoXCJDcmVhdGUgTGluayBuZWVkIHN0YXJ0IGFuZCBlbmRcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyID0gUVRvcG8udXRpbC5leHRlbmQoZ2V0RGVmYXVsdCgpLCBjb25maWcgfHwge30pO1xyXG4gICAgTGluay5jYWxsKHRoaXMsIG5ldyBKVG9wby5MaW5rKGNvbmZpZy5zdGFydC5qdG9wbywgY29uZmlnLmVuZC5qdG9wbykpO1xyXG4gICAgLy/lh73mlbBcclxuICAgIHRoaXMuc2V0ID0gc2V0SlRvcG87XHJcbiAgICAvL+WIneWni+WMllxyXG4gICAgdGhpcy5zZXQodGhpcy5hdHRyKTtcclxuICAgIC8v5rqQ56CB5L+u5pS5XHJcbiAgICByZXNldCh0aGlzKTtcclxufVxyXG5RVG9wby51dGlsLmluaGVyaXRzKERpcmVjdExpbmssIExpbmspO1xyXG5mdW5jdGlvbiBzZXRKVG9wbyhjb25maWcpIHtcclxuICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi5fc2V0QXR0cihjb25maWcpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHJlc2V0KGxpbmspIHtcclxuICAgIGxpbmsuanRvcG8uZ2V0U3RhcnRQb3NpdGlvbiA9IGp0b3BvUmVzZXQuZ2V0U3RhcnRQb3NpdGlvbjtcclxuICAgIGxpbmsuanRvcG8ucGFpbnRQYXRoID0ganRvcG9SZXNldC5wYWludFBhdGg7XHJcbn1cclxuRGlyZWN0TGluay5wcm90b3R5cGUuc2V0QnVuZGxlT2Zmc2V0ID0gZnVuY3Rpb24gKGJ1bmRsZU9mZnNldCkge1xyXG4gICAgaWYgKCQuaXNOdW1lcmljKGJ1bmRsZU9mZnNldCkpIHtcclxuICAgICAgICB0aGlzLmp0b3BvLmJ1bmRsZU9mZnNldCA9IHBhcnNlSW50KGJ1bmRsZU9mZnNldCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIuYnVuZGxlT2Zmc2V0ID0gdGhpcy5qdG9wby5idW5kbGVPZmZzZXQ7XHJcbn07XHJcbkRpcmVjdExpbmsucHJvdG90eXBlLmdldERlZmF1bHQgPSBnZXREZWZhdWx0O1xyXG5EaXJlY3RMaW5rLnByb3RvdHlwZS5vcGVuVG9nZ2xlID0gZnVuY3Rpb24gKHNjZW5lKSB7XHJcbiAgICB0aGlzLmF0dHIuZXhwZW5kQWJsZSA9IHRydWU7XHJcbiAgICB2YXIganRvcG8gPSBzY2VuZS5qdG9wbztcclxuICAgIC8qKlxyXG4gICAgICog55u057q/5YiH5o2iXHJcbiAgICAgKiBAcGFyYW0gZmxhZyDkuLp0cnVl5YiZ5bGV5byA5Li6ZmFsc2XliJnnvKnmlL7vvIzml6DlgLzliJnmoLnmja7njrDnirbliIfmjaIsXHJcbiAgICAgKi9cclxuICAgIHRoaXMudG9nZ2xlID0gZnVuY3Rpb24gKGZsYWcpIHtcclxuICAgICAgICB2YXIgdG9kbyA9ICEodGhpcy5nZXRVc2VUeXBlKCkgPT0gUVRvcG8uY29uc3RhbnQuQ0FTVUFMICYmIHRoaXMucGFyZW50KTtcclxuICAgICAgICBpZiAodHlwZW9mIGZsYWcgPT0gXCJib29sZWFuXCIgJiYgKGZsYWcgXiB0b2RvKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0b2RvKSB7XHJcbiAgICAgICAgICAgIC8v5bGV5byAXHJcbiAgICAgICAgICAgIC8v5aSN5Yi25bGe5oCnXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmF0dHIubnVtYmVyID4gMSAmJiB0aGlzLmF0dHIuZXhwZW5kQWJsZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkU2V0ID0gUVRvcG8udXRpbC5kZWVwQ2xvbmUodGhpcy5hdHRyKTtcclxuICAgICAgICAgICAgICAgIGNoaWxkU2V0LnN0YXJ0ID0gdGhpcy5wYXRoLnN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgY2hpbGRTZXQuZW5kID0gdGhpcy5wYXRoLmVuZDtcclxuICAgICAgICAgICAgICAgIGNoaWxkU2V0LnVzZVR5cGUgPSBRVG9wby5jb25zdGFudC5DQVNVQUw7XHJcbiAgICAgICAgICAgICAgICBjaGlsZFNldC5udW1iZXIgPSAxO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBhdHRyOiB0aGlzLmF0dHIsXHJcbiAgICAgICAgICAgICAgICAgICAgZXh0cmE6IHRoaXMuZXh0cmEsXHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogdGhpcy5wYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkZENoaWxkOiBmdW5jdGlvbiAobnVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkLmlzTnVtZXJpYyhudW0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW0gPSBwYXJzZUludChudW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW07IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaW5rID0gc2NlbmUuY3JlYXRlTGluayhjaGlsZFNldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmNoaWxkcmVuLnB1c2gobGluayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluay5wYXJlbnQgPSBwYXJlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluay5leHRyYSA9IHBhcmVudC5leHRyYTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgc2NlbmUucmVtb3ZlKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgcGFyZW50LmFkZENoaWxkKHBhcmVudC5hdHRyLm51bWJlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvL+iBmuWQiFxyXG4gICAgICAgICAgICB2YXIgZmF0aGVyID0gdGhpcy5wYXJlbnQ7XHJcbiAgICAgICAgICAgIHNjZW5lLnJlbW92ZShmYXRoZXIuY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICB2YXIgY29uZmlnID0gZmF0aGVyLmF0dHI7XHJcbiAgICAgICAgICAgIGNvbmZpZy5zdGFydCA9IGZhdGhlci5wYXRoLnN0YXJ0O1xyXG4gICAgICAgICAgICBjb25maWcuZW5kID0gZmF0aGVyLnBhdGguZW5kO1xyXG4gICAgICAgICAgICBzY2VuZS5jcmVhdGVMaW5rKGNvbmZpZykuZXh0cmEgPSBmYXRoZXIuZXh0cmE7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2RldmVsb3AvY29yZS9lbGVtZW50L2xpbmsvRGlyZWN0LmpzXG4vLyBtb2R1bGUgaWQgPSAzMlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwic291cmNlUm9vdCI6IiJ9')},33:function(module,exports,__webpack_require__){eval('var Link = __webpack_require__(2);\r\nmodule.exports = {\r\n    constructor: FlexionalLink,\r\n    setDefault: setDefault,\r\n    getDefault: getDefault\r\n};\r\n//-\r\nvar DEFAULT = {\r\n    number: 1,\r\n    alpha: 1,\r\n    color: \'22,124,255\',\r\n    arrow: {\r\n        size: 10,\r\n        offset: 0,\r\n        start: false,\r\n        end: false\r\n    },\r\n    jsonId:"",\r\n    radius: 0,\r\n    gap: 20,\r\n    width: 2,\r\n    dashed: null,\r\n    zIndex: 100,\r\n    font: {\r\n        size: 16,\r\n        type: "微软雅黑",\r\n        color: \'255,255,255\'\r\n    },\r\n    useType: QTopo.constant.link.FLEXIONAL,\r\n    direction: "horizontal",\r\n    offsetGap: 60//折线处长度\r\n};\r\nfunction setDefault(config) {\r\n    QTopo.util.extend(DEFAULT, config || {});\r\n}\r\nfunction getDefault() {\r\n    return QTopo.util.deepClone(DEFAULT);\r\n}\r\n//-\r\n//-----\r\nvar jtopoReset = {\r\n    paintPath: function (cx, path) {\r\n        var attr = this.qtopo.attr;\r\n        if (this.nodeA === this.nodeZ)return void this.paintLoop(cx);\r\n        var start = path[0];\r\n        var end = path[path.length - 1];\r\n        cx.beginPath();\r\n        cx.moveTo(start.x, start.y);\r\n        for (var i = 1; i < path.length; i++) {\r\n            if (null == this.dashedPattern) {\r\n                if (attr.radius > 0) {\r\n                    if (i < path.length - 1) {\r\n                        cx.arcTo(path[i].x, path[i].y,path[i + 1].x, path[i + 1].y,attr.radius);//增加折线弧度\r\n                    } else {\r\n                        cx.lineTo(path[i].x, path[i].y);\r\n                    }\r\n                } else {\r\n                    cx.lineTo(path[i].x, path[i].y);\r\n                }\r\n            } else {\r\n                cx.JTopoDashedLineTo(path[i - 1].x, path[i - 1].y, path[i].x, path[i].y, this.dashedPattern);\r\n            }\r\n        }\r\n        cx.stroke();\r\n        cx.closePath();\r\n        if (null != this.arrowsRadius) {\r\n            if (attr.arrow.end) {\r\n                this.paintArrow(cx, path[path.length - 2], path[path.length - 1]);\r\n            }\r\n            if (attr.arrow.start) {\r\n                this.paintArrow(cx, path[1], path[0]);//添加双向箭头\r\n            }\r\n        }\r\n    }\r\n};\r\n//-----\r\nfunction FlexionalLink(config) {\r\n    if (!config.start || !config.end || !config.start.jtopo || !config.end.jtopo) {\r\n        QTopo.util.error("Create Link need start and end");\r\n        return;\r\n    }\r\n    this.attr = QTopo.util.extend(getDefault(), config || {});\r\n    Link.call(this, new JTopo.FlexionalLink(config.start.jtopo, config.end.jtopo));\r\n    //函数\r\n    this.set = setJTopo;\r\n    //初始化\r\n    this.set(this.attr);\r\n    //修改源码\r\n    reset(this);\r\n}\r\nQTopo.util.inherits(FlexionalLink, Link);\r\nfunction setJTopo(config) {\r\n    if (config) {\r\n        var self = this;\r\n        this._setAttr(config);\r\n    }\r\n}\r\nfunction reset(link) {\r\n    //双向箭头\r\n    link.jtopo.paintPath = jtopoReset.paintPath;\r\n}\r\n// 折线拐角处线段的长度\r\nFlexionalLink.prototype.setOffsetGap = function (offsetGap) {\r\n    if ($.isNumeric(offsetGap)) {\r\n        this.jtopo.offsetGap = parseInt(offsetGap);\r\n    }\r\n    this.attr.offsetGap = this.jtopo.offsetGap;\r\n};\r\nFlexionalLink.prototype.setDirection = function (direction) {\r\n    //折线方向 horizontal 水平 "vertical"垂直\r\n    if (direction) {\r\n        this.jtopo.direction = direction;\r\n    }\r\n    this.attr.direction = this.jtopo.direction;\r\n};\r\nFlexionalLink.prototype.setRadius = function (radius) {\r\n    if ($.isNumeric(radius)) {\r\n        radius = parseInt(radius);\r\n        if (radius > 20) {\r\n            radius = 20;\r\n        } else if (radius < 0) {\r\n            radius = 0;\r\n        }\r\n        this.attr.radius = radius;\r\n    }\r\n};\r\nFlexionalLink.prototype.getDefault = getDefault;\r\n/*一种绘制固定在节点右侧的二次线*/\r\n//resetFold.jtopo.getPath =poinst;\r\nfunction poinst() {\r\n    //重写线的绘制路径\r\n    var littleSize = 50;\r\n    var startRight = {\r\n        x: start.x + start.width,\r\n        y: start.y + start.height / 2\r\n    };\r\n    var endRight = {\r\n        x: end.x + end.width,\r\n        y: end.y + end.height / 2\r\n    };\r\n    var middleA = {};\r\n    var middleB = {};\r\n    if (startRight.x > endRight.x) {\r\n        middleA.x = startRight.x + littleSize;\r\n        middleA.y = startRight.y;\r\n        middleB.x = startRight.x + littleSize;\r\n        middleB.y = endRight.y;\r\n    } else {\r\n        middleA.x = endRight.x + littleSize;\r\n        middleA.y = startRight.y;\r\n        middleB.x = endRight.x + littleSize;\r\n        middleB.y = endRight.y;\r\n    }\r\n    return [startRight, middleA, middleB, endRight];\r\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9saW5rL0ZsZXhpb25hbC5qcz8wMDA2Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixpQkFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHO0FBQ2hHLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0Q7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQ7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjMzLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIExpbmsgPSByZXF1aXJlKFwiLi9MaW5rLmpzXCIpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIGNvbnN0cnVjdG9yOiBGbGV4aW9uYWxMaW5rLFxyXG4gICAgc2V0RGVmYXVsdDogc2V0RGVmYXVsdCxcclxuICAgIGdldERlZmF1bHQ6IGdldERlZmF1bHRcclxufTtcclxuLy8tXHJcbnZhciBERUZBVUxUID0ge1xyXG4gICAgbnVtYmVyOiAxLFxyXG4gICAgYWxwaGE6IDEsXHJcbiAgICBjb2xvcjogJzIyLDEyNCwyNTUnLFxyXG4gICAgYXJyb3c6IHtcclxuICAgICAgICBzaXplOiAxMCxcclxuICAgICAgICBvZmZzZXQ6IDAsXHJcbiAgICAgICAgc3RhcnQ6IGZhbHNlLFxyXG4gICAgICAgIGVuZDogZmFsc2VcclxuICAgIH0sXHJcbiAgICBqc29uSWQ6XCJcIixcclxuICAgIHJhZGl1czogMCxcclxuICAgIGdhcDogMjAsXHJcbiAgICB3aWR0aDogMixcclxuICAgIGRhc2hlZDogbnVsbCxcclxuICAgIHpJbmRleDogMTAwLFxyXG4gICAgZm9udDoge1xyXG4gICAgICAgIHNpemU6IDE2LFxyXG4gICAgICAgIHR5cGU6IFwi5b6u6L2v6ZuF6buRXCIsXHJcbiAgICAgICAgY29sb3I6ICcyNTUsMjU1LDI1NSdcclxuICAgIH0sXHJcbiAgICB1c2VUeXBlOiBRVG9wby5jb25zdGFudC5saW5rLkZMRVhJT05BTCxcclxuICAgIGRpcmVjdGlvbjogXCJob3Jpem9udGFsXCIsXHJcbiAgICBvZmZzZXRHYXA6IDYwLy/mipjnur/lpITplb/luqZcclxufTtcclxuZnVuY3Rpb24gc2V0RGVmYXVsdChjb25maWcpIHtcclxuICAgIFFUb3BvLnV0aWwuZXh0ZW5kKERFRkFVTFQsIGNvbmZpZyB8fCB7fSk7XHJcbn1cclxuZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHtcclxuICAgIHJldHVybiBRVG9wby51dGlsLmRlZXBDbG9uZShERUZBVUxUKTtcclxufVxyXG4vLy1cclxuLy8tLS0tLVxyXG52YXIganRvcG9SZXNldCA9IHtcclxuICAgIHBhaW50UGF0aDogZnVuY3Rpb24gKGN4LCBwYXRoKSB7XHJcbiAgICAgICAgdmFyIGF0dHIgPSB0aGlzLnF0b3BvLmF0dHI7XHJcbiAgICAgICAgaWYgKHRoaXMubm9kZUEgPT09IHRoaXMubm9kZVopcmV0dXJuIHZvaWQgdGhpcy5wYWludExvb3AoY3gpO1xyXG4gICAgICAgIHZhciBzdGFydCA9IHBhdGhbMF07XHJcbiAgICAgICAgdmFyIGVuZCA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTtcclxuICAgICAgICBjeC5iZWdpblBhdGgoKTtcclxuICAgICAgICBjeC5tb3ZlVG8oc3RhcnQueCwgc3RhcnQueSk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChudWxsID09IHRoaXMuZGFzaGVkUGF0dGVybikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGF0dHIucmFkaXVzID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpIDwgcGF0aC5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN4LmFyY1RvKHBhdGhbaV0ueCwgcGF0aFtpXS55LHBhdGhbaSArIDFdLngsIHBhdGhbaSArIDFdLnksYXR0ci5yYWRpdXMpOy8v5aKe5Yqg5oqY57q/5byn5bqmXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3gubGluZVRvKHBhdGhbaV0ueCwgcGF0aFtpXS55KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGN4LmxpbmVUbyhwYXRoW2ldLngsIHBhdGhbaV0ueSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjeC5KVG9wb0Rhc2hlZExpbmVUbyhwYXRoW2kgLSAxXS54LCBwYXRoW2kgLSAxXS55LCBwYXRoW2ldLngsIHBhdGhbaV0ueSwgdGhpcy5kYXNoZWRQYXR0ZXJuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjeC5zdHJva2UoKTtcclxuICAgICAgICBjeC5jbG9zZVBhdGgoKTtcclxuICAgICAgICBpZiAobnVsbCAhPSB0aGlzLmFycm93c1JhZGl1cykge1xyXG4gICAgICAgICAgICBpZiAoYXR0ci5hcnJvdy5lbmQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFpbnRBcnJvdyhjeCwgcGF0aFtwYXRoLmxlbmd0aCAtIDJdLCBwYXRoW3BhdGgubGVuZ3RoIC0gMV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhdHRyLmFycm93LnN0YXJ0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhaW50QXJyb3coY3gsIHBhdGhbMV0sIHBhdGhbMF0pOy8v5re75Yqg5Y+M5ZCR566t5aS0XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcbi8vLS0tLS1cclxuZnVuY3Rpb24gRmxleGlvbmFsTGluayhjb25maWcpIHtcclxuICAgIGlmICghY29uZmlnLnN0YXJ0IHx8ICFjb25maWcuZW5kIHx8ICFjb25maWcuc3RhcnQuanRvcG8gfHwgIWNvbmZpZy5lbmQuanRvcG8pIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiQ3JlYXRlIExpbmsgbmVlZCBzdGFydCBhbmQgZW5kXCIpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuYXR0ciA9IFFUb3BvLnV0aWwuZXh0ZW5kKGdldERlZmF1bHQoKSwgY29uZmlnIHx8IHt9KTtcclxuICAgIExpbmsuY2FsbCh0aGlzLCBuZXcgSlRvcG8uRmxleGlvbmFsTGluayhjb25maWcuc3RhcnQuanRvcG8sIGNvbmZpZy5lbmQuanRvcG8pKTtcclxuICAgIC8v5Ye95pWwXHJcbiAgICB0aGlzLnNldCA9IHNldEpUb3BvO1xyXG4gICAgLy/liJ3lp4vljJZcclxuICAgIHRoaXMuc2V0KHRoaXMuYXR0cik7XHJcbiAgICAvL+S/ruaUuea6kOeggVxyXG4gICAgcmVzZXQodGhpcyk7XHJcbn1cclxuUVRvcG8udXRpbC5pbmhlcml0cyhGbGV4aW9uYWxMaW5rLCBMaW5rKTtcclxuZnVuY3Rpb24gc2V0SlRvcG8oY29uZmlnKSB7XHJcbiAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuX3NldEF0dHIoY29uZmlnKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZXNldChsaW5rKSB7XHJcbiAgICAvL+WPjOWQkeeureWktFxyXG4gICAgbGluay5qdG9wby5wYWludFBhdGggPSBqdG9wb1Jlc2V0LnBhaW50UGF0aDtcclxufVxyXG4vLyDmipjnur/mi5Dop5LlpITnur/mrrXnmoTplb/luqZcclxuRmxleGlvbmFsTGluay5wcm90b3R5cGUuc2V0T2Zmc2V0R2FwID0gZnVuY3Rpb24gKG9mZnNldEdhcCkge1xyXG4gICAgaWYgKCQuaXNOdW1lcmljKG9mZnNldEdhcCkpIHtcclxuICAgICAgICB0aGlzLmp0b3BvLm9mZnNldEdhcCA9IHBhcnNlSW50KG9mZnNldEdhcCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIub2Zmc2V0R2FwID0gdGhpcy5qdG9wby5vZmZzZXRHYXA7XHJcbn07XHJcbkZsZXhpb25hbExpbmsucHJvdG90eXBlLnNldERpcmVjdGlvbiA9IGZ1bmN0aW9uIChkaXJlY3Rpb24pIHtcclxuICAgIC8v5oqY57q/5pa55ZCRIGhvcml6b250YWwg5rC05bmzIFwidmVydGljYWxcIuWeguebtFxyXG4gICAgaWYgKGRpcmVjdGlvbikge1xyXG4gICAgICAgIHRoaXMuanRvcG8uZGlyZWN0aW9uID0gZGlyZWN0aW9uO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyLmRpcmVjdGlvbiA9IHRoaXMuanRvcG8uZGlyZWN0aW9uO1xyXG59O1xyXG5GbGV4aW9uYWxMaW5rLnByb3RvdHlwZS5zZXRSYWRpdXMgPSBmdW5jdGlvbiAocmFkaXVzKSB7XHJcbiAgICBpZiAoJC5pc051bWVyaWMocmFkaXVzKSkge1xyXG4gICAgICAgIHJhZGl1cyA9IHBhcnNlSW50KHJhZGl1cyk7XHJcbiAgICAgICAgaWYgKHJhZGl1cyA+IDIwKSB7XHJcbiAgICAgICAgICAgIHJhZGl1cyA9IDIwO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocmFkaXVzIDwgMCkge1xyXG4gICAgICAgICAgICByYWRpdXMgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmF0dHIucmFkaXVzID0gcmFkaXVzO1xyXG4gICAgfVxyXG59O1xyXG5GbGV4aW9uYWxMaW5rLnByb3RvdHlwZS5nZXREZWZhdWx0ID0gZ2V0RGVmYXVsdDtcclxuLyrkuIDnp43nu5jliLblm7rlrprlnKjoioLngrnlj7PkvqfnmoTkuozmrKHnur8qL1xyXG4vL3Jlc2V0Rm9sZC5qdG9wby5nZXRQYXRoID1wb2luc3Q7XHJcbmZ1bmN0aW9uIHBvaW5zdCgpIHtcclxuICAgIC8v6YeN5YaZ57q/55qE57uY5Yi26Lev5b6EXHJcbiAgICB2YXIgbGl0dGxlU2l6ZSA9IDUwO1xyXG4gICAgdmFyIHN0YXJ0UmlnaHQgPSB7XHJcbiAgICAgICAgeDogc3RhcnQueCArIHN0YXJ0LndpZHRoLFxyXG4gICAgICAgIHk6IHN0YXJ0LnkgKyBzdGFydC5oZWlnaHQgLyAyXHJcbiAgICB9O1xyXG4gICAgdmFyIGVuZFJpZ2h0ID0ge1xyXG4gICAgICAgIHg6IGVuZC54ICsgZW5kLndpZHRoLFxyXG4gICAgICAgIHk6IGVuZC55ICsgZW5kLmhlaWdodCAvIDJcclxuICAgIH07XHJcbiAgICB2YXIgbWlkZGxlQSA9IHt9O1xyXG4gICAgdmFyIG1pZGRsZUIgPSB7fTtcclxuICAgIGlmIChzdGFydFJpZ2h0LnggPiBlbmRSaWdodC54KSB7XHJcbiAgICAgICAgbWlkZGxlQS54ID0gc3RhcnRSaWdodC54ICsgbGl0dGxlU2l6ZTtcclxuICAgICAgICBtaWRkbGVBLnkgPSBzdGFydFJpZ2h0Lnk7XHJcbiAgICAgICAgbWlkZGxlQi54ID0gc3RhcnRSaWdodC54ICsgbGl0dGxlU2l6ZTtcclxuICAgICAgICBtaWRkbGVCLnkgPSBlbmRSaWdodC55O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBtaWRkbGVBLnggPSBlbmRSaWdodC54ICsgbGl0dGxlU2l6ZTtcclxuICAgICAgICBtaWRkbGVBLnkgPSBzdGFydFJpZ2h0Lnk7XHJcbiAgICAgICAgbWlkZGxlQi54ID0gZW5kUmlnaHQueCArIGxpdHRsZVNpemU7XHJcbiAgICAgICAgbWlkZGxlQi55ID0gZW5kUmlnaHQueTtcclxuICAgIH1cclxuICAgIHJldHVybiBbc3RhcnRSaWdodCwgbWlkZGxlQSwgbWlkZGxlQiwgZW5kUmlnaHRdO1xyXG59XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9saW5rL0ZsZXhpb25hbC5qc1xuLy8gbW9kdWxlIGlkID0gMzNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sInNvdXJjZVJvb3QiOiIifQ==')},34:function(module,exports,__webpack_require__){eval('var Link=__webpack_require__(2);\r\nmodule.exports =  {\r\n    constructor:FoldLink,\r\n    setDefault:setDefault,\r\n    getDefault:getDefault\r\n};\r\n//-\r\nvar DEFAULT ={\r\n        number:1,\r\n        alpha:1,\r\n        color: \'22,124,255\',\r\n        arrow:{\r\n            size:10,\r\n            offset:0,\r\n            start:false,\r\n            end:false\r\n        },\r\n        jsonId:"",\r\n        gap:20,\r\n        width: 2,\r\n        dashed:  null,\r\n        zIndex : 100,\r\n        radius:0,\r\n        font:{\r\n            size:16,\r\n            type:"微软雅黑",\r\n            color:\'255,255,255\'\r\n        },\r\n        useType: QTopo.constant.link.FOLD,\r\n        direction:"vertical"\r\n};\r\nfunction setDefault(config){\r\n    QTopo.util.extend(DEFAULT, config || {});\r\n}\r\nfunction getDefault(){\r\n    return QTopo.util.deepClone(DEFAULT);\r\n}\r\n//---------\r\nvar jtopoReset={\r\n    //双向箭头,添加左右边概念\r\n    paintPath:function (cx, path) {\r\n        var attr=this.qtopo.attr;\r\n        if (this.nodeA === this.nodeZ)return void this.paintLoop(cx);\r\n        cx.beginPath();\r\n        cx.moveTo(path[0].x, path[0].y);\r\n        for (var i = 1; i < path.length; i++){\r\n            if(null == this.dashedPattern){\r\n                if (attr.radius > 0) {\r\n                    if (i < path.length - 1) {\r\n                        cx.arcTo(path[i].x, path[i].y,path[i + 1].x, path[i + 1].y,attr.radius);//增加折线弧度\r\n                    } else {\r\n                        cx.lineTo(path[i].x, path[i].y);\r\n                    }\r\n                } else {\r\n                    cx.lineTo(path[i].x, path[i].y);\r\n                }\r\n            }else{\r\n                cx.JTopoDashedLineTo(path[i - 1].x, path[i - 1].y, path[i].x, path[i].y, this.dashedPattern);\r\n            }\r\n        }\r\n        cx.stroke();\r\n        cx.closePath();\r\n        if (null != this.arrowsRadius) {\r\n            if (attr.arrow.end) {\r\n                this.paintArrow(cx, path[path.length - 2], path[path.length - 1]);\r\n            }\r\n            if (attr.arrow.start) {\r\n                this.paintArrow(cx, path[1], path[0]);//添加双向箭头\r\n            }\r\n        }\r\n    }\r\n};\r\n//---------\r\n//-\r\nfunction FoldLink(config){\r\n    if(!config.start||!config.end||!config.start.jtopo||!config.end.jtopo){\r\n        QTopo.util.error("Create Link need start and end");\r\n        return;\r\n    }\r\n    this.attr =  QTopo.util.extend(getDefault(), config || {});\r\n    Link.call(this, new JTopo.FoldLink(config.start.jtopo, config.end.jtopo));\r\n    //函数\r\n    this.set = setJTopo;\r\n    //初始化\r\n    this.set(this.attr);\r\n    //修改源码\r\n    reset(this);\r\n}\r\nQTopo.util.inherits(FoldLink,Link);\r\n//-\r\nfunction setJTopo(config) {\r\n    if (config) {\r\n        var self=this;\r\n        this._setAttr(config);\r\n    }\r\n}\r\nfunction reset(link){\r\n    link.jtopo.paintPath = jtopoReset.paintPath;\r\n}\r\n//-\r\nFoldLink.prototype.setDirection=function(direction){\r\n    //折线方向 horizontal 水平 "vertical"垂直\r\n    if(direction){\r\n        this.jtopo.direction=direction;\r\n    }\r\n    this.attr.direction=this.jtopo.direction;\r\n};\r\nFoldLink.prototype.getDefault=getDefault;\r\nFoldLink.prototype.setRadius = function (radius) {\r\n    if ($.isNumeric(radius)) {\r\n        radius = parseInt(radius);\r\n        if (radius > 20) {\r\n            radius = 20;\r\n        } else if (radius < 0) {\r\n            radius = 0;\r\n        }\r\n        this.attr.radius = radius;\r\n    }\r\n};\r\n//-//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9saW5rL0ZvbGQuanM/NTBiYiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBLGdHQUFnRztBQUNoRyxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNEO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQ7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIzNC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBMaW5rPXJlcXVpcmUoXCIuL0xpbmsuanNcIik7XHJcbm1vZHVsZS5leHBvcnRzID0gIHtcclxuICAgIGNvbnN0cnVjdG9yOkZvbGRMaW5rLFxyXG4gICAgc2V0RGVmYXVsdDpzZXREZWZhdWx0LFxyXG4gICAgZ2V0RGVmYXVsdDpnZXREZWZhdWx0XHJcbn07XHJcbi8vLVxyXG52YXIgREVGQVVMVCA9e1xyXG4gICAgICAgIG51bWJlcjoxLFxyXG4gICAgICAgIGFscGhhOjEsXHJcbiAgICAgICAgY29sb3I6ICcyMiwxMjQsMjU1JyxcclxuICAgICAgICBhcnJvdzp7XHJcbiAgICAgICAgICAgIHNpemU6MTAsXHJcbiAgICAgICAgICAgIG9mZnNldDowLFxyXG4gICAgICAgICAgICBzdGFydDpmYWxzZSxcclxuICAgICAgICAgICAgZW5kOmZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBqc29uSWQ6XCJcIixcclxuICAgICAgICBnYXA6MjAsXHJcbiAgICAgICAgd2lkdGg6IDIsXHJcbiAgICAgICAgZGFzaGVkOiAgbnVsbCxcclxuICAgICAgICB6SW5kZXggOiAxMDAsXHJcbiAgICAgICAgcmFkaXVzOjAsXHJcbiAgICAgICAgZm9udDp7XHJcbiAgICAgICAgICAgIHNpemU6MTYsXHJcbiAgICAgICAgICAgIHR5cGU6XCLlvq7ova/pm4Xpu5FcIixcclxuICAgICAgICAgICAgY29sb3I6JzI1NSwyNTUsMjU1J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdXNlVHlwZTogUVRvcG8uY29uc3RhbnQubGluay5GT0xELFxyXG4gICAgICAgIGRpcmVjdGlvbjpcInZlcnRpY2FsXCJcclxufTtcclxuZnVuY3Rpb24gc2V0RGVmYXVsdChjb25maWcpe1xyXG4gICAgUVRvcG8udXRpbC5leHRlbmQoREVGQVVMVCwgY29uZmlnIHx8IHt9KTtcclxufVxyXG5mdW5jdGlvbiBnZXREZWZhdWx0KCl7XHJcbiAgICByZXR1cm4gUVRvcG8udXRpbC5kZWVwQ2xvbmUoREVGQVVMVCk7XHJcbn1cclxuLy8tLS0tLS0tLS1cclxudmFyIGp0b3BvUmVzZXQ9e1xyXG4gICAgLy/lj4zlkJHnrq3lpLQs5re75Yqg5bem5Y+z6L655qaC5b+1XHJcbiAgICBwYWludFBhdGg6ZnVuY3Rpb24gKGN4LCBwYXRoKSB7XHJcbiAgICAgICAgdmFyIGF0dHI9dGhpcy5xdG9wby5hdHRyO1xyXG4gICAgICAgIGlmICh0aGlzLm5vZGVBID09PSB0aGlzLm5vZGVaKXJldHVybiB2b2lkIHRoaXMucGFpbnRMb29wKGN4KTtcclxuICAgICAgICBjeC5iZWdpblBhdGgoKTtcclxuICAgICAgICBjeC5tb3ZlVG8ocGF0aFswXS54LCBwYXRoWzBdLnkpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIGlmKG51bGwgPT0gdGhpcy5kYXNoZWRQYXR0ZXJuKXtcclxuICAgICAgICAgICAgICAgIGlmIChhdHRyLnJhZGl1cyA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHBhdGgubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjeC5hcmNUbyhwYXRoW2ldLngsIHBhdGhbaV0ueSxwYXRoW2kgKyAxXS54LCBwYXRoW2kgKyAxXS55LGF0dHIucmFkaXVzKTsvL+WinuWKoOaKmOe6v+W8p+W6plxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN4LmxpbmVUbyhwYXRoW2ldLngsIHBhdGhbaV0ueSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjeC5saW5lVG8ocGF0aFtpXS54LCBwYXRoW2ldLnkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGN4LkpUb3BvRGFzaGVkTGluZVRvKHBhdGhbaSAtIDFdLngsIHBhdGhbaSAtIDFdLnksIHBhdGhbaV0ueCwgcGF0aFtpXS55LCB0aGlzLmRhc2hlZFBhdHRlcm4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGN4LnN0cm9rZSgpO1xyXG4gICAgICAgIGN4LmNsb3NlUGF0aCgpO1xyXG4gICAgICAgIGlmIChudWxsICE9IHRoaXMuYXJyb3dzUmFkaXVzKSB7XHJcbiAgICAgICAgICAgIGlmIChhdHRyLmFycm93LmVuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWludEFycm93KGN4LCBwYXRoW3BhdGgubGVuZ3RoIC0gMl0sIHBhdGhbcGF0aC5sZW5ndGggLSAxXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGF0dHIuYXJyb3cuc3RhcnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFpbnRBcnJvdyhjeCwgcGF0aFsxXSwgcGF0aFswXSk7Ly/mt7vliqDlj4zlkJHnrq3lpLRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuLy8tLS0tLS0tLS1cclxuLy8tXHJcbmZ1bmN0aW9uIEZvbGRMaW5rKGNvbmZpZyl7XHJcbiAgICBpZighY29uZmlnLnN0YXJ0fHwhY29uZmlnLmVuZHx8IWNvbmZpZy5zdGFydC5qdG9wb3x8IWNvbmZpZy5lbmQuanRvcG8pe1xyXG4gICAgICAgIFFUb3BvLnV0aWwuZXJyb3IoXCJDcmVhdGUgTGluayBuZWVkIHN0YXJ0IGFuZCBlbmRcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdHRyID0gIFFUb3BvLnV0aWwuZXh0ZW5kKGdldERlZmF1bHQoKSwgY29uZmlnIHx8IHt9KTtcclxuICAgIExpbmsuY2FsbCh0aGlzLCBuZXcgSlRvcG8uRm9sZExpbmsoY29uZmlnLnN0YXJ0Lmp0b3BvLCBjb25maWcuZW5kLmp0b3BvKSk7XHJcbiAgICAvL+WHveaVsFxyXG4gICAgdGhpcy5zZXQgPSBzZXRKVG9wbztcclxuICAgIC8v5Yid5aeL5YyWXHJcbiAgICB0aGlzLnNldCh0aGlzLmF0dHIpO1xyXG4gICAgLy/kv67mlLnmupDnoIFcclxuICAgIHJlc2V0KHRoaXMpO1xyXG59XHJcblFUb3BvLnV0aWwuaW5oZXJpdHMoRm9sZExpbmssTGluayk7XHJcbi8vLVxyXG5mdW5jdGlvbiBzZXRKVG9wbyhjb25maWcpIHtcclxuICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICB2YXIgc2VsZj10aGlzO1xyXG4gICAgICAgIHRoaXMuX3NldEF0dHIoY29uZmlnKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZXNldChsaW5rKXtcclxuICAgIGxpbmsuanRvcG8ucGFpbnRQYXRoID0ganRvcG9SZXNldC5wYWludFBhdGg7XHJcbn1cclxuLy8tXHJcbkZvbGRMaW5rLnByb3RvdHlwZS5zZXREaXJlY3Rpb249ZnVuY3Rpb24oZGlyZWN0aW9uKXtcclxuICAgIC8v5oqY57q/5pa55ZCRIGhvcml6b250YWwg5rC05bmzIFwidmVydGljYWxcIuWeguebtFxyXG4gICAgaWYoZGlyZWN0aW9uKXtcclxuICAgICAgICB0aGlzLmp0b3BvLmRpcmVjdGlvbj1kaXJlY3Rpb247XHJcbiAgICB9XHJcbiAgICB0aGlzLmF0dHIuZGlyZWN0aW9uPXRoaXMuanRvcG8uZGlyZWN0aW9uO1xyXG59O1xyXG5Gb2xkTGluay5wcm90b3R5cGUuZ2V0RGVmYXVsdD1nZXREZWZhdWx0O1xyXG5Gb2xkTGluay5wcm90b3R5cGUuc2V0UmFkaXVzID0gZnVuY3Rpb24gKHJhZGl1cykge1xyXG4gICAgaWYgKCQuaXNOdW1lcmljKHJhZGl1cykpIHtcclxuICAgICAgICByYWRpdXMgPSBwYXJzZUludChyYWRpdXMpO1xyXG4gICAgICAgIGlmIChyYWRpdXMgPiAyMCkge1xyXG4gICAgICAgICAgICByYWRpdXMgPSAyMDtcclxuICAgICAgICB9IGVsc2UgaWYgKHJhZGl1cyA8IDApIHtcclxuICAgICAgICAgICAgcmFkaXVzID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hdHRyLnJhZGl1cyA9IHJhZGl1cztcclxuICAgIH1cclxufTtcclxuLy8tXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9saW5rL0ZvbGQuanNcbi8vIG1vZHVsZSBpZCA9IDM0XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJzb3VyY2VSb290IjoiIn0=');
},35:function(module,exports,__webpack_require__){eval('var Node=__webpack_require__(3);\r\nmodule.exports = {\r\n    constructor:ImageNode,\r\n    setDefault:setDefault,\r\n    getDefault:getDefault\r\n};\r\n//-\r\nvar DEFAULT= {\r\n    image: "",\r\n    size: [60, 60],\r\n    name: "node",\r\n    alpha: 1,\r\n    position: [0, 0],\r\n    font: {\r\n        size: 16,\r\n        type: \'微软雅黑\',\r\n        color: "255,255,255"\r\n    },\r\n    jsonId:"",\r\n    border:{\r\n        width:0,\r\n        radius:0,//最大160 最小0\r\n        color:"255,0,0"\r\n    },\r\n    zIndex: 200,//层级(10-999)\r\n    color: JTopo.util.randomColor(),\r\n    namePosition: \'bottom\',//Bottom_Center Top_Center Middle_Left Middle_Right Hidden\r\n    useType: QTopo.constant.node.IMAGE,\r\n    alarm: {\r\n        show: false,\r\n        text: "",\r\n        color: "255,255,255",\r\n        font: {\r\n            size: 16,\r\n            type: "微软雅黑"\r\n        }\r\n    }\r\n};\r\nfunction setDefault(config){\r\n    QTopo.util.extend(DEFAULT, config || {});\r\n}\r\nfunction getDefault(){\r\n    return QTopo.util.deepClone(DEFAULT);\r\n}\r\n//-\r\n//------\r\n    var jtopoReset={\r\n        paint:function (cx) {\r\n            alarmFlash.call(this,cx);\r\n            if (this.image) {\r\n                var b = cx.globalAlpha;\r\n                cx.globalAlpha = this.alpha;\r\n                if(null != this.alarmImage&& null != this.alarm ){\r\n                    cx.drawImage(this.alarmImage, -this.width / 2, -this.height / 2, this.width, this.height)\r\n                }else{\r\n                    cx.drawImage(this.image, -this.width / 2, -this.height / 2, this.width, this.height)\r\n                }\r\n                cx.globalAlpha = b;\r\n            } else{\r\n                cx.beginPath();\r\n                cx.fillStyle = "rgba(" + this.fillColor + "," + this.alpha + ")";\r\n                if(null == this.borderRadius || 0 == this.borderRadius){\r\n                    cx.rect(-this.width / 2, -this.height / 2, this.width, this.height);\r\n                }else{\r\n                    cx.JTopoRoundRect(-this.width / 2, -this.height / 2, this.width, this.height, this.borderRadius);\r\n                }\r\n                cx.fill();\r\n                cx.closePath();\r\n            }\r\n            this.paintText(cx);\r\n            this.paintBorder(cx);\r\n            this.paintCtrl(cx);\r\n            this.paintAlarmText(cx);\r\n        }\r\n    };\r\n//------\r\nfunction ImageNode(config) {\r\n    this.attr = QTopo.util.extend(getDefault(), config || {});\r\n    Node.call(this,new JTopo.Node());\r\n    //告警闪烁 ...paintChilds函数内,638行附近调用\r\n    this.jtopo.alarmFlash=alarmFlash;\r\n    //函数\r\n    this.set = setJTopo;\r\n    //初始化\r\n    this.set(this.attr);\r\n    reset(this);\r\n}\r\nQTopo.util.inherits(ImageNode,Node);\r\n//-\r\nfunction setJTopo(config) {\r\n    if (config) {\r\n        //处理一般属性的设置\r\n        this._setAttr(config);\r\n        //处理特殊属性的设置\r\n    }\r\n}\r\nfunction reset(node){\r\n    node.jtopo.paint=jtopoReset.paint;\r\n}\r\n\r\n//-\r\nImageNode.prototype.setImage=function(image) {\r\n    if(image){\r\n        this.jtopo.setImage(image);\r\n        this.attr.image=image;\r\n    }\r\n};\r\nImageNode.prototype.getDefault=getDefault;\r\n//--\r\nImageNode.prototype.setAlarm=function(config) {\r\n    alarmAttr(this,this.attr.alarm,config);\r\n};\r\nfunction alarmAttr(qtopo,alarm,config){\r\n    var jtopo=qtopo.jtopo;\r\n    if(typeof config.show=="undefined"){\r\n        config.show=alarm.show;\r\n    }\r\n    if ((typeof config.show=="boolean"&&config.show)||(config.show=="true")) {\r\n        qtopo.setAlpha(1);\r\n        jtopo.shadow = true;\r\n        jtopo.alarm = config.text || "";\r\n        alarm.text=jtopo.alarm;\r\n        if(config.color){\r\n            jtopo.alarmColor = QTopo.util.transHex(config.color.toLowerCase());\r\n            alarm.color=jtopo.alarmColor;\r\n        }\r\n        var size=alarm.font.size;\r\n        var font=alarm.font.type;\r\n        if(config.font&&$.isNumeric(config.font.size)){\r\n            size=config.font.size;\r\n        }\r\n        if(config.font&&config.font.type){\r\n            font=config.font.type;\r\n        }\r\n        jtopo.alarmFont =  size+ \'px \' + font;\r\n        alarm.font.size=size;\r\n        alarm.font.type=font;\r\n        toggleAlarmFlash(jtopo,true);\r\n    } else {\r\n        jtopo.alarm = null;\r\n        toggleAlarmFlash(jtopo,false);\r\n    }\r\n    alarm.show=config.show;\r\n}\r\nfunction toggleAlarmFlash(node,show){\r\n    //切换闪烁\r\n    if(show){\r\n        node.shadowOffsetX = 0;\r\n        node.shadowOffsetY = 0;\r\n        node.shadowColor = "rgba(" + node.alarmColor + ",1)";\r\n        node.shadowBlur = 10;\r\n        node.allowAlarmFlash=true;\r\n    }else{\r\n        node.shadowOffsetX = 3;\r\n        node.shadowOffsetY = 6;\r\n        node.shadowColor="rgba(0,0,0,0.1)";\r\n        node.shadowBlur = 10;\r\n        node.allowAlarmFlash=false;\r\n    }\r\n}\r\n//插入源码部分,启用告警后每次绘画执行修改阴影\r\nfunction alarmFlash(cx) {\r\n    if(this.shadow&&this.allowAlarmFlash){\r\n        if(typeof this.shadowDirection=="undefined"){\r\n            this.shadowDirection=true;\r\n        }\r\n        move(this);\r\n        cx.shadowBlur = this.shadowBlur;\r\n        function move(node){\r\n            if (node.shadowDirection) {\r\n                node.shadowBlur += 5;\r\n                if(node.shadowBlur>100){\r\n                    node.shadowDirection=false;\r\n                }\r\n            }\r\n            else {\r\n                node.shadowBlur -= 5;\r\n                if(node.shadowBlur<=10){\r\n                    node.shadowDirection=true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n//--\r\n//-//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9ub2RlL0ltYWdlLmpzPzczNWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiMzUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgTm9kZT1yZXF1aXJlKFwiLi9Ob2RlLmpzXCIpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIGNvbnN0cnVjdG9yOkltYWdlTm9kZSxcclxuICAgIHNldERlZmF1bHQ6c2V0RGVmYXVsdCxcclxuICAgIGdldERlZmF1bHQ6Z2V0RGVmYXVsdFxyXG59O1xyXG4vLy1cclxudmFyIERFRkFVTFQ9IHtcclxuICAgIGltYWdlOiBcIlwiLFxyXG4gICAgc2l6ZTogWzYwLCA2MF0sXHJcbiAgICBuYW1lOiBcIm5vZGVcIixcclxuICAgIGFscGhhOiAxLFxyXG4gICAgcG9zaXRpb246IFswLCAwXSxcclxuICAgIGZvbnQ6IHtcclxuICAgICAgICBzaXplOiAxNixcclxuICAgICAgICB0eXBlOiAn5b6u6L2v6ZuF6buRJyxcclxuICAgICAgICBjb2xvcjogXCIyNTUsMjU1LDI1NVwiXHJcbiAgICB9LFxyXG4gICAganNvbklkOlwiXCIsXHJcbiAgICBib3JkZXI6e1xyXG4gICAgICAgIHdpZHRoOjAsXHJcbiAgICAgICAgcmFkaXVzOjAsLy/mnIDlpKcxNjAg5pyA5bCPMFxyXG4gICAgICAgIGNvbG9yOlwiMjU1LDAsMFwiXHJcbiAgICB9LFxyXG4gICAgekluZGV4OiAyMDAsLy/lsYLnuqcoMTAtOTk5KVxyXG4gICAgY29sb3I6IEpUb3BvLnV0aWwucmFuZG9tQ29sb3IoKSxcclxuICAgIG5hbWVQb3NpdGlvbjogJ2JvdHRvbScsLy9Cb3R0b21fQ2VudGVyIFRvcF9DZW50ZXIgTWlkZGxlX0xlZnQgTWlkZGxlX1JpZ2h0IEhpZGRlblxyXG4gICAgdXNlVHlwZTogUVRvcG8uY29uc3RhbnQubm9kZS5JTUFHRSxcclxuICAgIGFsYXJtOiB7XHJcbiAgICAgICAgc2hvdzogZmFsc2UsXHJcbiAgICAgICAgdGV4dDogXCJcIixcclxuICAgICAgICBjb2xvcjogXCIyNTUsMjU1LDI1NVwiLFxyXG4gICAgICAgIGZvbnQ6IHtcclxuICAgICAgICAgICAgc2l6ZTogMTYsXHJcbiAgICAgICAgICAgIHR5cGU6IFwi5b6u6L2v6ZuF6buRXCJcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcbmZ1bmN0aW9uIHNldERlZmF1bHQoY29uZmlnKXtcclxuICAgIFFUb3BvLnV0aWwuZXh0ZW5kKERFRkFVTFQsIGNvbmZpZyB8fCB7fSk7XHJcbn1cclxuZnVuY3Rpb24gZ2V0RGVmYXVsdCgpe1xyXG4gICAgcmV0dXJuIFFUb3BvLnV0aWwuZGVlcENsb25lKERFRkFVTFQpO1xyXG59XHJcbi8vLVxyXG4vLy0tLS0tLVxyXG4gICAgdmFyIGp0b3BvUmVzZXQ9e1xyXG4gICAgICAgIHBhaW50OmZ1bmN0aW9uIChjeCkge1xyXG4gICAgICAgICAgICBhbGFybUZsYXNoLmNhbGwodGhpcyxjeCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmltYWdlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYiA9IGN4Lmdsb2JhbEFscGhhO1xyXG4gICAgICAgICAgICAgICAgY3guZ2xvYmFsQWxwaGEgPSB0aGlzLmFscGhhO1xyXG4gICAgICAgICAgICAgICAgaWYobnVsbCAhPSB0aGlzLmFsYXJtSW1hZ2UmJiBudWxsICE9IHRoaXMuYWxhcm0gKXtcclxuICAgICAgICAgICAgICAgICAgICBjeC5kcmF3SW1hZ2UodGhpcy5hbGFybUltYWdlLCAtdGhpcy53aWR0aCAvIDIsIC10aGlzLmhlaWdodCAvIDIsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KVxyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgY3guZHJhd0ltYWdlKHRoaXMuaW1hZ2UsIC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMiwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjeC5nbG9iYWxBbHBoYSA9IGI7XHJcbiAgICAgICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgICAgIGN4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgY3guZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgdGhpcy5maWxsQ29sb3IgKyBcIixcIiArIHRoaXMuYWxwaGEgKyBcIilcIjtcclxuICAgICAgICAgICAgICAgIGlmKG51bGwgPT0gdGhpcy5ib3JkZXJSYWRpdXMgfHwgMCA9PSB0aGlzLmJvcmRlclJhZGl1cyl7XHJcbiAgICAgICAgICAgICAgICAgICAgY3gucmVjdCgtdGhpcy53aWR0aCAvIDIsIC10aGlzLmhlaWdodCAvIDIsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGN4LkpUb3BvUm91bmRSZWN0KC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMiwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIHRoaXMuYm9yZGVyUmFkaXVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGN4LmZpbGwoKTtcclxuICAgICAgICAgICAgICAgIGN4LmNsb3NlUGF0aCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnRUZXh0KGN4KTtcclxuICAgICAgICAgICAgdGhpcy5wYWludEJvcmRlcihjeCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnRDdHJsKGN4KTtcclxuICAgICAgICAgICAgdGhpcy5wYWludEFsYXJtVGV4dChjeCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuLy8tLS0tLS1cclxuZnVuY3Rpb24gSW1hZ2VOb2RlKGNvbmZpZykge1xyXG4gICAgdGhpcy5hdHRyID0gUVRvcG8udXRpbC5leHRlbmQoZ2V0RGVmYXVsdCgpLCBjb25maWcgfHwge30pO1xyXG4gICAgTm9kZS5jYWxsKHRoaXMsbmV3IEpUb3BvLk5vZGUoKSk7XHJcbiAgICAvL+WRiuitpumXqueDgSAuLi5wYWludENoaWxkc+WHveaVsOWGhSw2MzjooYzpmYTov5HosIPnlKhcclxuICAgIHRoaXMuanRvcG8uYWxhcm1GbGFzaD1hbGFybUZsYXNoO1xyXG4gICAgLy/lh73mlbBcclxuICAgIHRoaXMuc2V0ID0gc2V0SlRvcG87XHJcbiAgICAvL+WIneWni+WMllxyXG4gICAgdGhpcy5zZXQodGhpcy5hdHRyKTtcclxuICAgIHJlc2V0KHRoaXMpO1xyXG59XHJcblFUb3BvLnV0aWwuaW5oZXJpdHMoSW1hZ2VOb2RlLE5vZGUpO1xyXG4vLy1cclxuZnVuY3Rpb24gc2V0SlRvcG8oY29uZmlnKSB7XHJcbiAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgLy/lpITnkIbkuIDoiKzlsZ7mgKfnmoTorr7nva5cclxuICAgICAgICB0aGlzLl9zZXRBdHRyKGNvbmZpZyk7XHJcbiAgICAgICAgLy/lpITnkIbnibnmrorlsZ7mgKfnmoTorr7nva5cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZXNldChub2RlKXtcclxuICAgIG5vZGUuanRvcG8ucGFpbnQ9anRvcG9SZXNldC5wYWludDtcclxufVxyXG5cclxuLy8tXHJcbkltYWdlTm9kZS5wcm90b3R5cGUuc2V0SW1hZ2U9ZnVuY3Rpb24oaW1hZ2UpIHtcclxuICAgIGlmKGltYWdlKXtcclxuICAgICAgICB0aGlzLmp0b3BvLnNldEltYWdlKGltYWdlKTtcclxuICAgICAgICB0aGlzLmF0dHIuaW1hZ2U9aW1hZ2U7XHJcbiAgICB9XHJcbn07XHJcbkltYWdlTm9kZS5wcm90b3R5cGUuZ2V0RGVmYXVsdD1nZXREZWZhdWx0O1xyXG4vLy0tXHJcbkltYWdlTm9kZS5wcm90b3R5cGUuc2V0QWxhcm09ZnVuY3Rpb24oY29uZmlnKSB7XHJcbiAgICBhbGFybUF0dHIodGhpcyx0aGlzLmF0dHIuYWxhcm0sY29uZmlnKTtcclxufTtcclxuZnVuY3Rpb24gYWxhcm1BdHRyKHF0b3BvLGFsYXJtLGNvbmZpZyl7XHJcbiAgICB2YXIganRvcG89cXRvcG8uanRvcG87XHJcbiAgICBpZih0eXBlb2YgY29uZmlnLnNob3c9PVwidW5kZWZpbmVkXCIpe1xyXG4gICAgICAgIGNvbmZpZy5zaG93PWFsYXJtLnNob3c7XHJcbiAgICB9XHJcbiAgICBpZiAoKHR5cGVvZiBjb25maWcuc2hvdz09XCJib29sZWFuXCImJmNvbmZpZy5zaG93KXx8KGNvbmZpZy5zaG93PT1cInRydWVcIikpIHtcclxuICAgICAgICBxdG9wby5zZXRBbHBoYSgxKTtcclxuICAgICAgICBqdG9wby5zaGFkb3cgPSB0cnVlO1xyXG4gICAgICAgIGp0b3BvLmFsYXJtID0gY29uZmlnLnRleHQgfHwgXCJcIjtcclxuICAgICAgICBhbGFybS50ZXh0PWp0b3BvLmFsYXJtO1xyXG4gICAgICAgIGlmKGNvbmZpZy5jb2xvcil7XHJcbiAgICAgICAgICAgIGp0b3BvLmFsYXJtQ29sb3IgPSBRVG9wby51dGlsLnRyYW5zSGV4KGNvbmZpZy5jb2xvci50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICAgICAgYWxhcm0uY29sb3I9anRvcG8uYWxhcm1Db2xvcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHNpemU9YWxhcm0uZm9udC5zaXplO1xyXG4gICAgICAgIHZhciBmb250PWFsYXJtLmZvbnQudHlwZTtcclxuICAgICAgICBpZihjb25maWcuZm9udCYmJC5pc051bWVyaWMoY29uZmlnLmZvbnQuc2l6ZSkpe1xyXG4gICAgICAgICAgICBzaXplPWNvbmZpZy5mb250LnNpemU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGNvbmZpZy5mb250JiZjb25maWcuZm9udC50eXBlKXtcclxuICAgICAgICAgICAgZm9udD1jb25maWcuZm9udC50eXBlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBqdG9wby5hbGFybUZvbnQgPSAgc2l6ZSsgJ3B4ICcgKyBmb250O1xyXG4gICAgICAgIGFsYXJtLmZvbnQuc2l6ZT1zaXplO1xyXG4gICAgICAgIGFsYXJtLmZvbnQudHlwZT1mb250O1xyXG4gICAgICAgIHRvZ2dsZUFsYXJtRmxhc2goanRvcG8sdHJ1ZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGp0b3BvLmFsYXJtID0gbnVsbDtcclxuICAgICAgICB0b2dnbGVBbGFybUZsYXNoKGp0b3BvLGZhbHNlKTtcclxuICAgIH1cclxuICAgIGFsYXJtLnNob3c9Y29uZmlnLnNob3c7XHJcbn1cclxuZnVuY3Rpb24gdG9nZ2xlQWxhcm1GbGFzaChub2RlLHNob3cpe1xyXG4gICAgLy/liIfmjaLpl6rng4FcclxuICAgIGlmKHNob3cpe1xyXG4gICAgICAgIG5vZGUuc2hhZG93T2Zmc2V0WCA9IDA7XHJcbiAgICAgICAgbm9kZS5zaGFkb3dPZmZzZXRZID0gMDtcclxuICAgICAgICBub2RlLnNoYWRvd0NvbG9yID0gXCJyZ2JhKFwiICsgbm9kZS5hbGFybUNvbG9yICsgXCIsMSlcIjtcclxuICAgICAgICBub2RlLnNoYWRvd0JsdXIgPSAxMDtcclxuICAgICAgICBub2RlLmFsbG93QWxhcm1GbGFzaD10cnVlO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgbm9kZS5zaGFkb3dPZmZzZXRYID0gMztcclxuICAgICAgICBub2RlLnNoYWRvd09mZnNldFkgPSA2O1xyXG4gICAgICAgIG5vZGUuc2hhZG93Q29sb3I9XCJyZ2JhKDAsMCwwLDAuMSlcIjtcclxuICAgICAgICBub2RlLnNoYWRvd0JsdXIgPSAxMDtcclxuICAgICAgICBub2RlLmFsbG93QWxhcm1GbGFzaD1mYWxzZTtcclxuICAgIH1cclxufVxyXG4vL+aPkuWFpea6kOeggemDqOWIhizlkK/nlKjlkYrorablkI7mr4/mrKHnu5jnlLvmiafooYzkv67mlLnpmLTlvbFcclxuZnVuY3Rpb24gYWxhcm1GbGFzaChjeCkge1xyXG4gICAgaWYodGhpcy5zaGFkb3cmJnRoaXMuYWxsb3dBbGFybUZsYXNoKXtcclxuICAgICAgICBpZih0eXBlb2YgdGhpcy5zaGFkb3dEaXJlY3Rpb249PVwidW5kZWZpbmVkXCIpe1xyXG4gICAgICAgICAgICB0aGlzLnNoYWRvd0RpcmVjdGlvbj10cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtb3ZlKHRoaXMpO1xyXG4gICAgICAgIGN4LnNoYWRvd0JsdXIgPSB0aGlzLnNoYWRvd0JsdXI7XHJcbiAgICAgICAgZnVuY3Rpb24gbW92ZShub2RlKXtcclxuICAgICAgICAgICAgaWYgKG5vZGUuc2hhZG93RGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBub2RlLnNoYWRvd0JsdXIgKz0gNTtcclxuICAgICAgICAgICAgICAgIGlmKG5vZGUuc2hhZG93Qmx1cj4xMDApe1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuc2hhZG93RGlyZWN0aW9uPWZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbm9kZS5zaGFkb3dCbHVyIC09IDU7XHJcbiAgICAgICAgICAgICAgICBpZihub2RlLnNoYWRvd0JsdXI8PTEwKXtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLnNoYWRvd0RpcmVjdGlvbj10cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbi8vLS1cclxuLy8tXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9ub2RlL0ltYWdlLmpzXG4vLyBtb2R1bGUgaWQgPSAzNVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwic291cmNlUm9vdCI6IiJ9')},36:function(module,exports,__webpack_require__){eval('var Node = __webpack_require__(3);\r\nmodule.exports = {\r\n    constructor: TextNode,\r\n    setDefault: setDefault,\r\n    getDefault: getDefault\r\n};\r\n//-\r\nvar DEFAULT = {\r\n    position: [0, 0],\r\n    font: {\r\n        size: 16,\r\n        type: \'微软雅黑\',\r\n        color: "255,255,255"\r\n    },\r\n    jsonId:"",\r\n    border: {\r\n        width: 0,\r\n        radius: 0,//最大160 最小0\r\n        color: "255,0,0"\r\n    },\r\n    zIndex: 200,//层级(10-999)\r\n    alpha: 1,\r\n    text: \'no text here\',\r\n    useType: QTopo.constant.node.TEXT\r\n};\r\nfunction setDefault(config) {\r\n    QTopo.util.extend(DEFAULT, config || {});\r\n}\r\nfunction getDefault() {\r\n    return QTopo.util.deepClone(DEFAULT);\r\n}\r\n//-\r\n//----\r\n//支持自动换行\r\nvar jtopoReset = {\r\n    paint: function (a) {\r\n        //自动换行\r\n        var texts = this.text.split("\\n");\r\n        a.beginPath();\r\n        a.font = this.font;\r\n        var fontWidth = a.measureText("田").width;\r\n        this.width = 0;\r\n        for (var j = 0; j < texts.length; j++) {\r\n            var width = a.measureText(texts[j]).width;\r\n            if (width > this.width) {\r\n                this.width = width;\r\n            }\r\n        }\r\n        this.height = texts.length * fontWidth;\r\n        a.strokeStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")";\r\n        a.fillStyle = "rgba(" + this.fontColor + ", " + this.alpha + ")";\r\n        if (texts.length > 1) {\r\n            for (var i = 0; i < texts.length; i++) {\r\n                a.fillText(texts[i], -this.width / 2 + 0.15 * fontWidth, this.height / 2 + (i - texts.length + 0.85) * fontWidth);\r\n            }\r\n        } else {\r\n            a.fillText(texts, -this.width / 2 + 0.03 * fontWidth, this.height / 2 - 0.15 * fontWidth);\r\n        }\r\n        a.closePath();\r\n        this.paintBorder(a);\r\n        this.paintCtrl(a);\r\n        this.paintAlarmText(a);\r\n    }\r\n};\r\n//----\r\nfunction TextNode(config) {\r\n    this.attr = QTopo.util.extend(getDefault(), config || {});\r\n    Node.call(this, new JTopo.TextNode());\r\n    this.set = setJTopo;\r\n    //初始化\r\n    this.set(this.attr);\r\n    reset(this);\r\n}\r\nQTopo.util.inherits(TextNode, Node);\r\n//-\r\nfunction setJTopo(config) {\r\n    if (config) {\r\n        //处理一般属性的设置\r\n        if (!this.attr.text&&!config.text) {\r\n            config.text = "not set text";\r\n        }\r\n        this._setAttr(config);\r\n    }\r\n}\r\n//重写源码\r\nfunction reset(node) {\r\n    node.jtopo.paint = jtopoReset.paint;\r\n}\r\n//-\r\nTextNode.prototype.getDefault = getDefault;\r\n//-\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9ub2RlL1RleHQuanM/MzM5ZiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0JBQWtCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0M7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiMzYuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgTm9kZSA9IHJlcXVpcmUoXCIuL05vZGUuanNcIik7XHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgY29uc3RydWN0b3I6IFRleHROb2RlLFxyXG4gICAgc2V0RGVmYXVsdDogc2V0RGVmYXVsdCxcclxuICAgIGdldERlZmF1bHQ6IGdldERlZmF1bHRcclxufTtcclxuLy8tXHJcbnZhciBERUZBVUxUID0ge1xyXG4gICAgcG9zaXRpb246IFswLCAwXSxcclxuICAgIGZvbnQ6IHtcclxuICAgICAgICBzaXplOiAxNixcclxuICAgICAgICB0eXBlOiAn5b6u6L2v6ZuF6buRJyxcclxuICAgICAgICBjb2xvcjogXCIyNTUsMjU1LDI1NVwiXHJcbiAgICB9LFxyXG4gICAganNvbklkOlwiXCIsXHJcbiAgICBib3JkZXI6IHtcclxuICAgICAgICB3aWR0aDogMCxcclxuICAgICAgICByYWRpdXM6IDAsLy/mnIDlpKcxNjAg5pyA5bCPMFxyXG4gICAgICAgIGNvbG9yOiBcIjI1NSwwLDBcIlxyXG4gICAgfSxcclxuICAgIHpJbmRleDogMjAwLC8v5bGC57qnKDEwLTk5OSlcclxuICAgIGFscGhhOiAxLFxyXG4gICAgdGV4dDogJ25vIHRleHQgaGVyZScsXHJcbiAgICB1c2VUeXBlOiBRVG9wby5jb25zdGFudC5ub2RlLlRFWFRcclxufTtcclxuZnVuY3Rpb24gc2V0RGVmYXVsdChjb25maWcpIHtcclxuICAgIFFUb3BvLnV0aWwuZXh0ZW5kKERFRkFVTFQsIGNvbmZpZyB8fCB7fSk7XHJcbn1cclxuZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHtcclxuICAgIHJldHVybiBRVG9wby51dGlsLmRlZXBDbG9uZShERUZBVUxUKTtcclxufVxyXG4vLy1cclxuLy8tLS0tXHJcbi8v5pSv5oyB6Ieq5Yqo5o2i6KGMXHJcbnZhciBqdG9wb1Jlc2V0ID0ge1xyXG4gICAgcGFpbnQ6IGZ1bmN0aW9uIChhKSB7XHJcbiAgICAgICAgLy/oh6rliqjmjaLooYxcclxuICAgICAgICB2YXIgdGV4dHMgPSB0aGlzLnRleHQuc3BsaXQoXCJcXG5cIik7XHJcbiAgICAgICAgYS5iZWdpblBhdGgoKTtcclxuICAgICAgICBhLmZvbnQgPSB0aGlzLmZvbnQ7XHJcbiAgICAgICAgdmFyIGZvbnRXaWR0aCA9IGEubWVhc3VyZVRleHQoXCLnlLBcIikud2lkdGg7XHJcbiAgICAgICAgdGhpcy53aWR0aCA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0ZXh0cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICB2YXIgd2lkdGggPSBhLm1lYXN1cmVUZXh0KHRleHRzW2pdKS53aWR0aDtcclxuICAgICAgICAgICAgaWYgKHdpZHRoID4gdGhpcy53aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gdGV4dHMubGVuZ3RoICogZm9udFdpZHRoO1xyXG4gICAgICAgIGEuc3Ryb2tlU3R5bGUgPSBcInJnYmEoXCIgKyB0aGlzLmZvbnRDb2xvciArIFwiLCBcIiArIHRoaXMuYWxwaGEgKyBcIilcIjtcclxuICAgICAgICBhLmZpbGxTdHlsZSA9IFwicmdiYShcIiArIHRoaXMuZm9udENvbG9yICsgXCIsIFwiICsgdGhpcy5hbHBoYSArIFwiKVwiO1xyXG4gICAgICAgIGlmICh0ZXh0cy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGEuZmlsbFRleHQodGV4dHNbaV0sIC10aGlzLndpZHRoIC8gMiArIDAuMTUgKiBmb250V2lkdGgsIHRoaXMuaGVpZ2h0IC8gMiArIChpIC0gdGV4dHMubGVuZ3RoICsgMC44NSkgKiBmb250V2lkdGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYS5maWxsVGV4dCh0ZXh0cywgLXRoaXMud2lkdGggLyAyICsgMC4wMyAqIGZvbnRXaWR0aCwgdGhpcy5oZWlnaHQgLyAyIC0gMC4xNSAqIGZvbnRXaWR0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGEuY2xvc2VQYXRoKCk7XHJcbiAgICAgICAgdGhpcy5wYWludEJvcmRlcihhKTtcclxuICAgICAgICB0aGlzLnBhaW50Q3RybChhKTtcclxuICAgICAgICB0aGlzLnBhaW50QWxhcm1UZXh0KGEpO1xyXG4gICAgfVxyXG59O1xyXG4vLy0tLS1cclxuZnVuY3Rpb24gVGV4dE5vZGUoY29uZmlnKSB7XHJcbiAgICB0aGlzLmF0dHIgPSBRVG9wby51dGlsLmV4dGVuZChnZXREZWZhdWx0KCksIGNvbmZpZyB8fCB7fSk7XHJcbiAgICBOb2RlLmNhbGwodGhpcywgbmV3IEpUb3BvLlRleHROb2RlKCkpO1xyXG4gICAgdGhpcy5zZXQgPSBzZXRKVG9wbztcclxuICAgIC8v5Yid5aeL5YyWXHJcbiAgICB0aGlzLnNldCh0aGlzLmF0dHIpO1xyXG4gICAgcmVzZXQodGhpcyk7XHJcbn1cclxuUVRvcG8udXRpbC5pbmhlcml0cyhUZXh0Tm9kZSwgTm9kZSk7XHJcbi8vLVxyXG5mdW5jdGlvbiBzZXRKVG9wbyhjb25maWcpIHtcclxuICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICAvL+WkhOeQhuS4gOiIrOWxnuaAp+eahOiuvue9rlxyXG4gICAgICAgIGlmICghdGhpcy5hdHRyLnRleHQmJiFjb25maWcudGV4dCkge1xyXG4gICAgICAgICAgICBjb25maWcudGV4dCA9IFwibm90IHNldCB0ZXh0XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3NldEF0dHIoY29uZmlnKTtcclxuICAgIH1cclxufVxyXG4vL+mHjeWGmea6kOeggVxyXG5mdW5jdGlvbiByZXNldChub2RlKSB7XHJcbiAgICBub2RlLmp0b3BvLnBhaW50ID0ganRvcG9SZXNldC5wYWludDtcclxufVxyXG4vLy1cclxuVGV4dE5vZGUucHJvdG90eXBlLmdldERlZmF1bHQgPSBnZXREZWZhdWx0O1xyXG4vLy1cclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9kZXZlbG9wL2NvcmUvZWxlbWVudC9ub2RlL1RleHQuanNcbi8vIG1vZHVsZSBpZCA9IDM2XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJzb3VyY2VSb290IjoiIn0=')},37:function(module,exports){eval('var events = {\r\n    init: function (scene) {\r\n        //注册分组切换\r\n        scene.on("dbclick", dbClick(scene));\r\n    }\r\n};\r\nfunction dbClick(scene) {\r\n    return function (e, qtopo) {\r\n        toggleGroup(e, qtopo, scene);\r\n        toggleLink(e, qtopo, scene);\r\n    }\r\n}\r\nfunction toggleGroup(e, qtopo, scene) {\r\n    //分组隐藏，显示缩放节点，节点位置根据分组长宽计算\r\n    if (qtopo) {\r\n        if (qtopo.getType() == QTopo.constant.CONTAINER) {\r\n            qtopo.toggle();\r\n        } else if (qtopo.getType() == QTopo.constant.NODE && qtopo.getUseType() == QTopo.constant.CASUAL) {\r\n            //分组显示，隐藏缩放节点，分组新位置根据节点位置和分组长宽计算\r\n            if (qtopo.toggleTo) {\r\n                qtopo.toggleTo.toggle();\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction toggleLink(e, qtopo, scene) {\r\n    if (qtopo && qtopo.getType() == QTopo.constant.LINK && qtopo.attr.expendAble) {\r\n        if (!$.isFunction(qtopo.toggle)) {\r\n            qtopo.openToggle(scene);\r\n        }\r\n        qtopo.toggle();\r\n    }\r\n}\r\nmodule.exports = events;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvZXZlbnRzLmpzP2FmNWMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIzNy5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBldmVudHMgPSB7XHJcbiAgICBpbml0OiBmdW5jdGlvbiAoc2NlbmUpIHtcclxuICAgICAgICAvL+azqOWGjOWIhue7hOWIh+aNolxyXG4gICAgICAgIHNjZW5lLm9uKFwiZGJjbGlja1wiLCBkYkNsaWNrKHNjZW5lKSk7XHJcbiAgICB9XHJcbn07XHJcbmZ1bmN0aW9uIGRiQ2xpY2soc2NlbmUpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZSwgcXRvcG8pIHtcclxuICAgICAgICB0b2dnbGVHcm91cChlLCBxdG9wbywgc2NlbmUpO1xyXG4gICAgICAgIHRvZ2dsZUxpbmsoZSwgcXRvcG8sIHNjZW5lKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB0b2dnbGVHcm91cChlLCBxdG9wbywgc2NlbmUpIHtcclxuICAgIC8v5YiG57uE6ZqQ6JeP77yM5pi+56S657yp5pS+6IqC54K577yM6IqC54K55L2N572u5qC55o2u5YiG57uE6ZW/5a696K6h566XXHJcbiAgICBpZiAocXRvcG8pIHtcclxuICAgICAgICBpZiAocXRvcG8uZ2V0VHlwZSgpID09IFFUb3BvLmNvbnN0YW50LkNPTlRBSU5FUikge1xyXG4gICAgICAgICAgICBxdG9wby50b2dnbGUoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHF0b3BvLmdldFR5cGUoKSA9PSBRVG9wby5jb25zdGFudC5OT0RFICYmIHF0b3BvLmdldFVzZVR5cGUoKSA9PSBRVG9wby5jb25zdGFudC5DQVNVQUwpIHtcclxuICAgICAgICAgICAgLy/liIbnu4TmmL7npLrvvIzpmpDol4/nvKnmlL7oioLngrnvvIzliIbnu4TmlrDkvY3nva7moLnmja7oioLngrnkvY3nva7lkozliIbnu4Tplb/lrr3orqHnrpdcclxuICAgICAgICAgICAgaWYgKHF0b3BvLnRvZ2dsZVRvKSB7XHJcbiAgICAgICAgICAgICAgICBxdG9wby50b2dnbGVUby50b2dnbGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB0b2dnbGVMaW5rKGUsIHF0b3BvLCBzY2VuZSkge1xyXG4gICAgaWYgKHF0b3BvICYmIHF0b3BvLmdldFR5cGUoKSA9PSBRVG9wby5jb25zdGFudC5MSU5LICYmIHF0b3BvLmF0dHIuZXhwZW5kQWJsZSkge1xyXG4gICAgICAgIGlmICghJC5pc0Z1bmN0aW9uKHF0b3BvLnRvZ2dsZSkpIHtcclxuICAgICAgICAgICAgcXRvcG8ub3BlblRvZ2dsZShzY2VuZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHF0b3BvLnRvZ2dsZSgpO1xyXG4gICAgfVxyXG59XHJcbm1vZHVsZS5leHBvcnRzID0gZXZlbnRzO1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2RldmVsb3AvY29yZS9ldmVudHMuanNcbi8vIG1vZHVsZSBpZCA9IDM3XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJzb3VyY2VSb290IjoiIn0=')},74:function(module,exports,__webpack_require__){eval('/** @module QTopo */\r\n//核心依赖\r\n__webpack_require__(10);\r\nif (typeof jQuery == "undefined") {\r\n    throw new Error("need jquery");\r\n}\r\n//QTopo\r\nvar QTopo = {\r\n    instance: [],\r\n    util: __webpack_require__(11),\r\n    constant: __webpack_require__(8),\r\n    log: {\r\n        error: true,\r\n        info: true\r\n    }\r\n};\r\nwindow.QTopo = QTopo;\r\nvar Scene = __webpack_require__(9);\r\n/**\r\n * 初始化Qtopo\r\n * @param dom\r\n * @param config\r\n * @see module:QTopo\r\n * @returns {{scene: (Scene|exports|module.exports), setOption: setOption, document: *, resize, serialize: toJson}}\r\n */\r\n/**\r\n * 初始化\r\n * @alias module:Qtopo.init\r\n */\r\nQTopo.init = function (dom, config) {\r\n    dom = dom instanceof Array ? dom[0] : dom;\r\n    var canvas = initCanvas(dom, $(dom).width(), $(dom).height());\r\n    var QtopoInstance = {\r\n        scene: new Scene(new JTopo.Stage(canvas), config),\r\n        setOption: setOption,\r\n        document: dom,\r\n        resize: resize(dom, canvas),\r\n        toJson:toJson\r\n    };\r\n    this.instance.push(QtopoInstance);\r\n    return QtopoInstance;\r\n};\r\nmodule.exports=QTopo;\r\n//---------------------\r\nfunction setOption(option, clear) {\r\n    option = option || {};\r\n    QTopo.util.info("start set topo: ", option);\r\n    var scene = this.scene;\r\n    if (clear) {\r\n        scene.clear();\r\n    }\r\n    createNode(scene, option.node);\r\n    createContainer(scene, option.container);\r\n    createLink(scene, option.link);\r\n    createLine(scene, option.line);\r\n    drawAlarm(scene, option.alarm);\r\n    QTopo.util.info("set topo complete: ", {\r\n        node:scene.children.node.length,\r\n        link:scene.children.link.length,\r\n        container:scene.children.container.length,\r\n        line:scene.children.line.length\r\n    });\r\n    return this;\r\n}\r\nfunction resize(dom, canvas) {\r\n    return function () {\r\n        canvas.setAttribute(\'width\', $(dom).width());\r\n        canvas.setAttribute(\'height\', $(dom).height());\r\n        return this;\r\n    }\r\n}\r\nfunction toJson(){\r\n    var data=this.scene.children;\r\n    var serialized={\r\n        init:this.scene.toJson(),\r\n        option:{\r\n            node:{\r\n                data:[]\r\n            },\r\n            link:{\r\n                data:[]\r\n            },\r\n            container:{\r\n                data:[]\r\n            },\r\n            line:{\r\n                data:[]\r\n            }\r\n        }\r\n    };\r\n    $.each(data,function(name,elements){\r\n        if($.isArray(elements)){\r\n            elements.map(function(element){\r\n                if(serialized.option[name]){\r\n                    serialized.option[name].data.push(element.toJson());\r\n                }\r\n            });\r\n        }\r\n    });\r\n    return serialized;\r\n}\r\nfunction initCanvas(dom, width, height) {\r\n    if (width <= 0 || height <= 0) {\r\n        throw new Error("The dom is not exist /not config width and height!");\r\n    }\r\n    dom.style.position = \'relative\';\r\n    dom.style.overflow = \'hidden\';\r\n    var canvas = document.createElement(\'canvas\');\r\n    dom.appendChild(canvas);\r\n    canvas.setAttribute(\'width\', width);\r\n    canvas.setAttribute(\'height\', height);\r\n    canvas.style.position = "absolute";\r\n    canvas.style.top = 0;\r\n    canvas.style.left = 0;\r\n    canvas.style[\'user-select\'] = \'none\';\r\n    canvas.style[\'-webkit-tap-highlight-color\'] = \'rgba(0, 0, 0, 0)\';\r\n    return canvas;\r\n}\r\nfunction createNode(scene, config) {\r\n    if (config) {\r\n        setDefaults(scene, QTopo.constant.node, config.style);\r\n        if ($.isArray(config.data)) {\r\n            $.each(config.data, function (i, item) {\r\n                var node = scene.createNode(item);\r\n                //额外属性添加\r\n                setExtra(node, item);\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n//排除临时元素\r\nfunction notCasual(arr) {\r\n    if (arr.length == 1) {\r\n        return arr[0];\r\n    } else {\r\n        for (var i = 0; i < arr.length; i++) {\r\n            if (arr[i].getUseType() != QTopo.constant.CASUAL) {\r\n                arr = arr[i];\r\n                return arr;\r\n            }\r\n        }\r\n    }\r\n}\r\n//根据配置创建分组\r\nfunction createContainer(scene, config) {\r\n    if (config) {\r\n        setDefaults(scene, QTopo.constant.container, config.style);\r\n        makeContainer(scene, config);\r\n    }\r\n}\r\nfunction makeContainer(scene, config) {\r\n    //搜索子的总标记\r\n    var findChild;\r\n    if (config.findChildren) {\r\n        findChild = config.findChildren;\r\n    }\r\n    if ($.isArray(config.data)) {\r\n        //开始构造分组\r\n        $.each(config.data, function (i, item) {\r\n            //无论是否有子元素，分组先创造出来\r\n            var container = scene.createContainer(item);\r\n            //额外属性添加\r\n            setExtra(container, item);\r\n            //确定查找子元素的标记\r\n            var findChild_exact = findChild;\r\n            if (item.findChildren) {\r\n                findChild_exact = item.findChildren;\r\n            }\r\n            makeChildren(scene, container, item, findChild_exact);\r\n        });\r\n    }\r\n}\r\nfunction makeChildren(scene, container, config, findChild) {\r\n    //过滤搜索子类的标记\r\n    findChild=filterTag(findChild);\r\n    if ($.isArray(config.children)) {\r\n        var errorInfo=[];\r\n        $.each(config.children, function (j, children) {\r\n            var child = scene.find(findChild + "=" + children);\r\n            if (child && child.length > 0) {\r\n                $.each(child, function (m, one) {\r\n                    if (one.getUseType() != QTopo.constant.CASUAL) {\r\n                        container.add(one);\r\n                    }\r\n                });\r\n            } else {\r\n                errorInfo.push({\r\n                    index: j,\r\n                    search: findChild + "=" + children\r\n                });\r\n            }\r\n        });\r\n        if(errorInfo.length>0){\r\n            QTopo.util.error( "some child not found : ",errorInfo);\r\n        }\r\n    }\r\n}\r\nfunction filterTag(tag){\r\n    if(!tag){\r\n        tag=\'jsonId\'\r\n    }\r\n    return tag;\r\n}\r\n//根据配置创建链接\r\nfunction createLink(scene, config) {\r\n    if (config) {\r\n        var path = config.path;\r\n        var findStart;\r\n        var findEnd;\r\n        if ($.isArray(path) && path.length > 0) {\r\n            //path为数组，0为起点条件1为终点条件,确定搜索条件,起始点条件可不同\r\n            if (path.length == 1) {\r\n                findEnd = path[0];\r\n                findStart = findEnd;\r\n            } else {\r\n                findStart = path[0];\r\n                findEnd = path[1];\r\n            }\r\n        } else {\r\n            findStart=filterTag(findStart);\r\n            findEnd=filterTag(findEnd);\r\n        }\r\n        //设置默认属性\r\n        setDefaults(scene, QTopo.constant.link, config.style);\r\n        //开始创建\r\n        makeLink(scene, config, findStart, findEnd);\r\n    }\r\n}\r\nfunction makeLink(scene, config, findStart, findEnd) {\r\n    if ($.isArray(config.data)) {\r\n        var errorInfo=[];\r\n        $.each(config.data, function (i, item) {\r\n            if (item) {\r\n                var link;\r\n                //根据确定的条件进行搜索\r\n                var start = notCasual(scene.find(findStart + "=" + item.start));\r\n                var end = notCasual(scene.find(findEnd + "=" + item.end));\r\n                if (start && end) {\r\n                    item.start = start;\r\n                    item.end = end;\r\n                    link = scene.addLink(item);\r\n                    //额外属性添加\r\n                    setExtra(link, item);\r\n                } else {\r\n                    var errorDate = {\r\n                        index: i,\r\n                        data: item\r\n                    };\r\n                    if (!start) {\r\n                        errorDate.missStart = item.start;\r\n                    }\r\n                    if (!end) {\r\n                        errorDate.missEnd = item.end;\r\n                    }\r\n                    errorInfo.push(errorDate);\r\n                }\r\n            } else {\r\n                errorInfo.push({\r\n                        index:i,\r\n                        info:"undefined data"\r\n                });\r\n            }\r\n        });\r\n        if(errorInfo.length>0){\r\n            QTopo.util.error("some link invalid : ", errorInfo);\r\n        }\r\n    }\r\n}\r\n//根据配置创建线段\r\nfunction createLine(scene, config) {\r\n    if (config) {\r\n        //设置默认属性\r\n        //设置默认属性\r\n        setDefaults(scene, QTopo.constant.line, config.style);\r\n        //开始创建\r\n        if ($.isArray(config.data)) {\r\n            $.each(config.data, function (i, v) {\r\n                var line = scene.createLine(v);\r\n                //额外属性添加\r\n                setExtra(line, v);\r\n            });\r\n        } else {\r\n            QTopo.util.error("can not draw line,need config \'path\' and \'path\' is Array and not empty,path\'s element need config x y, path used to find start and end");\r\n        }\r\n    }\r\n}\r\n//告警处理...\r\nfunction drawAlarm(scene, config) {\r\n    if (config) {\r\n        if ($.isArray(config.data) && config.node) {\r\n            var alarmData = config.data;\r\n            var alarmNodes = makeAlarmData(scene, alarmData, config);\r\n            QTopo.util.info("告警绘制 :", {\r\n                config:alarmData.length,\r\n                success:alarmNodes.length\r\n            });\r\n            if (config.animate) {\r\n                alarmAnimate(config.animate, alarmNodes);\r\n            } else {\r\n                $.each(alarmNodes, function (i, v) {\r\n                    v.node.set({\r\n                        alarm: v.alarm\r\n                    });\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction makeAlarmData(scene, alarmData, config) {\r\n    var alarms = [];\r\n    $.each(alarmData, function (k, v) {\r\n        var node = notCasual(scene.find(config.node + "=" + v["node"], "node"));\r\n        if (node) {\r\n            alarms.push({\r\n                node: node,\r\n                alarm: {\r\n                    show: typeof v.show == "boolean" ? v.show : true,\r\n                    text: v.text,\r\n                    color: v.color,\r\n                    font: v.font\r\n                }\r\n            });\r\n        }\r\n    });\r\n    return alarms;\r\n}\r\nvar animateRuning;\r\nfunction alarmAnimate(animate, alarmNodes) {\r\n    if (animate) {\r\n        if ($.isNumeric(animate.time)) {\r\n            clearAnimat();\r\n            QTopo.util.info("启用告警动画");\r\n            animateRuning = setInterval(function () {\r\n                if (alarmNodes.length > 0) {\r\n                    var data = alarmNodes.pop();\r\n                    data.node.set({\r\n                        alarm: data.alarm\r\n                    });\r\n                    if ($.isFunction(animate.callBack)) {\r\n                        animate.callBack(data.node);\r\n                    }\r\n                } else {\r\n                    QTopo.util.info("告警动画结束");\r\n                    clearAnimat();\r\n                }\r\n            }, parseInt(animate.time));\r\n        }\r\n    }\r\n}\r\nfunction clearAnimat() {\r\n    if (animateRuning) {\r\n        clearInterval(animateRuning);\r\n        animateRuning = "";\r\n    }\r\n}\r\nfunction setExtra(element,data){\r\n    if(data){\r\n        $.each(data,function(key,value){\r\n            if(filterConfig(element,key)&&["start","end","children","toggle","type","extra"].indexOf(key)<0){\r\n                element.extra[key]=value;\r\n            }\r\n        });\r\n        if(data.extra){\r\n            $.each(data.extra,function(key,value){\r\n                if(value){\r\n                    element.extra[key]=value;\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\nfunction filterConfig(element,key){\r\n    return element&&typeof element.attr[key]==\'undefined\';\r\n}\r\nfunction setDefaults(scene, typeArr, style) {\r\n    if (style) {\r\n        $.each(typeArr, function (i, types) {\r\n            scene.setDefault(types, style);\r\n        })\r\n    }\r\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL21haW4uanM/ZjkwOSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsdUJBQXVCLGdCQUFnQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EiLCJmaWxlIjoiNzQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiogQG1vZHVsZSBRVG9wbyAqL1xyXG4vL+aguOW/g+S+nei1llxyXG5yZXF1aXJlKFwiLi9jb3JlL2p0b3BvL2p0b3BvLW1pbi5qc1wiKTtcclxuaWYgKHR5cGVvZiBqUXVlcnkgPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwibmVlZCBqcXVlcnlcIik7XHJcbn1cclxuLy9RVG9wb1xyXG52YXIgUVRvcG8gPSB7XHJcbiAgICBpbnN0YW5jZTogW10sXHJcbiAgICB1dGlsOiByZXF1aXJlKCcuL3V0aWwuanMnKSxcclxuICAgIGNvbnN0YW50OiByZXF1aXJlKCcuL2NvbnN0YW50LmpzJyksXHJcbiAgICBsb2c6IHtcclxuICAgICAgICBlcnJvcjogdHJ1ZSxcclxuICAgICAgICBpbmZvOiB0cnVlXHJcbiAgICB9XHJcbn07XHJcbndpbmRvdy5RVG9wbyA9IFFUb3BvO1xyXG52YXIgU2NlbmUgPSByZXF1aXJlKCcuL2NvcmUvU2NlbmUuanMnKTtcclxuLyoqXHJcbiAqIOWIneWni+WMllF0b3BvXHJcbiAqIEBwYXJhbSBkb21cclxuICogQHBhcmFtIGNvbmZpZ1xyXG4gKiBAc2VlIG1vZHVsZTpRVG9wb1xyXG4gKiBAcmV0dXJucyB7e3NjZW5lOiAoU2NlbmV8ZXhwb3J0c3xtb2R1bGUuZXhwb3J0cyksIHNldE9wdGlvbjogc2V0T3B0aW9uLCBkb2N1bWVudDogKiwgcmVzaXplLCBzZXJpYWxpemU6IHRvSnNvbn19XHJcbiAqL1xyXG4vKipcclxuICog5Yid5aeL5YyWXHJcbiAqIEBhbGlhcyBtb2R1bGU6UXRvcG8uaW5pdFxyXG4gKi9cclxuUVRvcG8uaW5pdCA9IGZ1bmN0aW9uIChkb20sIGNvbmZpZykge1xyXG4gICAgZG9tID0gZG9tIGluc3RhbmNlb2YgQXJyYXkgPyBkb21bMF0gOiBkb207XHJcbiAgICB2YXIgY2FudmFzID0gaW5pdENhbnZhcyhkb20sICQoZG9tKS53aWR0aCgpLCAkKGRvbSkuaGVpZ2h0KCkpO1xyXG4gICAgdmFyIFF0b3BvSW5zdGFuY2UgPSB7XHJcbiAgICAgICAgc2NlbmU6IG5ldyBTY2VuZShuZXcgSlRvcG8uU3RhZ2UoY2FudmFzKSwgY29uZmlnKSxcclxuICAgICAgICBzZXRPcHRpb246IHNldE9wdGlvbixcclxuICAgICAgICBkb2N1bWVudDogZG9tLFxyXG4gICAgICAgIHJlc2l6ZTogcmVzaXplKGRvbSwgY2FudmFzKSxcclxuICAgICAgICB0b0pzb246dG9Kc29uXHJcbiAgICB9O1xyXG4gICAgdGhpcy5pbnN0YW5jZS5wdXNoKFF0b3BvSW5zdGFuY2UpO1xyXG4gICAgcmV0dXJuIFF0b3BvSW5zdGFuY2U7XHJcbn07XHJcbm1vZHVsZS5leHBvcnRzPVFUb3BvO1xyXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5mdW5jdGlvbiBzZXRPcHRpb24ob3B0aW9uLCBjbGVhcikge1xyXG4gICAgb3B0aW9uID0gb3B0aW9uIHx8IHt9O1xyXG4gICAgUVRvcG8udXRpbC5pbmZvKFwic3RhcnQgc2V0IHRvcG86IFwiLCBvcHRpb24pO1xyXG4gICAgdmFyIHNjZW5lID0gdGhpcy5zY2VuZTtcclxuICAgIGlmIChjbGVhcikge1xyXG4gICAgICAgIHNjZW5lLmNsZWFyKCk7XHJcbiAgICB9XHJcbiAgICBjcmVhdGVOb2RlKHNjZW5lLCBvcHRpb24ubm9kZSk7XHJcbiAgICBjcmVhdGVDb250YWluZXIoc2NlbmUsIG9wdGlvbi5jb250YWluZXIpO1xyXG4gICAgY3JlYXRlTGluayhzY2VuZSwgb3B0aW9uLmxpbmspO1xyXG4gICAgY3JlYXRlTGluZShzY2VuZSwgb3B0aW9uLmxpbmUpO1xyXG4gICAgZHJhd0FsYXJtKHNjZW5lLCBvcHRpb24uYWxhcm0pO1xyXG4gICAgUVRvcG8udXRpbC5pbmZvKFwic2V0IHRvcG8gY29tcGxldGU6IFwiLCB7XHJcbiAgICAgICAgbm9kZTpzY2VuZS5jaGlsZHJlbi5ub2RlLmxlbmd0aCxcclxuICAgICAgICBsaW5rOnNjZW5lLmNoaWxkcmVuLmxpbmsubGVuZ3RoLFxyXG4gICAgICAgIGNvbnRhaW5lcjpzY2VuZS5jaGlsZHJlbi5jb250YWluZXIubGVuZ3RoLFxyXG4gICAgICAgIGxpbmU6c2NlbmUuY2hpbGRyZW4ubGluZS5sZW5ndGhcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbn1cclxuZnVuY3Rpb24gcmVzaXplKGRvbSwgY2FudmFzKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgJChkb20pLndpZHRoKCkpO1xyXG4gICAgICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsICQoZG9tKS5oZWlnaHQoKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gdG9Kc29uKCl7XHJcbiAgICB2YXIgZGF0YT10aGlzLnNjZW5lLmNoaWxkcmVuO1xyXG4gICAgdmFyIHNlcmlhbGl6ZWQ9e1xyXG4gICAgICAgIGluaXQ6dGhpcy5zY2VuZS50b0pzb24oKSxcclxuICAgICAgICBvcHRpb246e1xyXG4gICAgICAgICAgICBub2RlOntcclxuICAgICAgICAgICAgICAgIGRhdGE6W11cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazp7XHJcbiAgICAgICAgICAgICAgICBkYXRhOltdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbnRhaW5lcjp7XHJcbiAgICAgICAgICAgICAgICBkYXRhOltdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbmU6e1xyXG4gICAgICAgICAgICAgICAgZGF0YTpbXVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgICQuZWFjaChkYXRhLGZ1bmN0aW9uKG5hbWUsZWxlbWVudHMpe1xyXG4gICAgICAgIGlmKCQuaXNBcnJheShlbGVtZW50cykpe1xyXG4gICAgICAgICAgICBlbGVtZW50cy5tYXAoZnVuY3Rpb24oZWxlbWVudCl7XHJcbiAgICAgICAgICAgICAgICBpZihzZXJpYWxpemVkLm9wdGlvbltuYW1lXSl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZC5vcHRpb25bbmFtZV0uZGF0YS5wdXNoKGVsZW1lbnQudG9Kc29uKCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBzZXJpYWxpemVkO1xyXG59XHJcbmZ1bmN0aW9uIGluaXRDYW52YXMoZG9tLCB3aWR0aCwgaGVpZ2h0KSB7XHJcbiAgICBpZiAod2lkdGggPD0gMCB8fCBoZWlnaHQgPD0gMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBkb20gaXMgbm90IGV4aXN0IC9ub3QgY29uZmlnIHdpZHRoIGFuZCBoZWlnaHQhXCIpO1xyXG4gICAgfVxyXG4gICAgZG9tLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcclxuICAgIGRvbS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG4gICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgZG9tLmFwcGVuZENoaWxkKGNhbnZhcyk7XHJcbiAgICBjYW52YXMuc2V0QXR0cmlidXRlKCd3aWR0aCcsIHdpZHRoKTtcclxuICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGhlaWdodCk7XHJcbiAgICBjYW52YXMuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XHJcbiAgICBjYW52YXMuc3R5bGUudG9wID0gMDtcclxuICAgIGNhbnZhcy5zdHlsZS5sZWZ0ID0gMDtcclxuICAgIGNhbnZhcy5zdHlsZVsndXNlci1zZWxlY3QnXSA9ICdub25lJztcclxuICAgIGNhbnZhcy5zdHlsZVsnLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yJ10gPSAncmdiYSgwLCAwLCAwLCAwKSc7XHJcbiAgICByZXR1cm4gY2FudmFzO1xyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZU5vZGUoc2NlbmUsIGNvbmZpZykge1xyXG4gICAgaWYgKGNvbmZpZykge1xyXG4gICAgICAgIHNldERlZmF1bHRzKHNjZW5lLCBRVG9wby5jb25zdGFudC5ub2RlLCBjb25maWcuc3R5bGUpO1xyXG4gICAgICAgIGlmICgkLmlzQXJyYXkoY29uZmlnLmRhdGEpKSB7XHJcbiAgICAgICAgICAgICQuZWFjaChjb25maWcuZGF0YSwgZnVuY3Rpb24gKGksIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBub2RlID0gc2NlbmUuY3JlYXRlTm9kZShpdGVtKTtcclxuICAgICAgICAgICAgICAgIC8v6aKd5aSW5bGe5oCn5re75YqgXHJcbiAgICAgICAgICAgICAgICBzZXRFeHRyYShub2RlLCBpdGVtKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4vL+aOkumZpOS4tOaXtuWFg+e0oFxyXG5mdW5jdGlvbiBub3RDYXN1YWwoYXJyKSB7XHJcbiAgICBpZiAoYXJyLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgcmV0dXJuIGFyclswXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGFycltpXS5nZXRVc2VUeXBlKCkgIT0gUVRvcG8uY29uc3RhbnQuQ0FTVUFMKSB7XHJcbiAgICAgICAgICAgICAgICBhcnIgPSBhcnJbaV07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbi8v5qC55o2u6YWN572u5Yib5bu65YiG57uEXHJcbmZ1bmN0aW9uIGNyZWF0ZUNvbnRhaW5lcihzY2VuZSwgY29uZmlnKSB7XHJcbiAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgc2V0RGVmYXVsdHMoc2NlbmUsIFFUb3BvLmNvbnN0YW50LmNvbnRhaW5lciwgY29uZmlnLnN0eWxlKTtcclxuICAgICAgICBtYWtlQ29udGFpbmVyKHNjZW5lLCBjb25maWcpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG1ha2VDb250YWluZXIoc2NlbmUsIGNvbmZpZykge1xyXG4gICAgLy/mkJzntKLlrZDnmoTmgLvmoIforrBcclxuICAgIHZhciBmaW5kQ2hpbGQ7XHJcbiAgICBpZiAoY29uZmlnLmZpbmRDaGlsZHJlbikge1xyXG4gICAgICAgIGZpbmRDaGlsZCA9IGNvbmZpZy5maW5kQ2hpbGRyZW47XHJcbiAgICB9XHJcbiAgICBpZiAoJC5pc0FycmF5KGNvbmZpZy5kYXRhKSkge1xyXG4gICAgICAgIC8v5byA5aeL5p6E6YCg5YiG57uEXHJcbiAgICAgICAgJC5lYWNoKGNvbmZpZy5kYXRhLCBmdW5jdGlvbiAoaSwgaXRlbSkge1xyXG4gICAgICAgICAgICAvL+aXoOiuuuaYr+WQpuacieWtkOWFg+e0oO+8jOWIhue7hOWFiOWIm+mAoOWHuuadpVxyXG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gc2NlbmUuY3JlYXRlQ29udGFpbmVyKGl0ZW0pO1xyXG4gICAgICAgICAgICAvL+mineWkluWxnuaAp+a3u+WKoFxyXG4gICAgICAgICAgICBzZXRFeHRyYShjb250YWluZXIsIGl0ZW0pO1xyXG4gICAgICAgICAgICAvL+ehruWumuafpeaJvuWtkOWFg+e0oOeahOagh+iusFxyXG4gICAgICAgICAgICB2YXIgZmluZENoaWxkX2V4YWN0ID0gZmluZENoaWxkO1xyXG4gICAgICAgICAgICBpZiAoaXRlbS5maW5kQ2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgIGZpbmRDaGlsZF9leGFjdCA9IGl0ZW0uZmluZENoaWxkcmVuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1ha2VDaGlsZHJlbihzY2VuZSwgY29udGFpbmVyLCBpdGVtLCBmaW5kQ2hpbGRfZXhhY3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG1ha2VDaGlsZHJlbihzY2VuZSwgY29udGFpbmVyLCBjb25maWcsIGZpbmRDaGlsZCkge1xyXG4gICAgLy/ov4fmu6TmkJzntKLlrZDnsbvnmoTmoIforrBcclxuICAgIGZpbmRDaGlsZD1maWx0ZXJUYWcoZmluZENoaWxkKTtcclxuICAgIGlmICgkLmlzQXJyYXkoY29uZmlnLmNoaWxkcmVuKSkge1xyXG4gICAgICAgIHZhciBlcnJvckluZm89W107XHJcbiAgICAgICAgJC5lYWNoKGNvbmZpZy5jaGlsZHJlbiwgZnVuY3Rpb24gKGosIGNoaWxkcmVuKSB7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZCA9IHNjZW5lLmZpbmQoZmluZENoaWxkICsgXCI9XCIgKyBjaGlsZHJlbik7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZCAmJiBjaGlsZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goY2hpbGQsIGZ1bmN0aW9uIChtLCBvbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob25lLmdldFVzZVR5cGUoKSAhPSBRVG9wby5jb25zdGFudC5DQVNVQUwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZChvbmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZXJyb3JJbmZvLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4OiBqLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaDogZmluZENoaWxkICsgXCI9XCIgKyBjaGlsZHJlblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZihlcnJvckluZm8ubGVuZ3RoPjApe1xyXG4gICAgICAgICAgICBRVG9wby51dGlsLmVycm9yKCBcInNvbWUgY2hpbGQgbm90IGZvdW5kIDogXCIsZXJyb3JJbmZvKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZmlsdGVyVGFnKHRhZyl7XHJcbiAgICBpZighdGFnKXtcclxuICAgICAgICB0YWc9J2pzb25JZCdcclxuICAgIH1cclxuICAgIHJldHVybiB0YWc7XHJcbn1cclxuLy/moLnmja7phY3nva7liJvlu7rpk77mjqVcclxuZnVuY3Rpb24gY3JlYXRlTGluayhzY2VuZSwgY29uZmlnKSB7XHJcbiAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIHBhdGggPSBjb25maWcucGF0aDtcclxuICAgICAgICB2YXIgZmluZFN0YXJ0O1xyXG4gICAgICAgIHZhciBmaW5kRW5kO1xyXG4gICAgICAgIGlmICgkLmlzQXJyYXkocGF0aCkgJiYgcGF0aC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIC8vcGF0aOS4uuaVsOe7hO+8jDDkuLrotbfngrnmnaHku7Yx5Li657uI54K55p2h5Lu2LOehruWumuaQnOe0ouadoeS7tizotbflp4vngrnmnaHku7blj6/kuI3lkIxcclxuICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgICAgICAgIGZpbmRFbmQgPSBwYXRoWzBdO1xyXG4gICAgICAgICAgICAgICAgZmluZFN0YXJ0ID0gZmluZEVuZDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZpbmRTdGFydCA9IHBhdGhbMF07XHJcbiAgICAgICAgICAgICAgICBmaW5kRW5kID0gcGF0aFsxXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZpbmRTdGFydD1maWx0ZXJUYWcoZmluZFN0YXJ0KTtcclxuICAgICAgICAgICAgZmluZEVuZD1maWx0ZXJUYWcoZmluZEVuZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8v6K6+572u6buY6K6k5bGe5oCnXHJcbiAgICAgICAgc2V0RGVmYXVsdHMoc2NlbmUsIFFUb3BvLmNvbnN0YW50LmxpbmssIGNvbmZpZy5zdHlsZSk7XHJcbiAgICAgICAgLy/lvIDlp4vliJvlu7pcclxuICAgICAgICBtYWtlTGluayhzY2VuZSwgY29uZmlnLCBmaW5kU3RhcnQsIGZpbmRFbmQpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG1ha2VMaW5rKHNjZW5lLCBjb25maWcsIGZpbmRTdGFydCwgZmluZEVuZCkge1xyXG4gICAgaWYgKCQuaXNBcnJheShjb25maWcuZGF0YSkpIHtcclxuICAgICAgICB2YXIgZXJyb3JJbmZvPVtdO1xyXG4gICAgICAgICQuZWFjaChjb25maWcuZGF0YSwgZnVuY3Rpb24gKGksIGl0ZW0pIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBsaW5rO1xyXG4gICAgICAgICAgICAgICAgLy/moLnmja7noa7lrprnmoTmnaHku7bov5vooYzmkJzntKJcclxuICAgICAgICAgICAgICAgIHZhciBzdGFydCA9IG5vdENhc3VhbChzY2VuZS5maW5kKGZpbmRTdGFydCArIFwiPVwiICsgaXRlbS5zdGFydCkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGVuZCA9IG5vdENhc3VhbChzY2VuZS5maW5kKGZpbmRFbmQgKyBcIj1cIiArIGl0ZW0uZW5kKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhcnQgJiYgZW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zdGFydCA9IHN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uZW5kID0gZW5kO1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmsgPSBzY2VuZS5hZGRMaW5rKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8v6aKd5aSW5bGe5oCn5re75YqgXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0RXh0cmEobGluaywgaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvckRhdGUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBpdGVtXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXJ0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yRGF0ZS5taXNzU3RhcnQgPSBpdGVtLnN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWVuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvckRhdGUubWlzc0VuZCA9IGl0ZW0uZW5kO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlcnJvckluZm8ucHVzaChlcnJvckRhdGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZXJyb3JJbmZvLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleDppLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvOlwidW5kZWZpbmVkIGRhdGFcIlxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZihlcnJvckluZm8ubGVuZ3RoPjApe1xyXG4gICAgICAgICAgICBRVG9wby51dGlsLmVycm9yKFwic29tZSBsaW5rIGludmFsaWQgOiBcIiwgZXJyb3JJbmZvKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLy/moLnmja7phY3nva7liJvlu7rnur/mrrVcclxuZnVuY3Rpb24gY3JlYXRlTGluZShzY2VuZSwgY29uZmlnKSB7XHJcbiAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgLy/orr7nva7pu5jorqTlsZ7mgKdcclxuICAgICAgICAvL+iuvue9rum7mOiupOWxnuaAp1xyXG4gICAgICAgIHNldERlZmF1bHRzKHNjZW5lLCBRVG9wby5jb25zdGFudC5saW5lLCBjb25maWcuc3R5bGUpO1xyXG4gICAgICAgIC8v5byA5aeL5Yib5bu6XHJcbiAgICAgICAgaWYgKCQuaXNBcnJheShjb25maWcuZGF0YSkpIHtcclxuICAgICAgICAgICAgJC5lYWNoKGNvbmZpZy5kYXRhLCBmdW5jdGlvbiAoaSwgdikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxpbmUgPSBzY2VuZS5jcmVhdGVMaW5lKHYpO1xyXG4gICAgICAgICAgICAgICAgLy/pop3lpJblsZ7mgKfmt7vliqBcclxuICAgICAgICAgICAgICAgIHNldEV4dHJhKGxpbmUsIHYpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiY2FuIG5vdCBkcmF3IGxpbmUsbmVlZCBjb25maWcgJ3BhdGgnIGFuZCAncGF0aCcgaXMgQXJyYXkgYW5kIG5vdCBlbXB0eSxwYXRoJ3MgZWxlbWVudCBuZWVkIGNvbmZpZyB4IHksIHBhdGggdXNlZCB0byBmaW5kIHN0YXJ0IGFuZCBlbmRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbi8v5ZGK6K2m5aSE55CGLi4uXHJcbmZ1bmN0aW9uIGRyYXdBbGFybShzY2VuZSwgY29uZmlnKSB7XHJcbiAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgaWYgKCQuaXNBcnJheShjb25maWcuZGF0YSkgJiYgY29uZmlnLm5vZGUpIHtcclxuICAgICAgICAgICAgdmFyIGFsYXJtRGF0YSA9IGNvbmZpZy5kYXRhO1xyXG4gICAgICAgICAgICB2YXIgYWxhcm1Ob2RlcyA9IG1ha2VBbGFybURhdGEoc2NlbmUsIGFsYXJtRGF0YSwgY29uZmlnKTtcclxuICAgICAgICAgICAgUVRvcG8udXRpbC5pbmZvKFwi5ZGK6K2m57uY5Yi2IDpcIiwge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnOmFsYXJtRGF0YS5sZW5ndGgsXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOmFsYXJtTm9kZXMubGVuZ3RoXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAoY29uZmlnLmFuaW1hdGUpIHtcclxuICAgICAgICAgICAgICAgIGFsYXJtQW5pbWF0ZShjb25maWcuYW5pbWF0ZSwgYWxhcm1Ob2Rlcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goYWxhcm1Ob2RlcywgZnVuY3Rpb24gKGksIHYpIHtcclxuICAgICAgICAgICAgICAgICAgICB2Lm5vZGUuc2V0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxhcm06IHYuYWxhcm1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG1ha2VBbGFybURhdGEoc2NlbmUsIGFsYXJtRGF0YSwgY29uZmlnKSB7XHJcbiAgICB2YXIgYWxhcm1zID0gW107XHJcbiAgICAkLmVhY2goYWxhcm1EYXRhLCBmdW5jdGlvbiAoaywgdikge1xyXG4gICAgICAgIHZhciBub2RlID0gbm90Q2FzdWFsKHNjZW5lLmZpbmQoY29uZmlnLm5vZGUgKyBcIj1cIiArIHZbXCJub2RlXCJdLCBcIm5vZGVcIikpO1xyXG4gICAgICAgIGlmIChub2RlKSB7XHJcbiAgICAgICAgICAgIGFsYXJtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIG5vZGU6IG5vZGUsXHJcbiAgICAgICAgICAgICAgICBhbGFybToge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3c6IHR5cGVvZiB2LnNob3cgPT0gXCJib29sZWFuXCIgPyB2LnNob3cgOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHYudGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBjb2xvcjogdi5jb2xvcixcclxuICAgICAgICAgICAgICAgICAgICBmb250OiB2LmZvbnRcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gYWxhcm1zO1xyXG59XHJcbnZhciBhbmltYXRlUnVuaW5nO1xyXG5mdW5jdGlvbiBhbGFybUFuaW1hdGUoYW5pbWF0ZSwgYWxhcm1Ob2Rlcykge1xyXG4gICAgaWYgKGFuaW1hdGUpIHtcclxuICAgICAgICBpZiAoJC5pc051bWVyaWMoYW5pbWF0ZS50aW1lKSkge1xyXG4gICAgICAgICAgICBjbGVhckFuaW1hdCgpO1xyXG4gICAgICAgICAgICBRVG9wby51dGlsLmluZm8oXCLlkK/nlKjlkYrorabliqjnlLtcIik7XHJcbiAgICAgICAgICAgIGFuaW1hdGVSdW5pbmcgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWxhcm1Ob2Rlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBhbGFybU5vZGVzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZS5zZXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGFybTogZGF0YS5hbGFybVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkLmlzRnVuY3Rpb24oYW5pbWF0ZS5jYWxsQmFjaykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZS5jYWxsQmFjayhkYXRhLm5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgUVRvcG8udXRpbC5pbmZvKFwi5ZGK6K2m5Yqo55S757uT5p2fXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyQW5pbWF0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHBhcnNlSW50KGFuaW1hdGUudGltZSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBjbGVhckFuaW1hdCgpIHtcclxuICAgIGlmIChhbmltYXRlUnVuaW5nKSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbChhbmltYXRlUnVuaW5nKTtcclxuICAgICAgICBhbmltYXRlUnVuaW5nID0gXCJcIjtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBzZXRFeHRyYShlbGVtZW50LGRhdGEpe1xyXG4gICAgaWYoZGF0YSl7XHJcbiAgICAgICAgJC5lYWNoKGRhdGEsZnVuY3Rpb24oa2V5LHZhbHVlKXtcclxuICAgICAgICAgICAgaWYoZmlsdGVyQ29uZmlnKGVsZW1lbnQsa2V5KSYmW1wic3RhcnRcIixcImVuZFwiLFwiY2hpbGRyZW5cIixcInRvZ2dsZVwiLFwidHlwZVwiLFwiZXh0cmFcIl0uaW5kZXhPZihrZXkpPDApe1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5leHRyYVtrZXldPXZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYoZGF0YS5leHRyYSl7XHJcbiAgICAgICAgICAgICQuZWFjaChkYXRhLmV4dHJhLGZ1bmN0aW9uKGtleSx2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICBpZih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHRyYVtrZXldPXZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZmlsdGVyQ29uZmlnKGVsZW1lbnQsa2V5KXtcclxuICAgIHJldHVybiBlbGVtZW50JiZ0eXBlb2YgZWxlbWVudC5hdHRyW2tleV09PSd1bmRlZmluZWQnO1xyXG59XHJcbmZ1bmN0aW9uIHNldERlZmF1bHRzKHNjZW5lLCB0eXBlQXJyLCBzdHlsZSkge1xyXG4gICAgaWYgKHN0eWxlKSB7XHJcbiAgICAgICAgJC5lYWNoKHR5cGVBcnIsIGZ1bmN0aW9uIChpLCB0eXBlcykge1xyXG4gICAgICAgICAgICBzY2VuZS5zZXREZWZhdWx0KHR5cGVzLCBzdHlsZSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vZGV2ZWxvcC9tYWluLmpzXG4vLyBtb2R1bGUgaWQgPSA3NFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwic291cmNlUm9vdCI6IiJ9');
},8:function(module,exports){eval('module.exports = {\r\n    SCENE:\'10\',\r\n    CONTAINER:"100",\r\n    LINK:"1000",\r\n    LINE:"1100",\r\n    NODE:\'10000\',\r\n    CASUAL:"临时工",//\r\n    node:{\r\n        IMAGE:"10010",\r\n        TEXT:"10001"\r\n    },\r\n    container:{\r\n        GROUP:"101"\r\n    },\r\n    link:{\r\n        CURVE:"1001",\r\n        DIRECT:"1002",\r\n        FLEXIONAL:"1003",\r\n        FOLD:"1004"\r\n    },\r\n    line:{\r\n        DIRECT:"1101"\r\n    },\r\n    mode:{\r\n        NORMAL:"normal",\r\n        EDIT:"edit",\r\n        DRAG:"drag",\r\n        SELECT:"select"\r\n    }\r\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvbnN0YW50LmpzPzhiZDkiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiOC5qcyIsInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgU0NFTkU6JzEwJyxcclxuICAgIENPTlRBSU5FUjpcIjEwMFwiLFxyXG4gICAgTElOSzpcIjEwMDBcIixcclxuICAgIExJTkU6XCIxMTAwXCIsXHJcbiAgICBOT0RFOicxMDAwMCcsXHJcbiAgICBDQVNVQUw6XCLkuLTml7blt6VcIiwvL1xyXG4gICAgbm9kZTp7XHJcbiAgICAgICAgSU1BR0U6XCIxMDAxMFwiLFxyXG4gICAgICAgIFRFWFQ6XCIxMDAwMVwiXHJcbiAgICB9LFxyXG4gICAgY29udGFpbmVyOntcclxuICAgICAgICBHUk9VUDpcIjEwMVwiXHJcbiAgICB9LFxyXG4gICAgbGluazp7XHJcbiAgICAgICAgQ1VSVkU6XCIxMDAxXCIsXHJcbiAgICAgICAgRElSRUNUOlwiMTAwMlwiLFxyXG4gICAgICAgIEZMRVhJT05BTDpcIjEwMDNcIixcclxuICAgICAgICBGT0xEOlwiMTAwNFwiXHJcbiAgICB9LFxyXG4gICAgbGluZTp7XHJcbiAgICAgICAgRElSRUNUOlwiMTEwMVwiXHJcbiAgICB9LFxyXG4gICAgbW9kZTp7XHJcbiAgICAgICAgTk9STUFMOlwibm9ybWFsXCIsXHJcbiAgICAgICAgRURJVDpcImVkaXRcIixcclxuICAgICAgICBEUkFHOlwiZHJhZ1wiLFxyXG4gICAgICAgIFNFTEVDVDpcInNlbGVjdFwiXHJcbiAgICB9XHJcbn07XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9kZXZlbG9wL2NvbnN0YW50LmpzXG4vLyBtb2R1bGUgaWQgPSA4XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJzb3VyY2VSb290IjoiIn0=')},9:function(module,exports,__webpack_require__){eval('//-\r\nvar Node = {\r\n    Image: __webpack_require__(35),\r\n    Text: __webpack_require__(36)\r\n};\r\nvar Link = {\r\n    Curve: __webpack_require__(31),\r\n    Direct: __webpack_require__(32),\r\n    Flexional: __webpack_require__(33),\r\n    Fold: __webpack_require__(34)\r\n};\r\n\r\nvar Line = {\r\n    Direct: __webpack_require__(29)\r\n};\r\nvar Container = {\r\n    Group: __webpack_require__(28)\r\n};\r\nvar events = __webpack_require__(37);\r\nmodule.exports = Scene;\r\n//-\r\n//画布对象\r\nvar defaults = function () {\r\n    return {\r\n        mode: QTopo.constant.mode.NORMAL,\r\n        backgroundImage: ""\r\n    };\r\n};\r\nfunction Scene(stage, config) {\r\n    var self = this;\r\n    self.jtopo = new JTopo.Scene();\r\n    self.jtopo.qtopo = self;\r\n    self.children = {\r\n        node: [],\r\n        link: [],\r\n        container: [],\r\n        line: []\r\n    };\r\n    self.attr = defaults();\r\n    self.extra=config.extra||{};\r\n    stage.add(self.jtopo);\r\n    events.init(self);\r\n    //延时执行\r\n    setTimeout(function () {\r\n        if (config) {\r\n            if (config.backgroundImage) {\r\n                self.setBackgroundImage(config.backgroundImage);\r\n            }\r\n            if (config.backgroundColor) {\r\n                self.setBackgroundColor(config.backgroundColor);\r\n            }\r\n            if (config.mode) {\r\n                self.setMode(config.mode);\r\n            }\r\n        }\r\n    });\r\n}\r\n//-\r\nScene.prototype.get=function(key){\r\n    return this.attr[key];\r\n};\r\nScene.prototype.val=function(key,value){\r\n    if(QTopo.util.getClass(key)==\'Object\') {\r\n        var self=this;\r\n        $.each(key, function (name, value) {\r\n            self.extra[name] = value;\r\n        })\r\n    }else{\r\n        if(!value){\r\n            var result;\r\n            if(this.extra[key]){\r\n                result=this.extra[key];\r\n            }else if(this.attr[key]){\r\n                result=this.attr[key];\r\n            }else{\r\n                result=this[key];\r\n            }\r\n            return result;\r\n        }else{\r\n            this.extra[key]=value;\r\n        }\r\n    }\r\n};\r\nScene.prototype.setDefault = function (type, config) {\r\n    if (config) {\r\n        var constant = QTopo.constant;\r\n        switch (type) {\r\n            case constant.node.IMAGE:\r\n                Node.Image.setDefault(config);\r\n                break;\r\n            case constant.node.TEXT:\r\n                Node.Text.setDefault(config);\r\n                break;\r\n            case constant.link.DIRECT:\r\n                Link.Direct.setDefault(config);\r\n                break;\r\n            case constant.link.CURVE:\r\n                Link.Curve.setDefault(config);\r\n                break;\r\n            case constant.link.FLEXIONAL:\r\n                Link.Flexional.setDefault(config);\r\n                break;\r\n            case constant.link.FOLD:\r\n                Link.Fold.setDefault(config);\r\n                break;\r\n            case constant.line.DIRECT:\r\n                Line.Direct.setDefault(config);\r\n                break;\r\n            case constant.container.GROUP:\r\n                Container.Group.setDefault(config);\r\n                break;\r\n        }\r\n    }\r\n};\r\nScene.prototype.getDefault = function (type) {\r\n    if (type) {\r\n        var result;\r\n        var constant = QTopo.constant;\r\n        switch (type) {\r\n            case constant.node.IMAGE:\r\n                result = Node.Image.getDefault();\r\n                break;\r\n            case constant.node.TEXT:\r\n                result = Node.Text.getDefault();\r\n                break;\r\n            case constant.link.DIRECT:\r\n                result = Link.Direct.getDefault();\r\n                break;\r\n            case constant.link.CURVE:\r\n                result = Link.Curve.getDefault();\r\n                break;\r\n            case constant.link.FLEXIONAL:\r\n                result = Link.Flexional.getDefault();\r\n                break;\r\n            case constant.link.FOLD:\r\n                result = Link.Fold.getDefault();\r\n                break;\r\n            case constant.line.DIRECT:\r\n                result = Line.Direct.getDefault();\r\n                break;\r\n            case constant.container.GROUP:\r\n                result = Container.Group.getDefault();\r\n                break;\r\n        }\r\n        return result;\r\n    }\r\n};\r\nScene.prototype.setBackgroundImage = function (image) {\r\n    this.jtopo.background = image;\r\n    this.attr.background = image;\r\n};\r\nScene.prototype.setBackgroundColor = function (color) {\r\n    this.jtopo.backgroundColor = QTopo.util.transHex(color);\r\n    this.jtopo.alpha = 1;\r\n    this.attr.background = QTopo.util.transHex(color);\r\n};\r\nScene.prototype.setMode = function (mode) {\r\n    if (["normal", "edit", "drag", "select"].indexOf(mode) > -1) {\r\n        this.attr.mode = mode;\r\n        this.jtopo.mode = mode;\r\n    } else {\r\n        QTopo.util.error("set wrong mode :", mode);\r\n    }\r\n};\r\nScene.prototype.clear = function () {\r\n    QTopo.util.info("scene clear");\r\n    this.children = {\r\n        node: [],\r\n        link: [],\r\n        container: [],\r\n        line: []\r\n    };\r\n    this.jtopo.clear();\r\n};\r\nScene.prototype.getType = function () {\r\n    return QTopo.constant.SCENE;\r\n};\r\nScene.prototype.getUseType = function () {\r\n    return QTopo.constant.SCENE;\r\n};\r\nScene.prototype.on = function (name, fn) {\r\n    this.jtopo.addEventListener(name,fn);\r\n};\r\nScene.prototype.off = function (name, fn) {\r\n    this.jtopo.removeEventListener(name,fn);\r\n};\r\nScene.prototype.find = function (scan, type) {\r\n    var children = this.children;\r\n    var result = [];\r\n    var condition = typeof scan == "string" ? scan.split(",") : [];\r\n    if (condition.length > 0) {\r\n        $.each(condition, function (i, term) {\r\n            term = term.split("=");\r\n            //制定了类型，缩小查找范围，未指定则全部遍历\r\n            if (type) {\r\n                switch (type) {\r\n                    case "node":\r\n                        scanArr(children.node, term[0], term[1]);\r\n                        break;\r\n                    case "link":\r\n                        scanArr(children.link, term[0], term[1]);\r\n                        break;\r\n                    case "container":\r\n                        scanArr(children.container, term[0], term[1]);\r\n                        break;\r\n                    case "line":\r\n                        scanArr(children.line, term[0], term[1]);\r\n                        break;\r\n                }\r\n            } else {\r\n                $.each(children, function (j, arr) {\r\n                    scanArr(arr, term[0], term[1]);\r\n                });\r\n            }\r\n        });\r\n    }\r\n    return result;\r\n    //扫描数组中对象对应的属性是否相等\r\n    function scanArr(arr, key, value) {\r\n        $.each(arr, function (i, item) {\r\n            //只扫描对象的attr和extra中的属性\r\n            if (equal(item.extra, key, value) || equal(item.attr, key, value)) {\r\n                //排除重复的\r\n                if (result.indexOf(item) < 0) {\r\n                    result.push(item);\r\n                }\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    function equal(object, key, value) {\r\n        return object && object[key] && object[key] == value;\r\n    }\r\n};\r\nScene.prototype.getOrigin = function () {\r\n    return {\r\n        x: 0 - this.jtopo.translateX,\r\n        y: 0 - this.jtopo.translateY\r\n    }\r\n};\r\n//-\r\nfunction addJTopo(element) {\r\n    try {\r\n        this.jtopo.add(element.jtopo);\r\n    } catch (e) {\r\n        QTopo.util.error("In Scene, jtopo add error : ", e);\r\n    }\r\n}\r\nfunction removeJTopo(element) {\r\n    try {\r\n        this.jtopo.remove(element.jtopo);\r\n    } catch (e) {\r\n        QTopo.util.error("In Scene, jtopo remove error : ", e);\r\n    }\r\n}\r\nScene.prototype.createNode = function (config) {\r\n    var newNode;\r\n    var constant = QTopo.constant.node;\r\n    config = config || {};\r\n    switch (config.type) {\r\n        case constant.TEXT:\r\n            newNode = new Node.Text.constructor(config);\r\n            break;\r\n        default:\r\n            newNode = new Node.Image.constructor(config);\r\n    }\r\n    if (newNode && newNode.jtopo) {\r\n        addJTopo.call(this, newNode);\r\n        this.children.node.push(newNode);\r\n        return newNode;\r\n    } else {\r\n        QTopo.util.error("create Node error", config);\r\n        return false;\r\n    }\r\n};\r\n/**\r\n * 根据配置在两个元素之间创建新的链接\r\n * @param config\r\n * @returns {*}\r\n */\r\nScene.prototype.createLink = function (config) {\r\n    var newLink;\r\n    var constant = QTopo.constant.link;\r\n    config = config || {};\r\n    switch (config.type) {\r\n        case constant.CURVE:\r\n            newLink = new Link.Curve.constructor(config);\r\n            break;\r\n        case constant.FLEXIONAL:\r\n            newLink = new Link.Flexional.constructor(config);\r\n            break;\r\n        case constant.FOLD:\r\n            newLink = new Link.Fold.constructor(config);\r\n            break;\r\n        default:\r\n            newLink = new Link.Direct.constructor(config);\r\n    }\r\n    if (newLink && newLink.jtopo) {\r\n        addJTopo.call(this, newLink);\r\n        this.children.link.push(newLink);\r\n        return newLink;\r\n    } else {\r\n        QTopo.util.error("create Link error", config);\r\n        return false;\r\n    }\r\n};\r\n//--\r\n/**\r\n * 根据配置在两个元素之间创建链接,若两元素已有链接则原链接计数上加1,提供线路展开\r\n * @param config\r\n * @param fn 可选参数，若无则自动创建链接,若有则执行fn的动作\r\n */\r\nScene.prototype.addLink = function (config,fn) {\r\n    if (config && config.start && config.end) {\r\n        var links = this.linksBetween(config.start, config.end);//按number属性从大到小排列\r\n        if (links.length == 0) {\r\n            if($.isFunction(fn)){\r\n                fn();\r\n            }else{\r\n                return this.createLink(config);\r\n            }\r\n        } else {\r\n            //两点之间连线为1则认为是已有链接，超过1则认为是可以展开且已经展开的直线\r\n            var number = 1;\r\n            if ($.isNumeric(config.number)) {\r\n                number = parseInt(config.number);\r\n                if(number<1){\r\n                    number=1;\r\n                }\r\n            }\r\n            if(links.length==1){\r\n                links[0].set({\r\n                    number: links[0].attr.number + number\r\n                });\r\n                return links[0];\r\n            }else if(links.length>1){\r\n                var parent=links[0].parent;\r\n                if(parent){\r\n                    parent.attr.number+=number;\r\n                    parent.addChild(number);\r\n                }\r\n                return parent;\r\n            }\r\n        }\r\n    }\r\n};\r\nScene.prototype.linksBetween = function (start, end) {\r\n    var result = [];\r\n    var links = start.links;\r\n    //检测两元素间的连线是否已有\r\n    if ($.isArray(links.out)) {\r\n        $.each(links.out, function (i, linkOut) {\r\n            if (linkOut.path.end == end) {\r\n                result.push(linkOut);\r\n            }\r\n        });\r\n    }\r\n    if ($.isArray(links.in)) {\r\n        $.each(links.in, function (j, linkIn) {\r\n            if (linkIn.path.start == end) {\r\n                result.push(linkIn);\r\n            }\r\n        });\r\n    }\r\n    return result.sort(function (a, b) {\r\n        return b.attr.number - a.attr.number;\r\n    });\r\n};\r\n//--\r\nScene.prototype.createLine = function (config) {\r\n    var newLine;\r\n    var constant = QTopo.constant.line;\r\n    config = config || {};\r\n    switch (config.type) {\r\n        default:\r\n            newLine = new Line.Direct.constructor(config);\r\n    }\r\n    if (newLine && newLine.jtopo) {\r\n        addJTopo.call(this, newLine);\r\n        this.children.line.push(newLine);\r\n        return newLine;\r\n    } else {\r\n        QTopo.util.error("create Link error", config);\r\n        return false;\r\n    }\r\n};\r\n//--\r\nScene.prototype.createContainer = function (config) {\r\n    var newContainer;\r\n    var constant = QTopo.constant.container;\r\n    config = config || {};\r\n    switch (config.type) {\r\n        default:\r\n            newContainer = new Container.Group.constructor(config);\r\n    }\r\n    if (newContainer && newContainer.jtopo) {\r\n        //分组只加入其本身，切换节点不作数\r\n        var nodeConfig = {};\r\n        if (config.toggle) {\r\n            nodeConfig = config.toggle\r\n        }\r\n        //可选禁用分组切换\r\n        if (!(config.toggle&&typeof config.toggle.close == "boolean" && config.toggle.close)) {\r\n            addToggle(this, newContainer, nodeConfig);\r\n        }\r\n        this.children.container.push(newContainer);\r\n        addJTopo.call(this, newContainer);\r\n        return newContainer;\r\n    } else {\r\n        QTopo.util.error("create Container error", config);\r\n        return false;\r\n    }\r\n};\r\nfunction addToggle(scene, container, configToggle) {\r\n    configToggle.useType = QTopo.constant.CASUAL;//标记用途\r\n    container.toggleTo = new Node.Image.constructor(configToggle);\r\n    container.toggleTo.toggleTo = container;//互相索引\r\n    container.toggleTo.hide();//初始隐藏\r\n    addJTopo.call(scene, container.toggleTo);//加入画布\r\n}\r\n//--\r\n//-\r\nScene.prototype.remove = function (element) {\r\n    var self=this;\r\n    if (element) {\r\n        if ($.isArray(element)) {\r\n            $.each(element, function (i, item) {\r\n                removeOnce(item);\r\n            });\r\n        } else {\r\n            removeOnce(element);\r\n        }\r\n        function removeOnce(oneElement) {\r\n            if (oneElement.jtopo) {\r\n                switch (oneElement.getType()) {\r\n                    case QTopo.constant.NODE:\r\n                        if (QTopo.util.arrayDelete(self.children.node, oneElement) || oneElement.getUseType() == QTopo.constant.CASUAL) {\r\n                            removeNode.call(self, oneElement);\r\n                        }\r\n                        break;\r\n                    case QTopo.constant.LINK:\r\n                        if (QTopo.util.arrayDelete(self.children.link, oneElement) || oneElement.getUseType() == QTopo.constant.CASUAL) {\r\n                            removeLink.call(self, oneElement);\r\n                        }\r\n                        break;\r\n                    case QTopo.constant.LINE:\r\n                        if (QTopo.util.arrayDelete(self.children.line, oneElement) || oneElement.getUseType() == QTopo.constant.CASUAL) {\r\n                            removeLine.call(self, oneElement);\r\n                        }\r\n                        break;\r\n                    case QTopo.constant.CONTAINER:\r\n                        if (QTopo.util.arrayDelete(self.children.container, oneElement) || oneElement.getUseType() == QTopo.constant.CASUAL) {\r\n                            removeContainer.call(self, oneElement);\r\n                        }\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\nfunction upDataLinks(element) {\r\n    var links = element.links;\r\n    if (links) {\r\n        //更新其上连线的另一方的links属性\r\n        while (links.in.length > 0) {\r\n            this.remove(links.in.pop());\r\n        }\r\n        while (links.out.length > 0) {\r\n            this.remove(links.out.pop());\r\n        }\r\n    }\r\n}\r\n//线上删除时候,要更新node和container中的links属性\r\nfunction removeLink(link) {\r\n    try {\r\n        QTopo.util.arrayDelete(link.path.start.links.out, link);\r\n        QTopo.util.arrayDelete(link.path.end.links.in, link);\r\n        removeJTopo.call(this, link);\r\n    } catch (e) {\r\n        QTopo.util.error("Scene removeLink error", e);\r\n    }\r\n}\r\nfunction removeLine(line) {\r\n    try {\r\n        removeJTopo.call(this, line);\r\n    } catch (e) {\r\n        QTopo.util.error("Scene removeLine error", e);\r\n    }\r\n}\r\nfunction removeNode(node) {\r\n    //刷新一下现有的线\r\n    try {\r\n        //更新其上线另一头的links属性\r\n        upDataLinks.call(this, node);\r\n        //要更新其父的children属性,父删除子\r\n        if (node.parent && $.isArray(node.parent.children)) {\r\n            node.parent.remove(node);\r\n        }\r\n        //删除分组切换的节点时同时删除其切换的分组\r\n        if (node.toggleTo) {\r\n            //分组若隐藏了,应该展示\r\n            node.toggleTo.toggle();\r\n            this.remove(node.toggleTo);\r\n        }\r\n        removeJTopo.call(this, node);\r\n    } catch (e) {\r\n        QTopo.util.error("Scene removeNode error", e);\r\n    }\r\n}\r\n//容器删除时,要更与其相连的线的另一端的links属性,要更新其子类的parent属性\r\nfunction removeContainer(container) {\r\n    try {\r\n        //分组若隐藏了,应该展示\r\n        container.toggle(true);\r\n        //更新其上线另一头的links属性\r\n        upDataLinks.call(this, container);\r\n        //更新子元素的Parent属性\r\n        if ($.isArray(container.children) && container.children.length > 0) {\r\n            for (var i = 0; i < container.children.length; i++) {\r\n                container.children[i].parent = null;\r\n            }\r\n        }\r\n        //删除分组同时删除其切换节点\r\n        if (container.toggleTo) {\r\n            this.remove(container.toggleTo);\r\n        }\r\n        removeJTopo.call(this, container);\r\n    } catch (e) {\r\n        QTopo.util.error("Scene removeContainer error", e);\r\n    }\r\n}\r\n//-\r\nScene.prototype.toJson=function(){\r\n    var json=$.extend({},this.attr);\r\n    json.extra=$.extend({},this.extra);\r\n    return json;\r\n};\r\n\r\nScene.prototype.isChildren=function(element){\r\n    var result=false;\r\n    if(element.jtopo){\r\n        $.each(this.children,function(name,arr){\r\n            if(arr.indexOf(element)>-1){\r\n                result=true;\r\n                return false;\r\n            }\r\n        });\r\n    }\r\n    return result;\r\n};\r\nScene.prototype.goCenter = function () {\r\n    if (this.jtopo.childs && this.jtopo.childs.length > 0) {\r\n        this.jtopo.stage.centerAndZoom();\r\n    }\r\n};\r\nScene.prototype.resize = function (size) {\r\n    if ($.isNumeric(size)) {\r\n        this.jtopo.scaleX = size;\r\n        this.jtopo.scaleY = size;\r\n    }\r\n};\r\nScene.prototype.toggleZoom = function () {\r\n    if (!this.jtopo.stage.wheelZoom) {\r\n        this.jtopo.stage.wheelZoom = 0.85; // 设置鼠标缩放比例\r\n    } else {\r\n        this.jtopo.stage.wheelZoom = null;\r\n    }\r\n};\r\n/**\r\n * 切换鹰眼显示\r\n */\r\nScene.prototype.toggleEagleEye = function () {\r\n    this.jtopo.stage.eagleEye.visible = !this.jtopo.stage.eagleEye.visible;\r\n};\r\n/**\r\n * 获取当前画布的png格式图片在新的窗口打开\r\n */\r\nScene.prototype.getPicture = function () {\r\n    //stage.saveImageInfo();\r\n    //在新页面打开图片\r\n    var image = this.jtopo.stage.canvas.toDataURL("image/png");\r\n    var w = window.open(\'about:blank\', \'image from canvas\');\r\n    w.document.write("<img src=\'" + image + "\' alt=\'from canvas\'/>");\r\n    //下载图片\r\n    // here is the most important part because if you dont replace you will get a DOM 18 exception.\r\n    // var image =  stage.canvas.toDataURL("image/png").replace("image/png", "image/octet-stream;Content-Disposition: attachment;filename=foobar.png");\r\n    //var image = stage.canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");\r\n    //window.location.href=image; // it will save locally\r\n};\r\n/**\r\n * 切换元素的层次\r\n * @param element 待控制元素\r\n * @param flag 可选。true为降低false为提升，未有值则默认提升，若以提升到最高则降至最低\r\n */\r\nScene.prototype.toggleZIndex = function (element, flag) {\r\n    if (element) {\r\n        var jtopo = element.jtopo;\r\n        var scene = this.jtopo;\r\n        if (jtopo && scene) {\r\n            var map = scene.zIndexMap[jtopo.zIndex];\r\n            var index = map.indexOf(jtopo);\r\n            var todo=true;\r\n            if(typeof flag==\'boolean\'){\r\n                todo=flag;\r\n            }else{\r\n                if(index==map.length-1){\r\n                    todo=false;\r\n                }\r\n            }\r\n            if (todo) {\r\n                //提升层次\r\n                map.push(map[index]);\r\n                map.splice(index, 1);\r\n\r\n            } else {\r\n                //降低层次\r\n                map.splice(0, 0, map[index]);\r\n                map.splice(index + 1, 1);\r\n            }\r\n        }\r\n    }\r\n};\r\nvar selectedCatch = {\r\n    jtopo: [],\r\n    qtopo: []\r\n};\r\n/**\r\n *获取被选中的元素\r\n * @returns {Array|*}\r\n */\r\nScene.prototype.getSelected = function () {\r\n    var jtopo = this.jtopo.selectedElements;\r\n    if ($.isArray(jtopo)) {\r\n        if (selectedCatch.jtopo != jtopo) {\r\n            selectedCatch.jtopo = jtopo;\r\n            selectedCatch.qtopo = [];\r\n            jtopo.forEach(function (el) {\r\n                if (el.qtopo && el.qtopo.getUseType() != QTopo.constant.CASUAL) {\r\n                    selectedCatch.qtopo.push(el.qtopo);\r\n                }\r\n            });\r\n        }\r\n        return selectedCatch.qtopo;\r\n    } else {\r\n        return [];\r\n    }\r\n};\r\n/**\r\n * 高亮目标隐藏其他\r\n * @param target 可选参数,数组或对象,高亮其相关对象,无参则全部高亮\r\n * @param flag 可选参数，若为true则只高亮传入的对象,不选则只对传入对象相关的对象高亮\r\n */\r\nScene.prototype.toggleLight = function (target, flag) {\r\n    try {\r\n        var alpha = 1;\r\n        var lighting;\r\n        if (target) {\r\n            alpha = 0.1;\r\n            if (flag) {\r\n                if ($.isArray(target)) {\r\n                    lighting = target;\r\n                } else {\r\n                    lighting = [target];\r\n                }\r\n            } else {\r\n                if ($.isArray(target)) {\r\n                    lighting = getConnectionLightings(target);\r\n                } else {\r\n                    lighting = getConnectionLightings([target]);\r\n                }\r\n            }\r\n        }\r\n        totalSetAlpha(this.children.node.concat(this.children.link), alpha);\r\n        totalSetAlpha(lighting, 1);\r\n    } catch (e) {\r\n        QTopo.util.error("scene toggleLight error", e);\r\n    }\r\n    function getConnectionLightings(arr) {\r\n        var lighting = [];\r\n        $.each(arr, function (i, target) {\r\n            if (target.getType() == QTopo.constant.NODE && target.getUseType() != QTopo.constant.CASUAL) {\r\n                var links = target.links;\r\n                QTopo.util.arrayPush(lighting, target);\r\n                if (links) {\r\n                    if ($.isArray(links.out)) {\r\n                        $.each(links.out, function (l, outlink) {\r\n                            QTopo.util.arrayPush(lighting, outlink);\r\n                            QTopo.util.arrayPush(lighting, outlink.path.end);\r\n                        });\r\n                    }\r\n                    if ($.isArray(links.in)) {\r\n                        $.each(links.in, function (n, inlink) {\r\n                            QTopo.util.arrayPush(lighting, inlink);\r\n                            QTopo.util.arrayPush(lighting, inlink.path.start);\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return lighting;\r\n    }\r\n\r\n    function totalSetAlpha(total, alpha) {\r\n        //全部隐藏\r\n        if ($.isArray(total)) {\r\n            $.each(total, function (i, element) {\r\n                element.set({\r\n                    alpha: alpha\r\n                });\r\n            });\r\n        }\r\n    }\r\n};\r\nScene.prototype.moveToNode = function (node) {\r\n    // 查询到的节点居中显示\r\n    if (this.children.node.indexOf(node) > -1) {\r\n        var location = node.jtopo.getCenterLocation();\r\n        this.resize(1);\r\n        this.jtopo.setCenter(location.x, location.y);\r\n        // 闪烁几下\r\n        nodeFlash(node.jtopo, 5);\r\n    }\r\n    function nodeFlash(node, num) {\r\n        if ($.isNumeric(num)) {\r\n            if (num == 0) {\r\n                node.selected = false;\r\n            } else {\r\n                node.selected = !node.selected;\r\n                setTimeout(function () {\r\n                    nodeFlash(node, num - 1);\r\n                }, 300);\r\n            }\r\n        }\r\n    }\r\n};\r\n//---------自动布局\r\n/**\r\n * 自动布局\r\n * @param config 参数\r\n */\r\nScene.prototype.autoLayout = function (config) {\r\n    if (config && config.type) {\r\n        var needSort = [];\r\n        var jtopos = [];\r\n        this.children.node.forEach(function (v) {\r\n            if (!v.parent) {\r\n                needSort.push(v);\r\n                jtopos.push(v.jtopo);\r\n            }\r\n        });\r\n        switch (config.type) {\r\n            case "round":\r\n                layout_round(this.jtopo, jtopos);\r\n                break;\r\n            case "default":\r\n                layout_default(needSort, parseInt(config.rows), parseInt(config.rowSpace), parseInt(config.columnSpace), this.getOrigin());\r\n                break;\r\n        }\r\n    }\r\n};\r\nfunction layout_round(scene, jtopos) {\r\n    JTopo.layout.circleLayoutNodes(jtopos, {animate: {time: 1000}});\r\n}\r\nfunction layout_default(elements, rows, rowSpace, columnSpace, begin) {\r\n    if ($.isNumeric(rows)) {\r\n        rows = parseInt(rows);\r\n        if (rows < 1) {\r\n            rows = 1;\r\n        }\r\n        $.each(elements.sort(function (a, b) {\r\n            return getDegree(b) - getDegree(a);\r\n        }), function (i, v) {\r\n            //v.setLocation(begin.x + (i % rows) * columnSpace, begin.y);\r\n            move(v, begin.x + (i % rows) * columnSpace, begin.y);\r\n            if ((i + 1) % rows == 0) {\r\n                begin.y += rowSpace;\r\n            }\r\n        });\r\n    }\r\n}\r\n//-------工具函数\r\n//获取节点的度\r\nfunction getDegree(node) {\r\n    var inLinks = node.links.in;\r\n    var outLinks = node.links.out;\r\n    var degree = 0;\r\n    if (inLinks.length == 1) {\r\n        degree += inLinks[0].attr.number;\r\n    } else {\r\n        degree += inLinks.length;\r\n    }\r\n    if (outLinks.length == 1) {\r\n        degree += outLinks[0].attr.number;\r\n    } else {\r\n        degree += outLinks.length;\r\n    }\r\n    return degree;\r\n}\r\n//移动动画\r\nfunction move(node, targetX, targetY) {\r\n    targetX = parseInt(targetX);\r\n    targetY = parseInt(targetY);\r\n    var x = node.attr.position[0];\r\n    var y = node.attr.position[1];\r\n    var partX = parseInt((targetX - x)) / 10;\r\n    var partY = parseInt((targetY - y)) / 10;\r\n    var part = 0;\r\n    var temp = setInterval(function () {\r\n        if (Math.abs(targetX - x) > 1) {\r\n            x += partX;\r\n        }\r\n        if (Math.abs(targetY - y) > 1) {\r\n            y += partY;\r\n        }\r\n        node.setPosition([parseInt(x), parseInt(y)]);\r\n        part++;\r\n        if (Math.abs(targetX - x) <= 1 && Math.abs(targetY - y) <= 1) {\r\n            clearInterval(temp);\r\n        } else if (part >= 10) {\r\n            clearInterval(temp);\r\n        }\r\n    }, 100);\r\n}\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9kZXZlbG9wL2NvcmUvU2NlbmUuanM/OWVjOSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRUFBZ0U7QUFDaEU7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlEO0FBQ2pEO0FBQ0EsNENBQTRDO0FBQzVDLDhCQUE4QjtBQUM5Qiw2Q0FBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiwrQkFBK0I7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCLDBCQUEwQjtBQUMxQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEM7QUFDMUMsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpR0FBaUcsZ0NBQWdDO0FBQ2pJO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxVQUFVLFlBQVk7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0wiLCJmaWxlIjoiOS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLVxyXG52YXIgTm9kZSA9IHtcclxuICAgIEltYWdlOiByZXF1aXJlKFwiLi9lbGVtZW50L25vZGUvSW1hZ2UuanNcIiksXHJcbiAgICBUZXh0OiByZXF1aXJlKFwiLi9lbGVtZW50L25vZGUvVGV4dC5qc1wiKVxyXG59O1xyXG52YXIgTGluayA9IHtcclxuICAgIEN1cnZlOiByZXF1aXJlKFwiLi9lbGVtZW50L2xpbmsvQ3VydmUuanNcIiksXHJcbiAgICBEaXJlY3Q6IHJlcXVpcmUoXCIuL2VsZW1lbnQvbGluay9EaXJlY3QuanNcIiksXHJcbiAgICBGbGV4aW9uYWw6IHJlcXVpcmUoXCIuL2VsZW1lbnQvbGluay9GbGV4aW9uYWwuanNcIiksXHJcbiAgICBGb2xkOiByZXF1aXJlKFwiLi9lbGVtZW50L2xpbmsvRm9sZC5qc1wiKVxyXG59O1xyXG5cclxudmFyIExpbmUgPSB7XHJcbiAgICBEaXJlY3Q6IHJlcXVpcmUoXCIuL2VsZW1lbnQvbGluZS9EaXJlY3QuanNcIilcclxufTtcclxudmFyIENvbnRhaW5lciA9IHtcclxuICAgIEdyb3VwOiByZXF1aXJlKFwiLi9lbGVtZW50L2NvbnRhaW5lci9Hcm91cC5qc1wiKVxyXG59O1xyXG52YXIgZXZlbnRzID0gcmVxdWlyZShcIi4vZXZlbnRzLmpzXCIpO1xyXG5tb2R1bGUuZXhwb3J0cyA9IFNjZW5lO1xyXG4vLy1cclxuLy/nlLvluIPlr7nosaFcclxudmFyIGRlZmF1bHRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBtb2RlOiBRVG9wby5jb25zdGFudC5tb2RlLk5PUk1BTCxcclxuICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IFwiXCJcclxuICAgIH07XHJcbn07XHJcbmZ1bmN0aW9uIFNjZW5lKHN0YWdlLCBjb25maWcpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHNlbGYuanRvcG8gPSBuZXcgSlRvcG8uU2NlbmUoKTtcclxuICAgIHNlbGYuanRvcG8ucXRvcG8gPSBzZWxmO1xyXG4gICAgc2VsZi5jaGlsZHJlbiA9IHtcclxuICAgICAgICBub2RlOiBbXSxcclxuICAgICAgICBsaW5rOiBbXSxcclxuICAgICAgICBjb250YWluZXI6IFtdLFxyXG4gICAgICAgIGxpbmU6IFtdXHJcbiAgICB9O1xyXG4gICAgc2VsZi5hdHRyID0gZGVmYXVsdHMoKTtcclxuICAgIHNlbGYuZXh0cmE9Y29uZmlnLmV4dHJhfHx7fTtcclxuICAgIHN0YWdlLmFkZChzZWxmLmp0b3BvKTtcclxuICAgIGV2ZW50cy5pbml0KHNlbGYpO1xyXG4gICAgLy/lu7bml7bmiafooYxcclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICAgICAgaWYgKGNvbmZpZy5iYWNrZ3JvdW5kSW1hZ2UpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuc2V0QmFja2dyb3VuZEltYWdlKGNvbmZpZy5iYWNrZ3JvdW5kSW1hZ2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb25maWcuYmFja2dyb3VuZENvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnNldEJhY2tncm91bmRDb2xvcihjb25maWcuYmFja2dyb3VuZENvbG9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY29uZmlnLm1vZGUpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuc2V0TW9kZShjb25maWcubW9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG4vLy1cclxuU2NlbmUucHJvdG90eXBlLmdldD1mdW5jdGlvbihrZXkpe1xyXG4gICAgcmV0dXJuIHRoaXMuYXR0cltrZXldO1xyXG59O1xyXG5TY2VuZS5wcm90b3R5cGUudmFsPWZ1bmN0aW9uKGtleSx2YWx1ZSl7XHJcbiAgICBpZihRVG9wby51dGlsLmdldENsYXNzKGtleSk9PSdPYmplY3QnKSB7XHJcbiAgICAgICAgdmFyIHNlbGY9dGhpcztcclxuICAgICAgICAkLmVhY2goa2V5LCBmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgc2VsZi5leHRyYVtuYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgIH0pXHJcbiAgICB9ZWxzZXtcclxuICAgICAgICBpZighdmFsdWUpe1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0O1xyXG4gICAgICAgICAgICBpZih0aGlzLmV4dHJhW2tleV0pe1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0PXRoaXMuZXh0cmFba2V5XTtcclxuICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5hdHRyW2tleV0pe1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0PXRoaXMuYXR0cltrZXldO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHJlc3VsdD10aGlzW2tleV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5leHRyYVtrZXldPXZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuU2NlbmUucHJvdG90eXBlLnNldERlZmF1bHQgPSBmdW5jdGlvbiAodHlwZSwgY29uZmlnKSB7XHJcbiAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIGNvbnN0YW50ID0gUVRvcG8uY29uc3RhbnQ7XHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubm9kZS5JTUFHRTpcclxuICAgICAgICAgICAgICAgIE5vZGUuSW1hZ2Uuc2V0RGVmYXVsdChjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubm9kZS5URVhUOlxyXG4gICAgICAgICAgICAgICAgTm9kZS5UZXh0LnNldERlZmF1bHQoY29uZmlnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIGNvbnN0YW50LmxpbmsuRElSRUNUOlxyXG4gICAgICAgICAgICAgICAgTGluay5EaXJlY3Quc2V0RGVmYXVsdChjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubGluay5DVVJWRTpcclxuICAgICAgICAgICAgICAgIExpbmsuQ3VydmUuc2V0RGVmYXVsdChjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubGluay5GTEVYSU9OQUw6XHJcbiAgICAgICAgICAgICAgICBMaW5rLkZsZXhpb25hbC5zZXREZWZhdWx0KGNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBjb25zdGFudC5saW5rLkZPTEQ6XHJcbiAgICAgICAgICAgICAgICBMaW5rLkZvbGQuc2V0RGVmYXVsdChjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubGluZS5ESVJFQ1Q6XHJcbiAgICAgICAgICAgICAgICBMaW5lLkRpcmVjdC5zZXREZWZhdWx0KGNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBjb25zdGFudC5jb250YWluZXIuR1JPVVA6XHJcbiAgICAgICAgICAgICAgICBDb250YWluZXIuR3JvdXAuc2V0RGVmYXVsdChjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5TY2VuZS5wcm90b3R5cGUuZ2V0RGVmYXVsdCA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICBpZiAodHlwZSkge1xyXG4gICAgICAgIHZhciByZXN1bHQ7XHJcbiAgICAgICAgdmFyIGNvbnN0YW50ID0gUVRvcG8uY29uc3RhbnQ7XHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubm9kZS5JTUFHRTpcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IE5vZGUuSW1hZ2UuZ2V0RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubm9kZS5URVhUOlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gTm9kZS5UZXh0LmdldERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIGNvbnN0YW50LmxpbmsuRElSRUNUOlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gTGluay5EaXJlY3QuZ2V0RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubGluay5DVVJWRTpcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IExpbmsuQ3VydmUuZ2V0RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubGluay5GTEVYSU9OQUw6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBMaW5rLkZsZXhpb25hbC5nZXREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBjb25zdGFudC5saW5rLkZPTEQ6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBMaW5rLkZvbGQuZ2V0RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY29uc3RhbnQubGluZS5ESVJFQ1Q6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBMaW5lLkRpcmVjdC5nZXREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBjb25zdGFudC5jb250YWluZXIuR1JPVVA6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBDb250YWluZXIuR3JvdXAuZ2V0RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbn07XHJcblNjZW5lLnByb3RvdHlwZS5zZXRCYWNrZ3JvdW5kSW1hZ2UgPSBmdW5jdGlvbiAoaW1hZ2UpIHtcclxuICAgIHRoaXMuanRvcG8uYmFja2dyb3VuZCA9IGltYWdlO1xyXG4gICAgdGhpcy5hdHRyLmJhY2tncm91bmQgPSBpbWFnZTtcclxufTtcclxuU2NlbmUucHJvdG90eXBlLnNldEJhY2tncm91bmRDb2xvciA9IGZ1bmN0aW9uIChjb2xvcikge1xyXG4gICAgdGhpcy5qdG9wby5iYWNrZ3JvdW5kQ29sb3IgPSBRVG9wby51dGlsLnRyYW5zSGV4KGNvbG9yKTtcclxuICAgIHRoaXMuanRvcG8uYWxwaGEgPSAxO1xyXG4gICAgdGhpcy5hdHRyLmJhY2tncm91bmQgPSBRVG9wby51dGlsLnRyYW5zSGV4KGNvbG9yKTtcclxufTtcclxuU2NlbmUucHJvdG90eXBlLnNldE1vZGUgPSBmdW5jdGlvbiAobW9kZSkge1xyXG4gICAgaWYgKFtcIm5vcm1hbFwiLCBcImVkaXRcIiwgXCJkcmFnXCIsIFwic2VsZWN0XCJdLmluZGV4T2YobW9kZSkgPiAtMSkge1xyXG4gICAgICAgIHRoaXMuYXR0ci5tb2RlID0gbW9kZTtcclxuICAgICAgICB0aGlzLmp0b3BvLm1vZGUgPSBtb2RlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwic2V0IHdyb25nIG1vZGUgOlwiLCBtb2RlKTtcclxuICAgIH1cclxufTtcclxuU2NlbmUucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgUVRvcG8udXRpbC5pbmZvKFwic2NlbmUgY2xlYXJcIik7XHJcbiAgICB0aGlzLmNoaWxkcmVuID0ge1xyXG4gICAgICAgIG5vZGU6IFtdLFxyXG4gICAgICAgIGxpbms6IFtdLFxyXG4gICAgICAgIGNvbnRhaW5lcjogW10sXHJcbiAgICAgICAgbGluZTogW11cclxuICAgIH07XHJcbiAgICB0aGlzLmp0b3BvLmNsZWFyKCk7XHJcbn07XHJcblNjZW5lLnByb3RvdHlwZS5nZXRUeXBlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIFFUb3BvLmNvbnN0YW50LlNDRU5FO1xyXG59O1xyXG5TY2VuZS5wcm90b3R5cGUuZ2V0VXNlVHlwZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBRVG9wby5jb25zdGFudC5TQ0VORTtcclxufTtcclxuU2NlbmUucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKG5hbWUsIGZuKSB7XHJcbiAgICB0aGlzLmp0b3BvLmFkZEV2ZW50TGlzdGVuZXIobmFtZSxmbik7XHJcbn07XHJcblNjZW5lLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbiAobmFtZSwgZm4pIHtcclxuICAgIHRoaXMuanRvcG8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihuYW1lLGZuKTtcclxufTtcclxuU2NlbmUucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbiAoc2NhbiwgdHlwZSkge1xyXG4gICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgIHZhciBjb25kaXRpb24gPSB0eXBlb2Ygc2NhbiA9PSBcInN0cmluZ1wiID8gc2Nhbi5zcGxpdChcIixcIikgOiBbXTtcclxuICAgIGlmIChjb25kaXRpb24ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICQuZWFjaChjb25kaXRpb24sIGZ1bmN0aW9uIChpLCB0ZXJtKSB7XHJcbiAgICAgICAgICAgIHRlcm0gPSB0ZXJtLnNwbGl0KFwiPVwiKTtcclxuICAgICAgICAgICAgLy/liLblrprkuobnsbvlnovvvIznvKnlsI/mn6Xmib7ojIPlm7TvvIzmnKrmjIflrprliJnlhajpg6jpgY3ljoZcclxuICAgICAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJub2RlXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5BcnIoY2hpbGRyZW4ubm9kZSwgdGVybVswXSwgdGVybVsxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJsaW5rXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5BcnIoY2hpbGRyZW4ubGluaywgdGVybVswXSwgdGVybVsxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJjb250YWluZXJcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbkFycihjaGlsZHJlbi5jb250YWluZXIsIHRlcm1bMF0sIHRlcm1bMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwibGluZVwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FuQXJyKGNoaWxkcmVuLmxpbmUsIHRlcm1bMF0sIHRlcm1bMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICQuZWFjaChjaGlsZHJlbiwgZnVuY3Rpb24gKGosIGFycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjYW5BcnIoYXJyLCB0ZXJtWzBdLCB0ZXJtWzFdKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgLy/miavmj4/mlbDnu4TkuK3lr7nosaHlr7nlupTnmoTlsZ7mgKfmmK/lkKbnm7jnrYlcclxuICAgIGZ1bmN0aW9uIHNjYW5BcnIoYXJyLCBrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgJC5lYWNoKGFyciwgZnVuY3Rpb24gKGksIGl0ZW0pIHtcclxuICAgICAgICAgICAgLy/lj6rmiavmj4/lr7nosaHnmoRhdHRy5ZKMZXh0cmHkuK3nmoTlsZ7mgKdcclxuICAgICAgICAgICAgaWYgKGVxdWFsKGl0ZW0uZXh0cmEsIGtleSwgdmFsdWUpIHx8IGVxdWFsKGl0ZW0uYXR0ciwga2V5LCB2YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgIC8v5o6S6Zmk6YeN5aSN55qEXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmluZGV4T2YoaXRlbSkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGVxdWFsKG9iamVjdCwga2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiBvYmplY3QgJiYgb2JqZWN0W2tleV0gJiYgb2JqZWN0W2tleV0gPT0gdmFsdWU7XHJcbiAgICB9XHJcbn07XHJcblNjZW5lLnByb3RvdHlwZS5nZXRPcmlnaW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHg6IDAgLSB0aGlzLmp0b3BvLnRyYW5zbGF0ZVgsXHJcbiAgICAgICAgeTogMCAtIHRoaXMuanRvcG8udHJhbnNsYXRlWVxyXG4gICAgfVxyXG59O1xyXG4vLy1cclxuZnVuY3Rpb24gYWRkSlRvcG8oZWxlbWVudCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICB0aGlzLmp0b3BvLmFkZChlbGVtZW50Lmp0b3BvKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiSW4gU2NlbmUsIGp0b3BvIGFkZCBlcnJvciA6IFwiLCBlKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZW1vdmVKVG9wbyhlbGVtZW50KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHRoaXMuanRvcG8ucmVtb3ZlKGVsZW1lbnQuanRvcG8pO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIFFUb3BvLnV0aWwuZXJyb3IoXCJJbiBTY2VuZSwganRvcG8gcmVtb3ZlIGVycm9yIDogXCIsIGUpO1xyXG4gICAgfVxyXG59XHJcblNjZW5lLnByb3RvdHlwZS5jcmVhdGVOb2RlID0gZnVuY3Rpb24gKGNvbmZpZykge1xyXG4gICAgdmFyIG5ld05vZGU7XHJcbiAgICB2YXIgY29uc3RhbnQgPSBRVG9wby5jb25zdGFudC5ub2RlO1xyXG4gICAgY29uZmlnID0gY29uZmlnIHx8IHt9O1xyXG4gICAgc3dpdGNoIChjb25maWcudHlwZSkge1xyXG4gICAgICAgIGNhc2UgY29uc3RhbnQuVEVYVDpcclxuICAgICAgICAgICAgbmV3Tm9kZSA9IG5ldyBOb2RlLlRleHQuY29uc3RydWN0b3IoY29uZmlnKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgbmV3Tm9kZSA9IG5ldyBOb2RlLkltYWdlLmNvbnN0cnVjdG9yKGNvbmZpZyk7XHJcbiAgICB9XHJcbiAgICBpZiAobmV3Tm9kZSAmJiBuZXdOb2RlLmp0b3BvKSB7XHJcbiAgICAgICAgYWRkSlRvcG8uY2FsbCh0aGlzLCBuZXdOb2RlKTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLm5vZGUucHVzaChuZXdOb2RlKTtcclxuICAgICAgICByZXR1cm4gbmV3Tm9kZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgUVRvcG8udXRpbC5lcnJvcihcImNyZWF0ZSBOb2RlIGVycm9yXCIsIGNvbmZpZyk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICog5qC55o2u6YWN572u5Zyo5Lik5Liq5YWD57Sg5LmL6Ze05Yib5bu65paw55qE6ZO+5o6lXHJcbiAqIEBwYXJhbSBjb25maWdcclxuICogQHJldHVybnMgeyp9XHJcbiAqL1xyXG5TY2VuZS5wcm90b3R5cGUuY3JlYXRlTGluayA9IGZ1bmN0aW9uIChjb25maWcpIHtcclxuICAgIHZhciBuZXdMaW5rO1xyXG4gICAgdmFyIGNvbnN0YW50ID0gUVRvcG8uY29uc3RhbnQubGluaztcclxuICAgIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcclxuICAgIHN3aXRjaCAoY29uZmlnLnR5cGUpIHtcclxuICAgICAgICBjYXNlIGNvbnN0YW50LkNVUlZFOlxyXG4gICAgICAgICAgICBuZXdMaW5rID0gbmV3IExpbmsuQ3VydmUuY29uc3RydWN0b3IoY29uZmlnKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBjb25zdGFudC5GTEVYSU9OQUw6XHJcbiAgICAgICAgICAgIG5ld0xpbmsgPSBuZXcgTGluay5GbGV4aW9uYWwuY29uc3RydWN0b3IoY29uZmlnKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBjb25zdGFudC5GT0xEOlxyXG4gICAgICAgICAgICBuZXdMaW5rID0gbmV3IExpbmsuRm9sZC5jb25zdHJ1Y3Rvcihjb25maWcpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBuZXdMaW5rID0gbmV3IExpbmsuRGlyZWN0LmNvbnN0cnVjdG9yKGNvbmZpZyk7XHJcbiAgICB9XHJcbiAgICBpZiAobmV3TGluayAmJiBuZXdMaW5rLmp0b3BvKSB7XHJcbiAgICAgICAgYWRkSlRvcG8uY2FsbCh0aGlzLCBuZXdMaW5rKTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLmxpbmsucHVzaChuZXdMaW5rKTtcclxuICAgICAgICByZXR1cm4gbmV3TGluaztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgUVRvcG8udXRpbC5lcnJvcihcImNyZWF0ZSBMaW5rIGVycm9yXCIsIGNvbmZpZyk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59O1xyXG4vLy0tXHJcbi8qKlxyXG4gKiDmoLnmja7phY3nva7lnKjkuKTkuKrlhYPntKDkuYvpl7TliJvlu7rpk77mjqUs6Iul5Lik5YWD57Sg5bey5pyJ6ZO+5o6l5YiZ5Y6f6ZO+5o6l6K6h5pWw5LiK5YqgMSzmj5Dkvpvnur/ot6/lsZXlvIBcclxuICogQHBhcmFtIGNvbmZpZ1xyXG4gKiBAcGFyYW0gZm4g5Y+v6YCJ5Y+C5pWw77yM6Iul5peg5YiZ6Ieq5Yqo5Yib5bu66ZO+5o6lLOiLpeacieWImeaJp+ihjGZu55qE5Yqo5L2cXHJcbiAqL1xyXG5TY2VuZS5wcm90b3R5cGUuYWRkTGluayA9IGZ1bmN0aW9uIChjb25maWcsZm4pIHtcclxuICAgIGlmIChjb25maWcgJiYgY29uZmlnLnN0YXJ0ICYmIGNvbmZpZy5lbmQpIHtcclxuICAgICAgICB2YXIgbGlua3MgPSB0aGlzLmxpbmtzQmV0d2Vlbihjb25maWcuc3RhcnQsIGNvbmZpZy5lbmQpOy8v5oyJbnVtYmVy5bGe5oCn5LuO5aSn5Yiw5bCP5o6S5YiXXHJcbiAgICAgICAgaWYgKGxpbmtzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgIGlmKCQuaXNGdW5jdGlvbihmbikpe1xyXG4gICAgICAgICAgICAgICAgZm4oKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVMaW5rKGNvbmZpZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvL+S4pOeCueS5i+mXtOi/nue6v+S4ujHliJnorqTkuLrmmK/lt7LmnInpk77mjqXvvIzotoXov4cx5YiZ6K6k5Li65piv5Y+v5Lul5bGV5byA5LiU5bey57uP5bGV5byA55qE55u057q/XHJcbiAgICAgICAgICAgIHZhciBudW1iZXIgPSAxO1xyXG4gICAgICAgICAgICBpZiAoJC5pc051bWVyaWMoY29uZmlnLm51bWJlcikpIHtcclxuICAgICAgICAgICAgICAgIG51bWJlciA9IHBhcnNlSW50KGNvbmZpZy5udW1iZXIpO1xyXG4gICAgICAgICAgICAgICAgaWYobnVtYmVyPDEpe1xyXG4gICAgICAgICAgICAgICAgICAgIG51bWJlcj0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGxpbmtzLmxlbmd0aD09MSl7XHJcbiAgICAgICAgICAgICAgICBsaW5rc1swXS5zZXQoe1xyXG4gICAgICAgICAgICAgICAgICAgIG51bWJlcjogbGlua3NbMF0uYXR0ci5udW1iZXIgKyBudW1iZXJcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpbmtzWzBdO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihsaW5rcy5sZW5ndGg+MSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50PWxpbmtzWzBdLnBhcmVudDtcclxuICAgICAgICAgICAgICAgIGlmKHBhcmVudCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50LmF0dHIubnVtYmVyKz1udW1iZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50LmFkZENoaWxkKG51bWJlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5TY2VuZS5wcm90b3R5cGUubGlua3NCZXR3ZWVuID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcclxuICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgIHZhciBsaW5rcyA9IHN0YXJ0LmxpbmtzO1xyXG4gICAgLy/mo4DmtYvkuKTlhYPntKDpl7TnmoTov57nur/mmK/lkKblt7LmnIlcclxuICAgIGlmICgkLmlzQXJyYXkobGlua3Mub3V0KSkge1xyXG4gICAgICAgICQuZWFjaChsaW5rcy5vdXQsIGZ1bmN0aW9uIChpLCBsaW5rT3V0KSB7XHJcbiAgICAgICAgICAgIGlmIChsaW5rT3V0LnBhdGguZW5kID09IGVuZCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobGlua091dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmICgkLmlzQXJyYXkobGlua3MuaW4pKSB7XHJcbiAgICAgICAgJC5lYWNoKGxpbmtzLmluLCBmdW5jdGlvbiAoaiwgbGlua0luKSB7XHJcbiAgICAgICAgICAgIGlmIChsaW5rSW4ucGF0aC5zdGFydCA9PSBlbmQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGxpbmtJbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQuc29ydChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgIHJldHVybiBiLmF0dHIubnVtYmVyIC0gYS5hdHRyLm51bWJlcjtcclxuICAgIH0pO1xyXG59O1xyXG4vLy0tXHJcblNjZW5lLnByb3RvdHlwZS5jcmVhdGVMaW5lID0gZnVuY3Rpb24gKGNvbmZpZykge1xyXG4gICAgdmFyIG5ld0xpbmU7XHJcbiAgICB2YXIgY29uc3RhbnQgPSBRVG9wby5jb25zdGFudC5saW5lO1xyXG4gICAgY29uZmlnID0gY29uZmlnIHx8IHt9O1xyXG4gICAgc3dpdGNoIChjb25maWcudHlwZSkge1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIG5ld0xpbmUgPSBuZXcgTGluZS5EaXJlY3QuY29uc3RydWN0b3IoY29uZmlnKTtcclxuICAgIH1cclxuICAgIGlmIChuZXdMaW5lICYmIG5ld0xpbmUuanRvcG8pIHtcclxuICAgICAgICBhZGRKVG9wby5jYWxsKHRoaXMsIG5ld0xpbmUpO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4ubGluZS5wdXNoKG5ld0xpbmUpO1xyXG4gICAgICAgIHJldHVybiBuZXdMaW5lO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiY3JlYXRlIExpbmsgZXJyb3JcIiwgY29uZmlnKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn07XHJcbi8vLS1cclxuU2NlbmUucHJvdG90eXBlLmNyZWF0ZUNvbnRhaW5lciA9IGZ1bmN0aW9uIChjb25maWcpIHtcclxuICAgIHZhciBuZXdDb250YWluZXI7XHJcbiAgICB2YXIgY29uc3RhbnQgPSBRVG9wby5jb25zdGFudC5jb250YWluZXI7XHJcbiAgICBjb25maWcgPSBjb25maWcgfHwge307XHJcbiAgICBzd2l0Y2ggKGNvbmZpZy50eXBlKSB7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgbmV3Q29udGFpbmVyID0gbmV3IENvbnRhaW5lci5Hcm91cC5jb25zdHJ1Y3Rvcihjb25maWcpO1xyXG4gICAgfVxyXG4gICAgaWYgKG5ld0NvbnRhaW5lciAmJiBuZXdDb250YWluZXIuanRvcG8pIHtcclxuICAgICAgICAvL+WIhue7hOWPquWKoOWFpeWFtuacrOi6q++8jOWIh+aNouiKgueCueS4jeS9nOaVsFxyXG4gICAgICAgIHZhciBub2RlQ29uZmlnID0ge307XHJcbiAgICAgICAgaWYgKGNvbmZpZy50b2dnbGUpIHtcclxuICAgICAgICAgICAgbm9kZUNvbmZpZyA9IGNvbmZpZy50b2dnbGVcclxuICAgICAgICB9XHJcbiAgICAgICAgLy/lj6/pgInnpoHnlKjliIbnu4TliIfmjaJcclxuICAgICAgICBpZiAoIShjb25maWcudG9nZ2xlJiZ0eXBlb2YgY29uZmlnLnRvZ2dsZS5jbG9zZSA9PSBcImJvb2xlYW5cIiAmJiBjb25maWcudG9nZ2xlLmNsb3NlKSkge1xyXG4gICAgICAgICAgICBhZGRUb2dnbGUodGhpcywgbmV3Q29udGFpbmVyLCBub2RlQ29uZmlnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5jb250YWluZXIucHVzaChuZXdDb250YWluZXIpO1xyXG4gICAgICAgIGFkZEpUb3BvLmNhbGwodGhpcywgbmV3Q29udGFpbmVyKTtcclxuICAgICAgICByZXR1cm4gbmV3Q29udGFpbmVyO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiY3JlYXRlIENvbnRhaW5lciBlcnJvclwiLCBjb25maWcpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufTtcclxuZnVuY3Rpb24gYWRkVG9nZ2xlKHNjZW5lLCBjb250YWluZXIsIGNvbmZpZ1RvZ2dsZSkge1xyXG4gICAgY29uZmlnVG9nZ2xlLnVzZVR5cGUgPSBRVG9wby5jb25zdGFudC5DQVNVQUw7Ly/moIforrDnlKjpgJRcclxuICAgIGNvbnRhaW5lci50b2dnbGVUbyA9IG5ldyBOb2RlLkltYWdlLmNvbnN0cnVjdG9yKGNvbmZpZ1RvZ2dsZSk7XHJcbiAgICBjb250YWluZXIudG9nZ2xlVG8udG9nZ2xlVG8gPSBjb250YWluZXI7Ly/kupLnm7jntKLlvJVcclxuICAgIGNvbnRhaW5lci50b2dnbGVUby5oaWRlKCk7Ly/liJ3lp4vpmpDol49cclxuICAgIGFkZEpUb3BvLmNhbGwoc2NlbmUsIGNvbnRhaW5lci50b2dnbGVUbyk7Ly/liqDlhaXnlLvluINcclxufVxyXG4vLy0tXHJcbi8vLVxyXG5TY2VuZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgIHZhciBzZWxmPXRoaXM7XHJcbiAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgIGlmICgkLmlzQXJyYXkoZWxlbWVudCkpIHtcclxuICAgICAgICAgICAgJC5lYWNoKGVsZW1lbnQsIGZ1bmN0aW9uIChpLCBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVPbmNlKGl0ZW0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZW1vdmVPbmNlKGVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmVPbmNlKG9uZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKG9uZUVsZW1lbnQuanRvcG8pIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAob25lRWxlbWVudC5nZXRUeXBlKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFFUb3BvLmNvbnN0YW50Lk5PREU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChRVG9wby51dGlsLmFycmF5RGVsZXRlKHNlbGYuY2hpbGRyZW4ubm9kZSwgb25lRWxlbWVudCkgfHwgb25lRWxlbWVudC5nZXRVc2VUeXBlKCkgPT0gUVRvcG8uY29uc3RhbnQuQ0FTVUFMKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVOb2RlLmNhbGwoc2VsZiwgb25lRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBRVG9wby5jb25zdGFudC5MSU5LOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoUVRvcG8udXRpbC5hcnJheURlbGV0ZShzZWxmLmNoaWxkcmVuLmxpbmssIG9uZUVsZW1lbnQpIHx8IG9uZUVsZW1lbnQuZ2V0VXNlVHlwZSgpID09IFFUb3BvLmNvbnN0YW50LkNBU1VBTCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlTGluay5jYWxsKHNlbGYsIG9uZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgUVRvcG8uY29uc3RhbnQuTElORTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFFUb3BvLnV0aWwuYXJyYXlEZWxldGUoc2VsZi5jaGlsZHJlbi5saW5lLCBvbmVFbGVtZW50KSB8fCBvbmVFbGVtZW50LmdldFVzZVR5cGUoKSA9PSBRVG9wby5jb25zdGFudC5DQVNVQUwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUxpbmUuY2FsbChzZWxmLCBvbmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFFUb3BvLmNvbnN0YW50LkNPTlRBSU5FUjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFFUb3BvLnV0aWwuYXJyYXlEZWxldGUoc2VsZi5jaGlsZHJlbi5jb250YWluZXIsIG9uZUVsZW1lbnQpIHx8IG9uZUVsZW1lbnQuZ2V0VXNlVHlwZSgpID09IFFUb3BvLmNvbnN0YW50LkNBU1VBTCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ29udGFpbmVyLmNhbGwoc2VsZiwgb25lRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcbmZ1bmN0aW9uIHVwRGF0YUxpbmtzKGVsZW1lbnQpIHtcclxuICAgIHZhciBsaW5rcyA9IGVsZW1lbnQubGlua3M7XHJcbiAgICBpZiAobGlua3MpIHtcclxuICAgICAgICAvL+abtOaWsOWFtuS4iui/nue6v+eahOWPpuS4gOaWueeahGxpbmtz5bGe5oCnXHJcbiAgICAgICAgd2hpbGUgKGxpbmtzLmluLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmUobGlua3MuaW4ucG9wKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB3aGlsZSAobGlua3Mub3V0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmUobGlua3Mub3V0LnBvcCgpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLy/nur/kuIrliKDpmaTml7blgJks6KaB5pu05pawbm9kZeWSjGNvbnRhaW5lcuS4reeahGxpbmtz5bGe5oCnXHJcbmZ1bmN0aW9uIHJlbW92ZUxpbmsobGluaykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBRVG9wby51dGlsLmFycmF5RGVsZXRlKGxpbmsucGF0aC5zdGFydC5saW5rcy5vdXQsIGxpbmspO1xyXG4gICAgICAgIFFUb3BvLnV0aWwuYXJyYXlEZWxldGUobGluay5wYXRoLmVuZC5saW5rcy5pbiwgbGluayk7XHJcbiAgICAgICAgcmVtb3ZlSlRvcG8uY2FsbCh0aGlzLCBsaW5rKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiU2NlbmUgcmVtb3ZlTGluayBlcnJvclwiLCBlKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZW1vdmVMaW5lKGxpbmUpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmVtb3ZlSlRvcG8uY2FsbCh0aGlzLCBsaW5lKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiU2NlbmUgcmVtb3ZlTGluZSBlcnJvclwiLCBlKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZW1vdmVOb2RlKG5vZGUpIHtcclxuICAgIC8v5Yi35paw5LiA5LiL546w5pyJ55qE57q/XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8v5pu05paw5YW25LiK57q/5Y+m5LiA5aS055qEbGlua3PlsZ7mgKdcclxuICAgICAgICB1cERhdGFMaW5rcy5jYWxsKHRoaXMsIG5vZGUpO1xyXG4gICAgICAgIC8v6KaB5pu05paw5YW254i255qEY2hpbGRyZW7lsZ7mgKcs54i25Yig6Zmk5a2QXHJcbiAgICAgICAgaWYgKG5vZGUucGFyZW50ICYmICQuaXNBcnJheShub2RlLnBhcmVudC5jaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgbm9kZS5wYXJlbnQucmVtb3ZlKG5vZGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL+WIoOmZpOWIhue7hOWIh+aNoueahOiKgueCueaXtuWQjOaXtuWIoOmZpOWFtuWIh+aNoueahOWIhue7hFxyXG4gICAgICAgIGlmIChub2RlLnRvZ2dsZVRvKSB7XHJcbiAgICAgICAgICAgIC8v5YiG57uE6Iul6ZqQ6JeP5LqGLOW6lOivpeWxleekulxyXG4gICAgICAgICAgICBub2RlLnRvZ2dsZVRvLnRvZ2dsZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZShub2RlLnRvZ2dsZVRvKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVtb3ZlSlRvcG8uY2FsbCh0aGlzLCBub2RlKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBRVG9wby51dGlsLmVycm9yKFwiU2NlbmUgcmVtb3ZlTm9kZSBlcnJvclwiLCBlKTtcclxuICAgIH1cclxufVxyXG4vL+WuueWZqOWIoOmZpOaXtizopoHmm7TkuI7lhbbnm7jov57nmoTnur/nmoTlj6bkuIDnq6/nmoRsaW5rc+WxnuaApyzopoHmm7TmlrDlhbblrZDnsbvnmoRwYXJlbnTlsZ7mgKdcclxuZnVuY3Rpb24gcmVtb3ZlQ29udGFpbmVyKGNvbnRhaW5lcikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvL+WIhue7hOiLpemakOiXj+S6hizlupTor6XlsZXnpLpcclxuICAgICAgICBjb250YWluZXIudG9nZ2xlKHRydWUpO1xyXG4gICAgICAgIC8v5pu05paw5YW25LiK57q/5Y+m5LiA5aS055qEbGlua3PlsZ7mgKdcclxuICAgICAgICB1cERhdGFMaW5rcy5jYWxsKHRoaXMsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgLy/mm7TmlrDlrZDlhYPntKDnmoRQYXJlbnTlsZ7mgKdcclxuICAgICAgICBpZiAoJC5pc0FycmF5KGNvbnRhaW5lci5jaGlsZHJlbikgJiYgY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jaGlsZHJlbltpXS5wYXJlbnQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8v5Yig6Zmk5YiG57uE5ZCM5pe25Yig6Zmk5YW25YiH5o2i6IqC54K5XHJcbiAgICAgICAgaWYgKGNvbnRhaW5lci50b2dnbGVUbykge1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZShjb250YWluZXIudG9nZ2xlVG8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW1vdmVKVG9wby5jYWxsKHRoaXMsIGNvbnRhaW5lcik7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgUVRvcG8udXRpbC5lcnJvcihcIlNjZW5lIHJlbW92ZUNvbnRhaW5lciBlcnJvclwiLCBlKTtcclxuICAgIH1cclxufVxyXG4vLy1cclxuU2NlbmUucHJvdG90eXBlLnRvSnNvbj1mdW5jdGlvbigpe1xyXG4gICAgdmFyIGpzb249JC5leHRlbmQoe30sdGhpcy5hdHRyKTtcclxuICAgIGpzb24uZXh0cmE9JC5leHRlbmQoe30sdGhpcy5leHRyYSk7XHJcbiAgICByZXR1cm4ganNvbjtcclxufTtcclxuXHJcblNjZW5lLnByb3RvdHlwZS5pc0NoaWxkcmVuPWZ1bmN0aW9uKGVsZW1lbnQpe1xyXG4gICAgdmFyIHJlc3VsdD1mYWxzZTtcclxuICAgIGlmKGVsZW1lbnQuanRvcG8pe1xyXG4gICAgICAgICQuZWFjaCh0aGlzLmNoaWxkcmVuLGZ1bmN0aW9uKG5hbWUsYXJyKXtcclxuICAgICAgICAgICAgaWYoYXJyLmluZGV4T2YoZWxlbWVudCk+LTEpe1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0PXRydWU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn07XHJcblNjZW5lLnByb3RvdHlwZS5nb0NlbnRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICh0aGlzLmp0b3BvLmNoaWxkcyAmJiB0aGlzLmp0b3BvLmNoaWxkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5zdGFnZS5jZW50ZXJBbmRab29tKCk7XHJcbiAgICB9XHJcbn07XHJcblNjZW5lLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xyXG4gICAgaWYgKCQuaXNOdW1lcmljKHNpemUpKSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5zY2FsZVggPSBzaXplO1xyXG4gICAgICAgIHRoaXMuanRvcG8uc2NhbGVZID0gc2l6ZTtcclxuICAgIH1cclxufTtcclxuU2NlbmUucHJvdG90eXBlLnRvZ2dsZVpvb20gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoIXRoaXMuanRvcG8uc3RhZ2Uud2hlZWxab29tKSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5zdGFnZS53aGVlbFpvb20gPSAwLjg1OyAvLyDorr7nva7pvKDmoIfnvKnmlL7mr5TkvotcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5qdG9wby5zdGFnZS53aGVlbFpvb20gPSBudWxsO1xyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICog5YiH5o2i6bmw55y85pi+56S6XHJcbiAqL1xyXG5TY2VuZS5wcm90b3R5cGUudG9nZ2xlRWFnbGVFeWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmp0b3BvLnN0YWdlLmVhZ2xlRXllLnZpc2libGUgPSAhdGhpcy5qdG9wby5zdGFnZS5lYWdsZUV5ZS52aXNpYmxlO1xyXG59O1xyXG4vKipcclxuICog6I635Y+W5b2T5YmN55S75biD55qEcG5n5qC85byP5Zu+54mH5Zyo5paw55qE56qX5Y+j5omT5byAXHJcbiAqL1xyXG5TY2VuZS5wcm90b3R5cGUuZ2V0UGljdHVyZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIC8vc3RhZ2Uuc2F2ZUltYWdlSW5mbygpO1xyXG4gICAgLy/lnKjmlrDpobXpnaLmiZPlvIDlm77niYdcclxuICAgIHZhciBpbWFnZSA9IHRoaXMuanRvcG8uc3RhZ2UuY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcclxuICAgIHZhciB3ID0gd2luZG93Lm9wZW4oJ2Fib3V0OmJsYW5rJywgJ2ltYWdlIGZyb20gY2FudmFzJyk7XHJcbiAgICB3LmRvY3VtZW50LndyaXRlKFwiPGltZyBzcmM9J1wiICsgaW1hZ2UgKyBcIicgYWx0PSdmcm9tIGNhbnZhcycvPlwiKTtcclxuICAgIC8v5LiL6L295Zu+54mHXHJcbiAgICAvLyBoZXJlIGlzIHRoZSBtb3N0IGltcG9ydGFudCBwYXJ0IGJlY2F1c2UgaWYgeW91IGRvbnQgcmVwbGFjZSB5b3Ugd2lsbCBnZXQgYSBET00gMTggZXhjZXB0aW9uLlxyXG4gICAgLy8gdmFyIGltYWdlID0gIHN0YWdlLmNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIikucmVwbGFjZShcImltYWdlL3BuZ1wiLCBcImltYWdlL29jdGV0LXN0cmVhbTtDb250ZW50LURpc3Bvc2l0aW9uOiBhdHRhY2htZW50O2ZpbGVuYW1lPWZvb2Jhci5wbmdcIik7XHJcbiAgICAvL3ZhciBpbWFnZSA9IHN0YWdlLmNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIikucmVwbGFjZShcImltYWdlL3BuZ1wiLCBcImltYWdlL29jdGV0LXN0cmVhbVwiKTtcclxuICAgIC8vd2luZG93LmxvY2F0aW9uLmhyZWY9aW1hZ2U7IC8vIGl0IHdpbGwgc2F2ZSBsb2NhbGx5XHJcbn07XHJcbi8qKlxyXG4gKiDliIfmjaLlhYPntKDnmoTlsYLmrKFcclxuICogQHBhcmFtIGVsZW1lbnQg5b6F5o6n5Yi25YWD57SgXHJcbiAqIEBwYXJhbSBmbGFnIOWPr+mAieOAgnRydWXkuLrpmY3kvY5mYWxzZeS4uuaPkOWNh++8jOacquacieWAvOWImem7mOiupOaPkOWNh++8jOiLpeS7peaPkOWNh+WIsOacgOmrmOWImemZjeiHs+acgOS9jlxyXG4gKi9cclxuU2NlbmUucHJvdG90eXBlLnRvZ2dsZVpJbmRleCA9IGZ1bmN0aW9uIChlbGVtZW50LCBmbGFnKSB7XHJcbiAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgIHZhciBqdG9wbyA9IGVsZW1lbnQuanRvcG87XHJcbiAgICAgICAgdmFyIHNjZW5lID0gdGhpcy5qdG9wbztcclxuICAgICAgICBpZiAoanRvcG8gJiYgc2NlbmUpIHtcclxuICAgICAgICAgICAgdmFyIG1hcCA9IHNjZW5lLnpJbmRleE1hcFtqdG9wby56SW5kZXhdO1xyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSBtYXAuaW5kZXhPZihqdG9wbyk7XHJcbiAgICAgICAgICAgIHZhciB0b2RvPXRydWU7XHJcbiAgICAgICAgICAgIGlmKHR5cGVvZiBmbGFnPT0nYm9vbGVhbicpe1xyXG4gICAgICAgICAgICAgICAgdG9kbz1mbGFnO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGlmKGluZGV4PT1tYXAubGVuZ3RoLTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRvZG89ZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRvZG8pIHtcclxuICAgICAgICAgICAgICAgIC8v5o+Q5Y2H5bGC5qyhXHJcbiAgICAgICAgICAgICAgICBtYXAucHVzaChtYXBbaW5kZXhdKTtcclxuICAgICAgICAgICAgICAgIG1hcC5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8v6ZmN5L2O5bGC5qyhXHJcbiAgICAgICAgICAgICAgICBtYXAuc3BsaWNlKDAsIDAsIG1hcFtpbmRleF0pO1xyXG4gICAgICAgICAgICAgICAgbWFwLnNwbGljZShpbmRleCArIDEsIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG52YXIgc2VsZWN0ZWRDYXRjaCA9IHtcclxuICAgIGp0b3BvOiBbXSxcclxuICAgIHF0b3BvOiBbXVxyXG59O1xyXG4vKipcclxuICrojrflj5booqvpgInkuK3nmoTlhYPntKBcclxuICogQHJldHVybnMge0FycmF5fCp9XHJcbiAqL1xyXG5TY2VuZS5wcm90b3R5cGUuZ2V0U2VsZWN0ZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIganRvcG8gPSB0aGlzLmp0b3BvLnNlbGVjdGVkRWxlbWVudHM7XHJcbiAgICBpZiAoJC5pc0FycmF5KGp0b3BvKSkge1xyXG4gICAgICAgIGlmIChzZWxlY3RlZENhdGNoLmp0b3BvICE9IGp0b3BvKSB7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkQ2F0Y2guanRvcG8gPSBqdG9wbztcclxuICAgICAgICAgICAgc2VsZWN0ZWRDYXRjaC5xdG9wbyA9IFtdO1xyXG4gICAgICAgICAgICBqdG9wby5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsLnF0b3BvICYmIGVsLnF0b3BvLmdldFVzZVR5cGUoKSAhPSBRVG9wby5jb25zdGFudC5DQVNVQUwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZENhdGNoLnF0b3BvLnB1c2goZWwucXRvcG8pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNlbGVjdGVkQ2F0Y2gucXRvcG87XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIOmrmOS6ruebruagh+makOiXj+WFtuS7llxyXG4gKiBAcGFyYW0gdGFyZ2V0IOWPr+mAieWPguaVsCzmlbDnu4TmiJblr7nosaEs6auY5Lqu5YW255u45YWz5a+56LGhLOaXoOWPguWImeWFqOmDqOmrmOS6rlxyXG4gKiBAcGFyYW0gZmxhZyDlj6/pgInlj4LmlbDvvIzoi6XkuLp0cnVl5YiZ5Y+q6auY5Lqu5Lyg5YWl55qE5a+56LGhLOS4jemAieWImeWPquWvueS8oOWFpeWvueixoeebuOWFs+eahOWvueixoemrmOS6rlxyXG4gKi9cclxuU2NlbmUucHJvdG90eXBlLnRvZ2dsZUxpZ2h0ID0gZnVuY3Rpb24gKHRhcmdldCwgZmxhZykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICB2YXIgYWxwaGEgPSAxO1xyXG4gICAgICAgIHZhciBsaWdodGluZztcclxuICAgICAgICBpZiAodGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIGFscGhhID0gMC4xO1xyXG4gICAgICAgICAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCQuaXNBcnJheSh0YXJnZXQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlnaHRpbmcgPSB0YXJnZXQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxpZ2h0aW5nID0gW3RhcmdldF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJC5pc0FycmF5KHRhcmdldCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsaWdodGluZyA9IGdldENvbm5lY3Rpb25MaWdodGluZ3ModGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlnaHRpbmcgPSBnZXRDb25uZWN0aW9uTGlnaHRpbmdzKFt0YXJnZXRdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0b3RhbFNldEFscGhhKHRoaXMuY2hpbGRyZW4ubm9kZS5jb25jYXQodGhpcy5jaGlsZHJlbi5saW5rKSwgYWxwaGEpO1xyXG4gICAgICAgIHRvdGFsU2V0QWxwaGEobGlnaHRpbmcsIDEpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIFFUb3BvLnV0aWwuZXJyb3IoXCJzY2VuZSB0b2dnbGVMaWdodCBlcnJvclwiLCBlKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGdldENvbm5lY3Rpb25MaWdodGluZ3MoYXJyKSB7XHJcbiAgICAgICAgdmFyIGxpZ2h0aW5nID0gW107XHJcbiAgICAgICAgJC5lYWNoKGFyciwgZnVuY3Rpb24gKGksIHRhcmdldCkge1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmdldFR5cGUoKSA9PSBRVG9wby5jb25zdGFudC5OT0RFICYmIHRhcmdldC5nZXRVc2VUeXBlKCkgIT0gUVRvcG8uY29uc3RhbnQuQ0FTVUFMKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGlua3MgPSB0YXJnZXQubGlua3M7XHJcbiAgICAgICAgICAgICAgICBRVG9wby51dGlsLmFycmF5UHVzaChsaWdodGluZywgdGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIGlmIChsaW5rcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkLmlzQXJyYXkobGlua3Mub3V0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2gobGlua3Mub3V0LCBmdW5jdGlvbiAobCwgb3V0bGluaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUVRvcG8udXRpbC5hcnJheVB1c2gobGlnaHRpbmcsIG91dGxpbmspO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUVRvcG8udXRpbC5hcnJheVB1c2gobGlnaHRpbmcsIG91dGxpbmsucGF0aC5lbmQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQuaXNBcnJheShsaW5rcy5pbikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGxpbmtzLmluLCBmdW5jdGlvbiAobiwgaW5saW5rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBRVG9wby51dGlsLmFycmF5UHVzaChsaWdodGluZywgaW5saW5rKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFUb3BvLnV0aWwuYXJyYXlQdXNoKGxpZ2h0aW5nLCBpbmxpbmsucGF0aC5zdGFydCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBsaWdodGluZztcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB0b3RhbFNldEFscGhhKHRvdGFsLCBhbHBoYSkge1xyXG4gICAgICAgIC8v5YWo6YOo6ZqQ6JePXHJcbiAgICAgICAgaWYgKCQuaXNBcnJheSh0b3RhbCkpIHtcclxuICAgICAgICAgICAgJC5lYWNoKHRvdGFsLCBmdW5jdGlvbiAoaSwgZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zZXQoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFscGhhOiBhbHBoYVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuU2NlbmUucHJvdG90eXBlLm1vdmVUb05vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgLy8g5p+l6K+i5Yiw55qE6IqC54K55bGF5Lit5pi+56S6XHJcbiAgICBpZiAodGhpcy5jaGlsZHJlbi5ub2RlLmluZGV4T2Yobm9kZSkgPiAtMSkge1xyXG4gICAgICAgIHZhciBsb2NhdGlvbiA9IG5vZGUuanRvcG8uZ2V0Q2VudGVyTG9jYXRpb24oKTtcclxuICAgICAgICB0aGlzLnJlc2l6ZSgxKTtcclxuICAgICAgICB0aGlzLmp0b3BvLnNldENlbnRlcihsb2NhdGlvbi54LCBsb2NhdGlvbi55KTtcclxuICAgICAgICAvLyDpl6rng4Hlh6DkuItcclxuICAgICAgICBub2RlRmxhc2gobm9kZS5qdG9wbywgNSk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBub2RlRmxhc2gobm9kZSwgbnVtKSB7XHJcbiAgICAgICAgaWYgKCQuaXNOdW1lcmljKG51bSkpIHtcclxuICAgICAgICAgICAgaWYgKG51bSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBub2RlLnNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBub2RlLnNlbGVjdGVkID0gIW5vZGUuc2VsZWN0ZWQ7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlRmxhc2gobm9kZSwgbnVtIC0gMSk7XHJcbiAgICAgICAgICAgICAgICB9LCAzMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG4vLy0tLS0tLS0tLeiHquWKqOW4g+WxgFxyXG4vKipcclxuICog6Ieq5Yqo5biD5bGAXHJcbiAqIEBwYXJhbSBjb25maWcg5Y+C5pWwXHJcbiAqL1xyXG5TY2VuZS5wcm90b3R5cGUuYXV0b0xheW91dCA9IGZ1bmN0aW9uIChjb25maWcpIHtcclxuICAgIGlmIChjb25maWcgJiYgY29uZmlnLnR5cGUpIHtcclxuICAgICAgICB2YXIgbmVlZFNvcnQgPSBbXTtcclxuICAgICAgICB2YXIganRvcG9zID0gW107XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5ub2RlLmZvckVhY2goZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICAgICAgaWYgKCF2LnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgbmVlZFNvcnQucHVzaCh2KTtcclxuICAgICAgICAgICAgICAgIGp0b3Bvcy5wdXNoKHYuanRvcG8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc3dpdGNoIChjb25maWcudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwicm91bmRcIjpcclxuICAgICAgICAgICAgICAgIGxheW91dF9yb3VuZCh0aGlzLmp0b3BvLCBqdG9wb3MpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJkZWZhdWx0XCI6XHJcbiAgICAgICAgICAgICAgICBsYXlvdXRfZGVmYXVsdChuZWVkU29ydCwgcGFyc2VJbnQoY29uZmlnLnJvd3MpLCBwYXJzZUludChjb25maWcucm93U3BhY2UpLCBwYXJzZUludChjb25maWcuY29sdW1uU3BhY2UpLCB0aGlzLmdldE9yaWdpbigpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuZnVuY3Rpb24gbGF5b3V0X3JvdW5kKHNjZW5lLCBqdG9wb3MpIHtcclxuICAgIEpUb3BvLmxheW91dC5jaXJjbGVMYXlvdXROb2RlcyhqdG9wb3MsIHthbmltYXRlOiB7dGltZTogMTAwMH19KTtcclxufVxyXG5mdW5jdGlvbiBsYXlvdXRfZGVmYXVsdChlbGVtZW50cywgcm93cywgcm93U3BhY2UsIGNvbHVtblNwYWNlLCBiZWdpbikge1xyXG4gICAgaWYgKCQuaXNOdW1lcmljKHJvd3MpKSB7XHJcbiAgICAgICAgcm93cyA9IHBhcnNlSW50KHJvd3MpO1xyXG4gICAgICAgIGlmIChyb3dzIDwgMSkge1xyXG4gICAgICAgICAgICByb3dzID0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgJC5lYWNoKGVsZW1lbnRzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldERlZ3JlZShiKSAtIGdldERlZ3JlZShhKTtcclxuICAgICAgICB9KSwgZnVuY3Rpb24gKGksIHYpIHtcclxuICAgICAgICAgICAgLy92LnNldExvY2F0aW9uKGJlZ2luLnggKyAoaSAlIHJvd3MpICogY29sdW1uU3BhY2UsIGJlZ2luLnkpO1xyXG4gICAgICAgICAgICBtb3ZlKHYsIGJlZ2luLnggKyAoaSAlIHJvd3MpICogY29sdW1uU3BhY2UsIGJlZ2luLnkpO1xyXG4gICAgICAgICAgICBpZiAoKGkgKyAxKSAlIHJvd3MgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgYmVnaW4ueSArPSByb3dTcGFjZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbi8vLS0tLS0tLeW3peWFt+WHveaVsFxyXG4vL+iOt+WPluiKgueCueeahOW6plxyXG5mdW5jdGlvbiBnZXREZWdyZWUobm9kZSkge1xyXG4gICAgdmFyIGluTGlua3MgPSBub2RlLmxpbmtzLmluO1xyXG4gICAgdmFyIG91dExpbmtzID0gbm9kZS5saW5rcy5vdXQ7XHJcbiAgICB2YXIgZGVncmVlID0gMDtcclxuICAgIGlmIChpbkxpbmtzLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgZGVncmVlICs9IGluTGlua3NbMF0uYXR0ci5udW1iZXI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRlZ3JlZSArPSBpbkxpbmtzLmxlbmd0aDtcclxuICAgIH1cclxuICAgIGlmIChvdXRMaW5rcy5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgIGRlZ3JlZSArPSBvdXRMaW5rc1swXS5hdHRyLm51bWJlcjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZGVncmVlICs9IG91dExpbmtzLmxlbmd0aDtcclxuICAgIH1cclxuICAgIHJldHVybiBkZWdyZWU7XHJcbn1cclxuLy/np7vliqjliqjnlLtcclxuZnVuY3Rpb24gbW92ZShub2RlLCB0YXJnZXRYLCB0YXJnZXRZKSB7XHJcbiAgICB0YXJnZXRYID0gcGFyc2VJbnQodGFyZ2V0WCk7XHJcbiAgICB0YXJnZXRZID0gcGFyc2VJbnQodGFyZ2V0WSk7XHJcbiAgICB2YXIgeCA9IG5vZGUuYXR0ci5wb3NpdGlvblswXTtcclxuICAgIHZhciB5ID0gbm9kZS5hdHRyLnBvc2l0aW9uWzFdO1xyXG4gICAgdmFyIHBhcnRYID0gcGFyc2VJbnQoKHRhcmdldFggLSB4KSkgLyAxMDtcclxuICAgIHZhciBwYXJ0WSA9IHBhcnNlSW50KCh0YXJnZXRZIC0geSkpIC8gMTA7XHJcbiAgICB2YXIgcGFydCA9IDA7XHJcbiAgICB2YXIgdGVtcCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoTWF0aC5hYnModGFyZ2V0WCAtIHgpID4gMSkge1xyXG4gICAgICAgICAgICB4ICs9IHBhcnRYO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoTWF0aC5hYnModGFyZ2V0WSAtIHkpID4gMSkge1xyXG4gICAgICAgICAgICB5ICs9IHBhcnRZO1xyXG4gICAgICAgIH1cclxuICAgICAgICBub2RlLnNldFBvc2l0aW9uKFtwYXJzZUludCh4KSwgcGFyc2VJbnQoeSldKTtcclxuICAgICAgICBwYXJ0Kys7XHJcbiAgICAgICAgaWYgKE1hdGguYWJzKHRhcmdldFggLSB4KSA8PSAxICYmIE1hdGguYWJzKHRhcmdldFkgLSB5KSA8PSAxKSB7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGVtcCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXJ0ID49IDEwKSB7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGVtcCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSwgMTAwKTtcclxufVxyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2RldmVsb3AvY29yZS9TY2VuZS5qc1xuLy8gbW9kdWxlIGlkID0gOVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwic291cmNlUm9vdCI6IiJ9');
}});