<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>develop\core\element\link\Direct.js - Documenting JavaScript with YUIDoc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="Documenting JavaScript with YUIDoc" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/[C] Container.html">[C] Container</a></li>
                                <li><a href="../classes/[E] Element.html">[E] Element</a></li>
                                <li><a href="../classes/[L] Link.html">[L] Link</a></li>
                                <li><a href="../classes/[LE] Line.html">[LE] Line</a></li>
                                <li><a href="../classes/[N] Node.html">[N] Node</a></li>
                                <li><a href="../classes/ImageNode.html">ImageNode</a></li>
                                <li><a href="../classes/option配置.html">option配置</a></li>
                                <li><a href="../classes/QTopo.html">QTopo</a></li>
                                <li><a href="../classes/QTopo.instance.html">QTopo.instance</a></li>
                                <li><a href="../classes/QTopo.util.html">QTopo.util</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/core.html">core</a></li>
                                <li><a href="../modules/QTopo.html">QTopo</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: develop\core\element\link\Direct.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var Link = require(&quot;./Link.js&quot;);
module.exports = {
    constructor: DirectLink,
    setDefault: setDefault,
    getDefault: getDefault
};
//-
var DEFAULT = {
    number: 1,
    alpha: 1,
    color: &#x27;22,124,255&#x27;,
    arrow: {
        size: 10,
        offset: 0,
        start: false,
        end: false
    },
    jsonId:&quot;&quot;,
    gap: 20,
    width: 3,
    dashed: null,
    zIndex: 100,
    font: {
        size: 16,
        type: &quot;微软雅黑&quot;,
        color: &#x27;255,255,255&#x27;
    },
    expendAble: true,
    useType: QTopo.constant.link.DIRECT,
    bundleOffset: 60// 多条直线时，线条折线拐角处的长度
};
function setDefault(config) {
    QTopo.util.extend(DEFAULT, config || {});
}
function getDefault() {
    return QTopo.util.deepClone(DEFAULT);
}
//------
var jtopoReset={
    //双向箭头
    getStartPosition:function () {
        var a;
        return null != this.arrowsRadius &amp;&amp; (a = (function (self) {
            var b = self.nodeA, c = self.nodeZ;
            var d = JTopo.util.lineF(b.cx, b.cy, c.cx, c.cy);
            var e = b.getBound();
            return f = JTopo.util.intersectionLineBound(d, e);
        })(this)), null == a &amp;&amp; (a = {
            x: this.nodeA.cx,
            y: this.nodeA.cy
        }), a;
    },
    paintPath:function (a, b) {
        if (this.nodeA === this.nodeZ) return void this.paintLoop(a);
        a.beginPath(),
            a.moveTo(b[0].x, b[0].y);
        for (var c = 1; c &lt; b.length; c++) {
            null == this.dashedPattern ? (
                (null == this.PointPathColor ? a.lineTo(b[c].x, b[c].y) : a.JtopoDrawPointPath(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, a.strokeStyle, this.PointPathColor))
            ) : a.JTopoDashedLineTo(b[c - 1].x, b[c - 1].y, b[c].x, b[c].y, this.dashedPattern)
        }
        if (a.stroke(), a.closePath(), null != this.arrowsRadius) {
            if (this.qtopo.attr.arrow.end) {
                this.paintArrow(a, b[0], b[b.length - 1]);
            }//终点箭头
            if (this.qtopo.attr.arrow.start) {
                this.paintArrow(a, b[b.length - 1], b[0]);
            }//起点箭头
        }
    }
};
//------
//-
function DirectLink(config) {
    if (!config.start || !config.end || !config.start.jtopo || !config.end.jtopo) {
        QTopo.util.error(&quot;Create Link need start and end&quot;);
        return;
    }
    this.attr = QTopo.util.extend(getDefault(), config || {});
    Link.call(this, new JTopo.Link(config.start.jtopo, config.end.jtopo));
    //函数
    this.set = setJTopo;
    //初始化
    this.set(this.attr);
    //源码修改
    reset(this);
}
QTopo.util.inherits(DirectLink, Link);
function setJTopo(config) {
    if (config) {
        var self = this;
        self._setAttr(config);
    }
}
function reset(link) {
    link.jtopo.getStartPosition = jtopoReset.getStartPosition;
    link.jtopo.paintPath = jtopoReset.paintPath;
}
DirectLink.prototype.setBundleOffset = function (bundleOffset) {
    if ($.isNumeric(bundleOffset)) {
        this.jtopo.bundleOffset = parseInt(bundleOffset);
    }
    this.attr.bundleOffset = this.jtopo.bundleOffset;
};
DirectLink.prototype.getDefault = getDefault;
DirectLink.prototype.openToggle = function (scene) {
    this.attr.expendAble = true;
    var jtopo = scene.jtopo;
    /**
     * 直线切换
     * @param flag 为true则展开为false则缩放，无值则根据现状切换,
     */
    this.toggle = function (flag) {
        var todo = !(this.getUseType() == QTopo.constant.CASUAL &amp;&amp; this.parent);
        if (typeof flag == &quot;boolean&quot; &amp;&amp; (flag ^ todo)) {
            return;
        }
        if (todo) {
            //展开
            //复制属性
            if (this.attr.number &gt; 1 &amp;&amp; this.attr.expendAble) {
                var childSet = QTopo.util.deepClone(this.attr);
                childSet.start = this.path.start;
                childSet.end = this.path.end;
                childSet.useType = QTopo.constant.CASUAL;
                childSet.number = 1;
                var parent = {
                    attr: this.attr,
                    extra: this.extra,
                    path: this.path,
                    addChild: function (num) {
                        if ($.isNumeric(num)) {
                            num = parseInt(num);
                            for (var i = 0; i &lt; num; i++) {
                                var link = scene.createLink(childSet);
                                parent.children.push(link);
                                link.parent = parent;
                                link.extra = parent.extra;
                            }
                        }
                    },
                    children: []
                };
                scene.remove(this);
                parent.addChild(parent.attr.number);
            }
        } else {
            //聚合
            var father = this.parent;
            scene.remove(father.children);
            var config = father.attr;
            config.start = father.path.start;
            config.end = father.path.end;
            scene.createLink(config).extra = father.extra;
        }
    };
};
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
