<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>develop\core\element\container\Container.js - Documenting JavaScript with YUIDoc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="Documenting JavaScript with YUIDoc" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Element.html">Element</a></li>
                                <li><a href="../classes/option配置.html">option配置</a></li>
                                <li><a href="../classes/QTopo.html">QTopo</a></li>
                                <li><a href="../classes/QTopo.instance.html">QTopo.instance</a></li>
                                <li><a href="../classes/QTopo.util.html">QTopo.util</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/core.html">core</a></li>
                                <li><a href="../modules/QTopo.html">QTopo</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: develop\core\element\container\Container.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var Element = require(&quot;../Element.js&quot;);
module.exports = Container;
var jtopoReset = {
    paintText: function (a) {
        var text = this.text;
        if (null != text &amp;&amp; &quot;&quot; != text) {
            a.beginPath();
            a.font = this.font;
            var fontWidth = a.measureText(&quot;田&quot;).width;
            var maxWidth = fontWidth;
            a.fillStyle = &quot;rgba(&quot; + this.fontColor + &quot;,1)&quot;; //&quot;, &quot; + this.alpha + &quot;)&quot;;名称永远不透明
            //换行检测
            var texts = text.split(&quot;\n&quot;);
            for (var i = 0; i &lt; texts.length; i++) {
                var width = a.measureText(texts[i]).width;
                if (width &gt; maxWidth) {
                    maxWidth = width;
                }
            }
            var e = this.getTextPostion(this.textPosition, maxWidth, fontWidth,texts.length);
            for (var j = 0; j &lt; texts.length; j++) {
                var textWidth = a.measureText(texts[j]).width;
                a.fillText(texts[j], e.x + (maxWidth - textWidth) / 2, e.y + j * fontWidth);
            }

            a.closePath();
        }
    }
};
function Container(jtopo) {
    if (jtopo) {
        Element.call(this, jtopo);
    } else {
        QTopo.util.error(&quot;create Container without jtopo&quot;, this);
    }
    this.children = [];
    this.links = {
        in: [],
        out: []
    };
    reset(this);
}
QTopo.util.inherits(Container, Element);
function reset(element) {
    element.jtopo.paintText = jtopoReset.paintText;
}
Container.prototype.setName = function (name) {
    if (name) {
        if (this.attr.namePosition != &quot;hide&quot;) {
            this.jtopo.text = name.trim();
        }
        this.attr.name = name.trim();
    }
};
/**
 * 将元素加入分组内
 * @param element
 */
Container.prototype.add = function (element) {
    var self=this;
    if (!$.isArray(this.children)) {
        this.children = [];
    }
    if ($.isArray(element)) {
        $.each(element,function(i,el){
            addOnce(el);
        });
    }else{
        addOnce(element);
    }
    function addOnce(element){
        if (element&amp;&amp;check(element)&amp;&amp;!self.isChild(element)) {
            self.children.push(element);
            element.parent = self;
            self.jtopo.add(element.jtopo);
            if (self.attr.children &amp;&amp; typeof self.attr.children.dragble == &quot;boolean&quot;) {
                //若分组不允许移动组内元素，手动设置元素不可移动
                element.setDragable(self.attr.children.dragble);
            }
        }
    }
    function check(element){
        return element.getType()==QTopo.constant.NODE&amp;&amp;element.getUseType()!=QTopo.constant.CASUAL&amp;&amp;!element.parent;
    }
};
/**
 * 将子元素从分组中删除
 * @param element
 */
Container.prototype.remove = function (element) {
    if ($.isArray(this.children) &amp;&amp; this.isChild(element)) {
        this.children.splice(this.children.indexOf(element), 1);
        delete element.parent;
        this.jtopo.remove(element.jtopo);
        //移除元素，应手动设回元素可移动
        element.setDragable(true);
    }
};
Container.prototype.getChildren = function () {
    var children = [];
    var self = this;
    if (self.jtopo &amp;&amp; self.jtopo.childs) {
        $.each(self.jtopo.childs, function (i, v) {
            if (v.qtopo) {
                children.push(v.qtopo);
            } else {
                QTopo.util.error(this, &quot;the child not wraped by qtopo&quot;, v);
            }
        });
    }
    this.children = children;
    return children;
};
Container.prototype.getType = function () {
    return QTopo.constant.CONTAINER;
};
Container.prototype.setColor = function (color) {
    if (color) {
        color = QTopo.util.transHex(color.toLowerCase());
        this.jtopo.fillColor = color;
    }
    this.attr.color = this.jtopo.fillColor;
};
Container.prototype.setChildren = function (children) {
    var jtopo = this.jtopo;
    if (children) {
        if (typeof children.dragble == &quot;boolean&quot;) {
            this.jtopo.childDragble = children.dragble;
            for (var i = 0; i &lt; this.children.length; i++) {
                this.children[i].setDragable(children.dragble);
            }
        }
    }
    this.attr.children.dragble = jtopo.childDragble;
};
/**
 * 分组切换,在scene创建分组时可选是否提供切换，若无切换节点，该方法无动作
 * @param flag 为true则缩放为false则展开，无值则根据现状切换,
 */
Container.prototype.toggle = function (flag) {
    if (this.toggleTo) {
        var gJtopo = this.jtopo;
        var nJtopo = this.toggleTo.jtopo;
        var todo = typeof flag == &quot;boolean&quot; ? flag : gJtopo.visible;
        if (todo) {
            //缩放
            this.hide();
            this.toggleTo.show();
            this.toggleTo.setPosition([gJtopo.cx - nJtopo.width / 2, gJtopo.cy - nJtopo.height / 2]);
        } else {
            //展开
            this.show();
            this.toggleTo.hide();
            this.setPosition([nJtopo.cx - gJtopo.width / 2, nJtopo.cy - gJtopo.height / 2]);
        }
    }
};
/**
 * 判断元素是否已是子元素
 * @param element 判断的子元素
 */
Container.prototype.isChild = function (element) {
    if ($.isArray(this.children)) {
        var index=this.children.indexOf(element);
        if (element.parent != this&amp;&amp; index&gt; -1) {
            QTopo.util.error(&quot;some group get error,the child&#x27;s parent is not it and the child in its children,index is &quot;+index, this,element);
        }
        return index&gt;-1;
    } else {
        return false;
    }
};
/**
 * 判断元素是否在分组覆盖的范围内,临时元素不考虑
 * @param element
 * @returns {boolean}
 */
Container.prototype.isInside = function (element) {
    if (element &amp;&amp; element.getType() != QTopo.constant.CASUAL) {
        var center = element.getCenterPosition();
        return !this.isChild(element) &amp;&amp; center.x &gt; this.x &amp;&amp; center.x &lt; (this.x + this.width) &amp;&amp; center.y &gt; this.y &amp;&amp; center.y &lt; (this.y + this.height);
    } else {
        return false;
    }
};
/**
 * 实例序列化
 */
Container.prototype.toJson=function(){
    var json=$.extend({},this.attr);
    json.extra=$.extend({},this.extra);
    json.children=[];
    this.children.map(function(child){
        json.children.push(child.get(&#x27;jsonId&#x27;));
    });
    json.toggle=this.toggleTo.toJson();
    return json;
};
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
